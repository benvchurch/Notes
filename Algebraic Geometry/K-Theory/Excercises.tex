\documentclass[12pt]{article}
\usepackage{import}
\import{./}{KCommands}

\renewcommand{\GL}{\mathrm{GL}}

\begin{document}

\tableofcontents

\section{Chapter 1.1}

\subsection{1.2}

Consider the following conditions on a ring $R$,
\begin{enumerate}
\item[(I)] $R$ satisfies the IBP (if $R^n \cong R^m$ then $n = m$).
\item[(II)] For all $m,n$ and $P$ if $R^m \cong R^n \oplus P$ then $m \ge n$.
\item[(III)] For all $n$ and $P$ if $R^n \cong R^n \oplus P$ then $P = 0$
\end{enumerate}
We will show (III) $\implies$ (II) $\implies$ (I). First suppose $R$ satisfies (III) and consider the situation that $R^m \cong R^n \oplus P$ and $m < n$. We can add $R^{n - m}$ to each side to get,
\[ R^n \cong R^n \oplus (P \oplus R^{n - m}) \]
then applying (III) we find $P \oplus R^{n - m} = 0$ a contradiction proving (II). 
\bigskip\\
Now assume property (II) and suppose that $R^m \cong R^n$. By applying (II) in the case $P = 0$ we find $m \ge n$ and $n \ge m$ and thus $m = n$ proving the IBP i.e. property (I). 

\subsection{1.3}

We need to show that the following conditions on a ring $R$ are equivalent,
\begin{enumerate}
\item For all $n$, every surjection $R^n \to R^n$ is an isomorphism.
\item For all $n$, and $f, g \in M_n(R)$ if $f g = \id$ then $g f = \id$ and $g \in \GL_n(R)$.
\item For all $n$ and $P$ if $R^n \cong R^n \oplus P$ then $P = 0$.
\end{enumerate}

First suppose property (a) and let $f g = \id$ for $f, g \in M_n(R) = \End{R^n}$. Since $f g = \id$ the map $g : R^n \to R^n$ is surjective and thus an isomorphism by property (a). so we find that $g \in \GL_n(R)$ and there is some $h \in \GL_n(R)$ such that $g h = hg = \id$. However,
\[ f g h = (fg)h = h = f (gh) = f \]
so $h = f$ and thus $fg = gf = \id$ proving (b).
\bigskip\\
Now suppose (b) holds and suppose we have the situation $R^n \cong R^n \oplus P$. Then consider the maps $\iota : R^n \to R^n \oplus P$ and $\pi : R^n \oplus P$ which satisfiy $\pi \circ \iota = \id$. Now let $f : R^n \to R^n \oplus P$ be the given isomorphism then define $\tilde{\iota} = f^{-1} \circ \iota : R^n \to R^n$ and $\tilde{\pi} = \pi \circ f : R^n \to R^n$ and thus $\tilde{\pi} \circ \tilde{\iota} = \id$ and $\tilde{\pi}, \tilde{\iota} \in \End{R^n} = M_n(R)$.
Thus by (b), $\tilde{\iota} \circ \tilde{\pi} = \id$ so $\tilde{\iota} = f^{-1} \circ \iota$ is an isomorphism which implies that $\iota : R^n \to R^n \oplus P$ is an isomorphism (since $f^{-1}$ is) and thus $P = 0$ proving (c).
\bigskip\\
Finally, suppose (c) and suppose that $f : R^n \to R^n$ is a surjection. Then consider the exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \ker{f} \arrow[r] & R^n \arrow[r] & R^n \arrow[r] & 0
\end{tikzcd}
\end{center}
Then $R^n$ is free and thus projective so the sequence is split,
\[ R^n \cong R^n \oplus \ker{f} \]
so by (c) we have $\ker{f} = 0$ and thus $f$ is an isomorphism proving (a).
\bigskip\\
Finally suppose that $R$ is commutative and $f,g \in M_n(R)$ with $fg = \id$. Then $\det{fg} = \det{f} \det{g} = 1$ so $f,g \in \GL_n(R)$ and thus there exists a matrix (coefactors) $h$ such that $gh = \id$ then $f = h$ by a previous argument. Therefore commutative rings satisfy all the above properties. 

\subsection{1.7}

(NO IDEA)

\subsection{1.8}

(NO IDEA)

\subsection{1.9}

(NO IDEA)

\section{Chapter 1.2}

\begin{remark}
In this section $R$ is a commutative (unital) ring. 
\end{remark}

\subsection{2.2}

\subsection{2.4}

Consider a continuous function $f : \Spec{R} \to \Z$. First, $\Spec{R}$ is quasi-compact. This is easily shown since every affine cover $U_i$ can be refined to a cover by principal opens $D(f_i)$ then,
\[ \Spec{R} = \bigcup_{i = 1}^\infty D(f_i) = D( \left< f_i \right> ) \]
(since $f_i \notin \p$ for some $f_i$ iff $\left< f_i \right> \not\supset \p$) and thus $\left< f_i \right> = R$ (otherwise it would be contained in a maximal ideal) but then $1 = r_1 f_1 + \cdots + r_n f_n$ for finitely many so,
\[ \Spec{R} = D(\left< f_1, \dots, f_n \right>) = \bigcup_{ i = 1}^n D(f_i) \]
so there is a finite subcover of $U_i$. 
\bigskip\\
Therefore, $f(\Spec{R}) \subset \Z$ is compact and thus finite so it must take finitely many values $n_1, \dots, n_c$. Then $V_i = f^{-1}(n_i)$ is a closed subset of $\Spec{R}$ since $\Z$ is discrete. 
\bigskip\\
If $R$ is not reduced then consider $R_{\red} = R / \nilrad{R}$ and $\Spec{R} \cong \Spec{R_{\red}}$ naturally so we may assume that $R$ is reduced and we may use idempotent lifitng (2.2). 
\bigskip\\
Since $V_i$ is closed $V_i = V(I_i)$ for some ideal $I_i \subset R$. Furthermore,
\[ \Spec{R} = \bigcup_{i = 1}^n V_i = \bigcup_{i = 1}^n V(I_i) = \bigcup_{i = 1}^n V(I_n) = V(I_1 \cdots I_n) \]
Thus $\sqrt{I_1 \cdots I_n} = \nilrad{R} = (0)$ so $I_1 \cdots I_n = (0)$. Furthermore, the $V_i$ are disjoint so,
\[ \varnothing = V_i \cap V_j = V(I_i) \cap V(I_j) = V(I_i + I_j) \]
and thus $I_i + I_j = R$ so the ideals $I_i$ and $I_j$ are coprime. Therefore, by CRT,
\[ R = R/(0) = R / (I_1 \cdots I_n) = (R / I_1) \times \cdots \times (R / I_n) \]
since these ideals are pairwise coprime. (Note, there is an error in the text, it has these two conditions backwards). 

\subsection{2.5}

Conisder the following properties,
\begin{enumerate}
\item $\Spec{R}$ is connected.
\item Every finitely generated projective $R$-module has constant rank.
\item $R$ has no idempotent elements except $0$ and $1$.
\end{enumerate}
I claim that these are equivalent. 
\bigskip\\
See the background material in Appendix A, but for any finitely-generated projective module
If $\Spec{A}$ is connected then since $\rank(P)$ is continuous (see Appendix) then then its image must be connected in $\Z$ and thus constant.
\bigskip\\
Suppose $e \in R$ were a nontrivial idepotent. Then consider the module $P = (e)$ which I claim is f.g. (obvious) and projective. It suffices to show that $P$ is free on some open cover. On the open set $D(e)$ we have $P_e \cong R_e$ so $P$ is free on $D(e)$ of rank $1$. Furthermore, on the open set $D(1 - e)$ we have $P_{1 - e} = (e)_{1 - e} = (0)$ since $e^2 = e$ and thus $P$ is free of rank $0$. Since $e + (1 - e) = 1$ these open sets cover $\Spec{R}$. Therefore $P$ is f.g. projective but does not have finite rank. Thus (b) $\implies$ (c).
\bigskip\\
Finally, if $\Spec{R}$ is not connected then we can write $\Spec{R} = V(I) \cup V(J)$ for two nontrivial disjoint closed sets in which case $IJ = (0)$ and $I + J = R$. Thus by CRT, $R = (R / I) \times (R / J)$. However, the element $(1, 0)$ in this product is a nontrivial idempotent in the ring. Thus (c) $\implies$ (a). 

\subsection{2.8}

\subsection{2.10}

Let $P, Q$ be $R$-modules and $P \otimes_R Q \cong R^n$ for $n > 0$. Then $P$ and $Q$ are f.g. projective $R$-modules. 

\begin{proof}
(DO)
\end{proof}

\subsection{2.11}

Let $M$ be a finitely generated module over a commuative ring $R$. I claim that the following are equivalent for every $n$,
\begin{enumerate}
\item $M$ is f.g. projective of constant rank $n$
\item $M_\p \cong R^n_\p$ for every prime ideal $\p$ of $R$.
\end{enumerate}
Clearly (a) $\implies$ (b) so we assume that $M_\p \cong R^n_\p$ at each prime $\p$. By Lemma 2.4 it suffices to show that $M$ is finitely presented since then freeness of the stalks implies projectivity and $M$ is automatically of constant rank $n$ by definition. 
\bigskip\\
Lift the basis map $R_\p^n \to M_\p^n$ to a map $f : R^n \to M$ by clearing denominators. Now consider the exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \ker{f} \arrow[r] & R^n \arrow[r] & M \arrow[r] & \coker{f} \arrow[r] & 0
\end{tikzcd}
\end{center}
Since $M$ is finitely generated then so is $\coker{f}$. Furthermore, when we localize at $\p$ we get,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & (\ker{f})_\p \arrow[r] & R^n_\p \arrow[r] & M_\p \arrow[r] & (\coker{f})_\p \arrow[r] & 0
\end{tikzcd}
\end{center}
but we know $R^n_\p \to M_\p$ is an isomorphism so $(\coker{f})_\p = (\ker{f})_\p = 0$. Since $\coker{f}$ is f.g. there exists $g \in R$ such that $(\coker{f})_g = 0$. Then localizing at $g$ instead we find,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & (\ker{f})_g \arrow[r] & R_g^n \arrow[r] & M_g \arrow[r] & 0
\end{tikzcd}
\end{center}
Then for any prime $\q \in D(g)$ we may localize again to find,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & (\ker{f})_\q \arrow[r] & R_\q^n \arrow[r] & M_\q \arrow[r] & 0
\end{tikzcd}
\end{center}
so $R_\q^n \to M_\q$ is a surjection. However, my assumeption $M_\q$ is free of rank $n$ and $R$ is commutative so by 1.3 property (a). we know $R_\q^n \to M_\q$ is an isomorphism and thus $\ker{f}_\q = 0$. Therefore $(\ker{f})_g$ is an $A_g$-module with empty support so $\ker{f}_g = 0$. Therefore, $M_g \cong R_g^n$ so $M$ is locally free and thus projective.
\bigskip\\
Therefore, suppose that $M$ is finitely generated free at each stalk with $\rank(M)$ continuous. Then $\Spec{R}$ has a finite open cover $U_i = (\rank(M))^{-1}(n_i)$ such that $M|_{U_i}$ is f.g. with $M_\p = R_\p^{n_i}$ for fixed $n_i$ on each $U_i$. Thus we have shown that $M$ is locally free on $U_i$ and thus locally free on $\Spec{R}$ and thus projective. Conversely if $M$ is f.g. projective then we know (by Lemma 2.4) that $M$ is locally free and thus $M_\p \cong R_\p^{n_\p}$ and has continuous rank funciton.   


\subsection{2.12}

Let $\phi : R \to S$ be a morphism of rings then let $f = \phi^{-1} : \Spec{S} \to \Spec{R}$ be the associated morphism of affine schemes. Now there is a functor,
\[ f^* : \QCoh{\Spec{R}} \to \QCoh{\Spec{S}} \] given explicitly by $M \mapsto M \otimes_R S$. I claim that if $P$ is f.g. projective then $f^* P$ is f.g. projective. This is clear using the following property and noting that $(-) \otimes_R S$ is left adjoint to restriction of an $S$ module to an $R$ module which is clearly exact.

\begin{lemma}
If a functor $F : \C \to \D$ is left adjoint to $G : \D \to \C$ between abelian categories and $G$ is exact then $F$ preserves projectives. 
\end{lemma}

\begin{proof}
$F(P)$ is projective iff $\Hom{\C}{F(P)}{-}$ is exact but,
\[ \Hom{\D}{F(P)}{-} \cong \Hom{\C}{P}{G(-)} \] which is exact since $G$ and $\Hom{\C}{P}{-}$ are for projective $P$. 
\end{proof}

Now I claim that $\rank(f^* P) = \rank(P) \circ f$. This is because,
\[ (f^* P) \otimes_{S_\p} \kappa(\p) = P \otimes_R S \otimes_{S_\p} \kappa(\p) = P \otimes_R \kappa(\p) \]
Via the map $R \to S \to \kappa(\p)$. Now we get an inclusion of fields, $\kappa(f(\p)) \to \kappa(\p)$ which $R \to \kappa(\p)$ factors through. Thus,
\[ P \otimes_R \kappa(\p) = P \otimes_R \kappa(f(\p)) \otimes_{\kappa(f(\p))} \kappa(\p) \]
In particular, these vectorspaces have equal rank i.e.
\begin{align*}
\rank_\p(f^* P) & = \dim_{\kappa(\p)} (P \otimes_R \kappa(\p)) = \dim_{\kappa(\p)} (P \otimes_R \kappa(f(\p)) \otimes_{\kappa(f(\p))} \kappa(\p)) 
\\
& = \dim_{\kappa(f(\p))} (P \otimes_R \kappa(f(\p)) = \rank_{f(\p)}(P) 
\end{align*}

\subsection{2.16}

\newcommand{\R}{\mathcal{R}}

Fix a small category of rings $\R$. A big projective $R$-module is a choice of a finitely generated projective $S$-module $P_S$ for each $S$ over $R$ in $\R$ equiped with an isomrophism $P_S \otimes_S T \to P_T$ for every $S \to Y$ over $R$ which satisfies the following properties,
\begin{enumerate}
\item the identity $\id : S \to S$ induces $\id : P_S \to P_S$
\item to each commutative triangle of $R$-algebras we have a commutative triangle of modules.
\end{enumerate}
Now let $\mathbb{P}'(R)$ denote the category of big $R$-modules and $\mathbb{P}'(R) \to \mathbb{P}(R)$ be the forgetful functor sending $P$ to $P_R$. 
(FINISH THIS)

\section{Chapter 1.3}

\begin{remark}
Here $R$ is a commutative (unital) ring. 
\end{remark}

\subsection{3.1}

We need to show that the following are equivalent properties of an $R$-module $L$,
\begin{enumerate}
\item there is an $R$-module $M$ such that $L \otimes M \cong R$
\item $L$ is an algebraic line bundle (a f.g. projective module of constant rank $1$)
\item $L$ is a finitely generated $R$-module and $L_\p \cong R_\p$ for each prime $\p$.
\end{enumerate}

\begin{proof}
Assuming (a) then by 2.10 we have $L$ and $M$ are finitely generated projective. Thus $L_\p \cong R_\p^n$ and $M_\p \cong R_\p^m$ for some $n,m$ but then $L_\p \otimes_{R_\p} M_\p \cong R_{\p}^{mn}$ so $m = n = 1$ proving (b).
\bigskip\\
(b) $\implies$ (c) is a trivial consequence of Lemma 2.4.
\bigskip\\
Finally assume (c) then I claim that $L \otimes_R L^\vee \cong R$ where $L^\vee = \Hom{R}{L}{R}$. First, not there is a natural map $L \otimes L^\vee \to R$ by evaluation. We may check this map is an isomorphism locally on stalks,
\[ L_\p \otimes \Hom{R_\p}{L_\p}{R_\p} \to R_\p \]
(note that $(\Hom{R}{L}{R})_\p = \Hom{R_\p}{L_\p}{R_\p}$ holds since $L$ is finitely presented which holds because it is f.g. projective using criterion (4) proved in 2.11). However, $L_\p \cong R_\p$ so this above map is clearly an isomorphism with $1 \otimes \id \mapsto 1$.  
\end{proof}

\subsection{3.4}

\subsection{3.15}

\subsection{3.18}

Consider the following sequence,
\begin{center}
\begin{tikzcd}
1 \arrow[r] & \Pic{R} \arrow[r] & \Pic{R[t]} \times \Pic{R[t^{-1}]} \arrow[r] & \Pic{R[t, t^{-1}]} 
\end{tikzcd}
\end{center}
the first map is induced by the inclusions $R \to R[t]$ and $R[t^{-1}]$ and the second by the difference of the maps induced by the inclusion $R[t] \to R[t, t^{-1}]$ and $R[t^{-1}] \to R[t, t^{-1}]$. Since $\Pic{-}$ is a covariant functor on the category of commutative rings the above sequence is a complex since,
\begin{center}
\begin{tikzcd}
R \arrow[r] & R[t] \times R[t^{-1}] \arrow[r] & R[t, t^{-1}]
\end{tikzcd}
\end{center}
is exact (this is the computation showing that $\Gamma(\P^1_R, \struct{\P^1_R}) = R$). 
\bigskip\\
Now, given $P \in \Pic{R[t]}$ and $Q \in \Pic{R[t^{-1}]}$ suppose that $P \otimes_{R[t]} R[t, t^{-1}]$ and $Q \otimes_{R[t^{-1}]} R[t, t^{-1}]$ are isomorphic as $R[t, t^{-1}]$-modules.

(USE UNITS-PIC sequence and snake lemma)

\section{Chapter 2.1}

\subsection{2.1}

\subsection{2.2}

\subsection{2.3}

\section{Chapter 2.3}

\subsection{3.3}

\subsection{3.4}

\subsection{3.5}

\subsection{3.7}

\section{Chapter 2.4}

\subsection{4.2}

\section{Chapter 2.5}

\subsection{5.2}

\subsection{5.7}

\subsection{5.8}

\section{Chapter 2.6-8}

\section{Appendix A. Rank Functions}

\begin{remark}
Here $R$ is a commutative (unital) ring. 
\end{remark}

\begin{definition}
Let $M$ be an $R$-module. Then there is a function $\rank(M) : \Spec{R} \to \Z$ defined by $x \mapsto \rank_\p(M) = \dim_{\kappa(\p)}(M_\p \otimes_{R_\p} \kappa(\p))$. 
\end{definition}

\begin{proposition}
$\rank_\p(M)$ is the minimal number of generators of $M_p$ as an $R_\p$-module.
\end{proposition}

\begin{proof}
If $M_\p$ is generated by $m_1, \dots, m_n$ then $M_\p \otimes_R \kappa(\p) = M_\p / \p M_\p$ is generated by $\bar{m}_1, \dots, \bar{m}_n$ over $\kappa(\p) = R_\p / \p R_\p$ since surjectivity of $R_\p^n \to M_\p$ is preserved after applying $(-) \otimes_R \kappa(\p)$. Thus, $\rank_\p(M) = \dim_{\kappa(\p)} M_\p \otimes_{R_\p} \kappa(\p) \le n$. 
\bigskip\\
Now suppose that $v_1, \dots, v_n$ is a $\kappa(\p)$-basis of $M_\p \otimes_{R_\p} \kappa(\p) = M_\p / \p M_\p$ then choose a lifts $m_1, \dots, m_n \in M_\p$. I claim that $m_1, \dots, m_n$ generated $M_\p$ as an $R_\p$-module. Let $N \subset M_\p$ be the $R_\p$-submodule generated by the $m_1, \dots, m_n$ and let $K = M_\p / N$. Then I claim that $\p K = K$. To see this it suffices to show that $K \subset \p K$. For any $m \in M_\p$ we know that its image $\bar{m} \in M_\p / \m M_\p$ is in the span of the basis $v_1, \dots, v_n$ so,
\[ \bar{m} = r_1 v_1 + \cdots r_n v_n \]
for $r_i \in R_\p$. Thus,
\[ m - (r_1 m_1 + \cdots r_n m_n) \in \p M \]
This implies that in $K$ we have $m \in \p K$ so $K = \p K$. Then since $\Jac{R_\p} = \p$ (because $R_\p$ is local) by Nakayama $K = 0$ so $M_\p$ is generated by $m_1, \dots, m_n$. 
\end{proof}

\begin{theorem}
The following are equivalent:
\begin{enumerate}
\item $M$ is a finitely-generated projective $R$-module
\item $M$ is a locally-free $R$-module of finite rank $\rank_x(M) < \infty$
\item $M$ is a finitely-presented $R$-module and for each $\p \in \Spec{R}$, $M_\p$ is a free $R_\p$-module. 
\end{enumerate}
\end{theorem}

\begin{proposition}
If $P$ is a finitely-generated projective module then $\rank(P) : \Spec{R} \to \Z$ is continuous.
\end{proposition}

\begin{proof}
It suffices to prove for $f = \rank(P)$ that $f^{-1}(n) = V$ is open. For any $\p \in V$ we know that $P_\p$ is free of rank $n$. Lift a basis (by clearing demoninators) to a map $f : R^n \to P$ and consider the exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \ker{f} \arrow[r] & R^n \arrow[r, "f"] & P \arrow[r] & \coker{f} \arrow[r] & 0
\end{tikzcd}
\end{center}  
Since $P$ is fintely generated then $\coker{P}$ is also finitely generated. Localizing this exact sequence at $\p$ we get an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & (\ker{f})_\p \arrow[r] & R_\p^n \arrow[r, "f"] & P_\p \arrow[r] & (\coker{f})_\p \arrow[r] & 0
\end{tikzcd}
\end{center}
but $f : R^n_\p \to P_\p$ is an isomorphism so $(\coker{f})_\p = \ker{f}_\p = 0$. Since $\coker{f}_\p$ is finitely generated there is some $g \notin \p$ such that $\coker{f}_\p = 0$. Thus we have.
\begin{center}
\begin{tikzcd}
0 \arrow[r] & (\ker{f})_g  \arrow[r] & R^n_g \arrow[r] & P_g \arrow[r] & 0 
\end{tikzcd}
\end{center}
We have yet to use projectivity of $P$ so,
in particular, we see that $\forall \q \in D(g) : \rank_\q(M) \le n$ for any finitely-generated $R$-module $M$. We call this upper-semicontinuity of $\rank(M) : \Spec{R} \to \Z$.
\bigskip\\
Now applying projectivity of $P$ (and thus $P_g$ as a $R_g$-module) the above exact sequence splits to give,
\[ R^n \cong P_g \oplus \ker{f}_g \]
so the projection $R^n \onto \ker{f}_g$ shows that $\ker{f}_g$ is finitely generated and $(\ker{f}_g)_\p = 0$ so there is some $h \notin \p$ such that $\ker{f}_{gh} = 0$. Then, by exactness of localization we get $R_{gh}^n \xrightarrow{\sim} P_{gh}$ so $P$ is free of rank $n$ on $D(gh)$ and thus $\forall \q \in D(gh) : \rank_\q(P) = n$ so $\p \in D(gh) \subset V$. Therefore, $V$ is open so this function is continuous.  
\end{proof}


\begin{definition}
Let $X$ be a scheme and $\F$ a coherent $\struct{X}$-module then there is a function $\rank(\F) : X \to \Z$ defined by $x \mapsto \rank_x(\F) = \dim_{\kappa(x)}(\F_x \otimes_{\stalk{X}{x}} \kappa(x))$. 
\end{definition}

\begin{remark}
Since $\F$ is coherent then locally $\F |_U = \wt{M}$ for some finitely generated $A$-module with $U = \Spec{A}$. (Note that this is necessary for coherence but only sufficient when $X$ is locally noetherian). Thus, $\F_x$ is a finitely-generated $\stalk{X}{x}$-module and thus $\F_x \otimes_{\stalk{X}{x}} \kappa(x)$ is finite dimensional. 
\end{remark}

\begin{theorem}
If $\F$ is a projective coherent $\struct{X}$-module then $\rank(\F) : X \to \Z$ is continuous. 
\end{theorem}

\begin{proof}

\end{proof}

\begin{proposition}
Projective coherent $\struct{X}$-modules on a scheme $X$ are exactly locally-free $\struct{X}$-modules of finite type. (CHECK).
\end{proposition}



\end{document}