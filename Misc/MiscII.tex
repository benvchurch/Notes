\documentclass[12pt]{article}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,      
    urlcolor=blue,
}

\usepackage{import}
\import{"../Algebraic Geometry/"}{AlgGeoCommands}

\newcommand{\Loc}[1]{\mathfrak{Loc}\left( #1 \right)}
\newcommand{\AbGrp}{\mathbf{AbGrp}}



\begin{document}

\tableofcontents


\section{Local Cohomology}

\begin{definition}
A local group or local system of groups $\L$ is a locally-constant sheaf of abelian groups. We write $\Loc{X}$ for the category of local systems on $X$.  
\end{definition}

\begin{theorem}
Let $X$ be a locally-path-connected (AND) topological space. Then there is a equivalence of categories between the category of local groups on $X$ and the category of actions of the fundamental groupoid $\Pi(X)$ on abelian groups. 
\end{theorem}

\begin{proof}
There is a functor $\Loc{X} \to \AbGrp^{\Pi(X)}$ sending a local system to its monodromy action. For any path $\gamma : I \to X$ and a point $\gamma(t)$ there is a open connected neighborhood $\gamma(t) \in U_t$ small enough such that $\L |_U{_t} \cong \underline{G}|_{U_t}$ for some abelian group $G$. Then $\gamma^{-1}(U_t)$ cover $I$ which is compact so we may choose finitely many $U_{i}$ which cover the path and we may assume that $U_i \cap U_{i + 1} \neq \empty$. Then since both are connected and $\L$ is constant on each we get isomorphisms,
\begin{center}
\begin{tikzcd}
\L(U_i) \arrow[rd, "\sim"] & & \L(U_{i+1}) \arrow[ld, "\sim"']
\\
& \L(W)
\end{tikzcd}
\end{center}
where $W$ is a connected component of $U_i \cap U_{i + 1}$. Thus $\L(U_i) \xrightarrow{\sim} \L(U_{i+1})$. Inductivly, this gives $\L(U_0) \xrightarrow{\sim} \L(U_n)$ which, since it is well-defined after shrinking the neighborhoods admits restricting to stalks, gives the monodromy map $[\gamma] : \L_{\gamma(0)} \to \L_{\gamma(1)}$. Clearly this construction respects composition. Furthermore, we can do the exact same construction for maps $I^2 \to X$ showing that the identifications everywhere commute under homotopy. Explicitly, let $h : I^2 \to X$ be a path homotopy between $\gamma_1 : I \to X$ and $\gamma_2 : I \to X$ then for each $t$ let $h(t, -) : I \to X$ be the path homotoping the point $\gamma_1(t)$ to $\gamma_2(t)$. Then $[h(t_2, -)] \circ [\gamma_1(t_1 \mapsto t_2)] = [\gamma_2(t_1 \mapsto t_2)] \circ [h(t_1, -)]$ as maps $\L_{\gamma_1(t_1)} \to \L_{\gamma_2(t_2)}$. Since at the endpoints $h(0, - ) = h(1, -)$ is the constant path then we see that $[\gamma_1] = [\gamma_2]$. Therefore, monodromy defined a functor $M_\L : \Pi(X) \to \AbGrp$. 
\bigskip\\
Now I claim this association $\L \mapsto M_\L$ is functorial. Given a morphism $\eta : \L \to \L'$ of local groups we get get maps $\eta_x : \L_x \to \L_x'$ which commute with restriction and thus with the monodromy construction i.e. a natural transformation between functors $M_\L$ and $M_{\L'}$.
\bigskip\\
Now we need to show that $\L \mapsto M_\L$ is fully faithful. 
\bigskip\\
Finally, $M : \Loc{X} \to \AbGrp^{\Pi(X)}$ is essentially surjective. (PROVE THIS)
\end{proof}

\begin{remark}
When $X$ is connected, then groupoid $\Pi(X)$-representations are simply group representations of $\pi_1(X,x_0)$.
\end{remark}

\begin{definition}
Let $X$ be a locally-path-connected. For each $n > 1$ (for $n = 1$ the representation is simply the inner automorphism representation of a groupoid) there is a groupoid representation $\pi_n(X) : \Pi(X) \to \AbGrp$ which generalizes the action at each point $\pi_1(X, x_0) \acts \pi_n(X, x_0)$. By the above theorem, this corresponds to a local group $\underline{\pi_n(X)}$. 
\end{definition}


\section{Action on Fibres of Fibration}

\begin{theorem}
Let $F \embed E \xrightarrow{\sim} B$ be a fibration. Then there is a groupoid action $\Pi(B)$ on the space of fibres and in particular $\pi_1(B, x_0) \to \Aut{F}$. 
\end{theorem}

\begin{proof}
Consider a path $\gamma : I \to B$ from $x_1$ to $x_2$ and then the diagram,
\begin{center}
\begin{tikzcd}[row sep = large, column sep = large]
F_{x_1} \arrow[r, hook] \arrow[d, hook] & E \arrow[d, "p"]
\\
F_{x_1} \times I \arrow[ru, dashed, "\tilde{\gamma}"] \arrow[r, "\gamma"] & B
\end{tikzcd}
\end{center}
By homotopy lifting we get a map $\tilde{\gamma} : F_{x_1} \times I \to E$ lifitng $\gamma : F_{x_1} \times I \to B$. Then $p \circ \tilde{\gamma} = \gamma$ so $\tilde{\gamma}(-, 1) \subset F_{x_2}$ since $p \circ \tilde{\gamma}(-,1) = \gamma(1) = x_2$. Therefore we get a map $[\gamma] : F_{x_1} \to F_{x_2}$ via $[\gamma](x) = \tilde{\gamma}(x, 1)$. 
\bigskip\\
I claim that two lifts of homotopic paths are homotopic. Given two paths $\gamma_1, \gamma_2 : I \to B$ and a path homotopy $h : I^2 \to B$ and two lifts $\tilde{\gamma_1}, \tilde{\gamma_2} : F_{x_1} \times I \to E$ we want a map $F_{x_1} \times I^2 \to E$ above $h : \times I^2 \to B$. This map is defined on $F_{x_1} \times (I \times \{ 0, 1 \} \cup \{ 0 \} \times I)$ via $\tilde{\gamma}_1$ on $F_{x_1} \times I \times \{0\}$ and $\tilde{\gamma}_2$ on $F_{x_1} \times I \times \{0\}$ any by inclusion of the fibre $F_{x_1}$ on $F_{x_1} \times \{ 0 \} \times I$ (constant on $I$) since $h_ {\{0\} \times I}$ is constant since it is a path homotopy. Then by homotopy lifitng, we get $\tilde{h} : F_{x_1} \times I \times I \to E$ such that $p \circ \tilde{h} = h$ and thus $\tilde{h}(-, 1, -) : F_{x_1} \times I \to F_{x_2}$ gives a homotopy from $[\gamma_1] : F_{x_1} \to F_{x_2}$ to $[\gamma_2] : F_{x_1} \to F_{x_2}$. 
\bigskip\\
Therefore, we have a representation of $\Pi(B)$ on $\mathbf{hTop}$ sending $x \mapsto F_x$ and $\gamma \mapsto [\gamma]$. 
\end{proof}


\section{Serre - Vanishing}

\begin{rmk}
First we prove the result for the case $\P^n_R$. 
\end{rmk}

\begin{theorem}
Let $\P^n = \P^n_R$. For any coherent $\struct{\P^n}$-module $\F$ there is some $r > 0$ such that,
\[ H^i(\P^n_R, \F \otimes_{\struct{\P^n}} \struct{\P^n}(s)) = 0 \]
for all $i > 0$ and $s \ge r$.
\end{theorem}

\begin{proof}
Since this holds for $i > n$ we may apply reverse induction on $i$. Assume the theorem holds for $i + 1$ and let $\F$ be some coherent sheaf. Since $\struct{\P^n}(1)$ is ample, for some $\ell > 0$ the sheaf $\F \otimes_{\struct{\P^n}} \struct{\P^n}(\ell)$ is generated by global sections,
\[ \bigoplus_{j = 1}^N \struct{\P^n} \onto \F \otimes_{\struct{\P^n}} \struct{\P^n}(\ell) \]
and thus tensoring by $\struct{\P^n}(-\ell)$ we get a surjection,
\[ \bigoplus_{j = 1}^N \struct{\P^n}(-\ell) \onto \F \]
which we may extend to an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \G \arrow[r] &  \bigoplus\limits_{j = 1}^N \struct{\P^n}(-\ell)  \arrow[r] & \F \arrow[r] & 0
\end{tikzcd}
\end{center}
Since $\struct{\P^n}(d)$ is locally free it is flat (exactness can be checked on stalks) so we get a short exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \G(d) \arrow[r] &  \bigoplus\limits_{j = 1}^N \struct{\P^n}(d - \ell)  \arrow[r] & \F(d) \arrow[r] & 0
\end{tikzcd}
\end{center}
Applying the LES of homology we get,
\begin{center}
\begin{tikzcd}
\bigoplus\limits_{j = 1}^N H^i(\P^n_R, \struct{\P^n}(d - \ell)) \arrow[r] & H^i(\P^n_R, \F(d)) \arrow[r] & H^{i+1}(\P^n_R, \G(d))
\end{tikzcd}
\end{center}
By the induction hypothesis, for all sufficently large $d \ge r_\G$ the cohomology $H^{i+1}(\P^n_R, \G(d)) = 0$ vanishes and furthermore by explicit calcuation, $H^i(\P^n_R, \struct{\P^n}(d - \ell)) = 0$ for $i > 0$ and $d \ge \ell$ so take $r_\F = \max\{ \ell, r_\G \}$ and then for $d \ge r_\F$ we find,
\[ H^i(\P^n_R, \F \otimes_{\struct{\P^n}} \struct{\P^n}(d)) = 0 \]
proving the result by induction. 
\end{proof}

\begin{theorem}
Let $R$ be a noetherian ring and $X \to \Spec{R}$ proper. Furthermore, let $\L$ be an ample line bundle on $X$. Then for any coherent $\struct{X}$-module $\F$ there is some $r > 0$ such that,
\[ H^i(X, \F \otimes_{\struct{X}} \L^{\otimes s}) = 0 \]
for all $i > 0$ and $s \ge r$.
\end{theorem}

\begin{proof}
Since $X \to \Spec{R}$ is finite type and $X$ has an ample line bundle $\L$ then $X$ must be quasi-projective over $R$ for some immersion $\iota : X \to \P^N_R$ where $\L^{\otimes d} = \iota^* \struct{\P^N}(1)$. Since $X \to \Spec{R}$ is proper and $\P^N_R \to \Spec{R}$ is separated then $\iota : X \to \P^N_R$ is automatically proper hence a closed immersion so $X$ is projective. 
\bigskip\\
Being a closed immersion $\iota : X \to \P^N_R$ is affine so we may compute (the Leray spectral sequence degenerates),
\[ H^i(X, \G) = H^i(\P^N_R, \iota_* \G) \]
for any quasi-coherent sheaf on $X$. Therefore, considering the coherent sheaf $\G = \F \otimes_{\otimes{\struct{X}}} \L^{\otimes s}$ it suffices to compute,
\[ H^i(\P^N_R, \iota_* ( \F \otimes_{\struct{X}} \L^{\otimes s} ) ) \]
We will apply the projection formula noting that writing $s = nd + r$ gives,
\[ \L^{\otimes s} = (\L^{\otimes d})^{\otimes n} \otimes_{\struct{X}} \L^{\otimes r} = (\iota^* \struct{\P^N}(1))^{\otimes n} \otimes_{\struct{X}} \L^{\otimes r} = \iota^* \struct{\P^n}(n) \otimes_{\struct{X}} \L^{r} \]
Therefore, let $\E = \struct{\P^n}(n)$ in the projection formula to find that,
\[ \iota_* ( \F \otimes_{\struct{X}} \L^{s} ) = \iota_* (\F \otimes_{\struct{X}} \L^{r} \otimes_{\struct{X}} \iota^* \struct{\P^N}(n)) = \iota_* (\F \otimes_{\struct{X}} \L^{r}) \otimes_{\struct{\P^n}} \struct{\P^N}(n) \]
Since $\iota_* (\F \otimes_{\struct{X}} \L^{r})$ is coherent the previous proposition alows us to choose $n$ large enough (taking the maximum of the $n$ large enough to kill the cohomology of each of $r = 0, 1, \dots, d-1$) so that,
\[ H^i(\P^N_R, \iota_* (\F \otimes_{\struct{X}} \L^{r}) \otimes_{\struct{\P^n}} \struct{\P^N}(n))  = 0 \]
for any $r = 0, 1, \dots, d-1$ and $n \gg 0$.
Therefore, for all sufficiently large $s$ we have,
\[ H^i(X, \F \otimes_{\struct{X}} \L^{\otimes s}) = H^i(\P^N_R, \iota^* (\F \otimes_{\struct{X}} \L^{\otimes s})) = H^i(\P^N_R, \iota_* (\F \otimes_{\struct{X}} \L^{r}) \otimes_{\struct{\P^n}} \struct{\P^N}(n)) = 0 \]
\end{proof}

\begin{theorem}[projection formula]
Let $f : X \to Y$ be a morphism of ringed spaces $\F$ a $\struct{X}$-module and $\E$ a finite locally free $\struct{Y}$-module. Then,
\[ R^q f_* (\F \otimes_{\struct{X}} f^* \E) = R^q f_* \F \otimes_{\struct{Y}} \E \]
\end{theorem}

\begin{theorem}
Let $X$ be projective, then the functors $\Ext{i}{\struct{X}}{-}{\G} : \Coh{\struct{X}} \to \Mod{\Gamma(X, \struct{X})}$ for a fixed quasi-coherent $\struct{X}$-module $\G$ are universal contravariant $\delta$-functors. 
\end{theorem}

\begin{proof}
It suffices to show that $\Ext{i}{}{-}{\G}$ are coeffaceable for all $i > 0$. Since $X$ is projective there is an ample line bundle $\L$ on $X$ and for the coherent $\struct{X}$-module $\G$ there is some $r > 0$ such that,
\[ H^i(X, \G \otimes_{\struct{X}} \L^{\otimes s}) = 0 \]
for any $s \ge r$ and $i > 0$. Then since $\L$ is ample, for any coherent $\struct{X}$-module $\F$ for some $n_0$ such that for $n \ge n_0$ the coherent sheaf $\F \otimes_{\struct{X}} \L^{\otimes n}$ is generated by global sections. Choosing $n \ge \max \{ n_0, r \}$ we get a surjection,
\[ \bigoplus_{j = 1}^N \struct{X} \onto \F \otimes_{\struct{X}} \L^{\otimes n} \]
However, since $\L$ is a line bundle we may tensor by $\L^{\otimes -n} = (\L^{\otimes n}])^\vee  $ to get a surjection,
\[ \H = \bigoplus_{j = 1}^N \L^{\otimes -n} \onto \F \]
Furthermore, since $\L$ is locally free of rank one,
\[ \Ext{i}{\struct{X}}{\H}{\G} = \bigoplus_{j = 1}^N \Ext{i}{\struct{X}}{(\L^{\otimes n})^\vee}{\G} = \bigoplus_{j = 1}^N \Ext{i}{\struct{X}}{\struct{X}}{\L^{\otimes n} \otimes_{\struct{X}} \G} = \bigoplus_{j = 1}^N H^i(X,  \G \otimes_{\struct{X}} \L^{\otimes n}) = 0 \]
for $i > 0$ by Serre vanishing showing that $\Ext{i}{\struct{X}}{-}{\G}$ is coeffaceable for all $i > 0$.  
\end{proof}

\section{Computing Ext and Tor in the Second Argument}

\subsection{Ext}

\begin{definition}
Let $\C$ be an abelian category (possibly enriched over another category $\D$). Then if $\C$ has enough injectives, $\Ext{i}{\C}{A}{-} : \C \to \D$ are the right-derived functors of $\Hom{\C}{A}{-} : \C \to \D$. 
\end{definition}

\begin{lemma}
$\Ext{i}{\C}{-}{M} : \C \to \D$ is a contravariant functor. 
\end{lemma}

\begin{proof}
Given an injective resolution $M \to I^\bullet$ and a map $A \to B$ we get a morphism of complexes $\Hom{\C}{B}{I^\bullet} \to \Hom{\C}{A}{I^\bullet}$ and thus a morphims of cohomology,
\[ \Ext{i}{\C}{B}{M} \to \Ext{i}{\C}{A}{M} \]
which clearly respects composition.
\end{proof}

\begin{lemma}
If $P$ is projective then $\Ext{i}{\C}{P}{-} = 0$ for $i > 0$.
\end{lemma}

\begin{proof}
This follow immediatly from the defining property that $\Hom{\C}{P}{-}$ is exact.
\end{proof}

\begin{prop}
Given a short exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & A \arrow[r] & B \arrow[r] & C \arrow[r] & 0
\end{tikzcd}
\end{center}
in $\C$ and some $M \in \C$ then there is a long exact sequence, 
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \Hom{\C}{C}{M} \arrow[draw=none]{d}[name=Z, shape=coordinate]{}  \arrow[r] & \Hom{\C}{B}{M} \arrow[r] & \Hom{\C}{A}{M} 
\arrow[dll,
rounded corners, crossing over,
to path={ -- ([xshift=2ex]\tikztostart.east)
|- (Z) [near end]\tikztonodes
-| ([xshift=-2ex]\tikztotarget.west)
-- (\tikztotarget)}]
\\
& \Ext{1}{\C}{C}{M} \arrow[draw=none]{d}[name=ZZ, shape=coordinate]{}  \arrow[r] & \Ext{1}{\C}{B}{M} \arrow[r] & \Ext{1}{\C}{A}{M} \arrow[dll,
rounded corners, crossing over,
to path={ -- ([xshift=2ex]\tikztostart.east)
|- (ZZ) [near end]\tikztonodes
-| ([xshift=-2ex]\tikztotarget.west)
-- (\tikztotarget)}]
\\
& \Ext{2}{\C}{C}{M} \arrow[r] & \Ext{2}{\C}{B}{M} \arrow[r] & \Ext{2}{\C}{A}{M} \arrow[r] & \cdots
\end{tikzcd}
\end{center}
\end{prop}

\begin{proof}
Take an injective resolution $M \to I^\bullet$. Then since each $I^n$ is injective the functor $\Hom{\C}{-}{I^n}$ is exact so we get an exact sequence of complexes,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \Hom{\C}{C}{\I^\bullet} \arrow[r] & \Hom{\C}{B}{\I^\bullet} \arrow[r] & \Hom{\C}{A}{\I^\bullet} \arrow[r] & 0
\end{tikzcd}
\end{center}
Taking the cohomology sequence of this short exact sequence of complexes gives the desired long exact sequence. 
\end{proof}

\begin{lemma}
If $P_\bullet \to A$ is a projective resolution then $\Ext{i}{\C}{A}{-} = H^i(\Hom{\C}{P_\bullet}{-})$. 
\end{lemma}

\begin{proof}
We may use the acyclicity lemma which may be proven by the above exact sequence for $\Hom{\C}{-}{M}$ noting that $\Ext{i}{\C}{P_n}{M} = 0$. However, a more elegant argument goes as follows. Since $P_\bullet$ is a complex of projectives the functor $\Hom{\C}{P_n}{-}$ is exact so for any exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & M \arrow[r] & N \arrow[r] & K \arrow[r] & 0
\end{tikzcd}
\end{center}
we get an exact sequence of complexes,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \Hom{\C}{P_\bullet}{M} \arrow[r] & \Hom{\C}{P_\bullet}{N} \arrow[r] & \Hom{\C}{P_\bullet}{K} \arrow[r] & 0
\end{tikzcd}
\end{center}
which gives a long exact sequence in the cohomology functors $H^i(\Hom{\C}{P_\bullet}{-})$ which shows that $H^i(\Hom{\C}{P_\bullet}{-})$ form a $\delta$-functor. Furthermore, since $\C$ has enough injectives, for any $M \in \C$ we can embed $M \embed I$ into an injective $I$ and $H^i(\Hom{\C}{P_\bullet}{I}) = 0$ since $\Hom{\C}{-}{I}$ is exact. Therefore,  $H^i(\Hom{\C}{P_\bullet}{-})$ is an effaceable $\delta$-functor and thus universal by Grothendieck. Furthermore, since $\Hom{\C}{-}{M}$ is left-exact,
\begin{align*}
H^0(\Hom{\C}{P_\bullet}{-}) & = \ker{(\Hom{\C}{P^0}{-} \to \Hom{\C}{P^1}{-})} = \Hom{\C}{\coker{(P^1 \to P^0)}}{-} 
\\
& = \Hom{\C}{A}{-} 
\end{align*}
However, $\Ext{i}{\C}{A}{-}$ are the derived functors of $\Hom{\C}{A}{-}$ so they too form a universal $\delta$-functor over $\Hom{\C}{A}{-}$. Thus, since universal $\delta$-functors with naturally isomorphic first terms are unique,
\[ \Ext{i}{\C}{A}{-} = H^i(\Hom{\C}{P_\bullet}{-}) \]
\end{proof}

\begin{rmk}
The above formalism applies exactly to any bifunctor $F : \C^\op \times \C \to \D$ such that for any $A \in \C$ there are enough $F(A, -)$-acyclics $I$ for which $F(-,I)$ is exact and replacing `injective' with this class of acyclics and `projective' by any class of objects $P$ such that $F(P, -)$ is exact. Furthermore we assume $\C$ is abelian with enough injectives, $\D$ is additive, and $F : \C^\op \times \C \to \D$ is additive. 
\bigskip\\
For example, in the category of $\struct{X}$-modules on a scheme, the bifunctor,
\[ \shHom{\struct{X}}{-}{-} : \shMod{\struct{X}}^\op \times \shMod{\struct{X}} \to \shMod{\struct{X}} \] satisfies the following properties. For injective sheaves $\I$ we have $\shHom{\struct{X}}{-}{\I}$ is exact and there are enough injectives which are  acyclic for $\shHom{\struct{X}}{\F}{-}$. If $\E$ is a locally-free sheaf then,
\[ \shHom{\struct{X}}{\E}{-} = \E^\vee \otimes_{\struct{X}} (-) \]
and $\E^\vee$ is locally free and thus flat so $\shHom{\struct{X}}{\E}{-}$ is exact. Therefore, we see that $\shExt{i}{\struct{X}}{-}{\G}$ is a contravariant $\delta$-functor, vanishing on locally free sheaves, which may be computed via cohomology of locally-free complexes. Furthermore, whenever $\shMod{\struct{X}}$ has enough locally frees (for example whenever $X$ has an ample line bundle) then $\shExt{i}{\struct{X}}{-}{\G}$ forms a universal contravariant $\delta$-functor.
\end{rmk}

\subsection{Tor}

\begin{defn}
When $\C$ has a right-exact cmonoid structure $- \otimes_\C -$ and $\C$ has enough projectives then define $\Tor{\C}{i}{A}{-} : \C \to \C$ as the left-derived functors of $A \otimes_\C - : \C \to \C$. 
\end{defn}

\begin{rmk}
Here it will be necessary to assume that $\C$ has enough flat objects ($F \otimes_\C -$ is exact). 
\end{rmk}

\begin{lemma}
$\Tor{\C}{i}{-}{M}$ is a covariant functor.
\end{lemma}

\begin{proof}
Given a map $A \to B$ and a projective resolution $P_\bullet \to M$ we get a morphism of complexes, $A \otimes_\C P_\bullet \to B \otimes_\C P_\bullet$ and thus a morphism of homology,
\[ \Tor{\C}{i}{A}{M} \to \Tor{\C}{i}{B}{M} \]
\end{proof}

\begin{defn}
We say an object $P \in \C$ is \textit{flat} if $P \otimes_\C - $ is an exact functor.
\end{defn}

\begin{lemma}
The following are equivalent,
\begin{enumerate}
\item $P$ is flat
\item $\Tor{\C}{i}{P}{-} = 0$ for all $i > 0$
\item $\Tor{\C}{1}{P}{-} = 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
Clearly $(a) \implies (b) \implies (c)$. Now, if $\Tor{\C}{1}{P}{-} = 0$ then for any exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & A \arrow[r] & B \arrow[r] & C \arrow[r] & 0
\end{tikzcd}
\end{center}
we get an exact sequence,
\begin{center}
\begin{tikzcd}
\Tor{\C}{1}{P}{C} \arrow[r] & P \otimes_\C A \arrow[r] & P \otimes_\C B \arrow[r] & P \otimes_\C C \arrow[r] & 0
\end{tikzcd}
\end{center}
so if $\Tor{\C}{1}{P}{-} = 0$ then $P \otimes_\C -$ is exact i.e. $P$ is flat.
\end{proof}


\begin{prop}
Given a short exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & A \arrow[r] & B \arrow[r] & C \arrow[r] & 0
\end{tikzcd}
\end{center}
in $\C$ and some $M \in \C$ then there is a long exact sequence, 
\begin{center}
\begin{tikzcd}
\cdots \arrow[r] & \Tor{\C}{2}{A}{M} \arrow[draw=none]{d}[name=Z, shape=coordinate]{}  \arrow[r] & \Tor{\C}{2}{B}{M} \arrow[r] & \Tor{\C}{2}{C}{M} 
\arrow[dll,
rounded corners, crossing over,
to path={ -- ([xshift=2ex]\tikztostart.east)
|- (Z) [near end]\tikztonodes
-| ([xshift=-2ex]\tikztotarget.west)
-- (\tikztotarget)}]
\\
& \Tor{\C}{1}{A}{M} \arrow[draw=none]{d}[name=ZZ, shape=coordinate]{}  \arrow[r] & \Tor{\C}{1}{B}{M} \arrow[r] & \Tor{\C}{1}{C}{M} \arrow[dll,
rounded corners, crossing over,
to path={ -- ([xshift=2ex]\tikztostart.east)
|- (ZZ) [near end]\tikztonodes
-| ([xshift=-2ex]\tikztotarget.west)
-- (\tikztotarget)}]
\\
 & A \otimes_\C M \arrow[r] & B \otimes_\C M \arrow[r] & C \otimes_\C M \arrow[r] & 0
\end{tikzcd}
\end{center}
\end{prop}

\begin{proof}
Take a flat resolution $F_\bullet \to M$. Then since each $F_n$ is flat the functor $F_n \otimes_\C -$ is exact so we get an exact sequence of complexes (using symmetry of $- \otimes_\C -$),
\begin{center}
\begin{tikzcd}
0 \arrow[r] & A \otimes_\C F_\bullet \arrow[r] & B \otimes_\C F_\bullet \arrow[r] & C \otimes_\C F_\bullet \arrow[r] & 0
\end{tikzcd}
\end{center}
Taking the homology sequence of this short exact sequence of complexes gives the desired long exact sequence since by the acylicity lemma we may commute $\Tor{\C}{i}{A}{M}$ via a flat resolution of $M$.  (FUCK I USED SYMMETRY HERE!!)
\end{proof}

\begin{lemma}
If $F_\bullet \to A$ is a flat resolution then $\Tor{\C}{i}{A}{-} = H_i(F_\bullet \otimes_\C -)$.
\end{lemma}

\begin{proof}
We may use the acyclicity lemma which may be proven by the above exact sequence for $\Tor{\C}{i}{-}{M}$ showing that $\Tor{\C}{i}{-}{M}$ forms a $\delta$-functor and noting that $\Tor{\C}{i}{F_n}{M} = 0$. However, a more elegant argument goes as follows. Since $F_\bullet$ is a complex of flats the functor $F_n \otimes -$ is exact so for any exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & M \arrow[r] & N \arrow[r] & K \arrow[r] & 0
\end{tikzcd}
\end{center}
we get an exact sequence of complexes,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & F_\bullet \otimes M \arrow[r] & F_\bullet \otimes N \arrow[r] & F_\bullet \otimes K \arrow[r] & 0
\end{tikzcd}
\end{center}
which gives a long exact sequence in the homology functors $H_i(F_\bullet \otimes -)$ which shows that $H_i(F_\bullet \otimes -)$ form a (homological) $\delta$-functor. Furthermore, since $\C$ has enough flats, for any $M \in \C$ we have a surjection $F \onto M$ for some flat $F$ and $H_i(F_\bullet \otimes_\C F) = 0$ since $- \otimes F$ is exact (both rows and columns stay exact, it is the exactness of the columns here ensured by flatness of $F$ which is needed for the vanishing). Therefore,  $H_i(F_\bullet \otimes -)$ is a coeffaceable $\delta$-functor and thus universal by Grothendieck. Furthermore, since $- \otimes_\C M$ is right-exact,
\begin{align*}
H_0(F_\bullet \otimes_\C -) & = \coker{([F_1 \otimes_\C -] \to [F_0 \otimes_\C -])} = \coker{(F_1 \to F_0)} \otimes_\C (-) = A \otimes_\C (-)
\end{align*}
However, $\Tor{\C}{i}{A}{-}$ are the derived functors of $A \otimes_\C -$ so they too form a universal $\delta$-functor over $A \otimes_\C -$. Thus, since universal $\delta$-functors with naturally isomorphic first terms are unique,
\[ \Tor{\C}{i}{A}{-} = H_i(F_\bullet \otimes_\C -) \]
\end{proof}

\begin{prop}
Tor is symmetric: there is a natural isomorphism $\Tor{\C}{i}{A}{B} = \Tor{\C}{i}{B}{A}$.
\end{prop}

\begin{proof}
Choose a flat resolution $F_\bullet \to A$. By the above lemma $\Tor{\C}{i}{A}{B} = H_i(F_\bullet \otimes_\C B)$. However, by the symmetry of $- \otimes_\C -$ we have, $H_i(F_\bullet \otimes_\C B) = H_i(B \otimes_\C F_\bullet)$. Furthermore, because $\Tor{\C}{i}{B}{-}$ is the left-derived functor of $B \otimes_\C -$ we may compute it via acyclics (since it is a $\delta$-functor) so $\Tor{\C}{i}{B}{A} = H_i(B \otimes_\C F_\bullet)$ and thus,
\[ \Tor{\C}{i}{A}{B} = H_i(F_\bullet \otimes_\C B) = H_i(B \otimes_\C F_\bullet) = \Tor{\C}{i}{B}{A} \]
\end{proof}

\begin{remark}
These arguments apply to the satellites of any symmetric bifunctor $F : \C \times \C \to \D$ between abelian categories such that $F(A, -)$ is right exact and $\C$ has enough objects $A$ for which $F(A, -)$ is exact, in particular, if $F(P, -)$ is exact for projectives (as is the tensor product). 
\end{remark}

\newcommand{\Tot}{\mathrm{Tot}}

\begin{remark}
Symmetry follows directly from the following spectral sequence argument. Let $F^A_\bullet \to A$ and $F^B_\bullet \to B$ be flat resolutions. Then consider the double complex $C_{p,q} = F^A_p \otimes_\C F^B_q$. There are two spectral sequences which compute the homology of the total complex $\Tot(C_{\bullet. \bullet})$. These two spectral sequences agree on their zeroth page, ${}^A E^0_{p,q} = {}^B E^0_{p,q} = F^A_p \otimes_\C F^B_q$. Now, the first pages are,
\begin{align*}
{}^A E^1_{p,q} & = H_{p}(C_{\bullet, q}) = H_{p}(F^A_\bullet \otimes_\C F^B_q) = A \otimes_\C F_p^B \quad \text{ in p degree zero}
\\
{}^B E^1_{p,q} & = H_{q}(C_{p, \bullet}) = H_{q}(F^A_p \otimes_\C F^B_\bullet) = F^A_p \otimes_\C B \quad \text{ in q degree zero}
\end{align*}
where we have used the fact that $- \otimes_\C F^B_q$ and $F^A_p \otimes_\C - $ are exact (since the resolutions are flat) and thus commute with taking homology. Then the second pages are,
\begin{align*}
{}^A E^2_{p,q} & = H_{q}({}^A E^1_{p, \bullet}) = H_{q}(A \otimes_\C F_\bullet^B) = L^q(A \otimes_\C -)(B) \quad \text{ in p degree zero}
\\
{}^B E^2_{p,q} & = H_{p}({}^B E^1_{\bullet, q}) = H_{p}(F^A_p \otimes_\C B) = L^p (- \otimes_\C B)(A) \quad \text{ in q degree zero}
\end{align*}
Since the second pages are supported in a single row or collumn both spectral sequences are converged. Therefore, we find,
\[ H_n(\Tot(C_{\bullet, \bullet})) = {}^A E^2_{0,n} = {}^B E^2_{n, 0} = L^n(A \otimes_\C -)(B) = L^n(- \otimes_\C B)(A) \] 
Therefore, for a bifunctor we may derive in either component to get the same satellite functors. Furthermore, when $- \otimes_\C -$ is symmetric then, 
\begin{align*}
L^n(A \otimes_\C -)(B) & = L^n(- \otimes_\C A)(B) = L^n(B \otimes_\C -)(A) 
\\
L^n(- \otimes_\C B)(A) & = L^n(B \otimes_\C -)(A) = L^n(- \otimes_\C A)(B) 
\end{align*}
so the derived functors are symmetric.
\end{remark}

\subsection{Acyclicity}

\begin{lemma}
Let $F$ be a $\delta$-functor. Suppose there is an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & A \arrow[r] & I^0 \arrow[r] & \cdots \arrow[r] & I^n \arrow[r] & K \arrow[r] & 0
\end{tikzcd}
\end{center}
where $I^i$ are $F$-acyclic. Then for $i > 0$,
\[ F^{n + 1 + i}(A) = F^i(A) \]
and $F^{n+1}(A) = \coker{(F^0(I^{n}) \to F^0(K))}$. 
\end{lemma}

\begin{proof}
We prove this by induction on $n$. For $n = 0$, we are given a short exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & A \arrow[r] & I^0 \arrow[r] & K \arrow[r] & 0
\end{tikzcd}
\end{center}
Taking the long exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & F^0(A) \arrow[r] & F^0(I^0) \arrow[r] & F^0(K) \arrow[r] & F^1(A) \arrow[r] & F^1(I^0)
\end{tikzcd}
\end{center}
and
\begin{center}
\begin{tikzcd}
F^i(I^0) \arrow[r] & F^i(K) \arrow[r] & F^{i+1}(A) \arrow[r] & F^{i+1}(I^0)
\end{tikzcd}
\end{center}
However, $I^0$ is $F$-acyclic so $F^i(I^0) = 0$ for $i > 0$ and thus $F^{i + 1}(A) = F^i(K)$ for $i > 0$. Furthermore, for the second sequence $F^1(A) = \coker{(F^0(I^0) \to F^0(K))}$. 
\bigskip\\
Now we assume the result holds for $n-1$. We split the exact sequence into,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & A \arrow[r] & I^0 \arrow[r] & \cdots \arrow[r] & I^n \arrow[r] & \tilde{K} \arrow[r] & 0
\end{tikzcd}
\end{center}
and 
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \tilde{K} \arrow[r] & I^n \arrow[r] & K \arrow[r] & 0
\end{tikzcd}
\end{center}
Applying the induction hypothesis we see that,
$F^{n + i}(A) = F^{i}(\tilde{K})$
for $i > 0$. In particular, we will use, $F^{n+1}(A) = F^{1}(\tilde{K})$. Now, by the LES of the second exact sequence we find,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & F^0(\tilde{K}) \arrow[r] & F^0(I^n) \arrow[r] & F^0(K) \arrow[r] & F^1(\tilde{K}) \arrow[r] & F^1(I^n)
\end{tikzcd}
\end{center}
and
\begin{center}
\begin{tikzcd}
F^i(I^n) \arrow[r] & F^i(K) \arrow[r] & F^{i+1}(\tilde{K}) \arrow[r] & F^{i+1}(I^n)
\end{tikzcd}
\end{center}
However, $I^n$ is $F$-acyclic so for $i > 0$ we get,
\[ F^i(K) = F^{i+1}(\tilde{K}) \quad \text{ and } \quad F^1(\tilde{K}) = \coker{(F^0(I^n) \to F^0(K))} \] 
Therefore, we have $F^{n + i + 1}(A) = F^{i+1}(\tilde{K}) = F^i(K)$ for $i > 0$. Furthermore, \[ F^{n+1}(A) = F^1(\tilde{K}) = \coker{(F^0(I^n) \to F^0(K))} \]
proving the lemma.
\end{proof}

\begin{theorem}[acyclicity]
If $F$ is a $\delta$-functor and $A \to I^\bullet$ a resolution of $F$-acyclic objects,
\[ F^n(A) = H^n(F^0(I^\bullet)) \]
\end{theorem}

\begin{proof}
We may truncate the resolution by adding a cokernel $K$ to give an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & A \arrow[r] & I^0 \arrow[r] & \cdots \arrow[r] & I^n \arrow[r] & K \arrow[r] & 0
\end{tikzcd}
\end{center}
By the previous lemma, we can compute,
\[ F^{n+1}(A) = \coker{(F^0(I^n) \to F^0(K))} \]
However, by exactness, $K = \coker{(I^{n-1} \to I^n)} = \ker{(I^{n+1} \to I^{n+2})}$. Furthermore, $F^0$ is left-exact so $F^0(K) = \ker{(F(I^{n+1}) \to F(I^{n+2}))}$. Therefore, for $n \ge 0$ we find,
\[ F^{n+1}(A) = \coker{(F^0(I^n) \to F^0(K))} = \coker{(F^0(I^n) \to \ker{(F(I^{n+1}) \to F(I^{n+2}))})} = H^{n+1}(F^0(I^\bullet)) \]
Furthermore, $F^0$ is left-exact so,
\[ F^0(A) = F^0(\ker{(I^0 \to I^1)}) = \ker{(F^0(I^0) \to F^0(I^1))} = H^0(F^0(I^\bullet)) \]
\end{proof}

\subsection{Tor for Sheaves}

\begin{remark}
Often the categories $\shMod{\struct{X}}$, $\QCoh{\struct{X}}$, and $\Coh{\struct{X}}$ do not have enough projectives. Therefore, we cannot define Tor for sheaves as a left-derived functor we need an alternative definition.  
\end{remark}

\begin{defn}
Let $X$ be a scheme such that $\Coh{\struct{X}}$ has enough locally-frees (e.g. $X$ has an ample line bundle). Given a coherent sheaf $\F$ and a resolution $\E_\bullet \to \F$ by locally free coherent sheaves, we define,
\[ \shTor{\struct{X}}{i}{\F}{-} = H_i( \E_\bullet \otimes_{\struct{X}} - ) \]
\end{defn}

\begin{prop}
$\shTor{\struct{X}}{i}{\F}{-}$ is a universal homological $\delta$-functor. 
\end{prop}

\begin{proof}
First, given an exact sequence of coherent sheaves,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \G_1 \arrow[r] & \G_2 \arrow[r] & \G_3 \arrow[r] & 0
\end{tikzcd}
\end{center}
we get an exact sequence of complexes,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \E_\bullet \otimes_{\struct{X}} \G_1 \arrow[r] & \E_\bullet \otimes_{\struct{X}} \G_2 \arrow[r] & \E_\bullet \otimes_{\struct{X}} \G_3 \arrow[r] & 0
\end{tikzcd}
\end{center}
since $\E_n$ is locally-free and thus flat. Taking homology gives a long exact sequence of $\Tor{\struct{X}}{i}{\F}{-}$ sheaves making it a homological $\delta$-functor.
It suffices to show that $\shTor{\struct{X}}{i}{\F}{-}$ is coeffaceable. Since there are enough locally-free sheaves for any coherent $\G$ we can find a locally-free and a surjection $\E' \onto \G$. Then, since $- \otimes_{\struct{X}} \E'$ is exact then,
\[ \shTor{\struct{X}}{i}{\F}{\E'} = H_i(\E_\bullet \otimes_{\struct{X}} \E') = 0 \]
where $\E_\bullet \to \F$ is a locally-free resolution. Therefore, $\shTor{\struct{X}}{i}{\F}{-}$ is coeffaceable.
\end{proof}

\begin{rmk}
Since $\shTor{\struct{X}}{i}{\F}{-}$ is universal it will agree with any other reasonable definition (any definition which is a universal $\delta$-functor) because there is a unique universal $\delta$-functor over,
\[ \shTor{\struct{X}}{0}{\F}{-} = H_0(\E_\bullet \otimes_{\struct{X}} -) = \coker{(\E^1 \to \E^0)} \otimes_{\struct{X}} - = \F \otimes_{\struct{X}} - \]
where the second equality follows from right-exactness of $- \otimes_{\struct{X}} \G$. In particular, it does not depened on the choice of resolution $\E_\bullet \onto \F$.
\end{rmk}

\begin{rmk}
Since $- \otimes_{\struct{X}} - : \shMod{\struct{X}} \times \shMod{\struct{X}} \to \shMod{\struct{X}}$ is a symmetric bifunctor with enough locally-frees which are flat. Then since $\shTor{\struct{X}}{i}{\F}{-}$ are the left-satellite functors of $\F \otimes_{\struct{X}} -$ we can apply the acyclicity lemma to show that we map compute sheaf Tor from a locally free resolution $\E_\bullet \onto \G$,
\[ \shTor{\struct{X}}{i}{\F}{\G} = H_i(\F \otimes_{\struct{X}} \E_\bullet) = H_i(\E_\bullet \otimes_{\struct{X}} \F) = \shTor{\struct{X}}{i}{\G}{\F} \]
which shows the symmetry of $\shTor{\struct{X}}{i}{-}{-}$. 
\end{rmk}

\section{Depth of Field}

First we calculate the size of the circle of confusion. Let the lense have aperature $D$ and focal length $f$. The image distance is given by,
\[ \frac{1}{i} + \frac{1}{o} = \frac{1}{f} \]
then,
\[ i = \frac{f o}{o - f} \]
Therefore, we can compute the change in image distance as $o$ changes,
\[ \deriv{i}{o} = \frac{f}{o - f} - \frac{f o}{(o - f)^2} = - \frac{f^2}{(o - f)^2} \]
For a depth of $\Delta o$ we have a spread of image depths,
\[ \Delta i  \approx \frac{f^2 \Delta o}{(o - f)^2} \]
Then the width of the circle of confusion is given by,
\[ \frac{C}{D} = \frac{\Delta i}{f + \Delta i} \approx \frac{\Delta i}{f} \]
Therefore,
\[ C = \frac{f D}{(o - f)^2} \Delta o \]
For a fixed allowable circle of confusion $C_{\text{max}}$ for the desired resolution, we find the depth of field,
\[ \text{DOF} = 2 \frac{C}{D} \cdot \frac{(o - f)^2}{f} = \frac{2 (o - f)^2 N C}{f^2} \]
where $N = f / D$ is the focal ratio. 

\subsection{Hyperfocal Distance}

At some focal distance $H$, all objects beyond $H$ are in focus. This occurs when,
\[ \frac{i - f}{f} = \frac{C}{D} \]
and
\[ i = \frac{f H}{H - f} \]
Then,
\[ \frac{H}{H - f} - 1 = \frac{f}{H - f} = \frac{C}{D} \]
Therefore,
\[ H = \frac{f (D + C)}{C} = \frac{f^2}{CN} + f \]
\bigskip\\
Alternativly,
if we focus at infinity and ask beyond which everything is in focus then,
\[ \frac{i - f}{i} = \frac{C}{D} \]
and

\[ i = \frac{f H}{H - f} \]
Then,
\[ 1 - \frac{H - f}{H} = \frac{f}{H} = \frac{C}{D} \]
Therefore,
\[ H = \frac{f D}{C} = \frac{f^2}{NC} \]

\section{Morphisms from Proper to Affine Schemes}

Let $X \to \Spec{R}$ be proper and $\Spec{A} \to \Spec{R}$ be affine. Now,
\[ \Hom{R}{X}{\Spec{A}} = \Hom{R}{A}{\Gamma(X, \struct{X})} \]
The map $X \to \Spec{A}$ is given as follows, consider $\varphi_x : A \to \Gamma(X, \struct{X}) \to \stalk{X}{x}$ then $x \mapsto \varphi_x^{-1}(\m_x)$. Therefore, all maps $X \to \Spec{A}$ are constant if $x \mapsto \res_x^{-1}(\m_x)$ is a fixed ideal independent of $x$.  

\section{Irreducible Polynomials over $\Z$}

\newcommand{\Fin}{\mathbb{F}}

Consider the map $\Spec{\Z[X]} \to \Spec{\Z}$. The fibres are, over the generic point $(0)$, we have $\Spec{\Q[X]} \to \Spec{\Q}$ which corresponds to ideals of the form $(f(X))$ for $f$ an irreducible polynomial $f \in \Q[X]$. The fibres over $(p)$ are $\Spec{\Fin_p[X]} \to \Spec{\Fin_p}$ whose primes are of the form $(f(X))$ for $f$ an irreducible polynomial $f \in \Fin_p[X]$. Therefore we get an explicit description of $\Spec{\Fin[X]}$, we have the primes, $(f(X))$ for irreducible $f \in \Q[X]$ (for which we may clear denominators to get $f \in \Z[X]$) and $(p, f(X))$ for irreduclbe $f \in \Fin_p[X]$ (choosing some representative in $\Z[X]$) and finally of course $(0)$ and $(p)$ are prime (corresponding to the generic points of the fibres). 
\bigskip\\
Suppose $f \in \Z[X]$ were irreducible then any prime (strictly) above $(f)$ must be of the form $(p, f(X))$ otherwise $f$ would be a nontrivial product. Then we have $\dim{\Z[X]/(f)} = 1$ furthermore, (COMPLETE THIS ARGUMENT ... )

\section{Normalization}

\begin{example}
Consider $X = \Spec{A}$ with $A = k[x,y]/(y^2 - x^2(x + 1)$. Then consider,
\[ A \to k[t] \quad \quad x \mapsto t^2 - 1 \quad y \mapsto t(t^2 - 1) \]
Then $y^2 = t^2 (t^2 - 1)$ and $x^2 (x - 1) = t^2 (t^2 - 1)^2$ so this map is well-defined. This gives a dominant map,
\[ \A^1_k \to \Spec{A} \]
Furthermore, I claim that,
\[ \Frac{A} \embed k(t) \]
is an isomorphism, clearly $\Frac{A} \to k(t)$ is injective. The inverse map is $t \mapsto y/x$ then $y/x \mapsto t \mapsto y/x$ and $t \mapsto y/x \mapsto t$. Furthermore, $x \mapsto (t^2 - 1) \mapsto (y^2/x^2 - 1) = x$ and $y \mapsto t(t^2 -1) \mapsto y/x(y^2/x^2 - 1) = y$. Thus the map $\A^1 \to \Spec{A}$ is a dominant birational morphism. Furthermore,
\[ \overline{A} = k[y/x]  = k[t] \subset \Frac{A} \]
because $t = y/x$ satisfies the monic $t^2 - x - 1$ so $\A^1 \to \Spec{A}$ is the normalization.
\end{example}

\begin{example}
Consider the cusp $X = \Spec{A}$ with $A = k[x,y] = (y^2 - x^3)$. Then consider,
\[ A \to k[t] \quad \quad x \mapsto t^2 \quad y \mapsto t^3 \]
Then $y^2 \mapsto t^6$ and $x^2 \mapsto t^6$ so this is well-defined. This gives a dominant map,
\[ \A^1_k \to \Spec{A} \]
Furthermore, I claim that,
\[ \Frac{A} \embed k(t) \]
is an isomorphism. Send $t \mapsto y/x$ then $t \mapsto y/x \mapsto t$ and $y/x \mapsto t \mapsto y/x$. Then $y \mapsto t^3 \mapsto y^3 / x^3 = y$ and $x \mapsto t^2 \mapsto y^2 / x^2 = x$. Therefore, $\A^1_k \to \Spec{A}$ is a dominant birational morphism. Furthermore,
\[ \overline{A} = k[y/x] = k[t] \subset k(t) = \Frac{A} \]
because $t = y/x$ satisfies the monic $t^2 - x$. 
\end{example}

\begin{example}
Consider the tachnode $X = \Spec{A}$ with $A = k[x,y]/(x^2 - y^4)$. Then consider,
\[ A \to k[t, s]/(s^2 - 1) \quad \quad x \mapsto t \quad y \mapsto t^2 s \]
Then $x^4 \mapsto t^4$ and $y^2 \mapsto t^4$ so this is well-defined. this gives a dominant map,
\[ \Spec{k[t,s]/(s^2 - 1)} = \A^1_k \coprod \A^1_k \to \Spec{A} \]
On the irreduclble componenets $\p_{+} = (y - x^2)$ and $\p_{-} = (y + x^2)$ of $\Spec{A}$ we have,
\[ \stalk{X}{\p_{+}} = \Frac{k[x,y]/(y - x^2)} \quad \quad \stalk{X}{\p_{-}} = \Frac{k[x,y]/(y + x^2)} \]
and thus the map $\Spec{k[t, s]/(s^2 - 1)} \to \Spec{A}$ gives an isomorphism on each component and $\spec{k[t, x]/(s^2 - 1)}$ is normal. 
\end{example}

\section{A Very Werid Scheme}

For finite products we have,
\[ \Spec{A \times B} = \Spec{A} \coprod \Spec{B} \]
where we take the coproduct in the category of schemes. In particular, the primes of $A \times B$ are simply $\p_1 \times B$ or $A \times \p_2$ for primes $\p_1 \subset A$ and $\p_2 \subset B$. However, for infinite product this fails. Consider,
\[ X = \Spec{\prod\limits_{i = 0}^\infty k} \quad \quad R = \prod\limits_{i = 0}^\infty k \]
where $k$ field. The prime ideals of this ring are not just the kernels of the projections $R \to k$ which are maximal ideals. To see this, consider the ideal $I$ of functions $\N \to k$ which have finite support. Clearly $I \to R \to k$ is surjective for each projection so $I$ is not contained in any of the described primes. It turns out that prime ideals of $R$ correspond to ultrafilters $\F$ of $\N$ where $\p(\F)$ for some ultrafilter is the following,
\[ \p(\F) = \{ (a_i) \mid \{ i \mid a_i = 0 \} \in \F \} \]
Therefore, the principal ultrafilter $\F_i$ above $\{ i \}$ gives exactly $\p(\F_i) = \ker{\pi_i}$ but there are many more nonprincipal ultrafilters. 

\section{Coproducts in the Category of Schemes}

\begin{prop}
The forgetful functor $F : \Sch \to \Top$ preserves colimits. 
\end{prop}

\begin{rmk}
Let $\Hom{\Top}{F(X)}{S} = \Hom{\Sch}{X}{T(S)}$ 
\end{rmk}

\section{NOTE LOOK UP THE PROOF FOR PROJ -> LOCALLY FREE}

\section{Ravi Excersies}

\begin{rmk}
Maps $\Spec{k} \to \P^n_k$ are equivalent to giving a line bundle $\L$ on $\Spec{k}$ i.e. a one-dimensional $k$-vectorspace $V \cong k$ and $n+1$ sections $s_i \in V$ not all zero. We call this point $[s_0, \dots, s_n] \in \P^n_k$ up to isomorphism $\varphi : V \cong V'$ and $\varphi(s_i) = s_i'$ This is simply global scalling by $k^\times$. Furthermore, for any extension $K / k$ we can describe $\P^n_k(K)$ similarly but with $s_i \in K$. 
\end{rmk}

\begin{definition}
Projection from a rational point $\P^n_k \rat \P^{n-1}_k$ given a projection point $p \in \P^n_k$. We define this as follows: by an automorphism of $\P^n_k$ let $p = [1 : 0 : \cdots : 0]$. Take the dense open $U = D(X_0) \setminus \{ 0 \} = \Spec{x_1, \dots, x_n} \setminus \{ (0) \}$. Then consider the map $U \to \P^{n-1}_k$ via $\L = \struct{U}$ and $s_i = x_i$. These global sections generate because we have removed the point at which they all vanish. This rational map $\P^n_k \rat \P^{n-1}_k$ has domain $\Dom{f} = \P^n_k \setminus \{ p \}$.   
\end{definition}


\subsection{6.5 F}

Consider the conic $C = V(X^2 + Y^2 = Z^2) \subset \P^2_k$. Consider the map $\P^1_k \to \P^2_k$ defined by the line bundle $\L = \struct{\P^1}(2)$ and the sections $X_0^2 - X_1^2, 2 X_0 X_1, X_0^2 + X_1^2$. The image is exactly $C = V(X^2 + Y^2 = Z^2)$ and thus $C \cong \P^1_k$. However, if characteristic of $k = 2$ then these sections are $X_0^2 + X_1^2, 0, X_0^2 + X_1^2$ which does not define a map since these may all vanish simultaneously. In fact, $V(X^2 + Y^2 = Z^2)$ is not smooth in characteristic two since $X^2 + Y^2 = (X + Y)^2$ so we get $X + Y = \pm Z$ the union of two lines in $\P_k^2$. 
\bigskip\\ 
We can also describe an isomorphism as follows. First, lets do a change of coordinates $X \mapsto \tfrac{1}{2}(X + Z)$ and $Z \mapsto \tfrac{1}{2}(X - Z)$ then $C = V(XZ + Y^2)$. 
Take the point $p = [1 : 0 : 0]$ use the projection $\P^2_k \rat \P^1_k$ away from $p$. On the affine $D(X)$ this is the map $U = \Spec{k[y, z]/(z + y^2)} \setminus \{ 0 \} \to \P^1_k$ via $(y, z) \mapsto [y : z]$. Now $U = \Spec{k[y, y^{-1}]} = \Gm^k$ and the map is $\Gm^k \to \P^1_k$ via $t \mapsto [t, t^2]$. This is a rational map $C \rat \P^1_k$ of smooth projective curves so it extends to $C \to \P^1_k$ which is inverse to the previous map. 

\subsection{6.5 G}

Consider $C = \Spec{k[x, y]/(y^2 - x^3 - x^2)}$. Then we construct a rational map $C \rat \A^1_k$ via projecting from $p = (0,0)$. Explicitly, consider $U = D(x)$ and consider, $f : U \to \A^1_k$ via $t \mapsto y/x$. Inversely we define $g : \A^1_k \to C$ generated by the ring map $x \mapsto t^2 - 1$ and $y \mapsto  t(t^2 - 1)$. Note that we have seen this is the normalization $\A^1_k \to C$ of $C$. Then $g \circ f : U \to C$ is $x \mapsto y^2/x^2 - 1 = x$ and $y \mapsto y/x(y^2/x^2 - 1) = y$. Furthermore, $f \circ g : \Gm^k \to \A^1_k$ is $t \mapsto y/x \mapsto t$. Therefore, these are inverse rational maps showing that $C \birat \A^1_k$ is birational. However we cannot extend this rational map to $p$ since $\stalk{C}{p} = \Spec{(k[x, y]/(y^2 - x^2))_{(x, y)}}$ is not a domain and thus not regular.
\bigskip\\
This gives a formula for the rational points of $C$ by $\A^1_L \rat C_L$. Via $t \mapsto (t^2 - 1, t(t^2 - 1))$ which hit every $L$-rational point on $C$. Thus,
\[ C(L) = \{ (t^2 - 1, t(t^2 - 1)) \mid t \in L \} \]
We see that $C$ is a rational curve i.e. $C \birat \P^1_k$. 

\subsection{6.5 H}

Consider the quadric surface,
\[ Q = V(X^2 + Y^2 - Z^2 - W^2) \subset \P^3_k \]
First, we do a change of variables,
\[ X \mapsto \tfrac{1}{2}(X + Z) \quad Z \mapsto \tfrac{1}{2}(X - Z) \quad Y \mapsto \tfrac{1}{2}(Y + W) \quad W \mapsto \tfrac{1}{2}(Y - W) \]
which gives,
\[ Q = V(XZ + YW) \subset \P^3_k \]
Now we project from the point $p = [1 : 0 : 0 : 0]$ on $U = D(X) \setminus \{ p \}$ this gives the map, 
\[ f : \Spec{k[y, z, w]/(z + yw)} \setminus \{ 0 \} \to \P^2_k \]
via sections $y, z, w$. We describe an inverse $\P^2_k \rat Q$ as follows, consider $\P^2_k = \Proj{k[T_0, T_1, T_2]}$ then on $D(T_0 T_2)$ take $\Spec{k[t_0, t_1]} \to \Spec{k[y,z,w]/(z + yw)}$ via $y \mapsto -t_1$ and $z \mapsto -t_1^2/t_0$ and $w \mapsto -t_1 / t_0$ which is the map $(t_0, t_1) \mapsto (-t_1, -t_1^2/t_0, -t_1/t_0)$. This gives,
\[ g : D(T_0 T_2) \to D(XW) \]
and thus $\P^2_k \rat Q$. Furthermore, $g \circ f : D(XW) \to U$ is,
\[ (y, z, w) \mapsto [y : z : w] = [y/w : z/w : 1] \mapsto (-z/w, -z^2/wy, -w/y) = (y, z, w) \] restriction of the identity since $z + wy = 0$. Furhtermore, $f \circ g : D(T_0 T_1 T_2) \to D(T_0 T_1 T_2)$ is,
\[ (t_0, t_1) \mapsto (-t_1, t_1^2/t_0, -t_1/t_0) \mapsto [-t_1 : -t_1^2/t_0 : -t_1/t_0] = [-t_0 t_1 : -t_1^2 : -t_1] = [ t_0 : t_1 : 1] = (t_0, t_1) \]
Thus we have $\P^2_k \birat Q$ via $(t_0, t_1) \mapsto (-t_1, -t_1^2/t_0, -t_1/t_0)$ on $D(T_0 T_1 T_2) \cong D(XZW)$ and thus, clearing denominators and sending $t_1 \mapsto - t_1$, we get,
\[ Q(L) = \{ [t_0 : t_1 t_0 : - t_1^2 : t_1] \mid t_0, t_1 \in L^\times \} \cup \{ [0 : t_0 : t_1 : 0] \mid t_1, t_2 \in L^\times \} \cup \{ [0 : t_0 : 0 : t_1] \mid t_1, t_2 \in L^\times \} \]

\subsection{6.5 I}

Consider the rational map $c : \P^2_k \rat \P^2_k$ given by $[x : y : z] \mapsto [1/x : 1/y : 1/z]$ on $D(xyz)$. Since $\P^2_k$ is smooth, we can extend over smooth codimension one irreducibles i.e. $V(x)$ and $V(y)$ and $V(z)$ such that $c$ is defined on a dense open of each. In particular, on $D(yz)$ we have $[x : y : z] \mapsto [1 : x/y : x/z]$ is equivalent to $c$ restriced to $D(xyz)$ and likewise on $D(xy)$ and $D(xz)$. Thus,
\[ \Dom{f} \supset D(xy) \cup D(yz) \cup D(zx) = \P^2_k \setminus \{ [1 : 0 : 0], [0 : 1 : 0], [0 : 0 : 1] \} \]
The remaining closed set is codimension two so we generically will not be able to extend over it. Indeed, if we try $[x : y : z] \mapsto  [y : x : xy / z]$ on $D(z)$ then at $[0 : 0 : 1]$ this is not defined so it does not work.


\subsection{6.5 J}

Show that there are no dominant rational maps $\P^1_k \to F^n_k$ where $F^n_k = \Proj{k[X, Y, Z]/(X^n + Y^n - Z^n)}$ is the Fermat curve for $n > 2$.


\section{Which Hypersurfaces are Isomorphic to Projective Space?}

First, what is a hypersurface. 

\begin{defn}
A hypersurface $H \subset \P^n_k$ is a codimension one integral closed subscheme i.e. a prime divisor on $\P^n_k$. 
\end{defn}

\begin{theorem}
Every hypersurface $H \subset \P^n_k$ is of the form $V(F)$ for some $F \in \Gamma(\P^n_k, \struct{\P^n_k}(d))$. 
\end{theorem}

\begin{proof}
Since $H$ is a prime divisor and $\P^n_k$ is locally factorial (in particular regular) then $H$ is Cartier so its associated sheaf of ideals $\I \cong \struct{\P^n}(-d)$ is invertible. Then the inclusion map $\struct{\P^n_k}(-d) \embed \struct{\P^n_k}$ is given by some regular section $F \in \Gamma(\P^n_k, \struct{\P^n_k}(d))$ and thus $H = V(F)$. 
\end{proof}

\begin{rmk}
In the case $n = 1$ hypersurfaces are exactly points and since $\P^0_L = \Spec{L}$ then for any finite extension $L / k$ we can easily find $\Spec{L} \to \P^1_k$ so hypersurfaces of $\P^1_k$ are exactly of the form $\P^0_L$. We wonder how this generalizes to $n > 1$. Furthermore, note that we will use the fact that $H$ is effective Cartier and argue, from the exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \struct{\P^n_k}(-d) \arrow[r] & \struct{\P^n_k} \arrow[r] & \iota_* \struct{H} \arrow[r] & 0
\end{tikzcd}
\end{center}
and the associated LES,
\begin{center}
\begin{tikzcd}
H^0(\P^n_k, \struct{\P^n_k}) \arrow[d, equals] \arrow[r] & H^0(H, \struct{H}) \arrow[r] & H^1(\P^n_k, \struct{\P^n_k}(-d)) \arrow[d]
\\
k & & 0
\end{tikzcd}
\end{center}
to argue that for $n > 1$ we get a surjection $k \onto H^0(H, \struct{H})$ showing that we cannot have extensions of $k$. Note that this argument does not hold for $n = 1$ since $H^1(\P^1_k, \struct{\P^1_k}(-d)) \neq 0$ and we can, in fact, have extensions of the base field.
\end{rmk}

\begin{theorem}
Let $H \subset \P^n_k$ be a degree $d$ hypersurface i.e. $H = V(F)$ for $F \in \Gamma(\P^n_k, \struct{\P^n_k}(d))$ and $n > 1$. Then $H \cong \P^{n-1}_L$ for some $L / k$ exactly when $L = k$ and either $d = 1$ or $n = 2$ and $d = 2$. 
\end{theorem}

\begin{proof}
Suppose that $H \cong \P^{n-1}_L$ and consider the inclusion $\iota : H \embed \P^n_k$ and let $X = \P^n_k$. Then for the ample sheaf $\L = \iota^* \struct{X}(1)$ we have $\L \in \Pic{X} \cong \Pic{\P^{n-1}_L}$ so $\L$ correspond to $\struct{\P^{n-1}_k}(k)$ for some $k \in \Z$. Therefore, we must have,
\[ H^p(H, \L^{\otimes \ell}) = H^p(\P^{n-1}_k, \struct{\P^{n-1}_k}(k\ell)) \]
In particular, 
\begin{align*}
\dim_k H^p(H, \L^{\otimes \ell}) & = (\dim_k L) \cdot
\begin{cases}
{ k \ell + n-1 \choose n-1 } & p = 0
\\
0 & p \neq 0, n-1 
\\
{ - k \ell - 1 \choose n - 1} & p = n-1
\end{cases} 
\end{align*}
Furthermore, since $\iota$ is a closed immersion (and thus affine) we have,
\[ H^p(H, \L^{\otimes \ell}) = H^p(X, \iota_* \L^{\otimes \ell}) = H^p(X, \iota_* \struct{H} \otimes_{\struct{X}} \struct{X}(\ell)) \]
using the projection formula. Then, there is an exact sequence of sheaves,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \I \arrow[d, equals] \arrow[r] & \struct{X} \arrow[r] & \iota_* \struct{H} \arrow[r] & 0
\\
& \struct{X}(-d)
\end{tikzcd}
\end{center}
Twisting by $\struct{X}(\ell)$ gives,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \struct{X}(\ell - d) \arrow[r] & \struct{X}(\ell) \arrow[r] & \iota_* \struct{H} \otimes_{\struct{X}} \struct{X}(\ell) \arrow[r] & 0
\end{tikzcd}
\end{center}
Now denote $\F = \iota_* \struct{H}$ and $\F(\ell) = \F \otimes_{\struct{X}} \struct{X}(\ell)$ which is the sheaf whose cohomology we wish to compute. Taking the LES of cohomology we get,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & H^0(X, \struct{X}(\ell - d)) \arrow[r] & H^0(X, \struct{X}(\ell)) \arrow[r] & H^0(H, \L^{\otimes \ell}) \arrow[r] & H^1(X, \struct{X}(\ell-d)) \arrow[r, equals] & 0
\end{tikzcd}
\end{center}
since $n > 1$. First, for $\ell = 0$ the first sequence gives $H^0(X, \struct{X}) \onto H^0(H, \struct{H})$ and thus $k \onto L$ which is a $k$-morphism so $L = k$ since it is an extension. Furthermore, from the above short exact sequence, we see that,
\[ h^0(H, \L^{\otimes \ell}) = h^0(X, \struct{X}(\ell)) - h^0(X, \struct{X}(\ell - d)) = { \ell + n \choose n} - {\ell - d + n \choose n} \]
In particular, for $d > 1$ and $\ell = 1$ we have,
\[ h^0(H, \L) = h^0(X, \struct{X}(1)) = n + 1 \]
This must equal (since $L = k$),
\[ h^0(H, \L) = { k + n - 1 \choose n - 1} = { k + n - 1 \choose k} = r(k) \]
which is is zero for $k < 0$ and monotonically increasing for $k > 0$. Note that $r(0) = 1$ and $r(1) = n$ and $r(2) = \tfrac{1}{2}(n+1)n$. Since $r(1) < r(2) < r(3)$ and $r(1) = n$ then either $r(2) = n+1$ or $r(k) \neq n + 1$ for all $k$. However, $\tfrac{1}{2} n(n+1) = n + 1$ exacly when $n = 2$ for $n > 0$ forcing the case $n = 2$ when $d > 1$. In particular for the case $n = 2$ and $d = 2$ we get a plane conic which we know is isomorphic to $\P^1_k$. Also, we need to consider the case $d = 1$ in which $H$ is a hyperplane and it is easy to see that $H \cong \P^{n-1}_k$ via the map $\P^{n-1}_k \embed \P^n_k$ defined by $\struct{\P^{n-1}_k}(1)$ and the $n$ sections perpendicular to $F \in \Gamma(\P^n_k, \struct{\P^n_k}(1))$ which has image $H$ proving the claim.
\bigskip\\
Note further that we get,
\begin{center}
\begin{tikzcd}
H^{n-1}(X, \struct{X}(\ell)) \arrow[r] & H^{n-1}(H, \L^{\otimes \ell}) \arrow[r] & H^n(X, \struct{X}(\ell-d)) \arrow[r] & H^n(X, \struct{X}(\ell)) \arrow[r] & H^n(H, \struct{H})
\end{tikzcd}
\end{center}
and otherwise $H^p(X, \struct{X}(\ell)) = H^{p+1}(X, \struct{X}(\ell - d))$ so $H^p(H, \struct{H}) = 0$ for $p \neq 0, n-1$. Since $\dim{H} = n-1$ we have $H^n(H, \struct{H}) = 0$ and also $H^{n-1}(X, \struct{X}(\ell)) = 0$ so we find,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & H^{n-1}(H, \L^{\otimes \ell}) \arrow[r] & H^n(X, \struct{X}(\ell-d)) \arrow[r] & H^n(X, \struct{X}(\ell)) \arrow[r] & 0
\end{tikzcd}
\end{center}
so we have,
\[ h^{n-1}(H, \L^{\otimes \ell}) = h^{n-1}(X, \struct{X}(\ell - d)) - h^{n-1}(X, \struct{X}(\ell)) = { d - \ell - 1 \choose n } - { - \ell - 1 \choose n} \]
which does have the correct degree in $(-\ell)$ i.e. $n-1$ to be $h^{n-1}(\P^{n-1}_k, \struct{\P^{n-1}_k}(k\ell))$.
\end{proof}




\section{Random Comalg Facts}

\begin{lemma}
Let $(p_1)$ and $(p_2)$ be incommensurable prime ideals. Then $(p_1) \cap (p_2) = (p_1 p_2)$.
\end{lemma}

\begin{proof}
Clearly $(p_1 p_2) \subset (p_1) \cap (p_2)$ so it suffices to show that if $a = p_1 x = p_2 y$ then $a \in (p_1 p_2)$. Since $a \in (p_1)$ and $p_2 \notin (p_1)$ we get $y \in (p_1)$ and likewise $x \in (p_2)$ showing that $a \in (p_1 p_2)$. 
\end{proof}

\section{Open Questions}

\begin{enumerate}
\item Coproducts in the Category of Schemes vs Affine Schemes why are they different but agree with LRS coproducts in the first case which agree with Top coproducts since the Forget : LRS $\to$ Top has a right-adjoint (Raymond chat).
\item Which Hypersurfaces are Rational?  GOOD QUESTION. I think all quadric hypersurfaces are rational even though only the conic $X^2 + Y^2 - Z^2$ is on the nose isomorphic to $\P^1_k$. Can we prove this? Projection from a point?
\item Example of an affine curve which does not embed in $\A^2_k$
\item Does unirational imply finite domination by rational variety in general?
\end{enumerate}

\section{To Do on Thesis}

\begin{enumerate}
\item Example of non-arithmetic curve with no $\Delta_{\nu}$-regular equation, try the think with weakly $\Delta$-nondegenerate by never $\Delta$-nondegenerate.
\item Is the elliptic curve example I gave toric?
\item find example which is toric: use the 
\item Explicit example of curve not on toric surface?
\item Explicit example of curve not on a Hirzburch surface?
\item Example of curve which is toric but never weakly $\Delta$-nondegenerate?
\item 
\end{enumerate}


\section{When is a Sheaf a Pushforward}

THE FOLLOWING IS NOT QUITE CORRECT BUT APPROXIMATELY

\begin{lemma}
Let $\iota : f : Z \embed X$ be a closed embedding and $U = X \setminus Z$. Then if $\F$ is a sheaf of $\struct{X}$-modules then $\F = \iota_* \iota^{-1} \F$ if and only if $\F |_U = 0$. Furthermore, $\F = \iota_* \iota^* \F$ if and only if $\I \cdot \F = 0$ where $\I$ is the ideal sheaf of $Z \embed X$. Furthermore, if $Z$ is reduced then these notions agree. 
\end{lemma}

\begin{proof}

\end{proof}

\begin{rmk}
Given simply topological maps, a sheaf $\F$ is a pushforward of some sheaf on a closed subset exactly when it is zero on the complement. However, if we ask for this sheaf to be the pushforward of a sheaf of $\struct{Z}$-modules then we need the stronger $\I \cdot \F = 0$. 
\end{rmk}

\section{Cayley-Hamilton}

\begin{theorem}
Let $A \in \mathrm{M}_{n}(R)$ be a square matrix over a ring $R$ and $p_A(\lambda) = \det{(\lambda I - A)}$ be its characteristic polynomial. Then $p_A(A) = 0$.
\end{theorem}

\begin{proof}
First, I argue in the case that $R = k$ is a field.
Matrices $A \in \mathrm{M}_n(k)$ correspond to closed points of $X = \A^{n^2}_k = \Spec{k[a_{ij}]}$. Now the fundamental observation is that $p_A(A)$ is a matrix of polynomials in $a_{ij}$ and thus gives a morphism $p : X \to X$ via the ring map $k[a_{ij}] \to k[a_{ij}]$ sending $a_{ij}$ to the $i,j$ entry of the matrix $p_A(A)$ with $A = (a_{ij})$. 
\bigskip\\
Now, if $p_A$ is seperable (i.e. has distinct roots over $\bar{k}$) then $A$ is diagonalizable over $\bar{k}$ (eigenvectors with distinct eignevalues are independent). Then $A = B D B^{-1}$ with $D$ diagonal (these matrices defined over $\bar{k}$) and it is clear that $p_A(B D B^{-1}) = B p_A(D) B^{-1} = 0$ since $p_A(\lambda) = 0$ for each eigenvalue. Furthermore, this case occurs exactly when the discriminant $\Delta(p_A) \neq 0$ which is a polynomial in $a_{ij}$ so $\Delta : X \to \A^1_k$ gives a global function. We have shown that for any closed point $A \in D(\Delta)$, i.e. some matrix over $\bar{k}$ with $\Delta(p_A) = 0$, that  $p_A(A) = 0$ so the map $p : X \to X$ vanishes on the closed points of $D(\Delta)$ which is dense since it is open and nontrivial (any diagonal matrix over $\bar{k}$ with nonrepeated entries satisfies this, I guess I used $\bar{k}$ is infinite here) in an irreducible variety $X$. Thus $p : X \to X$ is the zero map since it vanishes on a dense set (using that $X$ is a variety). In particular $p$ is the zero polynomial in $a_{ij}$.
\bigskip\\
Now, for an arbitrary ring $R$ take a matrix $A \in \mathrm{M}_n(R)$ then $p(a_{ij}) = p_A(A)$ is an integer coefficient polynomial in $a_{ij}$ (meaning the coefficients are in the image $\Z \to R$). However, for each prime $\p \in \Spec{R}$, the above argument shows that $\overline{p_A(A)} \in \kappa(\p)$ is zero since it is the characteristic polynomial applied to the matrix $\overline{A} \in \mathrm{M}_n(\kappa(\p))$ over the field $\kappa(\p)$. Thus $p_A(A) \in \p$ for each $\p \in \Spec{R}$ so $p_A(A) \in \nilrad{R}$ for any $A$ thus the coefficents are in $\nilrad{R}$ (we can see this because reducing $p$ in $\kappa(\p)$ gives the zero polynomial). However, the coefficients are in the image of $\Z \to R$ then $\nilrad{R} \cap \Im{\Z} = \nilrad{\Z / (n)}$ where $n = \ker{(\Z \to R)}$ 
(DAMN DOESNT WORK)
\end{proof}

\section{Quasi-Compactness and Noetherian Spaces}

\begin{defn}
A topological space $X$ is Noetherian if every descending chain of closed sets stabilizes.
\end{defn}

\begin{lemma}
Subspaces of Noetherian subspaces are Noetherian.
\end{lemma}

\begin{proof}
Let $S \subset X$ with $X$ noetherian. Then the closed sets of $S$ are exactly $S \cap Z$ for $Z \subset X$ closed. Thus descending chains of closed sets in $S$ stabilize.
\end{proof}

\begin{defn}
A space is quasi-compact if every open cover has a finite subcover.
\end{defn}

\begin{lemma}
Noetherian spaces are quasi-compact. 
\end{lemma}

\begin{proof}
Let $U_{\alpha}$ be an open cover of $X$ which is Noetherian. Then consider the poset $A$ under inclusion of finite unions of the $U_\alpha$ all of which are open sets of $X$. Since $X$ is Noetherian any ascending chain of opens must stabilize so any chain in $A$ has a maximum. Then by Zorn's lemma $A$ has a maximal element which must be $X$ since the $U_\alpha$ form a cover. Therefore there exists a finite subcover.
\end{proof}

\begin{cor}
Every subset of a noetherian topological space is quasi-compact.
\end{cor}

\begin{defn}
A continuous map $f : X \to Y$ is quasi-compact if for each quasi-compact open $U \subset Y$ then $f^{-1}(U)$ is quasi-compact open.
\end{defn}

\subsection{Irreducible Components}

\begin{lemma}
Let $Z \subset X$ be irreducible. Then $\overline{Z} \subset X$ is irreducible.
\end{lemma}

\begin{proof}
Suppose that $\overline{Z} = Z_1 \cup Z_2$ with $Z_1$ and $Z_2$ closed. Then $Z \subset Z_1 \cup Z_2$ so either $Z \subset Z_1$ or $Z \subset Z_2$. But since $Z_1$ and $Z_2$ are closed, we get $\overline{Z} = Z_1$ or $\overline{Z} = Z_2$. 
\end{proof}

\begin{lemma}
Increasing unions of irreducible subsets are irreducible.
\end{lemma}

\begin{proof}
Consider a chain $T$ of irreducible subsets and consider,
\[ U = \bigcup_{S \in T} S \]
Suppose $U = Z_1 \cup Z_2$ for closed subsets $Z_1$ and $Z_2$ of $U$. Then for each $S \in T$ we have $S \subset Z_1$ or $S \subset Z_2$. If for some $S_0 \in T$ we have $S_0 \not\subset Z_2$ (otherwise $Z_2 \supset U$ and we are done) then $S_0 \subset Z_1$ and for any $S \in T$ with $S \supset S_0$ we cannot have $S \subset Z_2$ else $S_0 \subset Z_2$. Therefore, $S \subset Z_1$. For any $S \in T$, since $T$ is totally ordered, either $S \subset S_0$ in which case $S \subset Z_1$ or $S \supset S_0$ in which case $S \subset Z_1$ (as we have just shown). Therefore, $U \subset Z_1$ so $U$ is irreducible.
\end{proof}

\begin{defn}
Let $X$ be a topological space then its irreducible components are the maximal irreducible subsets of $X$.
\end{defn}

\begin{rmk}
The irreducible subsets of $X$ form a poset under inclusion. Furthermore, since chains have a maximum, by Zorn's lemma $X$ always has some irreducible component.  
\end{rmk}

\begin{lemma}
Let $X$ be a topological space. The following hold,
\begin{enumerate}
\item irreducible components are closed
\item every irreducible subset of $X$ is contained in some irreducible component
\item the irreducible components of $X$ cover $X$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $C \subset X$ be an irreducible component. Then $\overline{C}$ is irreducible and $S \subset \overline{C}$ so $\overline{C} = C$ by maximality. Thus, $C$ is closed. For any irreducible set $S \subset X$, Zorn's Lemma gives a maximal element in the irreducible components above $S$ i.e. $S \subset C$ is contained in some irreducible component. In particular, since any point $x \in X$ is irreducible so $x \in C$ is contained in some irreducible component. Thus the irreducible components cover $X$.
\end{proof}

\begin{lemma}
Noetherian spaces have finitly many irreducible components.
\end{lemma}

\begin{proof}
Let $S$ be the poset of closed subspaces with infinitely many components ordered by inclusion. By the Noetherian hypothesis, descending chains in $S$ have minima so, by Zorn's lemma, $S$ has a minimum $Z$ which has infinitely many irreducible components. Clearly, $Z$ cannot be irreducible so we can write $Z = Z_1 \cup Z_2$ with $Z_1, Z_2 \subsetneq Z$ are proper closed subsets. By minimality, $Z_1, Z_2 \notin S$ and thus $Z_1, Z_2$ have finitely many irreducible components. Thus, $Z = Z_1 \cup Z_2$ has finitely many irreducible components so $S$ is empty. 
\end{proof}



\subsection{The Case for Schemes}


\begin{lemma}
Affine schemes are quasi-compact.
\end{lemma}

\begin{proof}
Let $U_i$ be an open cover of $\Spec{A_i}$. Since $D(f)$ for $f \in A$ forms a basis of the topology on $\Spec{A_i}$ we can shrink to the case $U_i = D(f_i)$. Then.
\[ X = \bigcup_{i  \in I} D(f_i) = \bigcup_{i \in I} D(( \{ f_i \mid i \in I \} )) \]
And thus the ideal $I = ( \{ f_i \mid i \in I \} )$ is not contained in any maximal ideal so $I = (1)$. Therefore, there are $f_1, \dots, f_n$ such that $a_1 f_1 + \cdots a_n f_n = 1$ and thus $(f_1, \dots, f_n) = (1)$ which implies that,
\[ X = D((f_1, \dots, f_n)) = \bigcup_{i = 1}^n D(f_i) \]
so $X$ is quasi-compact.
\end{proof}

\begin{defn}
A scheme $X$ is \textit{locally Noetherian} if for every affine open $U$ the ring $\struct{X}(U)$ is Noetherian. $X$ is \textit{Noetherian} if it is quasi-compact and locally-Noetherian. 
\end{defn}

\begin{lemma}
If $(f_1, \dots, f_n) = A$ and $A_{f_i}$ is Noetherian then $A$ is Noetherian.
\end{lemma}

\begin{proof}
For any ideal $I \subset A$ we know $I_{f_i} \subset A_{f_i}$ is finitely generated. Clearing denominators and collecting the finite union of these finite generators gives a map $A^N \to I$ which is surjective when localized $A^N_{f_i} \onto I_{f_i}$. Consider the $A$-module $K = \coker{(A^N \to I)}$ then for any $x \in K$ we have $f_i^{n_i} \cdot x = 0$ for each $i$ but $f_i^{n_i}$ generate the unit ideal (since $D(f_i^{n_i}) = D(f_i)$ which cover $\Spec{A}$) so $x = 0$ to $A^N \onto I$ so $I$ is finitely generated showing that $A$ is Noetherian.
\end{proof}

\begin{lemma}
If $X$ has an open affine cover $U_i = \Spec{A_i}$ with $A_i$ noetherian then $X$ is locally noetherian. Moreover, if the cover can be made finite then $X$ is noetherian. 
\end{lemma}

\begin{proof}
Let $V = \Spec{B} \subset X$ be an affine open, Then $V \cap U_i \subset V$ is open so it may be covered by principal opens $D(f_{ij}) \subset V \cap U_i$ for $f_{ij} \in B$. Since $V$ is quasi-compact we may find a finite subcover. We need to show that $B_{f_{ij}}$ is Noetherian then since $D(f_{ij})$ cover $V$ we use the lemma to conclude that $B$ is Noetherian. However, $D(f_{ij}) \subset V \cap U_i$ can be covered by principal opens (of $U_i = \Spec{A_i}$) $W_{ijk} \subset D(f_{ij}) \subset U_i = \Spec{A_i}$ and each $(A_i)_{f_{ijk}}$ is Noetherian since $A_i$ is. Now $W_{ijk}$ is a principal affine open of $D(f_{ij})$ so using the same lemma we find that $B_{f_{ij}}$ is Noetherian.
\bigskip\\
Now suppose the cover is finite and let $V_j$ be any open cover of $X$. We need to show $X$ is quasi-compact so we must show that $V_i$ has a finite subcover. Consider $U_i \cap V_j$  which is open in the affine $U_i = \Spec{A_i}$ so it may be covered by principal opens $D(f_{ijk}) \subset U_i \cap V_j$. Now,
\[ U_i = \bigcup_{j,k} D(f_{ijk}) \]
but $U_i$ is affine and thus quasi-compact so we may find an finite subcover which only uses finitely many $V_i$ but the cover $U_i$ of $X$ is also finite so only finitely many $V_i$ are needed to cover $X$.  
\end{proof}

\begin{cor}
$X = \Spec{A}$ is Noetherian iff $A$ is a Noetherian ring.
\end{cor}

\begin{proof}
If $X$ is Noetherian then $\struct{X}(X) = A$ is a Noetherian ring ($X$ is affine and thus quasi-compact). Conversely $\Spec{A}$ is a finite Noetherian affine cover so $X$ is Noetherian.
\end{proof}

\begin{rmk}
It is not the case that for a Noetherian scheme we must have $\struct{X}(X)$ a noetherian ring even for varieties. See http://sma.epfl.ch/~ojangure/nichtnoethersch.pdf. 
\end{rmk}

\begin{cor}
A Noetherian ring has finitely many minimal primes.
\end{cor}

\begin{proof}
Let $A$ be Noetherian then primes $\p \in \Spec{A}$ correspond to irreducible closed subsets $V(\p)$ and thus minimal primes correspond to irreducible components of $\Spec{A}$. Therefore, since $\Spec{A}$ is Noetherian, we see that $\Spec{A}$ has finitely many irreducible components and thus finitely many minimal primes. 
\end{proof}

\begin{lemma}
If $A$ is Noetherian then $\Spec{A}$ is a Noetherian topological space.
\end{lemma}

\begin{proof}
Every descending chain of subsets is of the form $V(I_1) \supsetneq V(I_2) \supsetneq V(I_3) \supsetneq \cdots$ but the ideals,
\[ \sqrt{I_1} \subsetneq \sqrt{I_2} \subsetneq \sqrt{I_3} \subsetneq \cdots \]
satbilize since $A$ is Noetherian and thus so does the chain of closed subsets.
\end{proof}

\begin{lemma}
If $X$ is a Noetherian scheme then its underlying topological space is Noetherian.
\end{lemma}

\begin{proof}
Choose a finite covering $U_i = \Spec{A_i}$ by Noetherian rings. Then for any descending chain of closed subsets $Z_1 \supsetneq Z_2 \supsetneq Z_3 \supsetneq \cdots$ we know $Z \cap U_i$ stabilizes at $n_i$ since $\Spec{A_i}$ is a Noetherian space. Thus, $Z$ satibilizes at $\max{n_i}$ which exists since the cover is finite. 
\end{proof}

\begin{rmk}
The converses of the above are false and so is $X$ Noetherian. Let $R$ be a non-Noetherian valuation ring. Then $\Spec{R}$ has two points and thus is Noetherian as a topological space but not as a scheme since $R$ is not a Noetherian ring. 
\end{rmk}

\begin{lemma}
If $X$ is locally Noetherian then any immersion $\iota : Z \embed X$ is quasi-compact.
\end{lemma}

\begin{proof}
Closed immersions are affine and thus quasi-compact so it suffices okay to show that open immersions are quasi-compact. Let $j : U \to X$ be an open immersion. It suffices to check that $j^{-1}(U_i)$ is quasi-compact on an affine open cover $U_i = \Spec{A_i}$ with $A_i$ Noetherian. But $j : j^{-1}(U_i) \to U_i \cap U$ is a homeomorphism and $\Spec{A_i}$ is a Noetherian topological space so every subset is quasi-compact and, in particular, $U_i \cap U$ is quasi-compact so $j^{-1}(U_i)$ is also.
\end{proof}

\begin{rmk}
When $X$ is Noetherian then it is a Noetherian space so any inclusion map $\iota : Z \embed X$ for \textit{any} subset $Z \subset X$ is quasi-compact since every subset is quasi-compact. In particular, every subset of $X$ is retrocompact. 
\end{rmk}

\subsection{Quasi-Compact Morphisms}

\begin{lemma}
A morphism $f : X \to Y$ is quasi-compact iff $Y$ has a cover by affine opens $V_i$ such that $f^{-1}(V_i)$ is quasi-compact.
\end{lemma}

\begin{proof}
Clearly if $f$ is quasi-compact then any affine open cover $V_i$ of $Y$ satisfies $f^{-1}(V_i)$ is quasi-compact since $V_i$ is a quasi-compact open by virtue of being affine open.
\bigskip\\
Now assume that such a cover exists. Let $U \subset Y$ be a quasi-compact open. Then $U$ is covered by finitely may $V_1, \dots, V_n$. Then $U \cap V_i$ is open in $V_i$ which is affine so it is covered by standard opens $W_{ij}$. Since $U$ is quasi-compact then we can choose finitely many $W_{ij}$. Now $f^{-1}(V_i)$ is quasi-compact by assumption so it has a finite cover by affine opens,
\[ f^{-1}(V_i) = \bigcup_{j = 1}^N \tilde{V}_{ij} \]
Then $f : \tilde{V}_{ik} \to V_i$ is a morphism of affine schemes so $f^{-1}(W_{ij}) \cap \tilde{V}_{ik}$ is a principal affine. Therefore,
\[ f^{-1}(U) = \bigcup_{i = 1}^n f^{-1}(V_i \cap U) = \bigcup_{i,j} f^{-1}(W_{ij}) = \bigcup_{i,j,k} f^{-1}(W_{ij}) \cap \tilde{V}_{ik} \]
is a finite union of principal affines each of which is quasi-compact so $f^{-1}(U)$ is quasi-compact. 
\end{proof}

\begin{proposition}
$X$ is quasi-compact iff any morphism $X \to T$ for some affine scheme $T$ is quasi-compact.
\end{proposition}

\begin{proof}
If $X$ is quasi-compact then $f : X \to T$ is quasi-compact since $T$ is an affine open cover of itself and $f^{-1}(T)$ is quasi-compact. Conversely, if $f : X \to T$ is quasi-compact with $T$ affine then $T$ is quasi-compact open in $T$ so $X = f^{-1}(T)$ is quasi-compact.
\end{proof}

\begin{lemma}
The base change of a quasi-compact morphism is quasi-compact.
\end{lemma}

\begin{proof}
(DO THIS)
\end{proof}

\section{Affine Morphisms}

\begin{defn}
A morphism $f : X \to Y$ is \textit{affine} if the preimage of every affine open is affine.
\end{defn}

\begin{lemma}
A composition of affine morphisms is affine.
\end{lemma}

\begin{proof}
If $f : X \to Y$ and $g : Y \to Z$ are affine then for any affine open $U \subset Z$ we know $(g \circ f)^{-1}(U) = f^{-1}(g^{-1}(U))$ but $g^{-1}(U)$ is affine open so $(g \circ f)^{-1}(U) = f^{-1}(g^{-1}(U))$ is affine open.
\end{proof}

\begin{lemma}
Every morphism of affine schemes is affine and thus quasi-compact.
\end{lemma}

\begin{proof}
Let $X = \Spec{A}$ and $Y = \Spec{B}$ and $f : X \to Y$ be a morphism of affine schemes given by a ring map $\varphi : B \to A$. Then, any affine open $\Spec{C} = V \subset Y$ can be covered by principal opens $D(f_i)$ for $f_i \in B$. Note that under $\psi : B \to C$ we see that $D(f_i) = D(\psi(f_i))$ since $D(f_i) \subset \Spec{C}$. Since $D(\psi(f_i))$ cover $\Spec{C}$ then $\psi(f_i) \in C$ generate the unit ideal. Then we have $f^{-1}(D(f_i)) = D(\varphi(f_i))$ which is affine and $\varphi(f_i)$ generate the unit ideal of $\Gamma(f^{-1}(V), \struct{X})$ so $f^{-1}(V)$ is an affine scheme and thus $f^{-1}$ is affine.
\end{proof}

\begin{rmk}
An alternative proof goes as follows. Consider the pullback diagram,
\begin{center}
\begin{tikzcd}
f^{-1}(U) \arrow[d, hook] \arrow[r] & U \arrow[d, hook]
\\
X \arrow[r] & Y
\end{tikzcd}
\end{center}
then open immersions are stable under base change so $f^{-1}(U) = U \times_Y X = \Spec{C \otimes_B A}$ is affine.
\end{rmk}

\begin{rmk}
In fact, by Tag 01S8, a morphism $f : X \to S$ is affine iff $X$ is relatively affine over $S$ meaning $X = \rSpec{S}{\mathcal{A}}$ for some quasi-coherent $\struct{S}$-algebra $\mathcal{A}$. 
\end{rmk}

\begin{lemma}
Let $f : X \to Y$ be a morphism and $W_i$ an affine open cover of $Y$ such that $f^{-1}(W_i)$ is affine. Then $f$ is affine.
\end{lemma}

\begin{proof}
Let $\Spec{A} = V \subset Y$ be affine open. Then $V_i = V \cap W_i$ is open in the affine open $V = \Spec{A}$ so it can be covered by principal opens $D(f_{ij}) \subset V \cap W_i$ for $f_{ij} \in A$. Since $f : f^{-1}(W_i) \to W_i$ is a morphism of affine schemes, the preimage of the affine open $D(f_{ij}) \subset V \cap W_i$ is affine $f^{-1}(D(f_{ij}))$ (note that $D(f_{ij}) \subset V \cap W_i$ is not necessarily a prinicpal affine open of $W_i$). But since $D(f_{ij})$ cover $\Spec{A}$ the $f_{ij} \in A$ generate the unit ideal and thus $f^\#(f_{ij}) \in \Gamma(f^{-1}(V), \struct{X})$ generate the unit ideal and $(f^{-1}(V))_{f_{ij}} = f^{-1}(D(f_{ij}))$ is affine so $f^{-1}(V)$ is affine.
\end{proof}

\begin{rmk}
We can alternatively use Nike's trick. Cover $V \cap W_i$ by $U_{ij}$ which are prinicpal affines of both $V$ and $W_i$. Then $f : f^{-1}(W_i) \to W_i$ takes the prinicpal affine open $U_{ij}$ of $W_i$ to a prinicpal affine open $f^{-1}(U_{ij})$ and thus $f^{-1}(V)$ is covered by affine opens such that $f^{-1}(U_{ij}) = (f^{-1}(V))_{f_{ij}}$ where $U_{ij} = \Spec{A_{f_{ij}}}$ since $U_{ij}$ is also a principal affine open of $V$ and thus $(f_{ij}) = A$ so $f^\#(f_{ij}) \in \Gamma(f^{-1}(V), \struct{X})$ generate the unit ideal proving that $f^{-1}(V)$ is affine. 
\end{rmk}

\begin{lemma}
The base change of an affine morphism is affine. 
\end{lemma}

\begin{proof}
Let $f : X \to Y$ be an affine morphism and $g : Y' \to Y$ any morphism. Cover $Y'$ and $Y$ by affine opens $U_i$ and $V_i$ such that $g : U_i \to V_i$. Then $f' : X \times_Y Y' \to Y'$ takes,
\[ f'^{-1}(U_i) = (X \times_Y Y') \times_{Y'} U_i = X \times_Y U_i = X \times_Y V_i \times_{V_i} \times U_i = f^{-1}(V_i) \times_{V_i} \times U_i \]
which is affine because $U_i$ and $V_i$ are affine and thus $f^{-1}(V_i)$ is affine. Since $Y'$ has an affine open cover which pulls back   to an affine open cover under $f'$ we see that $f'$ is affine by the previous lemma.
\end{proof}


\begin{lemma}
Affine morphisms are quasi-compact.
\end{lemma}

\begin{proof}
If $f : X \to Y$ is affine then any affine open cover $V_i$ of $Y$ gives $f^{-1}(V_i)$ is affine and thus quasi-compact so $f$ is quasi-compact. 
\end{proof}



\section{Separatedness}

\begin{defn}
A morphism $f : X \to Y$ with diagonal $\Delta_{X/Y} : X \to X \times_Y X$ is,
\begin{enumerate}
\item \textit{separated} if the diagonal $\Delta_{X/Y}$ is a closed immersion
\item \textit{affine-separated} if the diagonal $\Delta_{X/Y}$ is affine
\item \textit{quasi-separated} if the diagonal $\Delta_{X/Y}$ is quasi-compact
\end{enumerate}
\end{defn}

\begin{lemma}
Any morphism of affine schemes is separated. Furthermore, affine morphisms are separated.
\end{lemma}

\begin{proof}
For a map $\Spec{A} \to \Spec{B}$ the diagonal is $\Spec{A} \to \Spec{A \otimes_B A}$ given by $A \otimes_B A \to A$ via $a_1 \otimes a_2 \mapsto a_1 a_2$ which is surjective so the diagonal is a closed immersion. The second fact is Tag 01S7.
\end{proof}

\begin{lemma}
The composition of (quasi/affine)-separated morphisms are (quasi/affine)-separated. 
\end{lemma}

\begin{proof}
Let $f : X \to Y$ and $g : Y \to Z$ be (quasi/affine)-separated. Then,
\[ \Delta_{X/Z} = \Delta_{Y/Z}' \circ \Delta_{X/Y} : X \to X \times_Y X \to X \times_Z X \]
where $\Delta_{Y/Z}' : X \times_Y X \to X \times_Z X$ is the following base change (use magic square),
\begin{center}
\begin{tikzcd}
X \times_Y X \arrow[r, "\Delta_{Y/Z}'"] \arrow[d] &  X \times_Z X \arrow[d, "f \times f"] 
\\
Y \arrow[r, "\Delta_{Y/Z}"] & Y \times_Z Y
\end{tikzcd}
\end{center}
However, closed immersions / affine morphisms / quasi-compact morphisms are preserved under base change and composition and thus $\Delta_{X/Z}$ has the corresponding property.
\end{proof}

\begin{lemma}
The base change of (quasi/affine)-separated morphisms are (quasi/affine)-separated. 
\end{lemma}

\begin{proof}
Let $f : X \to Y$ be (quasi/affine)-separated morphism over $S$ and $g : Z \to S$ a base change morphism. Then I claim the following diagram is cartesian,
\begin{center}
\begin{tikzcd}
X_Z \arrow[r, "\Delta_{X_Z/Y_Z}"] \arrow[d] & X_Z \times_{Y_Z} X_Z \arrow[d]
\\
X \arrow[r, "\Delta_{X/Y}"] & X \times_Y X
\end{tikzcd}
\end{center}
Therefore, $\Delta_{X_Z/Y_Z}$ is the base change of $\Delta_{X/Y}$ and the immersion properties of $\Delta_{X/Y}$ are preserved under base change.
\end{proof}

\begin{lemma}
For any morphism $f : X \to Y$ the diagonal $\Delta_{X / Y} : X \to X \times_Y X$ is an immersion.
\end{lemma}

\begin{proof}
Let $V_i$ be an affine cover of $Y$ then choose an affine open cover $U_{ij}$ of $X$ with $f(U_{ij}) \subset V_i$. Then the diagonal of the affine map $U_{ij} \to V_j$ is $U_{ij} \to U_{ij} \times_{V_i} U_{ij}$ which is a closed immersion since it corresponds to $A_{ij} \otimes_{B_i} A_{ij} \to A_{ij}$ via $a_1 \otimes a_2 \mapsto a_1 a_2$ is surjective. Therefore $f : X \to Y$ is locally on $X$ a closed immersion and thus an immersion. 
\end{proof}

\begin{rmk}
Therefore, to show that $f : X \to Y$ is separated, it suffices to show that the diagonal is closed (here equivalently meaning that the map or its image is closed). 
\end{rmk}

\begin{lemma}
If $X$ is Noetherian then every morphism $f : X \to S$ is quasi-compact and quasi-seperated. 
\end{lemma}

\begin{proof}
Every subset of $X$ is quasi-compact since $X$ is (topologically) Noetherian. Then apply the first part to the diagonal $\Delta_{X/S} : X \to X \times_S X$ which is then quasi-compact and thus $f : X \to S$ is quasi-separated.
\end{proof}

\begin{lemma}
Let $f : X \to S$ be affine-separated/quasi-separated with $S = \Spec{A}$ affine. Then for any two affine opens $U, V \subset X$ the intersection $U \cap V$ is affine/quasi-compact. 
\end{lemma}

\begin{proof}
Consider the pullback diagram,
\begin{center}
\begin{tikzcd}
U \cap V \arrow[d, hook] \arrow[r] & U \times_S V \arrow[d, hook]
\\
X \arrow[r, "\Delta_{X/S}"] & X \times_S X 
\end{tikzcd}
\end{center}
where $U \cap V = \Delta_{X/S}^{-1}(U \times_S V)$ using the basechange of an open immersion is an open immersion. Then since $S$ is affine, $U \times_S V$ is affine and thus quasi-compact open of $X \times_S X$. Then if $f$ is affine-separated then $\Delta_{X/S}$ is affine so $U \cap V = \Delta_{X/S}^{-1}(U \times_S V)$ is affine. If $f$ is quasi-separated then $\Delta_{X/S}$ is quasi-compact so $U \cap V = \Delta_{X/S}^{-1}(U \times_S V)$ is quasi-compact.
\end{proof}

\begin{rmk}
In the separated case, we see that $U \cap V$ is affine and $\struct{X}(U) \otimes_{\struct{S}(S)} \struct{X}(V) \to \struct{X}(U \cap V)$ is surjective.
\end{rmk}

\begin{rmk}
Tag 01KO gives a generalization of this lemma. For the separated case see Tag 01KP.
\end{rmk}

\begin{lemma}
Let $f : X \to Y$ be quasi-compact and quasi-separated and $\F$ be a quasi-coherent $\struct{X}$-module then $f_* \F$ is a quasi-coherent $\struct{Y}$-module.
\end{lemma}

\begin{proof}
Sinsce this is local on $Y$ we can restrict to the case that $Y$ is affine. Then   $X = f^{-1}(Y)$ is quasi-compact (when $Y$ is not affine $f^{-1}(V)$ will be quasi-compact) so take a finite affine open cover $U_i$ and since $f : X \to Y$ is quasi-seperated over an affine then by the above lemma $U_i \cap U_j$ is quasi-compact so it has a finite affine open cover $U_{ijk}$. Then, by the sheaf property, there is an exact sequence of sheaves on $Y$
\begin{center}
\begin{tikzcd}
0 \arrow[r] & f_* \F \arrow[r] & \bigoplus\limits_{i} f_* (\F|_{U_i}) \arrow[r] & \bigoplus\limits_{ijk} f_* (\F|_{U_{ijk}}) 
\end{tikzcd}
\end{center}
which works because these are finite sums. However, $f : U_{ijk} \to Y$ is a morphism of affine schemes and since $\F$ is quasi-coherent we have $\F |_{U_{ijk}} = \wt{M_{ijk}}$ so $f_* (\F|_{U_{ijk}}) = \wt{M_{ijk}}$ as an $\struct{Y}(Y)$-module. Thus, $f_* \F$ is a kernel of quasi-coherent $\struct{Y}$-modules and thus is quasi-coherent. 
\end{proof}

\begin{rmk}
If $X$ is Noetherian then $f : X \to Y$ is automatically quasi-compact and quasi-separated so there is no issue in the above lemma.
\end{rmk}

\section{Sets Cut Out By Some Function}

\newcommand{\R}{\mathbb{R}}

\begin{theorem}
Every closed subset $E \subset \R^n$ is the vanishing of some smooth function.
\end{theorem}

\begin{proof}
Since $\R^n$ is a metric space, it is hereditarily paracompact so the complement $E^C \subset \R^n$ is paracomapct. Since $\R^n$ is seperable, $E^C$ is covered by countably many balls $B_{r_i}(a_i)$ for $a_i \in E^C$ since it is open so, by paracompactness, we may shrink the radii such that this cover is locally finite. Choose a smooth bump function, 
\[ g : [0, \infty) \to [0, \infty) \]
such that $g([0, 1)) > 0$ and $g([1, \infty)) = 0$ e.g. 
\[ g(x) = 
\begin{cases}
\exp{\left( - \frac{1}{1 - x} \right)} & x < 1
\\
0 & x \ge 1
\end{cases} \]
Then consider,
\[ f(x) = \sum_{x \in X} g(|x - a_i|/r_i) \]
Since $g(|x - a_i|/r_i) = 0$ for $x \notin B_{r_i}(a_i)$ and the cover is locally finite, this is a finite sum so $f$ is well-defined and smooth. Furthermore, 
\[ f(x) = 0 \iff x \notin \forall i \in I : x \notin B_{r_i}(a_i) \iff x \notin E^C \iff x \in E \]
\end{proof}

\begin{rmk}
This esaily generalizes to show that any closed subset $Z \subset X$ of a smooth manifold is cut out by closed sets.
\end{rmk}
\noindent
Our next question is what does the vanishing of analytic or holomorphic functions look like. We have one result.

\begin{prop}
A nontrivial vanishing set of analytic functions in $\R^n$ (or holomophic functions in $\mathbb{C}^n$) has positive codimension. Explicitly, it does not contain any nonempty open. 
\end{prop}

\begin{proof}
This is clear because analytic and holomorphic functions which vanish on a nonempty open vanish everywhere. 
\end{proof}

\section{The Topology of Schemes}

Here I want to ask what the topology of schemes ``looks like'' from the perspective of algebraic topology. The importance of the analytification functor $X \mapsto X^\an$ is that it alows us to compute the ``correct'' topological invariants to complex varieties. However, what happens if we try to compute algebraic topology on the Zariski topology?

\begin{lemma}
Suppose $X$ is a topological space with a dense point $\xi \in X$. Then $X$ is contractible.
\end{lemma}

\begin{proof}
Consider the homotopy $h : X \times I \to X$ defined by,
\[ h(x, t) = 
\begin{cases}
x & t = 0
\\
\eta & t > 0
\end{cases} \]
This is continuous because no nontrivial closed set $Z \subset X$ contains $\xi$ so $h^{-1}(Z) = Z \times \{ 0 \}$ which is closed. Furthermore $h^{-1}(X) = X \times I$ so $h$ is continuous. 
\end{proof}

\begin{rmk}
In particular, we see that every irreducible scheme is contractible. 
\end{rmk}
\noindent\\
However, there are example of varieties which have nontrivial homotopy type. 

\begin{example}
https://math.stackexchange.com/questions/2701914/connected-non-contractible-schemes
\end{example}

\section{Ample Invertible Sheaves}

DO THIS!!!!!

\subsection{ of Ample Divisor is Affine}

\begin{rmk}
Recall that $X_s = \{ x \in X \mid s_x \notin \m_x \L_x \}$ is open since under a local trivialization this is $\tilde{s}_x \notin \m_x$ and this happens exactly when $s$ is locally invertible an open condition.
\end{rmk}

\begin{rmk}
The following is Grothendieck's definition of Ampleness.
\end{rmk}

\begin{defn}
Let $X$ be quasi-compact. Then an invertible $\struct{X}$-module $\L$ is ample if for each $x \in X$ there exists $n \ge 1$ and $s \in \Gamma(X, \L^{\otimes n})$ such that $x \in X_s$ and $X_s$ is affine.
\end{defn}

\begin{theorem}
Let $\L$ be ample on quasi-compact $X$ and $s \in \Gamma(X, \L)$ then $X_s$ is affine.
\end{theorem}

\begin{proof}
We know that $s : \struct{X_s} \to \L|_{X_s}$ is an isomorphism. For each $x_i \in X_s$ we can choose $n_i \ge 1$ and $s_i \in \Gamma(X, \L^{\otimes n_i})$ such that $X_{s_i}$ is affine and $x_i \in X_{s_i}$.  
\end{proof}

\begin{rmk}
Since $\L$ is smple iff $\L^{\otimes n}$ is ample for any $n \ge 1$ we see that $X_s$ is affine for any $s \in \Gamma(X, \L^{\otimes n})$. 
\end{rmk}

\section{test}

\begin{align*}
\struct{X}
\\
A_{_{f_1}} = A_{f_1}
\\
\Hom{\struct{X}}{\F}{\G}
\\
\shHom{\struct{X}}{\F}{\G}
\\
\shExt{i}{\struct{X}}{\F}{\G}
\\
\shTor{\struct{X}}{i}{\F}{\G}
\\
\shEnd{\struct{X}}{\F}
\\
\shDer{\F}{\G}
\end{align*}

\section{Backup}

\section{Rational Maps}

\begin{definition}
Let $X, Y$ be schemes over $S$. Consider the set of pairs of opens and $S$-morphisms,
\[ \{ (U, f_U) \mid U \subset X \text{ dense open } f_U : U \to Y \} \]
And an equivalence relation $(U, f_U) \sim (V, f_V)$ if for some dense (in $X$) open $W \subset U \cap V$ we have $(f_U)_{W} = (f_V)_{W}$. A rational $S$-morphism $f : X \rat Y$ is an equivalence class of pairs $(U, f_U)$. 
\bigskip\\
The domain of the rational function $f : X \rat Y$ is,
\[ \Dom{f} = \bigcup \{ U \mid (U, f_U) \in f \} \]
The set of rational maps $X \rat Y$ is exactly,
\[ \mathrm{Rat}(X, Y) = \varinjlim_{U \in \mathcal{D}(X)} \Hom{\Sch}{U}{Y} \]
where $\mathcal{D}(X)$ is the set of dense open subset $U \subset X$.
\end{definition}

\begin{remark}
This is an equivalence relation since if $(U_1, f_1) \sim (U_2, f_2) \sim (U_3, f_3)$ then there exist dense opens $V \subset U_1 \cap U_2$ and $W \subset U_2 \cap U_3$. Then $V \cap W \subset U_1 \cap U_2 \cap U_3 \subset U_1 \cap U_3$ and $V \cap W$ is a dense open. Futhermore,
\[ (f_1|_{V})_{V \cap W} = (f_2|_{V})_{V \cap W} = (f_2|_{W})_{V \cap W} = (f_3|_{W})_{V \cap W} \]
\end{remark}

\begin{lemma}
If $U, V \subset X$ are dense opens then $U \cap V$ is a dense open.
\end{lemma}

\begin{proof}
For any nonempty open $W \subset X$ we know $W \cap U$ is non empty open since $U$ is dense and thus $W \cap U \cap V$ is nonempty since $V$ is dense. Thus $U \cap V$ is dense. 
\end{proof}

\subsection{Glueing Rational Maps}

\subsection{The Locus on Which Morphisms Agree}

\begin{lemma}
Let $(R, \m, \kappa)$ be a local ring. Then for schemes $X$ there is a natural bijection,
\[ \Hom{\Sch}{\Spec{R}}{X} \cong \{ x \in X \text{ and local map } \stalk{X}{x} \to R \} \]
\end{lemma}

\begin{proof}
Given $\Spec{R} \to X$ we automatically get $\m \mapsto x$ and $\stalk{X}{x} \to R_\m = R$. 
Now, note that taking any affine open neighbrohood $x \in \Spec{A} \subset X$ and then $A \to A_\p = \stalk{X}{x}$ to give $\Spec{\stalk{X}{x}} \to \Spec{A} \to X$. Clearly, this map sends $\m_x \mapsto x$ and at $\m_x$ has stalk map $\id : \stalk{X}{x} \to \stalk{X}{x}$ since it is the localization at $\p$ of $A \to A_\p$. 
\bigskip\\
Thus we get an inverse as follows. Given a point $x \in X$ and a local map $\phi : \stalk{X}{x} \to R$ then take,
\[ \Spec{R} \to \Spec{\stalk{X}{x}} \to X \]
This is inverse since $\m \mapsto \m_x$ (because $\stalk{X}{x} \to \m_x$ is local) and $\m_x \mapsto x$ and the stalk at $\m$ gives $\stalk{X}{x} \xrightarrow{\id} \stalk{X}{x} \xrightarrow{\phi} R$. 
\bigskip\\
Finally, I claim that any $f : \Spec{R} \to X$ factors through $\Spec{R} \to \Spec{\stalk{X}{x}} \to X$ and thus is reconstructed from $x \in X$ and $\stalk{X}{x} \to R$. Choose an affine open neighbrohood $x \in \Spec{A} \subset X$ then consider $f^{-1}(\Spec{A})$ which is open in $\Spec{R}$ and contains the unique closed point $\m \in \Spec{R}$ so there is some $f \in R$ s.t. $\m \in D(f) \subset f^{-1}(\Spec{A})$ so $f \notin \m$ so $f \in R^\times$ and thus $D(f) = \Spec{R}$. Therefore, we get a map $\Spec{R} \to \Spec{A}$ and thus $\phi : A \to R$ where $\phi^{-1}(\m) = \p = x$ so $A \setminus \p$ is mapped inside $R^\times$ so this map factors through $A \to A_\p \to R$ giving the desired factorization $\Spec{R} \to \Spec{\stalk{X}{x}} \to \Spec{A} \to X$.  
\end{proof}

\begin{definition}
The locus $Z$ on which two maps $f, g : X \to Y$ over $S$ agree is given as the pullback,
\begin{center}
\begin{tikzcd}[row sep = large, column sep = large]
Z \arrow[r] \pullback \arrow[d] & Y \arrow[d, "\Delta_Y"]
\\
X \arrow[r, "F"] & Y \times_S Y
\end{tikzcd}
\end{center}
with $F = (f, g)$. Furthermore $Z \to X$ is an immersion. 
\end{definition}

\begin{lemma}
Topologically, the locus on which $S$-morphisms $f, g : X \to Y$ agree is,
\[ Z = \{ x \in X \mid f(x) = g(x) \text{ and } f_x = g_x : \kappa(f(x)) \to \kappa(x) \} \]
\end{lemma}

\begin{proof}
On some $S$-subscheme $G \subset X$, the maps $f|_G = g|_G$ agree iff there exists $G \to Y$ such that,
\begin{center}
\begin{tikzcd}
G \arrow[d, hook] \arrow[r, dashed] & Y \arrow[d, "\Delta"]
\\
X \arrow[r, "F"] & Y \times_S Y
\end{tikzcd}
\end{center}
commutes. In particular, for any point $x \in X$ consider $\iota : \Spec{\kappa(x)} \to X$ then $f \circ \iota = g \circ \iota$ iff $f(x) = g(x)$ and $f_x = g_x : \kappa(f(x)) \to \kappa(x)$. Consider a point $z \in Z$ and $\Spec{\kappa(z)} \to Z$, such a point is equivalent to giving a diagram,
\begin{center}
\begin{tikzcd}[row sep = large, column sep = large]
\Spec{\kappa(z)} \arrow[rd, dashed] \arrow[rrd, bend left] \arrow[rdd, bend right]
\\
& Z \arrow[r] \pullback \arrow[d] & Y \arrow[d, "\Delta_Y"]
\\
& X \arrow[r, "F"] & Y \times_S Y
\end{tikzcd}
\end{center}
However, $\iota : Z \to X$ is an immersion so $f_x : \kappa(f(x)) \xrightarrow{\sim} \kappa(x)$ is an isomorphism. Therefore, points $\Spec{\kappa(z)} \to Z$ of $z$, are exactly points of $X$ for which a lift $\Spec{\kappa(x)} \to Y$ exists i.e. points such that $f$ and $g$ agree in the required way.
\end{proof}

\begin{lemma}
If $f : X \to Y$ is an immersion then $f_x : \stalk{Y}{f(x)} \onto \stalk{X}{x}$ is injective for each $x \in X$ and $f_x : \kappa(f(x)) \xrightarrow{\sim} \kappa(x)$ is an isomorphism.
\end{lemma}

\begin{proof}
First note that $f^{\#} : \struct{Y} \to f_* \struct{X}$ is surjective by definition (surjective for the closed immersion factor and isomorphism for the open immersion factor). Thus we get an injection $f_x : \stalk{Y}{y} \to (f_* \struct{X})_{f(x)}$. Furthermore, topologically, $f : X \to Y$ is a homeomorphism onto its image so for any open $U \subset X$ there exists an open $V \subset Y$ s.t. $U = f^{-1}(V)$ showing that,
\[ (f_* \struct{X})_{f(x)} = \varinjlim_{f(x) \in V} \struct{X}(f^{-1}(V)) = \varinjlim_{x \in U} \struct{X}(U) = \stalk{X}{x} \]
Finally, since $f_x : \stalk{Y}{f(x)} \onto \stalk{X}{x}$ is local we get $f_x : \kappa(f(x)) \onto \kappa(x)$ which is a surjection of fields and thus an isomorphism. 
\end{proof}

\begin{lemma}
If $Y \to S$ is separated then the locus on which $f,g : X \to Y$ over $S$ agree is closed.
\end{lemma}

\begin{proof}
Since $X \to S$ is separated, $\Delta_{Y/S} : Y \to Y \times_S Y$ is a closed immersion. So $Z \to X$ is the base change of a closed immersion and thus a closed immersion. 
\end{proof}

\begin{lemma}
Let $X$ be a reduced and $Y$ be a separated scheme over $S$ and $f ,g : X \to Y$ be morphims over $S$. If $f \circ j = g \circ j$ agree on a dense subscheme $j : G \embed X$ then $f = g$.
\end{lemma}

\begin{proof}
Consider $F = (f, g) : X \to Y \times_S Y$. Since $\Delta : Y \to Y \times_S Y$ is a closed immersion (by separatedness). Then $F^{-1}(\Delta)$ is the locus on which $f = g$ which is closed because $\Delta : Y \to Y \times_S Y$ is a closed immersion. Since $f|_G = g|_G$ we get a diagram,
\begin{center}
\begin{tikzcd}[row sep = large, column sep = large]
G \arrow[rd, dashed] \arrow[rrd, bend left] \arrow[rdd, bend right, hook]
\\
& Z \arrow[r, "\tilde{F}"] \pullback \arrow[d, hook, "\iota"'] & Y \arrow[d, "\Delta_Y"]
\\
& X \arrow[r, "F"] & Y \times_S Y
\end{tikzcd}
\end{center}
Since $\iota : Z \embed X$ is a closed immersion with dense image, $Z \embed X$ is surjective. By the following, $\iota : Z \to X$ is an isomorphism. Thus, $F = F \circ \iota \circ \iota^{-1} = \Delta_Y \circ \tilde{F} \circ \iota^{-1}$. By the univeral property of maps $X \to Y \times_S Y$ this implies that $f = g = \tilde{F} \circ \iota^{-1}$.
\end{proof}

\newcommand{\Nil}{\mathcal{N}}

\begin{lemma}
Let $X$ be a scheme and consider an exact sequence of quasi-coherent $\struct{X}$-modules,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \I \arrow[r] & \struct{X} \arrow[r] & \cA \arrow[r] & 0
\end{tikzcd}
\end{center}
and $\cA$ is a sheaf of $\struct{X}$-algebras. 
Suppose that $\cA_x \neq 0$ for each $x \in X$. Then $\I \embed \Nil$ where $\Nil$ is the sheaf of nilpotents.
\end{lemma}

\begin{proof}
Take an affine open $U = \Spec{R} \subset X$ such that $\mathcal{A} |_{U} = \wt{A}$. Then we have an surjection of rings $R \onto A$ giving $R/I = A$ for $I = \ker{(R \to A)}$. Now, for each $\p \in \Spec{R}$ we know $R_\p = \stalk{X}{\p} \neq 0$. However, if $\p \not\supset I$ then $(R/I)_\p = A_\p = 0$ so we must have $\p \supset I$ for all $\p \in \Spec{R}$ i.e. $I \subset \nilrad{R}$. Therefore, $\I |_U \embed \Nil|_U$ for any affine open $U \subset X$ showing that $\I$ is comprised of nilpotents. 
\end{proof}

\begin{corollary}
If $X$ is reduced and $\iota : Z \embed X$ is a surjective closed immersion then $\iota : Z \xrightarrow{\sim} X$ is an isomorphism. 
\end{corollary}

\begin{proof}
Since $\iota: Z \embed X$ is a homeomorphism onto its image $X$ it suffices to show that the map of sheaves $\iota^\# : \struct{X} \to \iota_* \struct{Z}$ is an isomorphism. Since $\iota : Z \to X$ is a closed immersion $\iota^\# : \struct{X} \onto \iota_* \struct{Z}$ is a surjection and $\struct{Z}$ is a quasi-coherent sheaf of $\struct{X}$-algebras giving an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \I \arrow[r] & \struct{X} \arrow[r] & \iota_* \struct{Z} \arrow[r] & 0
\end{tikzcd}
\end{center} Furthermore, 
\[ \Supp{\struct{X}}{\iota_* \struct{Z}} = \Im{\iota} = X \]
since $(\iota_* \struct{Z})_x = \stalk{Z}{x}$ when $x \in \Im{\iota}$ (and zero elsewhere). by the above, $\I \embed \Nil = 0$ since $X$ is reduced so $\iota^\# : \struct{X} \to \iota_* \struct{Z}$ is an isomorphism.  
\end{proof}

\begin{lemma}
A rational $S$-map $f : X \rat Y$ with $X$ reduced and $Y \to S$ separated is equivalent to a morphism $f : \Dom{f} \to Y$. 
\end{lemma}

\begin{proof}
For any $(U, f_U)$ and $(V, f_V)$ representing $f$ there must be a dense (in $X$) open $W \subset U \cap V$ on which $f_U|_W = f_V|_W$ and thus $f_U |_{U \cap V} = f_V |_{U \cap V}$ since $f_U, f_V : U \cap V \to Y$ are morphisms from reduced to irreducible schemes. Now $\Dom{f}$ has an open cover $(U_i, f_i)$ for which $f_i |_{U_i \cap U_j} = f_j |_{U_i \cap U_j}$ so these morphisms glue to give $f : \Dom{f} \to Y$ ($\Hom{S}{-}{Y}$ is a sheaf on the Zariski site).  
\end{proof}

\subsection{Dominant Morphisms}

\begin{definition}
A morphism $f : X \to Y$ is dominant if its image (topologically) is dense.
\end{definition}


\begin{lemma}
If $X$ and $Y$ are irreducible with generic points $\xi \in X$ and $\eta \in Y$ then $f : X \to Y$ is dominant iff $f(\xi) = \eta$. 
\end{lemma}

\begin{proof}
Clearly, if $f(\xi) = \eta$ then,
\[ \overline{f(X)} \supset \overline{f(\xi)} = X \]
so $f$ is dominant. Conversely, suppose that $f : X \to Y$ is dominant. Then,
\[ f(X) = f(\overline{\{ \xi \}}) \subset \overline{f(\xi)} \]
but $f(X)$ is dense so $\overline{f(\xi)} = Y$ but $Y$ has a unique generic point so $f(\xi) = \eta$.
\end{proof}

\begin{definition}
Let $X, Y$ be irreducible. A rational map $f : X \rat Y$ is \textit{dominant} if any representative $f : U \to Y$ is dominant.
\end{definition}

\begin{rmk}
Since, on an irreducble scheme $X$ every nonempty open $W \subset X$ contains the generic point $\xi \in W \subset X$. Therefore, if $f_U : U \to Y$ and $f_V : V \to Y$ agree on some dense open $W \subset U \cap V$ then $f_U(\xi) = \eta \iff f_V(\xi) = \eta$ so some representative is dominant iff every representative is dominant. 
\end{rmk}

\begin{prop}
Irreducible schemes with dominat rational maps form a category. 
\end{prop}

\begin{proof}
It suffices to show how dominant rational maps may be composed. Given $f : X \rat Y$ and $g : Y \rat Z$ and representatives $f_U : U \to Y$ and $g_V : V \to Y$. Then, consider $g \circ f : f^{-1}(V) \to Z$. Since $f$ is dominant $\xi_X \in f^{-1}(\xi_Y) \subset f^{-1}(V)$ so $f^{-1}(V)$ is nonempty (since $\Im{f} \cap V$ is nonempty because $\Im{f}$ is dense). Furthermore, $f(\xi_X) = \xi_Y$ and $g(\xi_Y) = \xi_Z$ so $g \circ f(\xi_X) = \xi_Z$ and thus $g \circ f$ is dominant so it defines a dominant rational map $g \circ f : X \rat Z$. Furthermore, if $(U_1, f_1) \sim (U_2, f_2)$ and $(V_1, g_1) \sim (V_2, g_2)$ then $f_1 |_W = f_2 |_W$ and $g_1 |_{W'} = g_2 |_{W'}$ for dense opens $W \subset U_1 \cap U_2$ and $W' \subset V_1 \cap V_2$. Then, $(g_1 \circ f_1) |_{f^{-1}(W') \cap W} = (g_2 \circ f_2) |_{f^{-1}(W') \cap W}$ so composition is well-defined. 
\end{proof}

\begin{remark}
We really need irreducibility to compose rational maps. Consider,
\[ \Spec{k[x,y]/(xy)} \xrightarrow{f} \Spec{k[x]} \rat \Gm \]
where $\Spec{k[x]} \to \Gm$ is defined on the dense open $D(x)$. However, $f^{-1}(D(x)) \subset \Spec{k[x,y]/(xy)}$ is $\Spec{k[x, x^{-1}]} \embed \Spec{k[x,y]/(xy)}$ contained in the $x$-axis and thus is not dense.
\end{remark}

\subsection{Rational Functions}

\begin{definition}
A \textit{rational function} on a scheme $X$ is a rational map $f : X \rat \A^1_\Z$ or for $X \to S$ equivalently a rational $S$-map $f : X \rat \A^1_S$. Since $\A^1$ is a ring object in the category of schemes and thus gives a ring structure on $\Hom{\Sch}{U}{\A^1}$. This puts a ring structure on the set of rational functions forming the ring of rational functions,
\[ R(X) = \varinjlim_{U \in \mathcal{D}(X)} \Hom{\Sch}{U}{\A^1} \]
where $\mathcal{D}(X)$ is the set of dense open subsets $U \subset X$.
\end{definition}

\begin{prop}
Suppose that $X$ has finitely many irreducible compoents with generic point $\xi_i$. Then,
\[ R(X) = \stalk{X}{\xi_1} \times \cdots \times \stalk{X}{\xi_n} \]
\end{prop}

\begin{proof}
For any dense open and there are finitely many irreducible components $Z_i$ then $Z_i \cap U \neq \empty$ so $\xi_i \in U$ for each $i$ since otherwise,
\[ U \subset \bigcup_{i \neq j} Z_i \]
which is closed (since the union is finite) contradicting denseness of $U$. Now,
\[ U_i = (Z_i \cap U) \setminus \bigcup_{j \neq i} Z_i \]
is open and $\xi \in U_i \subset Z_i$ and,
\[ \bigcup_{i = 1}^n U_i \subset U \subset X \]
is dense since it contains all $\xi_i$. However, $U_i \cap U_j = \varnothing$ and thus,
\begin{align*}
R(X) & = \varinjlim_{U \in \mathcal{D}(X)} \Hom{\Sch}{U}{\A^1}
\\
& = \varinjlim_{U \in \mathcal{D}(X)} \struct{X}(U)
\\
& = \varinjlim_{U \in \mathcal{D}(X)} \prod_{i = 1}^n \struct{X}(U_i)
\\
& = \prod_{i = 1}^n \varinjlim_{\xi_i \in U_i} \struct{X}(U_i)
\\
& = \prod_{i = 1}^n \stalk{X}{\xi_i} 
\end{align*}
since all opens containing each generic point are dense.
\end{proof}

\begin{cor}
If $X$ is reduced then,
\[ R(X) = \kappa(\xi_1) \times \cdots \times \kappa(\xi_n) \] 
If $X$ is irreducible then,
\[ R(X) = \stalk{X}{\xi} \]
If $X$ is integral then,
\[ R(X) = \kappa(\xi) = K(X) \]
so the ring of rational functions is exactly the function field on an integral scheme.
\end{cor}

\begin{lemma}
A dominant rational map $X \rat Y$ (over $S$) between irreducible schemes induces a $\stalk{S}{s}$-algebra map $\stalk{Y}{\xi_Y} \to \stalk{X}{\xi_X}$. 
\end{lemma}

\begin{proof}
A morphism $X \rat Y$ in the category of domiant rational $S$-maps gives by composition $R(Y) = \Hom{\mathbf{Rat}}{Y}{\A^1_S} \to \Hom{\mathbf{Rat}}{X}{\A^1_S} = R(X)$. Alternatively, since $X \rat Y$ is defined on some nonempty open (dense is automatic for irreducible schemes) $U \to Y$ and $\xi_X \in U$. Since $X \rat Y$ is dominant $\xi_X \mapsto \xi_Y$ and thus we get $\stalk{X}{\xi_Y} \to \stalk{X}{\xi_X}$ over $\stalk{S}{s}$ for $\xi_X, \xi_Y \mapsto s$. 
\end{proof}

\begin{cor}
A dominant rational $k$-map $X \rat Y$ of integral schemes over $\Spec{k}$ induces an extension of function fields $K(Y) \embed K(X)$ over $k$.
\end{cor}

\begin{rmk}
This is an extension of fields because a ring map $K(Y) \to K(X)$ is automatically injective on fields. 
\end{rmk}

\begin{cor}
There is a functor $\mathbf{Rat}_A^\op \to \Ring_A$ from the category of irreducble schemes over $\Spec{A}$ and dominant rational maps to the category of $A$-algebras sending $X \rat Y$ to $R(Y) \to R(X)$. 
\bigskip\\
Likewise, there is a functor $\mathbf{Rat}_{\text{int}, A}^\op \to \mathbf{Field}_A$ from the category of integral schemes over $\Spec{A}$ and dominant rational maps to the category of fields over $A$ sending $X \rat Y$ to $K(Y) \embed K(X)$ over $A$. 
\end{cor}

\subsection{Birational Maps}

\begin{definition}
Irreducible $S$-schemes are $S$-\textit{birational} if they are isomorphic in the category of irreducible $S$-schemes with dominant rational $S$-maps. We say that a rational $S$-map $f : X \rat Y$ is a birational map if it is dominant and there is a domiant rational $S$-map $g : Y \rat Y$ such that $g \circ f = \id_X$ and $f \circ g = \id_Y$ as rational maps. 
\end{definition}

\begin{prop}
If irreducible schemes $X$ and $Y$ are birational then $R(X) = R(Y)$. 
\end{prop}

\begin{prop}
In particular, if integral $k$-schemes $X$ and $Y$ are $k$-birational then $K(X) = K(Y)$ via a $k$-isomorphism. 
\end{prop}

\begin{prop}
Let $X$ and $Y$ be irreducible $S$-schemes. Then $X$ and $Y$ are $S$-birational iff there are dense opens $U \subset X$ and $V \subset Y$ which are isomorphic $U \cong V$ over $S$.
\end{prop}

\begin{proof}
If $f : U \to V$ and $g : V \to U$ are inverse $S$-isomorphisms then they represent inverse dominat (since they are surjective onto $U,V$ which are dense) rational $S$-maps $f : X \rat Y$ and $f : Y \rat X$ so $X$ and $Y$ are birational.
\bigskip\\
The reverse direction is Tag 0BAA.
\end{proof}

\begin{theorem}
There is an equivalence of categories between the following,
\begin{enumerate}
\item the category of integral schemes locally of finite type over $k$ with dominant rational maps
\item the category of affine integral schemes of finite type over $k$ with dominant rational maps
\item the opposite category of finitely-generated $k$-algebra domains with dominant rational maps
\item the opposite category of finitely-generated fields over $k$ with inclusions over $k$
\end{enumerate}
\end{theorem}

\begin{proof}
We need to show that an embedding $K(Y) \embed K(X)$ over $k$ for integral scheme locally of finite type over $k$ induces a rational map and for any finitely generated field $K$ over $k$ there is (DO THIS PROOF).
\end{proof}

\begin{rmk}
The restiction on the category of schemes is necessary. $\Spec{k(x)}$ is not finte type over $k$ and there is no rational map $\Spec{k[x]} \rat \Spec{k(x)}$ induced by $k(x) \embed k(x)$ since it would simply be a morphism and would be given by a ring map $k(x) \embed k[x]$ inducing $\id : k(x) \to k(x)$ which is impossible since it needs to send $x \mapsto x$ which is a unit in the source but not the target.
\end{rmk}

\begin{rmk}
See Tag 0BAD for a generalization.
\end{rmk}

\subsection{Rational Varieties}

\subsection{Extending Rational Maps}

\begin{lemma}
Regular local rings of dimension $1$ exactly correspond to DVRs.
\end{lemma}

\begin{proof}
Any DVR $R$ has a uniformizer $\varpi \in R$ then $\dim{R} = 1$ and $\m / \m^2 = (\varpi)/(\varpi^2) = \varpi \kappa$ which also has $\dim_{\kappa}(\m / \m^2) = 1$ so $R$ is regular.
\bigskip\\
Conversely, if $R$ is a regular local ring of dimension $\dim{R} = 1$ then, by regularity, $R$ is a normal noetherian domain so by $\dim{R} = 1$ then $R$ is Dedekind but also local and thus is a DVR. 
\end{proof}

\begin{proposition}
Let $X$ be a Noetherian $S$-scheme and $Z \subset X$ a closed irreducible codimension $1$ generically nonsingular subset (with generic point $\eta \in Z$ such that $\stalk{X}{\eta}$ is regular). Let $f : X \rat Y$ be a rational map with $Y$ proper over $S$. Then $Z \cap \Dom{f}$ is a dense open of $Z$.
\end{proposition}


\begin{proof}
Choose some representative $(U, f_U)$ for $f : X \rat Y$. Note that $\stalk{X}{\eta}$ is a regular dimension one (see Lemma \ref{codimension_loc_rings}) ring and thus a DVR. Consider the generic point $\xi \in X$ of $X$ then, by localizing, we get an inclusion of the generic point $\Spec{\stalk{X}{\xi}} \to \Spec{\stalk{X}{\eta}} \to X$ and $\stalk{X}{\xi} = K(X) = \Frac{\stalk{X}{\eta}}$. Furthermore, the inclusion of the generic point gives $\Spec{K(X)} \to U \xrightarrow{f_U} Y$ and thus we get a diagram,
\begin{center}
\begin{tikzcd}
\Spec{K(X)} \arrow[d, hook] \arrow[r] & Y \arrow[d]
\\
\Spec{\stalk{X}{\eta}} \arrow[ru, dashed, "\ell"] \arrow[r] & \Spec{k} 
\end{tikzcd}
\end{center}
and a lift $\Spec{\stalk{X}{\eta}} \to Y$ by the valuative criterion for properness applied to $Y \to \Spec{k}$ since $\stalk{X}{\eta}$ is a DVR. Choose an affine open $\Spec{R} \subset Y$ containing the image of $\Spec{\stalk{X}{\eta}} \to Y$ (i.e. choose a neighborhood of the image of $\eta$ which automatically contains $f(\xi)$ since the map factors $\Spec{\stalk{X}{\eta}} \to \Spec{\stalk{Y}{f(\eta)}} \to \Spec{R} \to Y$) and let $\eta \in V = \Spec{A} \subset X$ be an affine open neighbrohood of $\xi$ mapping into $\Spec{R}$. By Lemma \ref{open_domain}, since $\stalk{X}{\eta}$ is a domain, we may shrink $V$ so that $A$ is a domain. Since $X$ is irreducible $U \cap V$ is a dense open. Note that if $\eta \in U$ then $\eta \in \Dom{f}$ and thus $Z \cap \Dom{f}$ is a nonempty open of the irreducible space $Z$ and therefore a dense open so we are done. Otherwise, let $\p \in \Spec{A}$ correspond to $\eta \in Z$ then $A_\p = \stalk{X}{\eta}$ is a  DVR. Take some principal affine open $D(g) \subset U \cap V$ for $g \in A$ so $g \in \p$ since $\p \notin D(g) \subset U \cap V$. Since $A_\p$ is a DVR we may choose a uniformizer $\varpi \in \p$ so the map $A \to \p$ via $1 \mapsto \varpi$ is as isomorphism when localized at $\p$. Since $A$ is Noetherian both are f.g. $A$-modules so there must be some $s \in A \setminus \p$ such that $A_s \to \p_s$ is an isomorphism. Replacing $A$ by $A_s$ we may assume $\p = (\varpi) \subset A$ is principal. Since $g \in \p$ we can write $g = t \varpi^k$ for some $a \in A \setminus \p$ (see Lemma \ref{principal_ideal_powers}). Then consider $\tilde{V} = \Spec{A_t}$. Since $t \notin \p$ then $\eta \in \tilde{V}$ and since $g = t \varpi^k$ we have $D(g) \subset D(t) = \tilde{V}$.
Now we get the following diagram, 
\begin{center}
\begin{tikzcd}[row sep = large]
& & \Spec{R}
\\
\Spec{A_\p} \arrow[rru, bend left, "\ell"] \arrow[r] &  \Spec{A_t} \arrow[ru, dashed, "f_V"]
\\
\Spec{\Frac{A}} \arrow[r] \arrow[u] & \Spec{A_g} \arrow[u] \arrow[ruu, bend right, "f_U"'] 
\end{tikzcd}
\end{center}
I claim the square is a pushout in the category of affine schemes because maps $R \to A_\p$ and $R \to A_g$ which agree under the inclusion to $\Frac{A}$ gives a map $R \to A_\p \cap A_g \subset \Frac{A}$. However,
\[ x \in A_\p \cap A_g \implies x = \frac{u \varpi^r}{s} = \frac{a}{g^n} \]
for $u, s, t \in A \setminus \p$ and $a \in A$. Thus we get,
\[ u t^n \varpi^{r + nk} = s a \]
so $a \in \p^{r + nk} \setminus \p^{r + nk + 1}$ ($s \notin \p$ which is prime) and thus $a = u' \varpi^{r + nk}$ for $u' \in A \setminus \p$. Therefore,
\[ x = \frac{u' \varpi^{r + nk}}{t^n \varpi^{nk}} = \frac{u' \varpi^{r}}{t^n} \in A_t \]
Thus, $A_\p \cap A_g \subset A_t$ so we get a map $R \to A_t$. Therefore we get a map $f_{\tilde{V}} : \tilde{V} \to Y$ such that $(f|_{\tilde{V}})|_{D(f)} = (f_U)|_{D(f)}$ which implies that $\eta \in \tilde{V} \subset \Dom{f}$ so $Z \cap \Dom{f}$ is a dense open of $Z$. 
\end{proof}

\begin{prop}
Let $C \to S$ be a proper regular noetherian scheme with $\dim{C} = 1$ and $f : C \rat Y$ a rational $S$-map with $Y \to S$ proper. Then $f$ extens unquely to a morphism $f : C \to Y$. 
\end{prop}

\begin{proof}
For any point $x \notin \Dom{f}$ let $Z = \overline{\{ x \}} \subset D$ for $D = C \setminus \Dom{f}$. Since $\Dom{f}$ is a dense open, by lemma \ref{complement_dense_open_codim}, we have $\codim{Z, C} \ge \codim{D, C} \ge 1$ but $\dim{C} = 1$ so $\codim{Z, C} = 1$. Furthermore, since $C$ is regular, $\stalk{C}{x}$ is regular and thus, by the previous proposition, $Z \cap \Dom{f}$ is a dense open and in particular $x \in \Dom{f}$ meaning that $\Dom{f} = C$ so we get a morphism $C \to Y$. This is unique because $C$ is reduced (it is regular) and $Y$ is separated (it is proper over $S$) so morphisms $C \to Y$ are uniquely determined on a dense open which any representative for $f : C \rat Y$ is defined on.   
\end{proof}

\begin{defn}
A \textit{curve} over $k$ is an integral separated dimension one scheme finite type over $\Spec{k}$.
\end{defn}

\begin{cor}
Rational maps between normal proper curves are morphisms.
\end{cor}

\begin{cor}
Birational maps between normal proper curves are isomorphisms.
\end{cor}

\begin{proof}
Let $f : C_1 \rat C_2$ and $g : C_2 \rat C_1$ be birational inverses of smooth proper curves. Then we know that these extend to morphisms $f : C_1 \to C_2$ and $g : C_2 \to C_1$. Furthermore, the maps $g \circ f : C_1 \to C_1$ must extend the identity on some dense open. However, since curves are separated and reduced there is a unique extension of this map so $g \circ f = \id_{C_1}$ and likewise $f \circ g = \id_{C_2}$. 
\end{proof}

\begin{thm}
If $k$ is perfect then there exists a unique normal curve in each birational equivalence class of curves.
\end{thm}

\begin{proof}
It suffices to show existence. Given a curve $X$, we consider the projective closure $X \to \overline{X}$ (WHY THIS EXISTS) which is birational and $\overline{X} \to \Spec{k}$ is proper. Then take the normalization $\overline{X}^\nu \to \overline{X}$ which remains proper over $\Spec{k}$ (CHECK THIS) and is birational. Then $\overline{X}^\nu$ is regular and thus smooth over $k$ since $k$ is perfect and $\overline{X}^\nu \to X$ is birational.
\end{proof}

\subsection{Lemmas}

\begin{lemma} \label{principal_ideal_powers}
Let $A$ be a Noetherian domain and $\p = (\varpi)$ a principal prime. Then any $f \in \p$ can be written as $f = t \varpi^k$ for $f \in A \setminus \p$. 
\end{lemma}

\begin{proof}
From Krull intersection,
\[ \bigcap_{n \ge 0}^\infty \p^n = (0) \]
so there is some $n$ such that $f \in \p^n \setminus \p^{n+1}$. Thus $f = t \varpi^n$ for some $f \in A$ but if $t \in \p$ then $f \in \p^{n+1}$ so the result follows.
\end{proof}

\begin{lemma}
Let $X$ be a Noetherian scheme then the nonreduced locus,
\[ Z = \{ x \in X \mid \nilrad{\stalk{X}{x}} \neq 0 \} \]
is closed.
\end{lemma} 

\begin{proof}
The subsheaf $\Nil \subset \struct{X}$ is coherent since $X$ is Noetherian. Thus $Z = \Supp{\struct{X}}{\Nil}$ is closed and $\Nil_x = \nilrad{\struct{X}{x}}$. Locally, on $U = \Spec{A}$ we have $\Nil |_U  = \wt{\nilrad{A}}$ and $\nilrad{A}$ is a f.g. $A$-module since $A$ is Noetherian so,
\[ \Supp{\struct{X}}{\Nil} \cap U = \Supp{A}{\nilrad{A}} = V(\Ann{A}{\nilrad{A}} \]
is closed in $\Spec{A}$. 
\end{proof}

\begin{lemma}
Let $X$ be a Noetherian scheme then $X$ has finitly many irreducible components.
\end{lemma}

\begin{proof}
First let $X = \Spec{A}$ for a Noetherian ring $A$. Then the irreducible components of $A$ correspond to minimal primes $\p \in \Spec{A}$. Then $\dim{A_\p} = 0$ and $A_\p$ is Noetherian so $A_\p$ is artinian. $A_\p$ must have some associated prime so $\Ass{A_\p}{A_\p} = \{ \p A_\p \}$.  By Tag 05BZ, 
\[ \Ass{A}{A} \cap \Spec{A_\p} = \Ass{A_\p}{A_\p} = \{ \p \} \] 
so every minimal prime is an associated prime. However, for $A$ noetherian then $A$ admits a finite composition series so there are finitely many associated primes.
\bigskip\\
Now let $X$ be a Noetherian scheme. For any affine open $U \subset X$ we have shown that $U$ has finitely many irreducible components. However, since $X$ is quasi-compact there is a finite cover of affine opens and thus $X$ must have finitely many irreducible components. 
\end{proof}

\begin{lemma} \label{complement_dense_open_codim}
Let $X$ be a Noetherian scheme and $Y$ is the complement of some dense open $U$. Then $\codim{Y, X} \ge 1$.
\end{lemma}

\begin{proof}
It suffices to show that $Y$ does not contain any irreducible component since theny any irreducible contained in $Y$ cannot be maximal. Since $X$ is Noetherian, it has finitely many irreducible components $Z_i$. Then if $Z_j \subset Y$ for some $i$ we would have $Z_i \cap U = \varnothing$ but then,
\[ U \subset \bigcup_{i \neq j} Z_i \]
which is closed so $\overline{U} \subsetneq X$ contradicitng our assumption that $U$ is dense.
\end{proof}

\begin{example}
This may not hold when $X$ is not Noetherian. For example, (FIND EXAMPLE)
\[ X = \bigcup_{i = 1}^\infty V(x_i) \subset k[x_1, x_2, \cdots] \] 
\end{example}

\begin{lemma} \label{open_domain}
Let $X$ be a Noetherian scheme and $x \in X$ such that $\stalk{X}{x}$ is a domain. Then there is an affine open neighborhood $x \in U \subset X$ with $U = \Spec{A}$ and $A$ is a domian.
\end{lemma}

\begin{proof}
Take any affine open neighbrohood $x \in U \subset X$ with $U = \Spec{A}$ and $\p \in \Spec{A}$ corresponding to $x$. Then $A_\p = \stalk{X}{x}$ is a domain. Since $X$ is Noetherian then $A$ is Noetherian so it has finitely many minimal primes $\p_i$ (corresponding to the generic points of irreducible components of $U$) with $\p_0 \subset \p$. Since $A_\p$ is a domain, it has a unique minimal prime and thus $\p_0$ is the only minimal prime contained in $\p$ (geometrically $A_\p$ being a domain corresponds to the fact that $\p$ is the generic point of a generically reduced irreducible subset which lies in only one irreducible component)
\bigskip\\
Now for any $i \neq 0$ take $f_i \in \p \setminus \p_0$. This is always possible else $\p \subset \p_0$ contradicting the minimality of $\p_0$. If $f \notin \q$ then $\q \not\supset \p_i$ for any $i \neq 0$ so $\q \supset \p_0$ since it must lie above some minimal prime. Thus $\nilrad{A_f} = \p_0 A_f$ is prime and $f \notin \p$ since else $\p \supset \p_1 \cap \cdots \cap \p_n$ which is impossible since $\p \not\supset \p_i$ for any $i$. Now we know that $\nilrad{A_\p} = 0$ and $A_f$ is Noetherian so $\nilrad{A_\p}$ is finitely generated. Thus, there is some $g \notin \p$ such that $\nilrad{A_{fg}} = (\nilrad{A_f})_g = 0$. Thus $A_{fg}$ is a domain since $\nilrad{A_{fg}} = (0)$ and is prime and $\p \in A_{fg}$ because $fg \notin \p$. Therefore, $x \in \Spec{A_{fg}} \subset U$ is an affine open satisfying the requirements. 
\end{proof}

\begin{rmk}
This does not imply that $X$ is integral if $\stalk{X}{x}$ is a domain for each $x \in X$ (which is false, consider $\Spec{k \times k}$) because it only shows there is an integral cover of $X$ not that $\struct{X}(U)$ is a domain for each $U$. 
\end{rmk}

\begin{example}
Let $X = \Spec{k[x,y]/(xy, y^2)}$. Then for the bad point $\p = (x, y)$ we have $\nilrad{\stalk{X}{\p}} = (y)$. Away from the bad point, say $\p = (x - 1, y)$ we have, $\stalk{X}{\p} = \Spec{k[x]_{(x-1)}}$ so $\nilrad{\stalk{X}{\p}} = (0)$. Furthermore, at the generic point $\p = (y)$, we have, $\stalk{X}{\p} = \Spec{k(x)}$ so $\nilrad{\stalk{X}{\p}} = (0)$. 
\end{example}

\begin{example}
Consider $X = \Spec{k[x,y,z]/(yz)}$ which is the union of the $x$-$y$ and $x$-$z$ planes. Consider the generic point of the $z$-axis $\p = (x, y)$ then $\stalk{X}{\p} = \Spec{k[x, z]_{(x)}}$ is a domain since the $z$-axis only lies in one irreducible component. However, at the generic point of the $x$-axis, $\p = (y, z)$ we get $\stalk{X}{\p} = \Spec{(k[x, y, z]/(yz))_{(y, z)}}$ has zero divisors $yz = 0$ so is not a domain since the $x$-axis lives in two irreducible components.
\end{example}

\section{Reflexive Sheaves}

\newcommand{\RPic}[1]{\mathrm{RPic}\left( #1 \right)}
\renewcommand{\R}{\mathcal{R}}

\begin{defn}
Recall the dual of a $\struct{X}$ module $\F$ is the sheaf $\F^\vee = \shHom{\struct{X}}{\F}{\struct{X}}$. We say that a coherent $\struct{X}$-module $\F$ is \textit{reflexive} if the natural map $\F \to \F^{\vee \vee}$ is an isomorphism. 
\end{defn}

\begin{lemma}
Let $X$ be an integral locally Noetherian scheme and $\F, \G$ be coherent $\struct{X}$-modules. If $\G$ is reflexive then $\shHom{\struct{X}}{\F}{\G}$ is reflexive.
\end{lemma}

\begin{proof}
[Tag. 0AY4]
\end{proof}
\noindent\\
In particular, since $\struct{X}$ is clearly reflexive, this lemma shows that for any coherent $\struct{X}$-module then $\F^\vee$ is a reflexive coherent sheaf. We say the map $\F \to \F^{\vee \vee}$ gives the reflexive hull $\F^{\vee \vee}$ of $\F$.

\begin{defn}
Let $\R$ be the full subcategory $\Coh{\struct{X}}$ of coherent reflexive $\struct{X}$-modules. $\R$ is an additive category   and in fact has all kernels and cokernels defined by taking reflexive hulls of the sheaf kernel and cokernel. Furthermore, $\R$ inherits a monoidal structure from the tensor product defined using the reflexive hull as follows,
\[ \F \otimes_\R \G = (\F \otimes_{\struct{X}} \G)^{\vee \vee} \]
Finally, we define $\RPic{X}$ to be group of constant rank one reflexives induced by the monoidal structure on $\R$. Explicitly, $\RPic{X}$ is the group of isomorphism clases of constant rank one reflexive coherent $\struct{X}$-modules with multiplication $(\F, \G) \mapsto (\F \otimes_{\struct{X}} \G)^{\vee \vee}$ and inverse $\F \mapsto \F^\vee$. 
\end{defn}
\noindent\\
The importance of reflexive sheaves derives from their correspondence to Weil divisors. Here we let $X$ be a normal integral seperated Noetherian scheme. 

\begin{prop}
If $D$ is a Weil divisor then $\struct{X}(D)$ is reflexive of constant rank one. 
\end{prop}

\begin{proof}
(CITE OR DO).
\end{proof}

\begin{theorem}
Let $X$ be a normal integral seperated Noetherian scheme. There is an isomorphism of groups $\Cl{X} \xrightarrow{\sim} \RPic{X}$ defined by $D \mapsto \struct{X}(D)$.
\end{theorem}

\begin{proof}
(DO OR CITE)
\end{proof}
\noindent\\
We summarize the important results as follows.
\begin{theorem}
Let $X$ be a Noetherian normal integral scheme. Then for any Weil divisors $D, E$,
\begin{enumerate}
\item $\struct{X}(D + E) = (\struct{X}(D) \otimes_{\struct{X}} \struct{X}(E))^{\vee \vee}$
\item $\struct{X}(-D) = \struct{X}(D)^\vee$
\item $\shHom{\struct{X}}{\struct{X}(D)}{\struct{X}(E)} = \struct{X}(E - D)$
\item if $E$ is Cartier then $\struct{X}(D + E) = \struct{X}(D) \otimes_{\struct{X}} \struct{X}(E)$
\end{enumerate}
\begin{center}

\begin{proof}
(DO OR CITE)
\end{proof}

\end{center}
\end{theorem}
\noindent\\
Finally, we have a result which controls when the dualizing sheaf can be expressed in terms of a divisor.
\begin{prop}
Let $X$ be a projective variety over $k$. Then,
\begin{enumerate}
\item if $X$ is normal then its dualizing sheaf $\omega_X$ is reflexive of rank $1$ and thus $X$ admits a canonical divisor $K_X$ s.t. $\omega_X = \struct{X}(K_X)$
\item if $X$ is Gorenstein then $\omega_X$ is an invertible module so $K_X$ is Cartier.
\end{enumerate}
\end{prop}

\begin{proof}
(FIND CITATION OR DO).
\end{proof}



\section{Smooth Morphisms}

\subsection{Kahler Differentials}

\begin{prop}
We have the following general facts about Kahler differentials.
\item  Given ring maps $R \to A \to B$ we have an exact sequence,
\begin{center}
\begin{tikzcd}
\Omega_{A/R} \otimes_A B \arrow[r] & \Omega_{B/R} \arrow[r] & \Omega_{B/A} \arrow[r] & 0
\end{tikzcd}
\end{center}
\item Given $R \to A$ and $B = A / I$ we have an exact sequence,
\begin{center}
\begin{tikzcd}
I/I^2 \arrow[r] & \Omega_{A/R} \otimes_A B \arrow[r] & \Omega_{B/R} \arrow[r] & 0
\end{tikzcd}
\end{center}
\item Commutes with tensor product, given $R \to R'$ and setting $A' = A \otimes_R R'$ we have,
\[ \Omega_{A'/R'} = \Omega_{A/R} \otimes_R R' \]
\item Commutes with localization.
\[ \Omega_{S^{-1} A/R} = S^{-1} \Omega_{A/R} \]
\end{prop}

\begin{prop}
Let $A$ be a local $k$-algebra with $A/\m \cong k$. Then, the map,
\[ \m / \m^2 \xrightarrow{\sim} \Omega_{A/k} \otimes_A k \]
is an isomorphism.
\end{prop}

\subsection{Smooth Ring Maps}

\begin{defn}
Let $R \to S$ be a ring map. Consider the surjection $R[S] \to S$ and let $I$ be its kernel. We define the \textit{naive cotangent complex} as a complex supported in degree $-1$ and $0$,
\[ NL_{S/R} = \left( I/I^2 \to \Omega_{R[S]/R}  \otimes_R S \right) \]
The second exact sequence shows that $H^0(NL_{S/R}) = \Omega_{S/R}$. 
\end{defn}

\begin{defn}
We say a ring map $R \to S$ is smooth if it is finitely presented and $NL_{S/R}$ is quasi-isomorphic to a finite projective $S$-module placed in degree zero. 
\end{defn}

\begin{example}
We say a morphism $R \to S$ is \textit{standard smooth} if $S = R[x_1, \dots, x_n]/(f_1, \dots, f_c)$ and the polynomial,
\[ g = \det{\left( \pderiv{f_i}{x_j} \right)_{\substack{i = 1, \dots, c \\ j = 1, \dots, c}}} \]
in $R[x_1, \dots, x_n]$ maps to a unit in $S$. Such a ring map is smooth. 
\end{example}

\begin{defn}
A ring map $R \to A$ is \textit{formally smooth} if every diagram of the form,
\begin{center}
\begin{tikzcd}
A \arrow[r] \arrow[dr, dashed] & B/I 
\\
R \arrow[u] \arrow[r] & B \arrow[u]
\end{tikzcd}
\end{center}
where $I^2 = 0$ admits a map $A \to B$ making the diagram commute.
\end{defn}

\begin{prop}
Standard smooth ring maps are formally smooth.
\end{prop}

\begin{proof}
Let $A = R[x_1, \dots, x_n]/(f_1, \dots, f_c)$. Consider the map $\varphi : A \to B / I$ defined by $\varphi(x_i) = \bar{b_i}$. We may choose lifts $b_i + q_i \in B$ for $q_i \in I$ which define a morphism exactly when all $f_i(b + q) = 0$. Since $\varphi : A \to B/I$ is a ring map, we know that $\pi(f_i(b + q)) = f_i(\bar{b}) = 0$ meaning that $f_i(b + q) \in I$. Then, Taylor expanding,
\[ f_i(b + q) = f_i(b) + \sum_{j = 1}^n \pderiv{f_i}{x_j} (b) q_j + O(q_j^2) \]
but $I^2 = 0$ and thus the order $q_j^2$ terms vanish so we find,
\[ f_i(b + q) = f_i(b) + \sum_{j = 1}^n \pderiv{f_i}{x_j} q_j \]
Therefore, we can make the map $A \to B$ defined by the lifts $x_i \mapsto b_i + q_i$ well-defined if we can solve the matrix equation,
\[ \left( \pderiv{f_i}{x_j}(b) \right) \cdot q = - f(b) \]
Note that $I / I^2 = I$ so $I$ is naturally a $B/I$-module. Therefore, we may replace this with,
\[ \left( \pderiv{f_i}{x_j}(\bar{b}) \right) \cdot q = - f(b) \]
where $\pderiv{f_i}{x_j}(\bar{b})$ is the image of the matrix under $\pi : B \to B/I$. Finally, the determinant of the first $c \times c$ minor is a unit in $A$ and thus this matrix is a unit in $B/I$ so the above matrix equation admits a solution. Furthermore, the solution is unique if $n = c$ in which case the matrix is square an nonsingular so we get a unique map and we call $R \to A$ formally \etale. 
\end{proof}

\begin{prop}
$R \to A$ is smooth iff it is of finite presentation and formally smooth.
\end{prop}

\begin{proof}
Tag 00TN.
\end{proof}

\begin{prop}
Consider ring maps $R \to A \to B$ with $A \to B$ formally smooth then the first exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \Omega_{A/R} \otimes_A B \arrow[r] & \Omega_{B/R} \arrow[r] & \Omega_{B/A} \arrow[r] & 0
\end{tikzcd}
\end{center}
is a split short exact sequence of $B$-modules.
\end{prop}

\begin{prop}
Let $R \to A$ be a ring map and $B = A/I$ with $R \to B$ formally smooth. Then the second exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & I/I^2 \arrow[r] & \Omega_{A/R} \otimes_A B \arrow[r] & \Omega_{B/R} \arrow[r] & 0
\end{tikzcd}
\end{center}
is a split short exact sequence of $B$-modules.
\end{prop}

\subsection{Smooth Morphisms of Schemes}

\begin{defn}
We say that a morphism of schemes $f : X \to Y$ is \textit{smooth} at $x$ if there are affine opens $x \in U \subset X$ and $V \subset Y$ such that $f(U) \subset V$ and $f^\# : \struct{Y}(V) \to \struct{X}(U)$ is smooth. We say $f$ is smooth if it is smooth at every point.
\end{defn}

\begin{rmk}
The smooth locus of a morphism $f : X \to Y$ is automatically open by definition.
\end{rmk}

\begin{rmk}
Since $R \to A$ being smooth is a local property smoothness of a morphism implies smoothness on all affine ring maps.
\end{rmk}

\begin{lemma}
Let $f : X \to S$ be locally of finite presentation. Then $f$ is smooth at $x$ iff $\stalk{S}{f(x)} \to \stalk{X}{x}$ is flat and $X_{f(x)} \to \Spec{\kappa(f(x))}$ is smooth at $x$.
\end{lemma}

\begin{proof}
Tag 01V9.
\end{proof}

\begin{lemma}
Let $f : X \to \Spec{k}$ be locally of finite type. Then $f$ is smooth iff $X$ is geometrically regular over $k$. 
\end{lemma}

\begin{proof}
Tag 038X.
\end{proof}

\begin{rmk}
The preceeding two facts gives an alternative description of a smooth morphism.
\end{rmk}

\begin{prop}
A morphism $f : X \to Y$ is smooth iff it is
\begin{enumerate}
\item locally of finite presentation
\item flat
\item has geometrically regular fibers i.e. $X_y \to \Spec{\kappa(y)}$ is geometrically regular over $\kappa(y)$ for each $y \in Y$. 
\end{enumerate}
\end{prop}

\begin{prop}
Given a morphism $f : X \to Y$ of schemes over $S$, there is a canonical exact sequence,
\begin{center}
\begin{tikzcd}
f^* \Omega_{Y/S} \arrow[r] & \Omega_{X/S} \arrow[r] & \Omega_{X/Y} \arrow[r] & 0
\end{tikzcd}
\end{center}
which when $f$ is smooth is short exact i.e. $f^* \Omega_{Y/S} \to \Omega_{X/S}$ is injective.
\end{prop}

\begin{defn}
Given an immersion $\iota : Z \embed X$ with sheaf of ideals $\I = \ker{(\struct{X} \to \iota_* \struct{Z})}$ the nonormal sheaf is $\C_{Z/X} = \iota^* \I$ and $\iota_* \C_{Z/X} = \I \otimes_{\struct{X}} \struct{Z} = \I / \I^2$
\end{defn}

\begin{prop}
Given an immersion $\iota : Z \embed X$ of schemes over $S$ with sheaf of ideals $\I$ there is a canonical exact sequence,
\begin{center}
\begin{tikzcd}
\C_{Z/X} \arrow[r] & \iota^* \Omega_{X/S} \arrow[r] & \Omega_{Z/S} \arrow[r] & 0
\end{tikzcd}
\end{center}
which, when $Z \to S$ is smooth, is short exact i.e. $\C_{Z/X} \to \iota^* \Omega_{X/S}$ is injective.
\end{prop}

\begin{prop}
Let $f : X \to S$ be smooth. Then $\Omega_{X/S}$ is finite locally free and,
\[ \mathrm{rank}_x(\Omega_{X/S}) = \dim_x (X_{f(x)}) \]
\end{prop}

\begin{defn}
$f : X \to S$ is smooth of relative dimension $n$ if $f$ is smooth and $\Omega_{X/S}$ is locally free of constant rank $n$. 
\end{defn}

\begin{prop}
A morphism $f : X \to S$ is smooth iff 
\begin{enumerate}
\item $f$ is locally of finite presentation
\item $f$ is flat
\item $\Omega_{X/S}$ is locally free with $\rank_x(\Omega_{X/S}) = \dim_x(X_{f(x)})$. 
\end{enumerate}
\end{prop}

\begin{defn}
A morphism $f : X \to Y$ is \textit{\etale} if it is smooth of relative dimension zero. Therefore, we see that \etale is equivalent to.
\begin{enumerate}
\item locally of finite presentation
\item flat
\item $\Omega_{X/Y} = 0$
\end{enumerate}
which is the same as saying $f : X \to Y$ is smooth and unramified or flat and G-unramified.
\end{defn}

\begin{prop}
When $f : X \to Y$ is over $S$ is \etale the induced map $f^* \Omega_{Y/S} \xrightarrow{\sim} \Omega_{X/S}$ is an isomorphism.
\end{prop}

\begin{proof}
By smoothness, there is an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & f^* \Omega_{Y/S} \arrow[r] & \Omega_{X/S} \arrow[r] & \Omega_{X/Y} \arrow[r] & 0
\end{tikzcd}
\end{center}
but $\Omega_{X/Y} = 0$ since $f : X \to Y$ is \etale.
\end{proof}

\subsection{Formal Maps}

\begin{defn}
A morphism $f : X \to S$ consider every diagram,
\begin{center}
\begin{tikzcd}
X \arrow[d, "f"'] & \Spec{A/I} \arrow[l] \arrow[d]
\\
S & \Spec{A} \arrow[l] \arrow[lu, dashed]
\end{tikzcd}
\end{center}
with $I^2 = 0$. Searching for a lift $\Spec{A} \to X$ making the diagram commute, we say that $f$ is,
\begin{enumerate}
\item \textit{formally smooth} if a lift exists
\item \textit{formally unramified} if at most one lift exists
\item \textit{formally \etale} if a unique lift exists.
\end{enumerate}
\end{defn}

\begin{rmk}
Clearly $f$ is formally \etale iff it is formally smooth and formally unramified. 
\end{rmk}

\begin{rmk}
In particular, if $X$ and $S$ are affine then $X \to S$ is formally smooth (resp. unramified resp. \etale) iff $\struct{S}(S) \to \struct{X}(X)$ is formally smooth (rep. unramified resp. \etale) by definition and the anti-equivalence of categories between affine schemes and rings.
\end{rmk}

\begin{theorem}
The following are equivalent for a morphism of schemes $f : X \to Y$,
\begin{enumerate}
\item $f$ is smooth
\item $f$ is formally smooth and locally of finite type.
\end{enumerate}
\end{theorem}

\begin{proof}
Tag 02H6.
\end{proof}

\begin{prop}
Let $f : X \to Y$ over $S$ be formally smooth. Then the canonical exact sequence is short exact,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & f^* \Omega_{Y/S} \arrow[r] & \Omega_{X/S} \arrow[r] & \Omega_{X/Y} \arrow[r] & 0
\end{tikzcd}
\end{center}
Furthermore, if $\iota : Z \to X$ is formally unramified over $S$ with $Z \to S$ formally smooth then the canonical exact sequence is short exact,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \C_{Z/X} \arrow[r] & \iota^* \Omega_{X/S} \arrow[r] & \Omega_{Z/S} \arrow[r] & 0
\end{tikzcd}
\end{center}
\end{prop}

\begin{proof}
Tag 06B6 and Tag 06B7.
\end{proof}

\subsection{Intuition}

\begin{rmk}
We give intuition for why it is correct to thing of the following correspondences between properties in algebraic and in differential geometry,
\begin{enumerate}
\item smooth morphisms $\iff$ submersions
\item unramified morphisms $\iff$ immersions
\item \etale morphisms $\iff$ local diffeomorphims
\end{enumerate}
\end{rmk}

\noindent
We now justify this intuition as follows. The important facts about submersions follows from the constant rank theorem,

\begin{theorem}
Let $f : M \to N$ me a morphism such that $\d{f} : T_p M \to T_{f(p)} N$ has constant rank in a neighborhood of $p \in M$. Then there exists opens $U \subset M$ and $V \subset N$ with $p \in U$ and $f(p) \in V$ and diffeomorphisms $u : T_p X \to U$ and $v : T_{f(p)} Y \to V$ making the diagram commute,
\begin{center}
\begin{tikzcd}
T_p M \arrow[r, "u"] \arrow[d, "\d{f}"] & U \subset M \arrow[d, "f"]
\\
T_{f(p)} N \arrow[r, "v"] & V \subset N
\end{tikzcd}
\end{center} 
\end{theorem}

\begin{corollary}
If $\d{f} : T_p M \to T_{f(p)} N$ is an isomorphism then $f$ is locally at $p$ a diffeomorphism.
\end{corollary}

\begin{corollary}
Local immersions are locally the inclusion of a subspace and local submersion are locally a projection to a subspace. 
\end{corollary}

\begin{definition}
Let $f : M \to N$ be a smooth map. Then $x \in M$ is a \textit{regular point} if $\d{f}_x : T_x M \to T_x N$ is surjective. We say that $y \in N$ is a \textit{regular value} if each $x \in f^{-1}(y)$ is a regular point. If every point (equivalently value) is regular then $f : M \to N$ is a \textit{submersion}. 
\end{definition}

\begin{theorem}[Preimage]
Let $f : M \to N$ be smooth and $y \in N$ a regular value. Then $Y = f^{-1}(y)$ is an embedded submanifold of $M$ of codimension $\dim{N}$. Furthermore, for any $x \in Y$ the tangent space is $T_x Y = \ker{\d{f}_x} \subset T_x M$. 
\end{theorem}

\noindent
The preimage theorem is analogous to the criterion that (let $f$ be locally of finite presentation and flat) $f : X \to Y$ is smooth at every point over $y$ (i.e. $y$ is a regular value) iff the fiber $X_y \to \Spec{\kappa(y)}$ is smooth i.e. $X_y$ is nonsingular. Therefore, a smooth map is one with smooth fibers just as a submersion is a map whose fibers are smooth submanifolds.
\bigskip\\
Furthermore, we can directly relate the algebraic geometry conditions to conditions about the pullback map on differential forms dual to the derivative map on tangent vectors which will directly relate these properties to the definitions of the associated differential geometry concepts.
\bigskip\\
We have the following,
\begin{enumerate}
\item smooth $\implies f^* \Omega_Y \embed \Omega_X$ is injective 
\item unramified $\implies f^* \Omega_Y \onto \Omega_X$ is surjective
\item \etale $\implies f^* \Omega_Y \xrightarrow{\sim} \Omega_X$ is an isomorphism.
\end{enumerate}
Then dualizing we see that on tangent sheaves,
\begin{enumerate}
\item smooth $\implies \T_X \onto f^* \T_Y$ is surjective 
\item unramified $\implies \T_X \embed f^* \T_Y$ is surjective
\item \etale $\implies T_Y \xrightarrow{\sim} f^* \T_X$ is an isomorphism.
\end{enumerate}
These exactly correspond to the differential geometry definitions of submersion, immersion, and local diffeomorphism. 
\bigskip\\
Finally, we may give intuition for the formal versions of these properties and how they relate to the condition on the differential map on tangent vectors. Let $f : X \to Y$ be formally smooth / unramified / \etale map of varieties over an algebraically closed field $k$. Then for each closed point $y \in Y$ and tangent vector at $y$ there is an associated map $\Spec{k[x]/(x^2)} \to Y$. Furthermore, for any closed point $\Spec{k} \to X$ above $y$, taking the ideal $(x)$ which has square zero we get a diagram,
\begin{center}
\begin{tikzcd}
X \arrow[d, "f"'] & \Spec{k} \arrow[l] \arrow[d]
\\
S & \Spec{k[x]/(x^2)} \arrow[l] \arrow[lu, dashed]
\end{tikzcd}
\end{center}
\begin{enumerate}
\item If $f$ is formally smooth there exists a lift $\Spec{k[x]/(x^2)} \to X$ so we may lift tangent vectors i.e. the differential $\d{f} : T_x X \to T_y Y$ is surjective ($f$ is a submersion).

\item If $f$ is formally unramified there is at most one lift i.e. the differntial $\d{f} : T_x X \to T_y Y$ is injective ($f$ is an immersion).

\item If $f$ is formally \etale then there is a unique lift i.e. the differential $\d{f} : T_x X \to T_y Y$ is an isomorphism ($f$ is a localy diffeomorphism). 
\end{enumerate}

\section{Serre Duality}

\subsection{Some Homological Algebra}

\begin{rmk}
Here we work in abelian cateogries $\mathcal{A}, \mathcal{B}$ with a left-exact additive functor $F : \mathcal{A} \to \mathcal{B}$.
\end{rmk}

\begin{lemma}
Every summand of an injective object is injective. 
\end{lemma}

\begin{proof}
Suppose that $I = K \oplus L$ is injective. Given an injection $A \embed B$ and a map $A \to K$ we get a diagram,
\begin{center}
\begin{tikzcd}
A \arrow[dd, hook] \arrow[rd] \arrow[rr] & & K \arrow[dd] \arrow[ld, "\id"]
\\
& K 
\\
B \arrow[rr, dashed] \arrow[ru, dashed] & & I \arrow[ul]
\end{tikzcd}
\end{center}
so $A \to K$ extends to $B \to K$ so $K$ is injective.
\end{proof}

\begin{cor}
Suppose $K \embed I$ is an embedding of injective modules. Then the quotient $I/K$ is injective.
\end{cor}

\begin{proof}
There is an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & K \arrow[r] & I \arrow[r] & I/K  \arrow[r] & 0
\end{tikzcd}
\end{center}
But $K$ is injective so this splits giving $I = K \oplus I/K$ and thus $I/K$ is injective.
\end{proof}

\begin{lemma}
Let $I^\bullet$ be a complex with $I^{n-1}$ injective. Define, 
\[ B^n = \Im{I^{n-1} \to I^n} \quad \text{and} \quad Z^n = \ker{(I^n \to I^{n+1})} \]
Fix $n$ such that $Z^{n-1}$ is injective. Then $H^n(F(I^\bullet)) = F(H^n(I^\bullet))$. If further $Z^n$ is injective then $H^n(I^\bullet)$ is also injective.
\end{lemma}

\begin{proof}
There are exact sequences,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & Z^{n-1} \arrow[r] & I^{n-1} \arrow[r] & B^{n} \arrow[r] & 0
\\
0 \arrow[r] & B^{n} \arrow[r] & Z^{n} \arrow[r] & H^n(I^\bullet) \arrow[r] & 0
\end{tikzcd}
\end{center}
since $Z^{n-1}$ and $I^{n-1}$ are injective then $B^n$ is injective. Thus, the sequences split because $Z^{n-1}$ and $B^n$ are injective. Furthermore, if $Z^n$ is injective then $H^n(I^\bullet)$ is also injective. Futhermore, because $F$ is additive, it preserves split exact sequences so,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & F(Z^{n-1}) \arrow[r] & F(I^{n-1}) \arrow[r] & F(B^{n}) \arrow[r] & 0
\\
0 \arrow[r] & F(B^{n}) \arrow[r] & F(Z^{n}) \arrow[r] & F(H^n(I^\bullet)) \arrow[r] & 0
\end{tikzcd}
\end{center}
are exact. From the first exact sequence, $F(B^n) = \Im{F(I^{n-1}) \to F(I^n)}$. Since $F$ perserves kernels $F(Z^n) = \ker{(F(I^n) \to F(I^{n+1}))}$. Therefore, the second sequence gives $H^n(F(I^\bullet)) = F(H^n(I^\bullet))$.
\end{proof}

\begin{lemma} \label{compute_first_nonzero_cohomology}
Let $I^\bullet$ be a bounded below complex of injectives and $c$ the smallest integer with $H^c(I^\bullet) \neq 0$. Then, $H^i(F(I^\bullet)) = 0$ for $i < c$ and $H^c(F(I^\bullet)) = F(H^c(I^\bullet))$.
\end{lemma}

\begin{proof}
Since $I^\bullet$ is bounded below it begins with $0 \to I^0 \to I^1 \to I^2$. If $c = 0$ then the first condition is trivially true and the second condition says $\ker{(F(I^0) \to F(I^1))} = F(\ker{(I^0 \to I^1)}$ which holds because $F$ is left-exact. Otherwise $ c > 0$  so $I^\bullet$ is exact at $I^0$. Thus, $Z^0 = \ker{(I^1 \to I^2)} = I^0$ is injective. Then, by the exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & Z^{n-1} \arrow[r] & I^{n-1} \arrow[r] & B^{n} \arrow[r] & 0
\end{tikzcd}
\end{center}
we find that if $Z^{n-1}$ is injective then so is $B^{n}$. If $n < c$ then $I^\bullet$ is exact at $I^{n}$ so $B^{n} = Z^{n}$ so $Z^{n}$ is injective. Therefore, $Z^n = B^n$ is injective for $n < c$. By the previous lemma, for $n \le c$ we have $H^n(F(I^\bullet)) = F(H^n(I^\bullet))$ which is zero for $n < c$.
\end{proof}

\begin{rmk}
Alternatively, there is a spectral sequence proof. There is a spectral sequence computing the hyperderived functors,
\[ E^{p,q}_2 = R F^p(H^q(I^\bullet)) \implies \mathbb{R} F^{p + q}(I^\bullet) \]
However, since $I^\bullet$ is injective, $\mathbb{R} F^{p + q}(I^\bullet) = H^{p + q}(F(I^\bullet))$. Then,
\[ E^{p, q}_2 = R F^p(H^q(I^\bullet)) = 
\begin{cases}
0 & q < c \text{ or } p < 0
\\
R F^p(H^c(I^\bullet)) & p \ge 0 \text{ and } q = c
\\
R F^p(H^q(I^\bullet)) & p + q > c
\end{cases} \]
Therefore, for $p + q < c$ all $E^{p,q}_2 = 0$ so $E^{p,q}_\infty = H^{p+q}(F(I^\bullet)) = 0$ for $p + q < c$. Furthermore, for $p + q = c$ the only nonzero term is $q = c$ and $p = 0$. However, for $r \ge 2$ all differentials starting at $(0, c)$ end outside the positive quadrant so are zero and all differentials ending at $(0, c)$ must start with $q < c$ and thus must be zero. Therefore, $E^{0,c}_{\infty} = F(H^c(I^\bullet))$ and $E^{p, q}_{\infty} = 0$ for $p + q = c$ and $q \neq c$. Thus, $H^c(F(I^\bullet)) = E^{0,c}_2 = F(H^c(I^\bullet))$. 
\end{rmk}

\subsection{Tensor-Hom Adjunction Done Right}

\begin{theorem}
Let $A, B, C, D$ be (non-commutative) rings and $M$ be an $(A, B)$-bimodule, $N$ be a $(B, C)$-bimodule, and $K$ be a $(D, C)$-bimodule. Then there is a natural adjunction,
\[ \Hom{C}{M \otimes_B N}{K} \cong \Hom{B}{M}{\Hom{C}{N}{K}} \]
as $(D, A)$-bimodules. Furthermore, let $M$ be an $(A, B)$-bimodule, $N$ be a $(B, C)$-bimodule, and $K$ be a $(A, D)$-bimodule. Then there is a natural adjunction,
\[ \Hom{A}{M \otimes_B N}{K} \cong \Hom{B}{N}{\Hom{A}{M}{K}} \]
as $(C, D)$-bimodules.
\end{theorem}

\begin{proof}
Let $\varphi : M \otimes_B N \to K$ be a right $C$-module map. Send this to the map $\tilde{\varphi} : M \to \Hom{C}{N}{K}$ via $\tilde{\varphi} : m \mapsto (n \mapsto \varphi(m \otimes n))$ and $\tilde{\varphi}$ is a map of right $B$-modules since,
\[ m \cdot b \mapsto (n \mapsto \varphi(m \otimes b n)) = (n \mapsto \varphi(m \otimes n)) \cdot b \]
We must check this is an isomorphism of $(C, A)$-bimodules. 
\end{proof}

\begin{rmk}
From here on we assume all rings are commutative. 
\end{rmk}

\begin{cor}
Let $A \to B$ be a map of rings, $M, N$ be $B$-modules and $K$ an $A$-module. Then there is a natural adjunction of $B$-modules,
\[ \Hom{A}{M \otimes_B N}{K} \cong \Hom{B}{M}{\Hom{A}{N}{K}} \]
\end{cor}

\begin{proof}
We replace $A,B,C,D$ in the theorem by $B,B,A,A$. Via the ring map, we view $M$ as an $(B,B)$-bimodule, $N$ as an $(B, A)$-bimodule, and $K$ as an $(A, A)$-bimodule. Then we get a map of $(A, B)$-bimodules,
\[ \Hom{A}{M \otimes_B N}{K} \cong \Hom{B}{M}{\Hom{A}{N}{K}} \]
\end{proof}

\begin{cor}
Let $A \to B$ be a map of rings, $M$ be an $A$-module and $N, K$ be $B$-modules. Then there is a natural adjunction of $B$-modules,
\[ \Hom{B}{M \otimes_A N}{K} \cong \Hom{A}{M}{\Hom{B}{N}{K}} \]
\end{cor}

\begin{proof}
We replace $A,B,C,D$ in the theorem by $A,A,B,B$. Via the ring map, we view $M$ as an $(A,A)$-bimodule, $N$ as an $(A, B)$-bimodule, and $K$ as an $(B, B)$-bimodule. Then we get a map of $(B, A)$-bimodules,
\[ \Hom{B}{M \otimes_A N}{K} \cong \Hom{A}{M}{\Hom{B}{N}{K}} \]
\end{proof}

\begin{cor}
Let $A$ be a ring, $M, N, K$ be $A$-modules. Then there is a natural adjunction of $A$-modules,
\[ \Hom{A}{M \otimes_A N}{K} \cong \Hom{A}{M}{\Hom{A}{N}{K}} \]
\end{cor}

\begin{proof}
Viewing $M, N, K$ as $(A, A)$-bimodules we find,
\[ \Hom{A}{M \otimes_A N}{K} \cong \Hom{A}{M}{\Hom{A}{N}{K}} \]
as $(A,A)$-bimodules.
\end{proof}

\begin{cor}
Let $A \to B$ be a map of rings. The restriction $(-)_A : \Mod{B} \to \Mod{A}$ functor and internal hom $\Hom{A}{B}{-} : \Mod{A} \to \Mod{B}$ are adjoint via,
\[ \Hom{A}{M_A}{N} \cong \Hom{B}{M}{\Hom{A}{B}{N}} \]
as $B$-modules.
\end{cor}

\begin{proof}
We replace $A,B,C,D$ in the theorem by $B, B, A, A$. View $M$ as an $(B, B)$-bimodule, $B$ as a $(B, A)$-bimodule, and $N$ as a $(A, A)$-bimodule. Then we get,
\[ \Hom{A}{M \otimes_B B}{N} \cong \Hom{B}{M}{\Hom{A}{B}{N}} \]
as $(A, B)$-bimodules.
\end{proof}


\begin{cor}
Let $A \to B$ be a map of rings. The tensor product $- \otimes_A B : \Mod{A} \to \Mod{B}$ and restriction $(-)_A : \Mod{B} \to \Mod{A}$ are adjoint via,
\[ \Hom{B}{M \otimes_A B}{N} \cong \Hom{A}{M}{N_A} \]
as $B$-modules.
\end{cor}

\begin{proof}
We replace $A, B, C, D$ in the theorem by $A, A, B, B$. View $M$ as an $(A, A)$-bimodule, $B$ as a $(A, B)$-bimodule, and $N$ as a $(B, B)$-bimodule. Then we get,
\[ \Hom{B}{M \otimes_A B}{N} \cong \Hom{A}{M}{\Hom{B}{B}{N}} \]
as $(B, A)$-bimodules.
\end{proof}

\begin{cor}
Let $A \to B$ be a ring map, $N$ a flat $B$-module, and $I$ an injective $A$-module. Then $\Hom{A}{N}{I}$ is an injective $B$-module.
\end{cor}

\begin{proof}
The functor $\Hom{A}{N}{-}$ is right-adjoint to $- \otimes_B N$ which is exact so $\Hom{A}{B}{-}$ preserves injectives. Explicitly,
the functor $\Hom{B}{-}{\Hom{A}{N}{I}} = \Hom{A}{- \otimes_B N}{I}$ is exact on $\Mod{B}$ since $\Hom{A}{-}{I}$ and $- \otimes_B N$ are exact. 
\end{proof}

\begin{cor}
Let $A \to B$ be a ring map, $P$ a projective $A$-module, $Q$ a projective $B$-module. Then $P \otimes_A Q$ is a projective $B$-module.
\end{cor}

\begin{proof}
The functor $- \otimes_A Q$ is left-adjoint to $\Hom{B}{Q}{-}$ which is exact since $Q$ is projective so $- \otimes_A Q$ preserves projectives. Explicitly, the functor $\Hom{B}{P \otimes_A N}{-} = \Hom{A}{P}{\Hom{B}{N}{-}}$ is exact on $\Mod{B}$ since $\Hom{A}{P}{-}$ and $\Hom{B}{Q}{-}$ are exact.
\end{proof}

\begin{theorem}
Let $A \to B$ be a map of rings. Let $M, N$ be $B$-modules with $N$ flat over $B$ and $K$ an $A$-module. Then there is a spectral sequence,
\[ E^{p,q}_2 = \Ext{p}{B}{M}{\Ext{q}{A}{N}{K}} \implies \Ext{p+q}{A}{M \otimes_B N}{K} \]
\end{theorem}

\begin{proof}
The functors $\Hom{B}{M}{-}$ and $\Hom{A}{N}{-}$ satisfy,
\[ \Hom{B}{M}{\Hom{A}{N}{-}} = \Hom{A}{M \otimes_B N}{-} \]
Furthermore, $\Hom{A}{N}{-}$ preserves injectives because $N$ is flat so $\Hom{A}{N}{-}$ is right-adjoint to $- \otimes_B N$ which is exact. Therefore, the Grothendieck spectral sequence applies to this composition of functors giving a spectral sequence,
\[ E^{p,q}_2 = \Ext{p}{B}{M}{\Ext{q}{A}{N}{K}} \implies \Ext{p+q}{A}{M \otimes_B N}{K} \]
\end{proof}

\subsection{Tensor-Hom Adjunction for Sheaves}


\begin{prop} \label{tensor_hom_adjunction_sites}
Let $X$ be a site and $\sA \to \sB$ be a map of sheaves of rings. Let $\F, \H$ be $\sB$-modules and $\H$ be a $\sA$-module. Then there is a natural isomorphism,
\[ \shHom{\sA \:}{\F \otimes_{\sB} \G}{\H} \cong \shHom{\sB \:}{\F}{\shHom{\sA \:}{\G}{\H}} \]
\end{prop}

\begin{prop}
Let $(X, \struct{X})$ be a ringed space, $\F, \G, \H$ be $\struct{X}$-modules. Then there is a canonical isomorphism,
\[ \shHom{\struct{X}}{\F \otimes_{\struct{X}} \G}{\H} \iso \shHom{\struct{X}}{\F}{\shHom{\struct{X}}{\G}{\H}} \]
\end{prop}

\begin{proposition} \label{flat_hom_injective}
Let $\sA \to \sB$ be a map of sheaves of rings. Let $\K$ be a flat (e.g. locally free) $\sB$-module and $\I$ an injective $\sA$-module. Then $\shHom{\sA \:}{\K}{\I}$ is an injective $\sB$-module.
\end{proposition}

\begin{proof}
The functor
\[ \shHom{\sA \:}{\K}{-} : \Mod{\sA} \to \Mod{\sB} \] 
is right-adjoint to tensor product $- \otimes_{\sB} \K : \Mod{\sB} \to \Mod{\sA}$ which is exact because $\K$ is flat. Explicitly, the functor,
\[ \Hom{\sB}{-}{\shHom{\sA \:}{\K}{\I}} = \Hom{\sA}{- \otimes_{\sB} \K}{\I} \]
is exact since $\I$ is an injective $\sA$-module and $\L$ is $\sB$-flat.
\end{proof}

\begin{theorem}
Let $\sA \to \sB$ be a map of sheaves of rings, $\F$ a $\sB$-module, $\K$ a flat $\sB$-module, and $\G$ a $\sA$-module. Then there exist two spectral sequences,
\begin{align*}
E^{p, q}_2 & = \shExt{p \:}{\sB}{\F}{\shExt{q \:}{\sA}{\K}{\G}} \implies \shExt{p+q \:}{\sA}{\F \otimes_{\sB} \K}{\G} 
\\
E^{p, q}_2 & = \Ext{p}{\sB}{\F}{\shExt{q \:}{\sA}{\K}{\G}} \implies \Ext{p+q}{\sA}{\F \otimes_{\sB} \K}{\G} 
\end{align*}
\end{theorem}

\begin{proof}
The functors $\shHom{\sB \:}{\F}{-}$ and $\shHom{\sA \:}{\K}{-}$ satisfy,
\[ \shHom{\sB \:}{\F}{\shHom{\sA \:}{\K}{-}} = \shHom{\sA \:}{\F \otimes_{\sB} \K}{-} \]
Furthermore, by the previous lemma, $\shHom{\sA \:}{\K}{-}$ preserves injectives which are acyclic for $\shHom{\sB \:}{\F}{-}$ so we may apply the Grothendieck spectral sequence to this composition of functors to get a spectral sequence,
\[ E^{p, q}_2 = \shExt{p \:}{\sB}{\F}{\shExt{q \:}{\sA}{\K}{\G}} \implies \shExt{p+q \:}{\sA}{\F \otimes_{\sB} \K}{\G} \]
Furthermore, taking the global section of the first equation gives,
\[ \Hom{\sB}{\F}{\shHom{\sA \:}{\K}{-}} = \Hom{\sA}{\F \otimes_{\sB} \K}{-} \]
and $\shHom{\sA \:}{\K}{-}$ preserves injectives which are acyclic for $\Hom{\sB}{\F}{-}$ so we may apply the Grothendieck spectral sequence to this composition of functors to get a spectral sequence,
\[ E^{p, q}_2 = \Ext{p}{\sB}{\F}{\shExt{q \:}{\sA}{\K}{\G}} \implies \Ext{p+q}{\sA}{\F \otimes_{\sB} \K}{\G} \]
\end{proof}

\subsection{Depth and Cohen-Macaulayness}

\begin{prop}
Let $A$ be a regular local ring and $B = A / I$. Then $\Ext{p}{A}{B}{-} = 0$ for $p > \dim{A} - \dim{B}$. 
\end{prop}

\begin{prop}
Let $A$ be a Cohen-Macaulay local ring and $B = A/I$. Then $\Ext{p}{A}{B}{-} = 0$ for $p < \dim{A} - \dim{B}$. 
\end{prop}

\subsection{Serre Duality}

(CHECK THE HYPOTHESES!!)

(DEFINE DUALIZING SHEAF!)

(UNIQUENESS OF DUALIZING SHEAF!)

(EXISTENCE OF QUASI-COHERENT DUALIZING SHEAF)

\begin{theorem}
Let $X$ be projective, Cohen-Macaulay, $k$-scheme of equidimension $n$. Further, suppose $X$ has a dualizing sheaf $\omega_X$. Then, there is a natural isomorphism for any coherent sheaf $\F$ and $i \ge 0$,
\[ \theta^i : \Ext{i}{\struct{X}}{\F}{\omega_X} \iso H^{n-i}(X, \F)^\vee \] 
agreeing in $i = 0$ with $\Hom{\struct{X}}{\F}{\omega_X} \iso H^n(X, \F)^\vee$.
\end{theorem}

\begin{proof}
(DO THISS!!!!)
\end{proof}

\begin{theorem}
(DOOO!!!) Serre Duality for $\P^n$. 
\end{theorem}


\begin{prop}
Let $\iota : X \embed Y$ be a closed immersion of projective $k$-schemes. Let $c = \dim{X} - \dim{Y}$ be the codimension. Suppose that $Y$ is Cohen-Macaulay, equidimensional and has a dualizing sheaf $\omega_Y$. Furthermore, suppose that $\shExt{p}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y} = 0$ for $p < c$. Then $\omega_X = \iota^* \shExt{c}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y}$ is a dualizing sheaf for $X$. 
\end{prop}

\begin{proof}
Let $n = \dim{X}$ and $m = \dim{Y}$.
We need to show there is a natural isomorphism,
\[ \Hom{\struct{X}}{\F}{\omega_X} = H^n(X, \F)^\vee \]
We compute,
\[ \Hom{\struct{X}}{\F}{\omega_X} = \Hom{\iota_* \struct{X}}{\iota_* \F}{\shExt{c}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y}} \]
Now I claim that,
\[ \Hom{\iota_* \struct{X}}{\iota_* \F}{\shExt{c}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y}} = \Ext{c}{\struct{Y}}{\iota_* \F}{\omega_Y} \]
To do this, we can use Prop. \ref{compute_first_nonzero_cohomology}.  Choose an injective resolution $\omega_Y \to \I^\bullet$. Then we take the complex $\shHom{\struct{Y}}{\iota_* \struct{X}}{\I^\bullet}$ which is a complex of injective $\iota_* \struct{X}$-modules since  \[ \shHom{\struct{Y}}{\iota_* \struct{X}}{-} : \Mod{\struct{Y}} \to \Mod{\iota_* \struct{X}} \] is right-adjoint to restriction $\Mod{\iota_* \struct{X}} \to \Mod{\struct{Y}}$ which is exact (see Lemma \ref{flat_hom_injective}). Furthermore,
\[ \shExt{p}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y} = H^p(\shHom{\struct{Y}}{\iota_* \struct{X}}{\I^\bullet}) \]
so by assumption the complex is exact for $p < c$. 
Taking the right-exact functor $\Hom{\iota_* \struct{X}}{\iota_* \F}{-}$ we can apply Prop. \ref{compute_first_nonzero_cohomology} to get,
\begin{align*}
\Hom{\iota_* \struct{X}}{\iota_* \F}{\shExt{c}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y}} & = \Hom{\iota_* \struct{X}}{\iota_* \F}{H^c(\shHom{\struct{Y}}{\iota_* \struct{X}}{\I^\bullet})}
\\
& = H^c(\Hom{\iota_* \struct{X}}{\iota_* \F}{\shHom{\struct{Y}}{\iota_* \struct{X}}{\I^\bullet}})
\end{align*}
However, by Prop. \ref{tensor_hom_adjunction_sites}, we get,
\[ \Hom{\iota_* \struct{X}}{\iota_* \F}{\shHom{\struct{Y}}{\iota_* \struct{X}}{\I^\bullet}}  = \Hom{\struct{Y}}{\iota_* \F}{\I^\bullet} \]
Therefore,
\begin{align*}
\Hom{\iota_* \struct{X}}{\iota_* \F}{\shExt{c}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y}} & = H^c(\Hom{\struct{Y}}{\iota_* \F}{\I^\bullet}) = \Ext{c}{\struct{Y}}{\iota_* \F}{\omega_Y} 
\end{align*}
Furthermore, since $Y$ is Cohen-Macaulay and equidimensional, by Serre Duality, we have,
\[ \Ext{c}{\struct{Y}}{\iota_* \F}{\omega_Y} = H^{m-c}(Y, \iota_* \F)^\vee = H^{n}(X, \F)^\vee \]
Putting everything together we find,
\[ \Hom{\struct{X}}{\F}{\omega_X} = \Hom{\iota_* \struct{X}}{\iota_* \F}{\shExt{c}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y}} = H^{n}(X, \F)^\vee \]
as required.
\end{proof}

\begin{rmk}
Alternatively, we may give a spectral sequence proof. The ring map $\struct{Y} \to \iota_* \struct{X}$ gives a spectral sequence,
\[ E^{p, q}_2 = \Ext{p}{\iota_* \struct{X}}{\iota_* \F}{\shExt{q \:}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y}} \implies \Ext{p+q}{\struct{Y}}{\iota_* \F}{\omega_Y} \]
where we have used that $\iota_* \struct{X}$ is trivially flat as a $\iota_* \struct{X}$-module. Now, $E^{p,q}_2 = 0$ for $q < c$ because $\shExt{q \:}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y} = 0$ for $q < c$. Furthermore, any differential with $r \ge 2$ ending or begining at $(0, c)$ hits zero since $d^{0,c}_r : E^{0,c}_r \to E^{r, c - r + 1}_r$ but $c - r + 1 < c$ so $E^{r, c - r + 1} = 0$ also $\d^{-r,c+r-1}_r : E^{-r, c + r - 1} \to E^{0, c}_r$ has $E^{-r, c + r - 1} = 0$. Therefore, $E^{0, c}_\infty = E^{0, c}_2$. Furthermore, $E^{p,q}_\infty = 0$ if $p < c$ so the $p + q = c$ diagonal of $E^{p,q}_\infty$ is zero except $E^{0,c}_\infty$ and thus,
\[ \Ext{c}{\struct{Y}}{\iota_* \F}{\omega_Y} = E^{0, c}_\infty = E^{0,c}_2 = \Hom{\iota_* \struct{X}}{\iota_* \F}{\shExt{q\:}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y}} \]
proving the claim. This is just the spectral sequence proof of Prop. \ref{compute_first_nonzero_cohomology}. 
\end{rmk}

\begin{lemma} \label{ext_vanshing_regular}
Let $\iota : X \embed Y$ be a closed immersion of projective $k$-schemes. Suppose that $Y$ is regular, equidimensional and has a locally free dualizing sheaf $\omega_Y$. Then $\shExt{p}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y} = 0$ for $p \neq \dim{X} - \dim{Y}$.
\end{lemma}

\begin{proof}
(PROVE THIS!!)
\end{proof}

\begin{prop}
Let $\iota : X \embed Y$ be a closed immersion of projective $k$-schemes. Let $c = \dim{X} - \dim{Y}$ be the codimension. Suppose that $Y$ is regular, equidimensional and has a locally free dualizing module $\omega_Y$. Then $\omega_X = \iota^* \shExt{c}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y}$ is a dualizing sheaf for $X$. 
\end{prop}

\begin{proof}
This follows from the previous two propositions.
\end{proof}

\begin{prop}
Let $X \xrightarrow{\iota_1} Y \xrightarrow{\iota_2} P$ be closed immersion of projective $k$-schemes. Define,
\begin{align*}
\iota & = \iota_2 \circ \iota_1
\\
n  & = \dim{X}
\\
m & = \dim{Y}
\\
c_1 & = \dim{P} - \dim{X}
\\
c_2 & = \dim{P} - \dim{Y}
\end{align*} 
Suppose that $P$ is regular, equidimensional and has a locally free dualizing module $\omega_P$ then we have seen $\omega_X = \iota^* \shExt{c_1}{\struct{P}}{\iota_* \struct{X}}{\omega_P}$ and $\omega_Y = \iota_2^* \shExt{c_2}{\struct{P}}{\iota_{2*} \struct{Y}}{\omega_P}$ are dualizing modules for $X$ and $Y$. Then, if $Y$ is Cohen-Macaulay and equidimensional we have,
\[ \omega_X = \iota_2^* \shExt{n-m}{\struct{Y}}{\iota_{1*} \struct{X}}{\omega_Y} \]
\end{prop}

\begin{proof}
Consider the spectral sequence of sheaves on $P$,
\[ E^{p,q}_2 = \shExt{p}{\iota_{2*} \struct{Y}}{\iota_* \struct{X}}{\shExt{q}{\struct{P}}{\iota_{2*} \struct{Y}}{\omega_P}} \implies \shExt{p+q}{\struct{P}}{\iota_* \struct{X}}{\omega_P} \]
Futhermore, by Lemma \ref{ext_vanshing_regular}, $\shExt{q}{\struct{P}}{\iota_{2*} \struct{Y}}{\omega_P} = 0$ for $q \neq c_2$ so the spectral sequence degenerates on the second page. Therefore, 
\[ \shExt{p + c_2}{\struct{P}}{\iota_* \struct{X}}{\omega_P} = E^{p,c_2}_\infty = \shExt{p}{\iota_{2*} \struct{Y}}{\iota_* \struct{X}}{\iota_{2*} \omega_Y} \]
In particular, taking $p = c_1 - c_2 = n - m$ we find, 
\[ \iota_* \omega_X = \shExt{c_1}{\struct{P}}{\iota_* \struct{X}}{\omega_P} = \shExt{n -m}{\iota_{2*} \struct{Y}}{\iota_* \struct{X}}{\iota_{2*} \omega_Y} = \iota_{2*} \shExt{n-m}{\struct{Y}}{\iota_{1*} \struct{X}}{\omega_Y} \]
with the last equality using that $\iota_{2}$ is affine.
Therefore, using the equivalence of categories induced by $\iota_*$ we find,
\[ \omega_X = \iota_{1}^* \shExt{n-m}{\struct{Y}}{\iota_{1*} \struct{X}}{\omega_Y} \]
\end{proof}

\begin{cor}
Let $\iota : X \to Y$ be closed immersion of projective $k$-schemes. If $Y$ is Cohen-Macaullay and equidimensional then $X$ and $Y$ have dualizing modules $\omega_X$ and $\omega_Y$ satisfying,
\[ \omega_X = \iota^* \shExt{c}{\struct{Y}}{\iota_* \struct{X}}{\omega_Y} \] 
\end{cor}

\begin{proof}
Consider $X \embed Y \embed \P^n$ and apply the previous proposition. 
\end{proof}

\section{The Koszul Complex}

\begin{defn}
Let $E$ be an $R$-module and $s : E \to R$ an $R$-linear map. Then the \textit{Koszul Complex} $K_\bullet(E, s)$ is the chain complex,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \bigwedge^r E \arrow[r, "\d_r"] & \bigwedge^{r-1} E \arrow[r, "\d_{r-1}"] & \cdots \arrow[r] & \bigwedge^1 E \arrow[r, "s"] & R \arrow[r] & 0
\end{tikzcd}
\end{center}
with $K_\ell(s) = \bigwedge^\ell E$ and the differential,
\[ \d_\ell(e_1 \wedge \cdots \wedge e_\ell) = \sum_{i = 1}^\ell (-1)^{i+1} s(e_i) \: \: e_1 \wedge \cdots \wedge \hat{e}_i \wedge \cdots \wedge e_\ell \]
It is straightforward to check from the definition that $K_\bullet(s)$ is, in fact, a chain complex. Consider,
\begin{align*}
\d_{\ell-1}(\d_{\ell}(e_1 \wedge \cdots \wedge e_{\ell})) & = \d_{\ell-1} \left( \sum_{i = 1}^\ell (-1)^{i+1} s(e_i) \: \: e_1 \wedge \cdots \wedge \hat{e}_i \wedge \cdots \wedge e_\ell \right)
\\
& = \sum_{j < i}^{\ell} (-1)^{i + j} s(e_j) \: s(e_i) \: e_1 \wedge \cdots \wedge \hat{e}_j \wedge \cdots \wedge \hat{e}_i \wedge \cdots \wedge e_\ell 
\\
& + \sum_{j > i}^{\ell} (-1)^{i + j + 1} s(e_j) \: s(e_i) \: e_1 \wedge \cdots \wedge \hat{e}_i \wedge \cdots \wedge \hat{e}_j \wedge \cdots \wedge e_\ell  
\\
& = 0
\end{align*}
\end{defn}

\begin{example}
Let $E = R^{\oplus n}$ be a free module. Then the map $s : E \to R$ is given by a vector $(f_1, \dots, f_n) \in R^n$ under the dot product. Then the Koszul complex $K_\bullet(R, f_1, \dots, f_n) = K_\bullet(E, s)$ becomes,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & R^{{n \choose n}} \arrow[r] & R^{{n \choose n-1}} \arrow[r] & \cdots \arrow[r] & R^{{n \choose 2}} \arrow[r] & R^{{n \choose 1}} \arrow[r] & R \arrow[r] & 0
\end{tikzcd}
\end{center}
with $R^{{n \choose k}} = \bigwedge^k R^n$ given the basis $e_1 \wedge \cdots \wedge e_k$. 
\end{example}

\begin{defn}
Let $f_1, \dots, f_n \in R$ be a sequence of elements and $M$ an $R$-module. We say the sequence is,
\begin{center}
\begin{enumerate}
\item $M$-\textit{regular} if $f_i$ is a nonzero divisor in $M/(f_1, \dots, f_{i-1})M$ and $M/(f_1, \dots, f_n) M$ is nonzero
\item $M$-\textit{Koszul regular} if $H_i(K_\bullet(R, f_1, \dots, f_n) \otimes_R M) = 0$ for $i > 0$
\item $M$-$H_1$-\textit{regular} if $H_1(K_\bullet(R, f_1, \dots, f_n) \otimes_R M) = 0$
\item \textit{regular} if it is $R$-\textit{regular}
\item \textit{Koszul regular} if it is $R$-\textit{Koszul regular}
\item $H_1$-\textit{regular} if it is $R$-$H_1$-\textit{regular}.
\end{enumerate}
\end{center}
\end{defn}

\begin{lemma}
Given a sequence $f_1, \dots, f_n \in R$ then regular implies Koszul regular implies $H_1$-regular. Furthermore these implications are reversible if $R$ is a local Noetherian ring with $f_1, \dots, f_n \in \m$.
\end{lemma}

\begin{proof}
See Tag 062D.
\end{proof}

\begin{lemma}
Let 
\end{lemma}

\subsection{Complete Intersections}

\section{Degree Zoo}

\subsection{Degree of a Finite Map}

\begin{defn}
Let $f : X \to Y$ be a finite dominant map of integral schemes. Then if $\xi \in X$ and $\eta \in Y$ are the generic points, the map $\stalk{Y}{\eta} \to \stalk{X}{\xi}$ gives a finite extension of fields $K(X) / K(Y)$. We say the \textit{degree} of $f$ is the degree of this extension,
\[ \deg{f} = [K(X) : K(Y)] \]
\end{defn}

\begin{lemma}
Let $f : X \to Y$ 
\end{lemma}

\subsection{The Case for Complete Varieties}

\begin{lemma}
Let $f : X \to Y$ be a morphism of proper $k$-varieties and $\F$ a coherent $\struct{X}$-module. Then,
\[ \chi(X, \F) = \sum_{q = 0}^c (-1)^q \chi(Y, R^q f_* \F) \]
\end{lemma}

\begin{proof}
Since $X$ and $Y$ are proper $k$-varieties, we have finitness of cohomology and vanishing above $\dim{X}$ and $\dim{Y}$. The Leray spectral sequence,
\[ E^{p,q}_2 = H^p(Y, R^q f_* \F) \implies H^{p+q}(X, \F) \]
converges. Notice that the integers,
\[ \ell_r = \sum (-1)^{p + q} \dim_k E^{p,q}_r \]
are well-defined since each $E^{p,q}_r$ is a finite $k$-module and $E^{p,q}_r$ is bounded in $p$ and $q$. Furthermore, $\ell_r$ is independent of $r$ since,
\[ E^{p,q}_{r+1} = \ker{(\d_{r}^{p,q})} / \Im{\d_{r}^{p-r,q+r-1}} \]
Then,
\begin{align*}
\ell_{r+1} & = \sum (-1)^{p + q} \dim_k \ker{(\d_{r}^{p,q})} - \sum (-1)^{p + q} \dim_k \Im{\d_{r}^{p-r,q+r-1}} 
\\
& = \sum (-1)^{p + q} \dim_k \ker{(\d_{r}^{p,q})} - \sum (-1)^{p + r + q - r + 1} \dim_k \Im{\d_{r}^{p,q}}
\\ 
& = \sum (-1)^{p + q} \dim_k \ker{(\d_{r}^{p,q})} - \sum (-1)^{p + q + 1} \dim_k \Im{\d_{r}^{p,q}}
\\
& = \sum (-1)^{p + q} \left( \dim_k \ker{(\d_{r}^{p,q})} + \dim_k \Im{\d_{r}^{p,q}} \right) 
\\
& = \sum (-1)^{p + q} \dim_k E^{p,q}_r = \ell_r
\end{align*}
Furthermore,
\begin{align*}
\ell_2 & = \sum (-1)^{p+q} \dim_k E^{p,q}_2 = \sum (-1)^{p+q} \dim_k H^p(Y, R^q f_* \F)
\\
& = \sum (-1)^q \sum (-1)^p \dim_k H^p(Y, R^q f_* \F) = \sum (-1)^q \chi(Y, R^q f_* \F)
\end{align*}
Finally, since $E^{p,q}_\infty$ is a filtration of $H^{p+q}(X, \F)$ we see that,
\[ \dim_k H^{n}(X, \F) = \sum_{p + q = n} \dim_k E^{p,q}_\infty \]
and thus, 
\begin{align*}
\ell_{\infty} & = \sum (-1)^{p+q} \dim_k E^{p,q}_\infty = \sum_{n = 0}^c (-1)^n \dim_k H^{n}(X, \F) = \chi(X, \F)
\end{align*}
so we find that,
\[ \chi(X, \F) = \ell_\infty = \ell_2 = \sum_{q = 0}^c (-1)^q \chi(Y, R^q f_* \F) \]
\end{proof}

\begin{cor}
Let $f : X \to Y$ be an affine morphism of proper $k$-varieties and $\F$ a coherent $\struct{X}$-module. Then,
\[ \chi(Y, f_* \F) = \chi(X, \F) \]
\end{cor}

\begin{proof}
This follows from the former because $R^q f_* = 0$ for $q > 0$ when $f$ is affine. Alternatively, we may use the fact that $H^p(X, \F) = H^p(Y, f_* \F)$ since $f$ is affine.
\end{proof}

\begin{lemma}

\end{lemma}

\begin{lemma}
Let $f : X \to Y$ be a finite dominant \etale morphism of proper $k$-varieties and $\F$ a coherent $\struct{Y}$-modules. Then,
\[ \chi(X, f^* \F) = \deg{f} \cdot \chi(Y, \F) \]
\end{lemma}

\begin{proof}
(IS THIS TRUE!!!!!!)
\end{proof}

\subsection{Degree on Curves}

(DO I NEED SMOOTH FOR THIS!!)
\begin{prop}
Let $C$ be a proper curve over $k$. There exists a map $c : G(C) \to \Cl{C}$ on the Grothendieck group of $C$ which is the unique such map satisfying the following properties,
\begin{enumerate}
\item $c : \struct{C}(D) \mapsto D$
\item if $\F$ is torsion (i.e. $\F_\xi = 0$) then,
\[ c(\F) = \sum_{x \in C} \ell_{\stalk{X}{x}}(\F_x) \cdot [x] \]
\end{enumerate}
\end{prop}



\begin{lemma}

\end{lemma}

\begin{prop}
Let $f : X \to Y$ be a nonconstant map of normal proper curves and $\L$ a line bundle on $Y$. Then $\deg{f^* \L} = \deg{f} \cdot \deg{\L}$.
\end{prop}

\begin{proof}
Let $\eta$ be a meromorphic section of $\L$. Then $\deg{\L} = \deg{\div{(\eta)}}$ and $\deg{f^* \L} = \deg{\div{(f^* \eta)}}$.
Therefore, we write,
\[ \div{(\eta)} = \sum_{y \in Y} n_y [y] \]
then we get,
\[ \div{(f^* \eta)} = f^* \div{(\eta)} = \sum_{y \in Y} \sum_{x \in f^{-1}(y)} n_y \: e_x \, [x] \]
and thus,
\[ \deg{(f^* \L)} = \deg{\div{(f^* \eta)}} = \sum_{y \in Y} \left( \sum_{x \in f^{-1}(y)} e_x \right) n_y = (\deg{f}) \sum_{y \in Y} n_y = \deg{f} \cdot \deg{\L} \]
\end{proof}

\subsection{Scheme Theoretic Image}

\subsection{Projective Degree}

\begin{defn}
Let $\F$ be a coherent sheaf on $\P^n_k$. Then we define the Hilbert function,
\[ p_\F(d) = \chi(\P^n, \F(d)) \]
\end{defn}

\begin{prop}
For any coherent sheaf $\F$ on $\P^n_k$ the Hilbert function is a rational polynomial. Explicilty, there exists a rational polynomial $p_\F \in \Q[x]$ such that,
\[ p_\F(d) = \chi(\P^n, \F(d)) \]
for all $d \in \Z$.
\end{prop}

\begin{proof}
We proceed by induction on $n$. For $n = 0$ the function is constant. Now suppose the theorem holds for $n$. Consider a coherent sheaf $\F$ on $\P^{n+1}_k$. Now, we can choose a hyperplane $H$ such that there is an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \F(-1) \arrow[r] & \F \arrow[r] & \G \arrow[r] & 0
\end{tikzcd}
\end{center}
where the middle map is $\F \otimes_{\struct{X}} ( \struct{X}(-1) \to \struct{X} )$ determining the hyperplane $H$. To do this see Tag 08A0 (if $k$ is finite we need to pass to some extension but by flat base change this does not change the dimensions of the cohomology). Then $\J  = \Im{\struct{X}(-1) \to \struct{X}}$ annihilates $\G$ because $\J \cdot \F$ is the image of $\F(-1) \to \F$. Thus we can write $\G = \iota_* \tilde{\G}$ for the inclusion of the hyperplane $\iota : H \embed X$ and some sheaf of $\struct{H}$-modules $\G$. Then, twising we get,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \F(d - 1) \arrow[r] & \F(d) \arrow[r] & \iota_* \tilde{\G}(d) \arrow[r] & 0
\end{tikzcd}
\end{center}
and taking Euler characteristics gives,
\[ \chi(\P^n, \F(d)) - \chi(\P^n, \F(d-1)) = \chi(H, \tilde{\G}(d)) \]
but $H \cong \P^{n-1}_k$ and thus $\chi(H, \tilde{G}(d))$ is a polynomial in $d$ by induction. Thus we find that,
\[ P_\F(d) - P_\F(d-1) = \chi(\P^n, \F(d)) - \chi(\P^n, \F(d-1)) = \chi(H, \tilde{\G}(d))  \]
is a polynomial in $d$ for all $d \in \Z$ and thus $P_\F(d)$ is a polynomial in $d$. 
\end{proof}

\begin{defn}
Let $\F$ be a coherent sheaf on $\P^n_k$. Then we define the following quantities,
\begin{enumerate}
\item $\dim{\F} = \dim{\Supp{\struct{X}}{\F}}$
\item $\deg{\F} = \lim\limits_{d \to \infty} n! \cdot \frac{\chi(\P^n, \F(d))}{d^\ell}$ where $\ell = \dim{\F}$
\item $p_a(\F) = (-1)^\ell (\chi(\P^n, \F) - 1)$
\end{enumerate}
\end{defn}

\begin{lemma}
We can read of the above information from the Hilbert polynomials as follows,
\begin{enumerate}
\item $\dim{\F} = \deg{P_\F}$
\item $\deg{\F} = n! \cdot a_\ell$ where $P_\F(t) = a_\ell t^\ell + \cdots + a_0$
\item $p_a(\F) = (-1)^\ell (a_0 - 1)$
\end{enumerate}
\end{lemma}

\begin{proof}
The second two properties follow directly from the definition. It remains to show that $\deg{P_\F} = \dim{\Supp{\struct{X}}{\F}}$. 
\end{proof}

\begin{lemma}
Let $\iota : X \embed \P^n$ be an closed immersion. Let $\F = \iota_* \struct{X}$ and the associated Hilbert polynomial, $P_\iota(d) = \chi(\P^n, \iota_* \struct{X}(d))$\footnote{Note that $\chi(\P^n, \iota_* \struct{X}(d)) = \chi(X, \iota^* \struct{\P^n}(d))$ by the projection formula.} Then we interpret the above data as follows,
\begin{enumerate}
\item $\deg{\P_\iota} = \dim{\F} = \dim{X}$
\item for a generic $(n-\ell)$-dimensional plane $H \subset \P^n$ we have $\dim{X \cap H} = 0$ and $\dim_k H^0(X \cap H, \struct{X \cap H}) = \deg{X}$
\item $(-1)^\ell (a_0 - 1) = p_a(\F) = p_a(X)$.
\end{enumerate}
\end{lemma}

\begin{proof}
The second 
\end{proof}

\subsection{Relations Between Degrees}

\begin{prop}
Let $\iota : C \embed \P^n_k$ be an embedding of a curve. Then $d = \deg{\iota^* \struct{\P^n}(1)}$ is the degree of the embedding.
\end{prop}

\begin{proof}

\end{proof}

\begin{defn}
Let $f : X \to \P^n$ be a morphism which is finite onto its image. Factoring $X \xrightarrow{g} Z \embed \P^n$ by taking the scheme theoretic image we define $\deg{f} = \deg{g} \cdot \deg{(Z \embed \P^n)}$.
\end{defn}

\begin{prop}
Let $f : C \to \P^n_k$ be a nonconstant morphism from a curve $C$. Then $\deg{f} = \deg{f^* \struct{\P^n}(1)}$.
\end{prop}

\begin{proof}
Factoring $C \to \tilde{C} \embed \P^n_k$ we know that $\deg{f} = \deg{g} \cdot \deg{\iota}$ but $\deg{\iota} = \deg{\iota^* \struct{\P^n}(1)}$. Furthermore, $\L = f^* \struct{\P^n}(1) = g^* \iota^* \struct{\P^n}(1)$ and thus,
\[ \deg{\L} = \deg{g^* \iota^* \struct{\P^n}(1)} = \deg{g^*} \cdot \deg{\iota^* \struct{\P^n}(1)} = \deg{g^*} \cdot \deg{\iota^*} = \deg{f} \]
\end{proof}

\section{Some Counter Examples}

\begin{example}
If $\iota : Z \embed X$ is a closed immersion then $\iota_*$ is exact and $\iota^*$ is a left inverse. However, this does not mean that $\iota^*$ is exact. For example, we have the exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \I \arrow[r] & \struct{X} \arrow[r] & \iota_* \struct{Z} \arrow[r] & 0
\end{tikzcd}
\end{center}
Then pulling back we get the right-exact sequence,
\begin{center}
\begin{tikzcd}
\C_{Z/X} \arrow[r] & \struct{Z} \arrow[r, "\sim"] & \struct{Z} \arrow[r] & 0 
\end{tikzcd}
\end{center}
but the second map is an isomorphism so $\C_{Z/X} \to \struct{Z}$ must be zero (it is because the map $\I \to \struct{X}$ vanishes on the curve) but $\C_{Z/X}$ is not generally zero so $\iota^*$ cannot be left-exact.
\end{example}

\begin{example}
Consider the normalization map $\nu : \P^1 \to \Proj{k[X,Y,Z]/(Y^2 Z - (X+1)X^2)}$ of a nodal cubic. Locally, about the origin, this is the map,
\[ \Spec{k[t]} \to \Spec{k[x,y]/(y^2 - (x+1)x^2)} \]
given by $x \mapsto t^2-1$ and $y \mapsto t(t^2 - 1)$.
However, $\nu$ is birational because localizing at $x$ gives,
\[ k[x,y,x^{-1}]/(y^2 - (x+1)x^2) \to k[t, t^{-1}] \]
via $x \mapsto t^2-1$ and $y \mapsto t(t^2 - 1)$ and its inverse $t \mapsto y/x$ which are mutually inverse because $t \mapsto y/x \mapsto t(t^2-1)/(t^2-1) = t$ and $x \mapsto t^2-1 \mapsto y^2/x^2-1 = x$ and $y \mapsto t(t^2-1) \mapsto y/x \cdot (y^2/x^2-1) = y$. However, consider the fiber above the origin,
\[ \nu^* [0] = [-1] + [1] \]
which has degree $2$ contradicting the sum formula for fibers. This is because the nodal cubic is not normal. 
\end{example}

\begin{example}
when the map def by line bundle is not morphism (FORMULA!!)
\end{example}


\section{Stein Factorization}

\begin{rmk}
Let $S$ be affine. For any $\struct{S}(S)$-algebra $A$, we know that,
\[ \Hom{S}{X}{\Spec{A}} = \Hom{\struct{S}(S)}{A}{\Gamma(X, \struct{X})} \]
We want to generalize this to $\struct{S}$-algebras $\sA$ on any scheme $S$.
\end{rmk}

\begin{defn}
For a quasi-coherent sheaf of $\struct{S}$-algebras $\sA$, the scheme $\rSpec{S}{\sA} \to S$ represents the functor $(f : X \to S) \mapsto \Hom{\struct{S}}{\sA}{f_* \struct{X}}$ i.e.
\[ \Hom{S}{X}{\rSpec{S}{\sA}} = \Hom{\struct{S}}{\sA}{f_* \struct{X}} \]
\end{defn}

\begin{rmk}
In the affine case, $S = \Spec{R}$, we see that $\sA = \wt{A}$ for some $R$-module $A$ and then,
\[ \Hom{S}{X}{\Spec{A}} = \Hom{R}{A}{\Gamma(X, \struct{X})} = \Hom{\struct{S}}{\sA}{f_* \struct{X}} \]
and therefore, $\rSpec{S}{\sA} = \Spec{A}$.  
\end{rmk}

\begin{theorem}
For a quasi-coherent sheaf of $\struct{S}$-algebras $\sA$, the scheme $\rSpec{S}{\sA} \to S$ exists. 
\end{theorem}

\begin{proof}
For an open affine cover $U \subset X$ with $U = \Spec{R}$ we get $\sA|_U = \wt{A}$ for some $R$-module $A$. Then by the preivous remark $\pi^{-1}(U) = \Spec{A}$ represents the correct functor. These glue to form $\rSpec{S}{\sA}$, see Tag 01LL for details.
\end{proof}

\begin{rmk}
Since $\rSpec{S}{\sA}$ represents the functor $(f : X \to S) \mapsto \Hom{\struct{S}}{\sA}{f_* \struct{X}}$ we get a universal element for $\pi : \rSpec{S}{\sA} \to S$,
\[ \alpha : \sA \to \pi_* \struct{\rSpec{S}{\sA}} \]
\end{rmk}

\begin{prop}
The universal map $\alpha : \sA \to \pi_* \struct{\rSpec{S}{\sA}}$ is an isomorphism of $\struct{S}$-algebras.
\end{prop}

\begin{proof}
This is local on $S$ so choose an affine open cover $U \subset S$ with $U = \Spec{R}$ then we have $\sA|_U = \wt{A}$ for some $R$-module $A$. Then we get $\pi^{-1}(U) = \Spec{A}$ so $\pi_* \struct{\rSpec{S}{\sA}} |_U = \wt{A}$ because $\Gamma(\pi^{-1}(U), \struct{\rSpec{S}{\sA}}) = A$. Thus, locally the map $\sA \to \pi_* \struct{\rSpec{S}{\sA}}$ is an isomorphism.
\end{proof}

\begin{rmk}
We can explicitly describe the natrual transformation given a morphism $f : X \to \rSpec{S}{\sA}$,
\begin{center}
\begin{tikzcd} 
\Hom{S}{\rSpec{S}{\sA}}{\rSpec{S}{\sA}} \arrow[d, "f^*"] \arrow[r, equals] & \Hom{\struct{S}}{\sA}{\pi_* \struct{\rSpec{S}{\sA}}} \arrow[d, "f_*"]
\\
\Hom{S}{X}{\rSpec{S}{\sA}} \arrow[r, equals] & \Hom{\struct{S}}{\sA}{\pi_* f_* \struct{X}}
\end{tikzcd}
\end{center}
Then we send $f \mapsto (\sA \iso \pi_* (\struct{\rSpec{S}{\sA}} \to f_* \struct{X}))$. 
\end{rmk}

\begin{theorem}
Let $f : X \to S$ be proper. Then there exists a factorization,
\begin{center}
\begin{tikzcd}
X \arrow[rd, "f"'] \arrow[rr, "\tilde{f}"] & & T \arrow[dl, "g"]
\\
& S
\end{tikzcd}
\end{center}
where $g : T \to S$ is finite and $\tilde{f} : X \to T$ is proper with $\tilde{f}_* \struct{X} = \struct{T}$.
\end{theorem}

\begin{proof}
Let $T = \rSpec{S}{f_* \struct{X}}$ then $T \to S$ is finite since $f_* \struct{X}$ is coherent. The identity map $f_* \struct{X} \to f_* \struct{X}$ gives, by the universal property, an $S$-morphism $\tilde{f} : X \to \rSpec{S}{f_* \struct{X}}$ so we have a diagram, 
\begin{center}
\begin{tikzcd}
X \arrow[rd, "f"'] \arrow[rr, "\tilde{f}"] & & T \arrow[dl, "g"]
\\
& S
\end{tikzcd}
\end{center}
Since $g$ is finite it is separated and $f$ is proper so $\tilde{f}$ is proper. Furthermore, by construction, the map $\tilde{f} : X \to T$ corresponds to $f_* \struct{X} \iso g_* \struct{\rSpec{S}{f_* \struct{X}}} \to g_* \tilde{f}_* \struct{X}$ which is $\id : f_* \struct{X} \to f_* \struct{X}$ by construction. Thus $g_* ( \struct{\rSpec{S}{f_* \struct{X}}} \to \tilde{f}_* \struct{X})$ is an isomorphism but $g : \rSpec{S}{f_* \struct{X}} \to S$ is affine so it reflects isomorphism\footnote{Suppose that $f : X \to Y$ is affine and $f_* (\F \to \G)$ is an isomorphism then on any affine open $U \subset Y$, since $f$ is affine, $V = f^{-1}(U) = \Spec{S}$. Then $\F|_V = \wt{M}$ and $\G|_V = \wt{N}$ for $S$-modules, $M, N$ then $f_* \F_U = \wt{M_R}$ and $f_* \G |_U = \wt{N_R}$ and we have $M_R \iso N_R$ is an isomorphism of $R$-modules so $M \to N$ is an isomorphism of $S$-modules. Therefore, the map $\F \to \G$ is locally an isomorphism} and therefore, $\struct{T} \iso \tilde{f}_* \struct{X}$.
\end{proof}

\begin{theorem}[Zariski]
Let $f : X \to Y$ be a proper morphism of schemes with $f_* \struct{X} = \struct{Y}$. Then $f$ is surjective and has geometrically connected fibers. 
\end{theorem}

\begin{proof}
DO THIS!!
\end{proof}

\section{Zariski's Main Theorem}

\section{When is Pullback on Cohomology Injective}

\begin{lemma}
Let $f : X \to Y$ be a dominant quasi-compact morphism of schemes with $Y$ reduced. Then $f^{\#} : \struct{Y} \to f_* \struct{X}$ is injective.
\end{lemma}

\begin{proof}
DO THIS!!!!
\end{proof}

\begin{rmk}
When $X$ and $Y$ are integral, the map $f^{\#} : \struct{Y} \to f_* \struct{X}$ is automatically injective because we have a diagram,
\begin{center}
\begin{tikzcd}
\struct{Y}(V) \arrow[r] \arrow[d, hook] & \struct{X}(U) \arrow[d, hook]
\\
K(Y) \arrow[r] & K(X)
\end{tikzcd}
\end{center}
where the map $K(Y) \to K(X)$ is injective since it is a map of fields. Since $X$ and $Y$ are injective, the downward maps are injective so $\struct{Y}(V) \to \struct{X}(U)$ is injective as well.
\end{rmk}

\begin{prop}

\end{prop}

\section{Birational Invariance of Plurigenera}

\begin{prop}
DO!!
\end{prop}

\section{Automorphisms and Closed Subschemes}
DO!!!!
\subsection{Proof of Picard Scheme Action Relation}

DO!!!

\section{Some General Properties of Morphisms}

\subsection{Monomorphisms}

\begin{rmk}
Here we work in any category with fiber products.
\end{rmk}

\begin{defn}
A morphism $f : X \to Y$ is \textit{monic} if $f \circ g_1 = f \circ g_2 \implies g_1 = g_2$.
\end{defn}

\begin{prop}
A morphism $f : X \to Y$ is monic iff $\Delta_{X/Y} : X \to X \times_Y X$ is an isomorphism.
\end{prop}

\begin{proof}
Let $f : X \to Y$ be monic. We have a diagram,
\begin{center}
\begin{tikzcd}[row sep = large]
X \times_Y X \arrow[r, "\pi_2"] \arrow[d, "\pi_1"'] & X \arrow[d, "f"]
\\
X \arrow[r, "f"'] & Y
\end{tikzcd}
\end{center}
so $f \circ \pi_1 = f \circ \pi_2$ and thus $\pi_1 = \pi_2$ since $f$ is monic. Furthermore, we know $\pi_i \circ \Delta_{X/Y} = \id_X$ so consider $\Delta_{X/Y} \circ \pi_1 : X \times_Y X \to X \times_Y X$. Then $\pi_i \circ \Delta_{X/Y} \circ \pi_1 = \pi_1$ because $\pi_i \circ \Delta_{X/Y} = \id_X$ but $\pi_1 = \pi_i$ so we see, $\pi_i \circ (\Delta_{X/Y} \circ \pi_1) = \pi_i$ and thus by the universal property of the product, $\Delta_{X/Y} \circ \pi_1 = \id_{X \times_Y X}$ since they agree after projection. Thus $\Delta_{X/Y}$ is an isomorphism.
\bigskip\\
Now assume that $\Delta_{X/Y} : X \to X \times_Y X$ is an isomorphism. Let $g_1, g_2 : Z \to X$ be morphisms such that $f \circ g_1 = f \circ g_2$. Consider the diagram,
\begin{center}
\begin{tikzcd}[row sep = large]
Z \arrow[dr, dashed, "g"] \arrow[rrd, bend left, "g_1"] \arrow[ddr, bend right, "g_2"']
\\
& X \times_Y X \arrow[r, "\pi_2"] \arrow[d, "\pi_1"'] & X \arrow[d, "f"]
\\
& X \arrow[r, "f"'] & Y
\end{tikzcd}
\end{center}
so we get a unique map $g : Z \to X \times_Y X$. Consider $\Delta_{Y/S}^{-1} \circ g : Z \to X$. Since $\pi_i \circ \Delta_{Y/S} = \id_X$,
\[ \Delta_{Y/S}^{-1} \circ g = (\pi_i \circ \Delta_{Y/S}) \circ (\Delta_{Y/S}^{-1} \circ g) = \pi_i \circ g = g_i \]
and thus $g_1 = g_2 = g$ so $f$ is a mono.
\end{proof}

\begin{lemma}
Monomorphisms are preserved under composition and base change.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ and $g : Y \to Z$ be monomorphisms. Suppose that $h_1, h_2 : W \to X$ are any two morphisms such that $(g \circ f) \circ h_1 = (g \circ f) \circ h_2$. Then $g \circ (f \circ h_1) = g \circ (f \circ h_2)$ so $f \circ h_1 = f \circ h_2$ since $g$ is monic. Then $h_1 = h_2$ since $f$ is monic. Thus $g \circ f$ is monic.
\bigskip\\
Let $f : X \to S$ be monic and $s : S' \to S$ any morphism. Consider the base change,
\begin{center}
\begin{tikzcd}[row sep = large]
Z \arrow[dr, "g_i"] \arrow[rrd, bend left, "\pi_2 \circ g_i"] \arrow[ddr, bend right, "f' \circ g_i "']
\\
& S' \times_S X \arrow[r, "\pi_2"] \arrow[d, "f'"'] & X \arrow[d, "f"]
\\
& S' \arrow[r, "s"] & S
\end{tikzcd}
\end{center}
and two maps $g_1, g_2 : Z \to S' \times_S X$ such that $f' \circ g_1 = f' \circ g_2$. Then $f \circ \pi_2 \circ g_i = s \circ f' \circ g_i$ and we assume $f' \circ g_1 = f' \circ g_2$ so $f \circ \pi_2 \circ g_1 = f' \circ \pi_2 \circ g_2$. Since $f$ is monic we know $\pi_2 \circ g_1 = \pi_2 \circ g_2$. However, also $f' \circ g_1 = f' \circ g_2$ so $g_1 = g_2$ by uniqueness in the universal property so $f'$ is monic.
\end{proof}

\begin{rmk}
From now on we work in the category of schemes over $S$.
\end{rmk}

\begin{lemma}
A monomorphism is separated.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ be monic. Then $\Delta_{X/Y} : X \to X \times_Y X$ is an isomorphism and in particular a closed immersion.
\end{proof}

\begin{lemma}
Embeddings (immersions) are monomorphisms.
\end{lemma}

\begin{proof}
Both open and closed immersions satisfy the cancellation property (see Tag 01L7).
\end{proof}

\begin{prop}
Let $f : X \to S$ be separated. Then any immersed subscheme $Z \embed X$ (via a locally closed embedding) is separated over $S$.
\end{prop}

\begin{proof}
Immersions are monic and thus separated. Furthermore, composition of separated morphisms are separated. 
\end{proof}

\subsection{Implication of Properties}

\subsubsection{Categorical Pullback Properties}

\begin{rmk}
These lemmas are categorical results hold in any category with fiber products.
\end{rmk}

\begin{lemma}[Magic Square]
Let $X_1, X_2 \to Y$ and $Y \to Z$ be morphisms. The following diagram is a pullback,
\begin{center}
\begin{tikzcd}[row sep = huge]
X_1 \times_Y X_2 \arrow[d] \arrow[r] & X_1 \times_Z X_2 \arrow[d]
\\
Y \arrow[r, "\Delta_{Y/Z}"] & Y \times_Z Y
\end{tikzcd}
\end{center}
\end{lemma}

\begin{proof}
Consider a diagram,
\begin{center}
\begin{tikzcd}[row sep = huge]
T \arrow[rrd, bend left] \arrow[ddr, bend right] \arrow[dr, dashed]
\\
& X_1 \times_Y X_2 \arrow[d] \arrow[r] & X_1 \times_Z X_2 \arrow[d]
\\
& Y \arrow[r, "\Delta_{Y/Z}"] & Y \times_Z Y
\end{tikzcd}
\end{center}
A map $T \to X_1 \times_Z X_2$ is a pair of maps $T \to X_1$ and $T \to X_2$ agreeing on $Z$. However, composing with $X_1 \times_Z X_2 \to Y \times_Z Y$ must agree with $T \to Y \to Y \times_Z Y$ and thus the maps $T \to X_1$ and $T \to X_2$ must agree on $Y$ so this defines a map $Z \to X_1 \times_Y X_2$. 
\end{proof}

\begin{lemma}
Let $f,g : X \to Y$ be morphims over $S$. Then $Z \to X$ in the following pullback diagram,
\begin{center}
\begin{tikzcd}[row sep = huge, column sep = large]
Z \arrow[r] \arrow[d] \pullback & Y \arrow[d, "\Delta_{X/S}"]
\\
X \arrow[r, "\mathit{(f,g)}"] & Y \times_S Y
\end{tikzcd}
\end{center}
is the equalizer of $f, g : X \to Y$.
\end{lemma}

\begin{proof}
Consider a morphism $h : T \to X$ such that $f \circ h = g \circ h$. Then $(f \circ h, g \circ h) : T \to Y \times_S Y$ equals $(f \circ h, f \circ h) = \Delta_{X/S} \circ f \circ h$ giving a commutative diagram,
\begin{center}
\begin{tikzcd}[row sep = huge, column sep = large]
T \arrow[rrd, bend left] \arrow[ddr, bend right] \arrow[dr, dashed] 
\\
& Z \arrow[d] \arrow[r] \pullback & Y \arrow[d, "\Delta_{X/S}"]
\\
& X \arrow[r, "\mathit{(f,g)}"] & Y \times_S Y
\end{tikzcd}
\end{center}
There is thus a unique map $T \to Z$ such that $T \to Z \to X$ is $h$ proving that $Z$ is the equalizer.
\end{proof}

\begin{cor}
Given $S$-morphisms $f_1 : X_1 \to Y$ and $f_2 : X_2 \to Y$ the morphism $Z \to X_1 \times_S X_2$ in the pullback diagram,
\begin{center}
\begin{tikzcd}[row sep = large]
Z \pullback \arrow[d] \arrow[r] & X_1 \times_S X_2 \arrow[d]
\\
Y \arrow[r, "\Delta_{Y/Z}"] & Y \times_S Y
\end{tikzcd}
\end{center}
is the equalizer of $f_1 \circ \pi_1, f_2 \circ \pi_2 : X_1 \times_S X_2 \to Y$. Giving three descriptions of $Z \to X_1 \times_S X_2$,
\begin{enumerate}
\item the natural map $X_1 \times_Y X_2 \to X_1 \times_S X_2$
\item the base change / pullback of $\Delta_{Y/S}$ along $f_1 \times f_2$
\item the equalizer of $f \circ \pi_1, g \circ \pi_2 : X_1 \times_S X_2 \to Y$.
\end{enumerate}
\end{cor}

\begin{cor}
Let $f : X \to Y$ be a morphism over $S$. Then the graph $\Gamma_f : X \to X \times_S Y$ is the base change of the diagonal $\Delta_{Y/S} : Y \to Y \times_S Y$ by $f \times \id_Y$.
\end{cor}

\begin{proof}
The diagram,
\begin{center}
\begin{tikzcd}[row sep = huge, column sep = large]
X \arrow[r, "\Gamma_f"] \arrow[d, "f"] & X \times_S Y \arrow[d, "f \times \id_Y"]
\\
Y \arrow[r, "\Delta_{Y/S}"] & Y \times_S Y
\end{tikzcd}
\end{center}
is cartesian (a pullback) by the magic diagram applied to $f : X \to Y$ and $\id_Y : Y \to Y$ over $S$.
\end{proof}

\begin{rmk}
Furthermore, the graph $\Gamma_f : X \to X \times_S Y$ is the equalizer of $f \circ \pi_1, \pi_2 : X \times_S Y \to Y$.
\end{rmk}

\subsubsection{Properties of The Graph Morphism of Schemes}

\begin{lemma}
Let $f : X \to Y$ be unramified over $S$. Then $\Delta_{X/Y} : X \to X \times_Y X$ is an open immersion.
\end{lemma}

\begin{proof}
Tag 02GE.
\end{proof}

\begin{cor}
Let $f : X \to Y$ be a morphism over $S$. In general, $\Gamma_f : X \to X \times_S Y$ is a locally closed immersion. Furthermore,
\begin{enumerate}
\item if $Y \to S$ is quasi-separated then $\Gamma_f : X \to X \times_S Y$ is quasi-compact
\item if $Y \to S$ is affine-separated then $\Gamma_f : X \to X \times_S Y$ is affine
\item if $Y \to S$ is separated then $\Gamma_f : X \to X \times_S Y$ is a closed immersion
\item if $Y \to S$ is unramified then $\Gamma_f : X \to X \times_S Y$ is an open immersion.
\end{enumerate}
\end{cor}

\begin{proof}
These properties are preserved under base change and the diagonal $\Delta_{Y/S} : Y \to Y \times_S Y$ has the corresponding property for each case and is, in general, a locally closed immersion.
\end{proof}

\subsubsection{Implication of Properties}

\begin{rmk}
The following hold in any category with fiber products.
\end{rmk}

\begin{prop}
Let $\cP$ be a property of morphisms which is preserved under composition and base change. Then the product of two morphisms with property $\cP$ has property $\cP$.
\end{prop}

\begin{proof}
Let $f : X_1 \to Y_1$ and $g : X_2 \to Y_2$ be morphisms over $S$ with $\cP$. We factor the product, 
$f \times g : X_1 \times_S X_2 \to Y_1 \times_S Y_2$ as,
\begin{center}
\begin{tikzcd}
X_1 \times_S Y_1 \arrow[r, "f \times \id_{Y_1}"] & X_2 \times_S Y_1 \arrow[r, "\id_{X_2} \times g"] & X_2 \times_S Y_2
\end{tikzcd}
\end{center}
Both morphisms have $\cP$ by base change so $f \times g$ does as well by composition. 
\end{proof}

\begin{prop}
Let $\cP$ be a property of morphisms which is perserved under composition and base change. Consider a morphism $f : X \to Y$ of $S$-objects giving a diagram,
\begin{center}
\begin{tikzcd}[row sep = large]
X \arrow[rr, "f"] \arrow[rd, "p"'] & & Y \arrow[ld, "q"]
\\
& S
\end{tikzcd}
\end{center}
If $p$ has property $\cP$ and the diagonal $\Delta_{Y/S}$ of $q$ has property $\cP$ then $f$ has property $\cP$.
\end{prop}

\begin{proof}
The morphism $f : X \to Y$ factors through the graph $\Gamma_f : X \to X \times_S Y$ giving the following diagram,
\begin{center}
\begin{tikzcd}[row sep = large]
& X \times_S Y \arrow[rd, "\pi_2"]
\\
X \arrow[rr, "f"] \arrow[ru, "\Gamma_f"] \arrow[rd, "p"'] & & Y \arrow[ld, "q"]
\\
& S
\end{tikzcd}
\end{center}
Since $\Gamma_f$ is a base change of $\Delta_{Y/S} : Y \to Y \times_S Y$, it has property $\cP$. Since $\pi_2 : X \times_S Y \to Y$ is the base change of $p : X \to S$ by $q : Y \to S$ so it has property $\cP$. Composing, $f$ has property $\cP$.
\end{proof}

\subsubsection{Application to the Category of Schemes}

\begin{rmk}
From now on we work in the category of schemes over $S$.
\end{rmk}

\begin{prop}
Let $\cP$ be a property of morphisms such that,
\begin{enumerate}
\item $\cP$ is preserved under composition
\item $\cP$ is preserved under base change
\item any closed immersion has $\cP$
\end{enumerate} 
then if $f : X \to Y$ has $\cP$ its reduction $f_{\red} : X_{\red} \to Y_{\red}$ also has $\cP$.
\end{prop}

\begin{proof}
Consider the diagram,
\begin{center}
\begin{tikzcd}
X_{\red} \arrow[d, "\pi_X"'] \arrow[r, "f_{\red}"] & Y_{\red} \arrow[d, "\pi_Y"]
\\
X \arrow[r, "f"'] & Y
\end{tikzcd}
\end{center}
where the downward maps are closed immersions which exists because $X_{\red} \to X \to Y$ is a map from a reduced scheme to $Y$ and thus factors through $Y_{\red} \to Y$. Then consider,
\begin{center}
\begin{tikzcd}
X_{\red} \arrow[rd, "f \circ \pi_X"'] \arrow[rr, "f_{\red}"] & & Y_{\red} \arrow[ld, "\pi_Y"]
\\
& Y
\end{tikzcd}
\end{center} 
Since $\pi_Y$ is a closed immersion and thus separated so $\Delta_{Y_\red / Y}$ is a closed immersion so it has $\cP$. Furthermore, $f \circ \pi_X$ has $\cP$ because $f$ does by hypothesis and $\pi_X$ does because it is a closed immersion and $\cP$ is closed under composition. Therefore, by the main lemma, $f_{\red}$ has $\cP$.
\end{proof}

\begin{cor}
Let $Y$ be an $S$-scheme and $X$ a $Y$-scheme.
\begin{enumerate}
\item if $X \to S$ is separated then $X \to Y$ is separated.
\item if $Y \to S$ is separated then $X \to Y$ is separated $\iff$ $X \to S$ is separated.
\end{enumerate}
\end{cor}

\begin{proof}
We have,
\begin{center}
\begin{tikzcd}
X \arrow[rr] \arrow[rd] & & Y \arrow[dl]
\\
& S
\end{tikzcd}
\end{center}
The diagonal $\Delta_{Y/S} : Y \to Y \times_S Y$ is, in general, an immersion and thus monic and thus separated. Furthermore, $X \to S$ is separated so by the main lemma $X \to Y$ is separated. 
\bigskip\\
Conversely, if $Y \to S$ is separated and $X \to Y$ is separated then $X \to S$ is separated by composition.
\end{proof}

\begin{cor}
Let $f : X \to Y$ be a morphism of $S$-schemes. Then, if the structue morphsim $X \to S$ is any of the following,
\begin{enumerate}
\item an immersion
\item locally of finite type
\item quasi-separated
\end{enumerate}
then $f : X \to Y$ satisfies those same properties.
\end{cor}

\begin{proof}
All properties here are preserved under composition and base change. Furthermore, the diagonal is an immersion (in particular locally of finite type and quasi-separated) giving the first two. 
The diagonal is an immersion and thus monic and thus separated. In particular the diagonal is generally quasi-separated so quasi-separated maps satisfy the cancellation property.
\end{proof}


\begin{cor}
Let $f : X \to Y$ be a morphism of $S$-schemes with $Y \to S$ quasi-separated. Then, if the structue morphsim $X \to S$ is any of the following,
\begin{enumerate}
\item quasi-compact
\item finite type
\item quasi-projective
\end{enumerate}
then $f : X \to Y$ satisfies those same properties.
\end{cor}

\begin{proof}
If $Y \to S$ is quasi-separated then (by definition) the diagonal is a quasi-compact immersion and thus finite type and quasi-projective so the cancellation property holds for quasi-compact, finite type, and quasi-projective morphisms.
\end{proof}

\begin{cor}
Morphism of varieties over $k$ are finite type and separated. 
\end{cor}

\begin{proof}
A morphism $f : X \to Y$ of varieties over $\Spec{k}$ is finite type since $X$ is finite type and separated since $X$ is separated.
\end{proof}

\begin{cor}
Let $f : X \to Y$ be a morphism of $S$-schemes with $Y \to S$ separated. Then, if the structue morphsim $X \to S$ is any of the following,
\begin{enumerate}
\item a closed immersion
\item proper
\item projective
\item finite
\item universally closed 
\end{enumerate}
then $f : X \to Y$ satisfies those same properties.
\end{cor}

\begin{proof}
Since $Y \to S$ is separated, the diagonal $\Delta : Y \to Y \times_S Y$ is a closed immersion. Furthermore, closed immersions satisfy all the properties listed above and thus give the cancellation property for such morphisms $X \to S$.
\end{proof}

\begin{cor}
Let $f : X \to S$ be a morphism and $\sigma : S \to X$ a section ($f \circ \sigma = \id_S$). Then the section $\sigma : S \to X$ is an immersion. Furthermore,
\begin{enumerate}
\item if $f : X \to S$ is quasi-separated then $\sigma : S \to X$ is a quasi-compact immersion
\item if $f : X \to S$ is separated then $\sigma : S \to X$ is a closed immersion
\item if $f : X \to S$ is unramified then $\sigma : S \to X$ is an open immersion 
\end{enumerate}
\end{cor}

\begin{proof}
Consider the diagram,
\begin{center}
\begin{tikzcd}
S \arrow[rr, "\sigma"] \arrow[rd, "\id"'] & & X \arrow[ld, "f"]
\\
& S
\end{tikzcd}
\end{center}
Then the result follows from above.
\end{proof}

\begin{cor}
Let $f : X \to S$ be separated and unramified with $S$ connected. Let $\sigma : S \to X$ be a section, $f \circ s = \id_S$, then $\sigma : S \to X$ is an isomorphism onto a connected component of $X$.
\end{cor}

\begin{proof}
By above, $\sigma : S \to X$ is an open and closed embedding so $\sigma$ is an isomorphism onto a clopen connected (since $S$ is connected) subscheme which must be a connected component.
\end{proof}

\begin{prop}
Let $q : Y \to S$ be unramified and separated. Given two $S$-morphisms $f, g : X \to Y$ from a connected scheme $X$ and some point $x \in X$ such that,
\begin{enumerate}
\item $f(x) = g(x) = y$
\item $f^\#, g^\# : \kappa(y) \to \kappa(x)$ agree
\end{enumerate}
then $f = g$.
\end{prop}

\begin{proof}
Consider the locus $Z$ on which $f, g : X \to Y$ agree i.e. the equalizer of $f, g : X \to Y$,
\begin{center}
\begin{tikzcd}[row sep = large]
Z \arrow[d, "\iota"] \arrow[r] & Y \arrow[d, "\Delta_{Y/S}"]
\\
X \arrow[r, "\mathit{(f,g)}"] & Y \times_S Y
\end{tikzcd}
\end{center}
Since $q : Y \to S$ is unramified and separated the diagonal $\Delta_{Y/S} : Y \to Y \times_S Y$ is an open and closed immersion. Thus, by base change $\iota : Z \embed X$ is an open and closed immersion. Since $X$ is connected, if $Z$ is nonempty then $\iota : Z \to X$ is an isomorphism which shows that $f = g$. Consider the point $\Spec{\kappa(x)} \to X$. But $Z$ is the equalizer of $f, g : X \to Y$ so $\Spec{\kappa(x)} \to X$ factors through $Z \to X$ iff $f,g : \Spec{\kappa(x)} \to Y$ are equal which is ensured by the hypotheses so $Z$ has a point and thus $\iota : Z \iso X$ is an isomorphism showing that $f = g$.
\end{proof}

\section{Quasi-Projective Morphisms}

\begin{defn}
A morphism $f : X \to S$ is \textit{quasi-projective / projective} if there exists an quasi-compact immersion / closed immersion $X \embed \P^n_S$ over $S$.
\end{defn}

\begin{lemma}
Projective and quasi-projective morphisms are preserved under composition and base change.
\end{lemma}

\begin{proof}

\end{proof}

\begin{defn}
We say a $k$-variety is \textit{quasi-projective / projective} if $X \to \Spec{k}$ is.
\end{defn}

\begin{prop}
Let $X \to S$ be quasi-projective. Then $X \to S$ is separated and quasi-compact.
\end{prop}

\begin{proof}
Follows from the fact that $\P^n_S \to S$ is separated and quasi-compact and that quasi-compact immersions are as well.
\end{proof}

\begin{prop}
Let $X \to S$ be projective. Then $X \to S$ is proper.
\end{prop}

\begin{proof}
Follows from the fact that $\P^n_S \to S$ is proper and that closed immersions are proper as well.
\end{proof}

\subsection{Proper and Universally Closed Morphisms}

\begin{defn}
A morphism $f : X \to S$ is \textit{universally} closed if for any $T \to S$ the base change $f_T : X \times_S T \to T$ is closed. 
\end{defn}

\begin{defn}
A morphism $f : X \to Y$ is \textit{proper} if it is finite type, separated, and universally closed. 
\end{defn}

\begin{lemma}
Universally closed morphisms are preserved under composition and under arbitrary base change.
\end{lemma}

\begin{proof}
The composition of closed morphisms is closed and composition is preserved under base change. Furthermore, universally closed morphisms are obviously preserved under base change.
\end{proof}

\begin{prop}
Consider a morphism $f : X \to Y$ of $S$-schemes giving a diagram,
\begin{center}
\begin{tikzcd}[row sep = large]
X \arrow[rr, "f"] \arrow[rd, "p"'] & & Y \arrow[ld, "q"]
\\
& S
\end{tikzcd}
\end{center}
If $p : X \to S$ is universally closed and $f : X \to Y$ is surjective then $q : Y \to S$ is universally closed. 
\end{prop}

\begin{proof}
The base change of a surjective morphism is surjective (Tag 01S1). Then under any base change $T \to S$ we get the diagram,
\begin{center}
\begin{tikzcd}[row sep = large]
X_T \arrow[rr, "f_T"] \arrow[rd, "p_T"'] & & Y_T \arrow[ld, "q_T"]
\\
& T
\end{tikzcd}
\end{center}
satisfying the hypotheses. Therefore, it suffices to show that $q : Y \to S$ is closed. Take a closed $C \subset Y$ then, because $f$ is surjective, $q(C) = p(f^{-1}(C))$ is closed.
\end{proof}

\begin{cor}
Consider a morphism $f : X \to Y$ of $S$-schemes giving a diagram,
\begin{center}
\begin{tikzcd}[row sep = large]
X \arrow[rr, "f"] \arrow[rd, "p"'] & & Y \arrow[ld, "q"]
\\
& S
\end{tikzcd}
\end{center}
If we have,
\begin{enumerate}
\item $p : X \to S$ is proper
\item $f : X \to Y$ is surjective 
\item $q : Y \to S$ is finite type and separated
\end{enumerate}
then both $f : X \to Y$ and $q : Y \to S$ are proper.
\end{cor}

\begin{proof}
By above, $q : Y \to S$ is universally closed and, by assumption, finite type and separated and thus proper. Furthermore, since $q : Y \to S$ is separated, by the previous discussion $f : X \to Y$ is proper.
\end{proof}

\begin{rmk}
This gives a proof of Hartshorne II.4.4.
\end{rmk}


\section{Submodules of Locally Free Modules}

\begin{lemma}
Let $M$ be a finitely presented $R$-module such that $M_\p$ is a free $R_\p$-module for each prime $\p \in \Spec{R}$. Then $M$ is a finite locally free $R$-module.
\end{lemma}

\begin{proof}
Lifting a basis of $M_\p$ gives an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & K \arrow[r] & R^n \arrow[r] & M \arrow[r] & C \arrow[r] & 0
\end{tikzcd}
\end{center}
Since $M$ is finitely presented, both $K$ and $C$ are finite $R$-modules. Furthermore, localizing the sequence at $\p$ gives,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & K_\p \arrow[r] & R_\p^n \arrow[r, "\sim"] & M_\p \arrow[r] & C_\p \arrow[r] & 0
\end{tikzcd}
\end{center}
so $K_\p = 0$ and $C_\p = 0$ by exactness. However, since both are finite $R$-modules there exists some $f \notin \p$ such that $K_f = 0$ and $C_f = 0$ and thus by the exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & K_f \arrow[r] & R_f^n \arrow[r] & M_f \arrow[r] & C_f \arrow[r] & 0
\end{tikzcd}
\end{center}
we get $R^n_f \iso M_f$ showing that $M$ is locally free.
\end{proof}

\begin{lemma}
Let $X$ be a scheme and $\F$ be a coherent $\struct{X}$-module such that $\F_x$ is a free $\stalk{X}{x}$-module for each $x \in X$. Then $\F$ is finite locally free.
\end{lemma}

\begin{proof}
On an affine open cover $U = \Spec{A}$ we know $\F|_U = \wt{M}$ for some finitely presented $A$-module $M$. Then for $x = \p \in \Spec{A}$, we have $\F_x = M_\p$ is a free (and finite since $M$ is finite) $\stalk{X}{x} = A_\p$-module. Thus by the previous lemma, $M$ is a locally free module and thus $\F|_U$ is finite locally free showing that $\F$ is finite locally free.
\end{proof}

\begin{example}
Let $\varphi : \F \to \G$ be a morphism of sheaves with $\F$ finite locally free. Then $\K = \ker{\varphi}$ need not be finite locally free. This is because stalkwise $\K_x \subset \F_x$ and $\F_x$ is finite free but if the local ring $\stalk{X}{x}$ is not a PID in general $\K_x$ need not be a free module. However, if $X$ is a regular curve then each $\stalk{X}{x}$ is a DVR and thus a PID so indeed submodules of finite free modules are finite free. Furthermore, since $X$ is noetherian $\K$ is coherent and thus finite locally free since $\K_x$ is a finite free $\struct{X}{x}$-module.
\end{example}

\begin{rmk}
From now on let $(X, \struct{X})$ be a locally rined space such that $\struct{X}$ is coherent. On such a space, $\F$ is coherent iff it is locally of finite presentation as an $\struct{X}$-module (see Tag 01BZ).
\end{rmk}

\begin{prop}
Let $\varphi : \F \onto \G$ an epimorphism of finite locally free $\struct{X}$-modules. Then the kernel $\K = \ker{\varphi}$ is finite locally free.
\end{prop}

\begin{proof}
Since $\K$ is a kernel of coherent sheaves, $\K$ is coherent.
The exact sequence of sheaves,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \K \arrow[r] & \F \arrow[r] & \G \arrow[r] & 0
\end{tikzcd}
\end{center}
gives an exact sequence on stalks,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \K_x \arrow[r] & \F_x \arrow[r] & \G_x \arrow[r] & 0
\end{tikzcd}
\end{center}
Since $\F_x$ and $\G_x$ are finite free $\stalk{X}{x}$-module they are projective and thus $\K_x$ is also finite projective (see next lemma). Since $\stalk{X}{x}$ is local, finite projective $\stalk{X}{x}$-modules are finte free. Thus $\F$ is a coherent $\struct{X}$-module with $\F_x$ a free $\stalk{X}{x}$-module so $\F$ is finite locally free by the prevous lemma.
\end{proof}

\begin{lemma}
Every summand of a projective object is projective. 
\end{lemma}

\begin{proof}
Suppose that $P = K \oplus L$ is projective. Given a surjection $A \onto B$ and a map $K \to B$ we get a diagram,
\begin{center}
\begin{tikzcd}
P \arrow[dd, "\pi"] \arrow[rr, dashed] & & A \arrow[dd, two heads]
\\
& K \arrow[lu, "\iota"'] \arrow[ru, dashed] \arrow[ld, "\id"'] \arrow[rd]
\\
K \arrow[rr] & & B
\end{tikzcd}
\end{center}
so $K \to B$ lifts to $K \to A$ showing that $K$ is projective.
\end{proof}

\begin{cor}
Suppose that $P \onto Q$ is a epimorphism of projective modules then the kernel $K = \ker{(P \to Q)}$ is projective.
\end{cor}

\begin{proof}
There is an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & K \arrow[r] & P \arrow[r] & Q \arrow[r] & 0
\end{tikzcd}
\end{center}
But $Q$ is projective so this sequence splits giving $P = K \oplus Q$. But $P$ is projective and thus $K$ is projective.
\end{proof}

\begin{prop}
Let $\iota : X \embed Y$ be a closed immersion of schemes smooth over locally noetherian $S$. Then $\C_{X/Y}$ is finite locally free (i.e. a vector bundle).
\end{prop}

\begin{proof}
There is an exact sequence of sheaves,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \C_{X/Y} \arrow[r] & \iota^* \Omega_{Y/S} \arrow[r] & \Omega_{X/S} \arrow[r] & 0
\end{tikzcd}
\end{center}
which is exact on the left because $X \to S$ is smooth. Furthermore, since $X$ and $Y$ are smooth over $S$ we know $\Omega_{Y/S}$ and $\Omega_{X/S}$ are finite locally free. Furthermore, $X$ and $Y$ are finitely presented over $S$ which is locally noetherian so $X$ and $Y$ are locally noetherian and thus $\struct{X}$ and $\struct{Y}$ are coherent. Thus applying the previous results, $\C_{X/Y}$ is finite locally free.
\end{proof}

\subsection{Computing (Co)Normal Bundles}

\renewcommand{\R}{\mathbb{R}}

\section{Canonical Forms}

\begin{defn}
Let $M$ be a smooth manifold and let $P = TM$ and $Q = T^* M$ denote its tangent bundle and cotangent bundle. Then there are canonical objects:
\begin{enumerate}
\item a vector field $V \in \Gamma(P, TP)$
\item a 1-form $\theta \in \Gamma(Q, T^*Q)$
\end{enumerate}
defined as follows. Choose $(x, v) \in P$ where $x \in M$ and $v \in T_x M$ then the projection $\pi : T^*P \to P$ induces $\d{\pi}  : TP \to TM$ so 

$v \in TP$ 

For the canonical 1-form, consider a point $(x, \varphi) \in Q$ where $x \in M$ and $\varphi : T_x M \to \mathbb{R}$. Using the projection $\pi : Q \to M$ we define $\theta_{(x, \varphi)} = \varphi \circ \d{\pi_{(x, \varphi)}} : T_m Q \to \mathbb{R}$ giving a smooth section $\theta : Q \to T^* Q$. We describe this as the 1-form given at $(x, \varphi)$ by pulling back $\varphi$ along $\pi$.

\end{defn}

\begin{rmk}
For a chart $\varphi : U \to M$ we get coordinate functions $x_i = \varphi^{-1} \circ \pi_i : M \to \mathbb{R}$ and a basis of vector fields $\pderiv{}{x^i} = \d{\varphi} \left( \pderiv{}{x^i} \right)$ and a basis of 1-forms $\d{x^i} = \varphi^* \d{x^i}$. 
\end{rmk}

\begin{rmk}
Therefore, we get a chart for $P$,
\[ \varphi : U \times \R^n \to  P \quad \text{via} \quad ( \{ x_i \}, \{ v^i \} ) \mapsto \left( \varphi(\{ x_i \}), v^i \pderiv{}{x^i} \right) \] 
and a chart for $Q$,
\[ \varphi : U \times \R^n \to Q \quad \text{via} \quad ( \{ x_i \}, \{ p_i \} ) \mapsto \left( \varphi(\{ x_i \}), p_i \: \d{x^i} \right) \] 
Consider two charts $\varphi : U \to M$ and 
\end{rmk}

\section{There is only one conic in $\P^2$}

\begin{theorem}
All irreducible conics in $\P^2$ are related by an automorphism of $\P^2$.
\end{theorem}

\begin{proof}
By definition, a conic is a degree $2$ subscheme $C \embed \P^2$ thus defined by a section of $\struct{\P^2}(2)$. Thus, if irreducible it is a curve of arithmetic genus $0$. Normalizing gives a degree two map $f : \P^1 \to \P^2$ with $f^* \struct{\P^2}(1) = \struct{\P^1}(2)$ (since $\struct{\P^1}(2)$ is the unique degree $2$ line bundle). Now I claim the pullback map $H^0(\P^2, \struct{\P^2}(1)) \to H^0(\P^1, \struct{\P^1}(2))$ is an isomorphism. Indeed, pushing forward we get a map $\struct{\P^2}(1) \to f_* f^* \struct{\P^2}(1)$ and by the projection formula $f_* f^* \struct{\P^2}(1) = f_* \struct{\P^1} \otimes_{\struct{\P^2}} \struct{\P^2}(1)$ which fits into the exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \struct{\P^2}(1-d) \arrow[r] & \struct{\P^2}(1) \arrow[r] & \struct{C}(1) \arrow[r] & 0
\end{tikzcd}
\end{center}
giving a long exact sequence containing,
\begin{center}
\begin{tikzcd}
H^0(\P^2, \struct{\P^2}(1-d)) \arrow[r] & H^0(\P^2, \struct{\P^2}(1)) \arrow[r] & H^0(C, \struct{C}(1)) \arrow[r] & H^1(\P^2, \struct{\P^2}(1-d)) 
\end{tikzcd}
\end{center}
for $d > 1$ we get $H^i(\P^2, \struct{\P^2}(1-d)) = 0$ for $i \le 1$ and thus an isomorphism,
\[ H^0(\P^2, \struct{\P^2}(1)) \iso H^0(C, \struct{C}(1)) \]
given by pulling back. Any map $\P^1 \to \P^2$ of degree two is defined by a basis of sections of $H^0(\P^1, \struct{\P^1}(2))$ (since we showed the above map is surjective and has the correct dimension $3$) and any two bases are related by $\mathrm{PGL}_3$ giving an automorphism of $\P^2$.
\end{proof}

\section{Connected Etale Covers}

\begin{rmk}
Integrality is not purely local in the sense that $\stalk{X}{x}$ being a domain does not imply that $X$ is integral nor does having an affine open cover by domains. For example, take $\A^1 \coprod \A^1$.
\end{rmk}

\begin{lemma}
Let $X$ be a connected scheme with finitely many irreducible components such that $\stalk{X}{x}$ is a domain at each $x \in X$. Then $X$ is integral.
\end{lemma}

\begin{proof}
Since $X$ is automatically reduced we must show $X$ is irreducible. Let $Z_1, \dots, Z_n \subset X$ be the irreducible components. It suffcies to show that $Z_i \cap Z_j = \empty$ for $i \neq j$ since in that case,
\[ Z_1 \cap \left( \bigcup_{j = 2}^n Z_j \right) = \empty \]
and because there are finitely many,
\[ Y = \bigcup_{j = 2}^n Z_j \]
is closed and $Z_1 \cup Y = X$. Thus either $Z_1 = X$ or $Y = X$ by connectedness. Proceeding we see that $Z_i = X$ for some $Z_i$ so $X$ has a single irreducible component i.e. $X$ is irreducible. 
\bigskip\\
Suppose otherwise that $p \in Z_i \cap Z_j$. Then $Z_i$ and $Z_j$ correspond to distinct minimal primes in $\stalk{X}{p}$ contradicting the fact that $\stalk{X}{p}$ is a domain and thus has a unique minimal prime. 
\end{proof}

\begin{lemma}
Let $f : X \to Y$ be an \etale morphism of locally Noetherian schemes and $f(x) = y$. Then $\stalk{X}{x}$ is a normal domain iff $\stalk{Y}{y}$ is a normal domain.
\end{lemma}

\begin{proof}
See Tag 025P and note that $f : X \to Y$ is \etale at $x$ iff $\stalk{Y}{y} \to \stalk{X}{x}$ is an \etale homomorphism of local rings.
\end{proof}

\begin{prop}
Let $Y$ be a normal Noetherian integral scheme and $f : X \to Y$ a quasi-compact \etale cover with $X$ connected. Then $X$ is a normal Noetherian integral scheme.
\end{prop}

\begin{proof}
Since $X \to Y$ is finite presentation and $Y$ is Noetherian then $X$ is Noetherian. Furthermore, by the previous result we have $\stalk{X}{x}$ is a normal domain for each $x \in X$, in particular a domain. Therefore, since $X$ is connected and Noetherian we find that $X$ is integral by previous results and normal by definition. 
\end{proof}

\begin{cor}
Let $X$ be a normal Noetherian integral scheme. Then quasi-compact \etale covers by normal Noetherian integral schemes are cofinal in $X_{\et}$.
\end{cor}

\begin{proof}
For any quasi-compact \etale cover $f : \tilde{X} \to X$ since $X$ is Noetherian and $f$ is finitely presented $\tilde{X}$ is Noetherian and thus has finitely many connected components $U_i$ which are thus clopen. Then $U_i \embed \tilde{X}$ are open immersions and thus \etale. Furthermore, $\tilde{X}$ is Noetherian so $U_i \embed \tilde{X}$ is quasi-compact. Thus, composing gives a quasi-compact \etale cover  $U_i \to X$ with $U_i$ connected so, by the previous proposition, the $U_i$ are normal Noetherian integral schemes.
\end{proof}

\begin{example}
The normality assumption is necessary. Indeed let,
\[ X = \Spec{k[x,y]/(y^2 - x^2 (x + 1)} \]
be an affine nodal cubic which is a curve (in particular Noetherian and integral). Then consider the cover $\tilde{X} = \A^1 \coprod_{\{ \pm 1 \}} \A^1$ (glued at $1$ and $-1$) where $\A^1 \to X$ is the normalization map. We need to show that this map is etale. Notice that $\A^1 \to X$ is not flat at $1 \mapsto (0,0)$ and $-1 \mapsto (0,0)$. However, $\stalk{X}{(0,0)} \to \stalk{\tilde{X}}{1}$ and $\stalk{X}{(0,0)} \to \stalk{\tilde{X}}{-1}$ are isomorphims because these local rings are both isomorphic to $k[x,y]/(xy)$ (note the change of variables $y^2 - x^2 = (u + v)^2 - (u - v)^2 = 4 uv$). However, this cover is not irreducible.
\end{example}


\section{Hilbert Spaces}

\subsection{Basic Definitions}

\newcommand{\inner}[2]{\left< #1 , #2 \right>}
\renewcommand{\C}{\mathbb{C}}
\renewcommand{\H}{\mathcal{H}}

\begin{defn}
A \textit{norm} on a $\R$-vector space $V$ is a function $|| \bullet || : V \to \R$ such that,
\begin{enumerate}
\item $||v|| \ge 0$
\item $||v|| = 0 \iff v = 0$
\item $||v + u|| \le ||v|| + ||u||$
\item $|| \alpha v || = \alpha || v ||$ for any $\alpha \in \R$.
\end{enumerate}
\end{defn}

\begin{rmk}
These imply that $d(u,v) = ||u - v||$ is a metric and thus a normed vector space is a topological vector space.
\end{rmk}

\begin{defn}
A Banach space is a normed vector space $|| \bullet || : V \to \R$ which is complete with respect to its metric.
\end{defn}

\begin{defn}
An Hermitian inner product on a $\C$-vector space is a conjugate-symmetric bilinear form $\inner{-}{-} : V \times \overline{V} \to \C$ such that $|| v || = \sqrt{\inner{v}{v}}$ is a norm. Explicitly,
\begin{enumerate}
\item $\inner{\alpha v + \beta u}{w} = \alpha \inner{v}{w} + \beta \inner{u}{w}$
\item $\inner{u}{v} = \overline{\inner{v}{u}}$
\item $\inner{v}{v} \ge 0$ and $\inner{v}{v} = 0 \iff v = 0$
\end{enumerate}
\end{defn}

\begin{defn}
A \textit{Hilbert Space} $\H$ is a Hermitian inner product space which is complete with respect to the induced norm. 
\end{defn}

\begin{rmk}
Therefore a Hilbert space is a Banach space whose norm is induced by an inner product.
\end{rmk}


\begin{prop}
A norm $|| \bullet ||$ is induced by a (real) inner product if and only if the real polarization identity holds:
\[ \tfrac{1}{2} \left( || v + u ||^2 + || v - u ||^2 \right) = || v ||^2 + || u ||^2 \]
and by a Hermitian inner product if and only if the complex polarization identities hold:
\[ \tfrac{1}{2} \left( || v + i u ||^2 + || v - u ||^2 \right) = || v ||^2 + || u ||^2 \]
\end{prop}

\begin{proof}
Suppose that $|| v ||^2 = \inner{v}{v}$ then,
\begin{align*}
\tfrac{1}{2} \left( || v + u ||^2 + || v - u ||^2 \right) & = \tfrac{1}{2} \left( \inner{v +  u}{v + u} + \inner{v - u}{v - u} \right) 
\\
& = \tfrac{1}{2} \left( \inner{v}{v} + 2 \inner{v}{u} + \inner{u}{u} + \inner{v}{v} - 2 \inner{v}{u} + \inner{u}{u} \right) 
\\
& = \inner{v}{v} + \inner{u}{u} = || v ||^2 + || u ||^2 
\end{align*}
Conversely, we define $\inner{v}{u} = \tfrac{1}{2} \left( || v + u ||^2 - || v ||^2 - || u ||^2 \right)$. Then clearly $\inner{v}{u} = \inner{u}{v}$ and,
\[ \inner{v}{v} =  \tfrac{1}{2} \left( || 2 v ||^2 - || v ||^2 - || v ||^2 \right) = \tfrac{1}{2} \left( 4 || v ||^2 - 2 || v ||^2 \right) = || v ||^2 \]
Finally, 
\begin{align*}
\inner{\alpha v + \beta u}{w} - \alpha \inner{v}{w} - \beta \inner{u}{w}  & = \tfrac{1}{2} \left( || \alpha v + \beta u + w ||^2 - || \alpha v + \beta u ||^2 - || w ||^2 \right)
\\
& - \tfrac{1}{2} \alpha \left( || v + w ||^2 - || v ||^2 - || w ||^2 \right) - \tfrac{1}{2} \beta \left( ||u + w||^2 - || u ||^2 - || w ||^2 \right)
\\
& = 
\end{align*}
(WTFF!!)
\end{proof}

\begin{prop}[Cauchy-Schwarz]
Let $(V, \inner{-}{-})$ be a Hermitian inner product space. Then, for any $v, u \in V$,
\[ | \inner{u}{v} | \le || u || \cdot || v || \]
With equality exactly when $u, v$ are linearly dependent.
\end{prop}

\begin{proof}
If $v = 0$ equality is obvious. Consider,
\[ u' = u - \frac{\inner{u}{v}}{\inner{v}{v}} v \]
Then we have,
\[ \inner{u'}{v} = \inner{u}{v} - \frac{\inner{u}{v}}{\inner{v}{v}} \inner{v}{v} = \inner{u}{v} - \inner{u}{v} = 0 \]
Therefore, writing 
\[ u = u' + \frac{\inner{u}{v}}{\inner{v}{v}} v \]
and thus we get
\[ ||u||^2 = || u' ||^2 + \left| \frac{\inner{u}{v}}{\inner{v}{v}} \right|^2 || v ||^2 + \inner{u'}{v} \frac{\inner{v}{u}}{\inner{v}{v}} + \inner{v}{u'} \frac{\inner{u}{v}}{\inner{v}{v}} = || u' ||^2 + \left| \frac{\inner{u}{v}}{\inner{v}{v}} \right|^2 || v ||^2 \]
Therefore, 
\[ || u ||^2 \ge \left| \frac{\inner{u}{v}}{\inner{v}{v}} \right|^2 || v ||^2 \]
or equivalently
\[ | \inner{u}{v} | \le || u || \cdot || v || \]
with equality exactly when,
\[ || u' || = 0 \iff u' = 0 \iff u \inner{v}{v} = \inner{u}{v} v \]
which is exactly when $u$ and $v$ are dependent (recally we assumed $v \neq 0$).
\end{proof}

\subsection{Operators}

\begin{defn}
A \textit{densely defined} operator $T : \H_1 \to \H_2$ of Hilbert spaces is a linear map defined on a dense subspace $D(T) \subset \H_1$. An operator is everywhere defined if $D(T) = \H_1$ which is generically called an operator. 
\end{defn}

\begin{defn}
An operator $T : X \to Y$ is \textit{bounded} if the operator norm,
\[ || T || = \sup_{v \in X} \frac{|| T(v) ||_{Y}}{|| v ||_{X}} = \sup_{v \in X} \frac{\inner{T(v)}{T(v)}_{Y}}{\inner{v}{v}_{X}} = \sup_{|| v ||_{X} = 1} \inner{T(v)}{T(v)}_{Y} \]
exists i.e. there exists some $M \in \R$ such that $||T(v)||_{Y} \le M || v ||_{X}$ for all $v \in X$..
\end{defn}

\begin{prop}
An operator $T : X \to Y$ the following are equivalent,
\begin{enumerate}
\item $T$ is bounded
\item $T$ is Lipschitz
\item $T$ is continuous
\end{enumerate}
\end{prop}

\begin{proof}
Suppose that $T : X \to Y$ is bounded by $M$. Then consider,
\[ || T(v) - T(u) || = || T (v - u) || \le M || v - u || \]
and thus $T : X \to Y$ is Lipschitz which implies continuous. Now suppose that $T$ is continuous. At $v = 0$, for $\epsilon = 1$ there exists $\delta > 0$ such that,
\[ || v || \le \delta \implies || T(v) || \le 1 \]
Then for any nonzero $v$ we set $u = \frac{\delta}{||v||} v$ and then,
\[ ||u|| = \delta \implies || T(u) || \le 1 \]
and thus,
\[ || T(v) || \le \frac{1}{\delta} || v || \]
proving that $T$ is bounded.
\end{proof}

\subsection{Basic Topological Properties}


\begin{prop}
Let $(M, d)$ be a metric space. Then $d : M \times M \to \R$ is continuous with respect to the metric topology.
\end{prop}

\begin{proof}
It suffices to show that for any $x,y \in X$ and $\epsilon > 0$ we have $| d(x',y') - d(x,y)| < 2 \epsilon$ for all $(x', y') \in B_\epsilon(x) \times B_\epsilon(y)$. From the triangle innequality,
\[ d(x',y') \le d(x, y') + d(x', x) \quad \text{and} \quad d(x, y') \le d(x', y') + d(x', x) \implies | d(x', y') - d(x, y') | \le d(x', x) \]
likewise $|d(x, y') - d(x, y) | \le d(y', y)$ and therefore,
\[ | d(x', y') - d(x, y) | \le d(x', x) + d(y', y) < 2 \epsilon \]
\end{proof}

\begin{prop}
Let $\H$ be a Hilbert space then $\inner{-}{-} : \H \to \C$ is continuous.
\end{prop}

\begin{proof}
This follows from the complex polarization identifies and the continuity of $|| v ||^2 = \inner{v}{v}$.
\end{proof}

\begin{lemma}
A subspace $S \subset M$ of a metric space is closed iff every convergent sequence $x_n \to x$ with $x_n \in W$ converges to $x \in S$.
\end{lemma}

\begin{proof}
If $W$ is closed then $x \in \overline{W} = W$ since every open neighborhood of $x$ contains points in the sequence $x_n \in W$. Conversely, suppose that $x \in \overline{W}$ we need to show $x \in W$. By hypothesis it suffices to find a sequence $x_n \in W$ converging to $x$. For any $n \in \N$ there exists $x_n \in W \cap B_{\frac{1}{n}}(x)$ and clearly $x_n \to x$.
\end{proof}

\begin{prop}
Let $W \subset \H$ be a subspace of a Hilbert space. Then,
\[ W^\perp = \{ v \in \H \mid \forall u \in W : \inner{v}{u} = 0 \} \]
is a closed subspace.
\end{prop}

\begin{proof}
Consider a sequence $x_n \in W^\perp$ such that $x_n \to x$ converges. Then $\forall v \in W : \inner{x_n}{v} = 0$ so,
\[ \inner{x}{v} = \inner{\lim_n x_n}{v} = \lim_n \inner{x_n}{v} = 0 \]
because $\inner{-}{-}$ is continuous with respect to the metric topology. Thus $x \in W$ and thus $W$ is closed. 
\end{proof}

\begin{rmk}
Note we do not assume $W$ is closed.
Warning: when $W$ is not closed we may not have $\H = W \oplus W^\perp$. For example, take $\ell_2$ and the subset $W$ of finite sequences. Then $W^\perp = (0)$. We now see that this cannot happen if $W$ is closed.
\end{rmk}


\begin{prop}
Let $W \subset \H$ be a closed subspace. Then there is a direct sum decomposition of the Hilbert space into $\H \cong W \oplus W^\perp$. 
\end{prop}

\begin{proof}
Fix $v \in \H$. Now consider a sequence $w_k \in W$ such that $|| v - w_k ||^2 \to \inf\limits_{w \in W} || v - w ||^2$. Notice that,
\[ || w - v ||^2 = || v ||^2 + || w ||^2 - \Re{\inner{w}{v}} \]  
Now for $v_n$ and $v_m$ consider,
\begin{align*}
|| w_n - v ||^2 + || w_m - v ||^2 & - 2 || \tfrac{1}{2}(w_n + w_m) - v ||^2
\\
& = || w_n ||^2 + || w_m ||^2 - 2 || \tfrac{1}{2} (w_n + w_m) ||^2 - 2 \Re{\inner{w_n}{v}} - 2 \Re{\inner{w_m}{v}} + 2 \Re{\inner{w_n + w_m}{v}}
\\
& = || w_n ||^2 + || w_m ||^2 - \tfrac{1}{2} || w_n + w_m ||^2 
\\
& = \tfrac{1}{2} || w_n - w_m ||^2
\end{align*}
However, as $n, m \to \infty$ I claim that,
\[ || w_n - v ||^2 + || w_m - v ||^2 - 2 || \tfrac{1}{2}(w_n + w_m) - v ||^2 \to 0 \]
Let $L = \inf\limits_{w \in W} || v - w ||^2$ which bounds $|| \tfrac{1}{2}(w_n + w_m) - v || \ge L$ meaning that,
\[ 0 \le || w_n - v ||^2 + || w_m - v ||^2 - 2 || \tfrac{1}{2}(w_n + w_m) - v ||^2 \le || w_n - v ||^2 + || w_m - v ||^2 - 2 L \]
which is nonegative because it equals $\tfrac{1}{2} || w_n - w_m ||^2$. Furthermore, both $|| w_n - v ||^2 \to L$ and $|| w_m - v ||^2 \to L$ so in the limit this quantity is zero.
Thus $|| w_n - w_m || \to 0$ so the sequence $w_n$ is Cauchy and thus converges to a limit $w_n \to w$. Since $W$ is closed and $w_n \in W$ we have $w \in W$. Furthermore, $|| v - w_ ||^2 \to || v - w ||^2$. And thus for any $\tilde{w} \in W$ we must have,
\[ || v - \tilde{w} ||^2 \ge || v - w ||^2 \]
In particular, take,
\[ || v - (w + t \tilde{w}) ||^2 = || v - w ||^2 - t \Re{\inner{v - w}{\tilde{w}}} + t^2 || \tilde{w} || \]
Thus, $- t \Re{\inner{v - w}{\tilde{w}}} + t^2 || \tilde{w} ||$ is positive for all $t$ which implies that $\Re{\inner{v - w}{\tilde{w}}} = 0$. Chainging $\tilde{w} \mapsto i \tilde{w}$ we see the imaginary part must vanish as well so $\inner{v - w}{\tilde{w}} = 0$. Since this holds for all $\tilde{w} \in W$ we find $v - w \in W^\perp$. Thus we can write $v = w + (v - w)$ for $w \in W$ and $v - w \in W^\perp$. Furthermore, clearly $W^\perp \cap W = (0)$ giving an internal direct sum decomposition $\H = W \oplus W^\perp$.
\end{proof}


\begin{prop}
For any subspace $W \subset \H$ of a Hilbert space, we have $(W^\perp)^\perp = \overline{W}$.
\end{prop}

\begin{proof}
$W \subset (W^\perp)^\perp$ since for any $w \in W$ if $v \in W^\perp$ then $\inner{w}{v} = 0$ so $w \in (W^\perp)^\perp$. Since $(W^\perp)^\perp$ is closed, $\overline{W} \subset (W^\perp)^\perp$. Conversely, $\overline{W}$ is closed so $\H = \overline{W} \oplus \overline{W}^\perp$ and thus any $v \in (\overline{W}^\perp)^\perp$ decomposes as $v = v_1 + v_2$ with $v_1 \in \overline{W}$ and $v_2 \in \overline{W}^\perp$ so $\inner{v_1}{v_2} = 0$. However, $v \in (\overline{W}^\perp)^\perp$ so $\inner{v}{v_2} = 0$ and thus $\inner{v_2}{v_2} = 0$ which implies that $v_2 = 0$ and thus $v = v_1 \in \overline{W}$. Therefore, $(W^\perp)^\perp \subset (\overline{W}^\perp)^\perp \subset \overline{W}$.
\end{proof}

\begin{cor}
A subspace $W \subset \H$ of a Hilbert space is trivial iff $W^\perp = \H$.
\end{cor}

\begin{proof}
Suppose $W^\perp = \H$. Then $W \subset W^\perp$ but $W \cap W^\perp = (0)$ so $W = (0)$.
\end{proof}

\begin{cor}
A subspace $W \subset \H$ of a Hilbert space is dense iff $W^\perp = (0)$.
\end{cor}

\begin{proof}
From before $\overline{W} = \H \iff (W^\perp)^\perp = \H \iff W^\perp = (0)$.
\end{proof}

\subsection{Dual Spaces}

\begin{defn}
Let $\H$ be a Hilbert space. A linear functional is a continuous linear map $\varphi : \H \to \R$. The dual space $\H^*$ is the Hilbert space of linear functionals along with the inner product,
\[ \inner{\varphi}{\psi} = \sup_{v \in \H} \frac{\inner{\varphi(v)}{\psi(v)}}{\inner{v}{v}} \]
\end{defn}

\begin{rmk}
We need to justify that this inner product exists. We need to show that $\inner{\varphi(v)}{\psi(v)}$ is bounded on the unit sphere $||v|| = 1$. This holds by continuity and the compactness of $S(\H)$.
We need to show this is an inner product. Linearity and conjugate-symmetry are clear. Furthermore positivity for $\inner{\varphi}{\varphi}$ is clear. Finally suppose that,
\[ \inner{\varphi}{\varphi} = \sup_{v \in \H^*} \frac{\inner{\varphi(v)}{\varphi(v)}}{\inner{v}{v}} = 0 \implies \forall v \in \H : \inner{\varphi(v)}{\varphi(v)} = 0 \implies \forall v \in \H : \varphi(v) = 0 \implies \varphi = 0 \]
\end{rmk}

\begin{theorem}[Riesz]
Let $\H$ be a Hilbert space\footnote{we require that $\inner{-}{-}$ be linear in its first argument.} For any linear functional $\varphi \in \H^*$ there exists a unique $v_\varphi \in \H$ such that $\forall u \in \H : \varphi(u) = \inner{u}{v_\varphi}$. Furthermore, $|| v_\varphi ||_{\H} = || \varphi ||_{\H^*}$.
\end{theorem}

\begin{proof}
Consider $K = \ker{\varphi}$ which is closed (since $\varphi$ is continuous). If $k = \H$ then $\varphi = 0$ so we may take $v_\varphi = 0$ and conclude. If $K \subsetneq \H$ then because $\K$ is closed and $\H$ is complete $K^\perp$ is nonempty. I claim, $K^\perp$ is one dimensional since if $v_1, v_2 \in K^\perp$ are nonzero then $\varphi(v_1)$ and $\varphi(v_2)$ are nonzero so there exists $\lambda \in \R$ such that $\varphi(v_1) = \lambda \varphi(v_2)$ and thus $\varphi(v_1 - \lambda v_2) = 0$ so $v_1 - \lambda v_2 \in K^\perp \cap K$ and thus $v_1 = \lambda v_2$ so we may choose a unit vector $u \in K^\perp$. Therefore, for any $v \in \H$ the vector $v - \inner{v}{u} u \in K$ therefore,
\[ \varphi(v) = \inner{v}{u} \varphi(u) = \inner{v}{u \overline{\varphi(u)}} \]
Hence we take $v_\varphi = \overline{\varphi(u)} u$. Furthermore,
\[ || v_{\varphi} ||^2_{\H} = \inner{v_\varphi}{v_{\varphi}} = \inner{u \overline{\varphi(u)}}{u \overline{\varphi(u)}} = | \varphi(u) |^2 \inner{u}{u} = | \varphi(u) |^2 \]
and likewise,
\[ || \varphi ||_{\H^*} = \sup_{v \in \H} \frac{|| \varphi(v) ||}{|| v ||} = \sup_{v \in \H} \frac{|| \inner{v}{u} \varphi(u) ||}{|| v ||} = \sup_{v \in \H} \frac{| \inner{v}{u} |}{|| v ||} | \varphi(u) | = | \varphi(u) | \]
Because $|| u || = 1$ so by Cauchy-Schwarz,
\[ | \inner{v}{u} | \le || v || \]
with equality when $v \in \vspan{v}$. Therefore, $||v_\varphi|| = || \varphi ||_{\H^*}$.
\end{proof}

\begin{cor}
Let $\H$ be a Hilbert space. Then the map $\overline{\H} \to \H^*$ defined by $v \mapsto \inner{-}{v}$ is an isometric isomorphism.
\end{cor}

\begin{proof}
This map is linear because $\lambda \cdot v = \bar{\lambda} v \mapsto \inner{-}{\bar{\lambda} v} = \lambda \inner{-}{v}$. Furthermore, if $\inner{u}{v} = 0$ for all $u$ then $\inner{v}{v} = 0$ and thus $v = 0$ so the map is injective. By the Riesz representation theorem, this map is surjective and isometric.
\end{proof}

\begin{cor}
The natural map $\H \to \H^{**}$ is an isomorphism of Hilbert spaces.
\end{cor}

\subsection{Adjoints}

\subsection{Weak Convergence}

\begin{defn}
We say a sequence $x_n \in \H$ converges weakly to $x \in \H$ if for all $y \in \H$ we get a covergent sequence,
\[ \inner{x_n}{y} \to \inner{x}{y} \] 
\end{defn}


\section{Soft Sheaves}

\begin{defn}
Let $X$ be a topological space. A sheaf $\F$ is \textit{soft} if for any closed $Z \subset X$ the induced map $\Gamma(X, \F) \to \Gamma(Z, \F|_Z)$ is surjective.
\end{defn}

\begin{rmk}
Let $\F$ be a sheaf. For any open $U \subset X$ the sheaf takes values $\F(U)$ and we know $\F(U) = \Gamma(U, \F|_U)$. Analogously, for a closed $Z \subset X$ we define,
\[ \F(Z) = \Gamma(\F, \F|_Z) \] 
\end{rmk}

\begin{lemma}
Let $X$ be paracompact and $Z \subset X$ closed. Then for any sheaf $\F$ the natural map,
\[ \varinjlim_{U \supset Z} \F(U) \to \F(Z) = \Gamma(Z, \F|_Z) \]
is an isomorphism.
\end{lemma}

\begin{proof}

\end{proof}

\begin{lemma}
If $\F$ is flasque then $\F$ is soft.
\end{lemma}

\begin{proof}
The restriction maps $\F(X) \to \F(U)$ are surjective and thus the induced maps,
\[ \F(X) \to \varinjlim_{U \supset Z} \F(U) \iso \F(Z) \]
are surjective.
\end{proof}

\begin{cor}
Any injective sheaf is soft.
\end{cor}

\begin{prop}
Let $\cP$ be a class of sheaves on $X$ such that,
\begin{enumerate}
\item injectives are in $\cP$ 
\item for any exact sequence where $\F \in \cP$ and $\I$ is injective,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \F \arrow[r] & \I \arrow[r] & \K \arrow[r] & 0
\end{tikzcd}
\end{center} 
then also $\K \in \cP$ and the sequence of sections,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \Gamma(X, \F) \arrow[r] & \Gamma(X, \I) \arrow[r] & \Gamma(X, \K) \arrow[r] & 0
\end{tikzcd}
\end{center}
is exact.
\end{enumerate}
Then all sheaves in $\cP$ are acyclic for $H^i(X, -)$ i.e. if $\F \in \cP$ then $H^i(X, \F) = 0$ for all $i > 0$.
\end{prop}

\begin{proof}
We show by induction on $n$ that $H^n(X, \F) = 0$ for all $\F \in \cP$. Take $\F \in \cP$ and embedd $\F$ into an injective,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \F \arrow[r] & \I \arrow[r] & \K \arrow[r] & 0
\end{tikzcd}
\end{center}
Since $\F, \I \in \cP$ then $\K \in \cP$. Since $\I$ is injective $H^i(X, \I) = 0$ for all $i > 0$. Thus, from the long exact sequence we find,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \Gamma(X, \F) \arrow[r] & \Gamma(X, \I) \arrow[r] & \Gamma(X, \K) \arrow[r] & H^1(X, \F) \arrow[r] & 0
\end{tikzcd}
\end{center} 
\begin{center}
\begin{tikzcd}
0 \arrow[r] & H^i(X, \H) \arrow[r] & H^{i+1}(X, \F) & 0
\end{tikzcd}
\end{center} 
However, by assumption the global sections sequence is exact so $H^1(X, \F) = 0$ proving the $i = 1$ base case. Now for induction assume that $H^n(X, \G) = 0$ for all $\G \in \cP$. Then  because $\K \in \cP$ using the long exact sequence,
\[ H^{n+1}(X, \F) = H^n(X, \K) = 0 \]
proving the statement for $n + 1$ and any $\F \in \cP$. 
\end{proof}

\begin{lemma}
Let $\F$ be a sheaf such that for any closed $Z \subset X$,
\[ \F(X) \to \varinjlim_{U \supset Z} \F(U) \]
is surjective. Then for any exact sequence of sheaves,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \F \arrow[r] & \G \arrow[r] & \K \arrow[r] & 0
\end{tikzcd}
\end{center}
then for any open $U \subset X$, the sequence of sections,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \Gamma(U, \F) \arrow[r] & \Gamma(U, \G) \arrow[r] & \Gamma(U, \K) \arrow[r] & 0
\end{tikzcd}
\end{center}
is exact.
\end{lemma}

\begin{proof}
Fix a global section $s \in \K(U)$. Now we consider the poset of (local) sections mapping to $s$,
\[ P = \{ (V, t) \mid V \subset U \text{ and } t \in \G(V) \text{ with } t \mapsto s|_V \} \]
with the order $(V, t) \le (V', t') \iff V \subset V'$ and $t'|_V = t$. 
We want to show $P$ contains $(U, t)$ for some $t$. Notice that for any chain $\{ (V_i, t_i) \mid i \in I \}$ in $P$ with a totally ordered index set $I$ we can define,
\[ V = \bigcup_{i \in I} V_i \]
and the $t_i$ glue to $t \in \G(V)$ because the $t_i$ agree on overlaps. Then $(V, t)$ is an upper bound of $\{ (V_i, t_i) \mid \i \in I \}$ so by Zorn's Lemma $P$ contains a maximal element $(V, t)$. Suppose that $V \neq U$ (i.e. $V \subset U$ is a proper subset) and take $Z = V^C$. 
\end{proof}

\begin{lemma}
Let $\F, \G$ be soft. Then for any exact sequence of sheaves,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \F \arrow[r] & \G \arrow[r] & \K \arrow[r] & 0
\end{tikzcd}
\end{center}
the sheaf $\K$ is also soft.
\end{lemma}

\begin{proof}
For any closed subspace $Z \subset X$ the diagram of sections,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \Gamma(X, \F) \arrow[d, two heads] \arrow[r] & \Gamma(X, \G) \arrow[d, two heads]\arrow[r] & \Gamma(X, \K) \arrow[d] \arrow[r] & 0
\\
0 \arrow[r] & \Gamma(Z, \F|_Z) \arrow[r] & \Gamma(X, \G|_Z) \arrow[r] & \Gamma(X, \K|_Z) \arrow[r] & 0 
\end{tikzcd}
\end{center}
with exact rows because restrictions of soft sheaves remain soft so we may apply the previous lemma to both exact sequences.
The first two vertical maps are surjections and thus so is the last by exactness.
\end{proof}


\section{Acyclicity}

\renewcommand{\C}{\mathcal{C}}

\begin{prop}
Let $\C$ be an abelian category and $\cP$ a class of objects such that,
\begin{enumerate}
\item for every injective $I \in \C$ there exists a monic $I \embed B$ with $B \in \cP$
\item if $A \oplus B \in \cP$ then $A, B \in \cP$.
\end{enumerate}
Then every injective object of $\C$ is in $\cP$.
\end{prop}

\begin{proof}
Let $I$ be injective. Take a monic $I \embed B$ with $B \in \cP$. Taking the cokernel gives a sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & I \arrow[r] & B \arrow[r] & K \arrow[r] & 0
\end{tikzcd}
\end{center}
which splits because $I$ is injective. Thus $B = I \oplus K$ and $B \in \cP$ so $I, K \in \cP$.
\end{proof}

\begin{prop}
Let $F : \cA \to \cB$ be an additive functor of abelian categories where $\cA$ has enough injectives and $\cP$ be a class of $\cA$-objects such that
\begin{enumerate}
\item injectives are in $\cP$ 
\item for any exact sequence where $A \in \cP$ and $I$ is injective,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & A \arrow[r] & I \arrow[r] & K \arrow[r] & 0
\end{tikzcd}
\end{center} 
then also $K \in \cP$ and the sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & F(A) \arrow[r] & F(I) \arrow[r] & F(K) \arrow[r] & 0
\end{tikzcd}
\end{center}
is exact.
\end{enumerate}
Then all onjects in $\cP$ are $F$-acyclic i.e. if $A \in \cP$ then $R^p F(A) = 0$ for all $p > 0$.
\end{prop}

\begin{proof}
We show by induction on $n$ that $R^n F(A) = 0$ for all $A \in \cP$. Take $A \in \cP$ and embedd $A$ into an injective,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & A \arrow[r] & I \arrow[r] & K \arrow[r] & 0
\end{tikzcd}
\end{center}
Since $F, I \in \cP$ then $K \in \cP$. Since $I$ is injective $R^i F(I) = 0$ for all $i  > 0$. Thus, from the long exact sequence we find,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & F(A) \arrow[r] & F(I) \arrow[r] & K(K) \arrow[r] & R^1 F(A) \arrow[r] & 0
\end{tikzcd}
\end{center} 
\begin{center}
\begin{tikzcd}
0 \arrow[r] & R^i F(K) \arrow[r] & R^{i+1} F(A) \arrow[r] & 0
\end{tikzcd}
\end{center} 
However, by assumption the sequence after applying $F(-)$ is exact so $R^1 F(A) = 0$ proving the $i = 1$ base case. Now for induction assume that $R^n F(B) = 0$ for all $B \in \cP$. Then  because $K \in \cP$ using the long exact sequence,
\[ R^{n+1} F(A) = R^n F(K) = 0 \]
proving the statement for $n + 1$ and any $A \in \cP$. 
\end{proof}

\begin{prop}
Let $F : \cA \to \cB$ be an additive functor of abelian categories where $\cA$ has enough injectives and $\cP$ be a class of $\cA$-objects such that,
\begin{enumerate}
\item for every $A \in \cA$ there exists a monic $A \embed B$ with $B \in \cP$
\item if $A \oplus B \in \cP$ then $A, B \in \cP$
\item for any exact sequence where $A \in \cP$ and $I$ is injective,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & A \arrow[r] & I \arrow[r] & K \arrow[r] & 0
\end{tikzcd}
\end{center} 
then also $K \in \cP$ and the sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & F(A) \arrow[r] & F(I) \arrow[r] & F(K) \arrow[r] & 0
\end{tikzcd}
\end{center}
is exact.
\end{enumerate}
Then the derived functors $R^p F$ may be computed on $\cP$-resolutions. Explicitly, for any $A \in \C$ there exists an exact sequence $0 \to A \to P^\bullet$ with $P^i \in \cP$ and for any such resolution,
\[ R^p F(A) = H^p(F(P^\bullet)) \]
\end{prop}

\begin{proof}
The first two properties imply that all injectives are in $\cP$. The second two properties then imply that objects in $\cP$ are $F$-acyclic. Finally (a) implies that $\cP$-resolutions exist and that cohomology (e.g. derived functors) is computed from them follows from the Leray acyclicity lemma.
\end{proof}

\section{Classifying Principal $G$-bundles}

Recall that $K(G, n)$ is the classifying space for $H^n(- ; G)$. Explicitly,
\[ H^n(X, G) = [X, K(G, n)] \]
given by pulling back along a function $f : X \to K(G,n)$ the class,
\[ \id \in \Hom{}{G}{G} = \Hom{}{\pi_n(X)}{G} = H^n(X, G) \]
When $G$ is a discrete abelian group, we want to justify the claim that $BG = K(G, 1)$ is the classifying space for principal $G$-bundles. Since $G$ is discrete, these are nearly Galois covering spaces except they need not be connected. Let $X$ be a connected CW complex then the universal coefficient theorem gives an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \Ext{1}{\Z}{H_0(X, \Z)}{G} \arrow[r] & H^1(X, G) \arrow[r] & \Hom{}{H_1(X, \Z)}{G} \arrow[r] & 0
\end{tikzcd}
\end{center} 
Howver, since $X$ is connected $H_0(X, \Z) = \Z$ and from the Hurewicz theorem $\pi_1(X) \to H_1(X, \Z)$ is the abelianization map. Therefore, there is an isomorphism,
\[ H^1(X, G) = \Hom{}{H_1(X, \Z)}{G} = \Hom{}{\pi_1(X)^\ab}{G} = \Hom{}{\pi_1(X)}{G} \]
Since $K(G, 1)$ classifies $H^1(X, G)$, we need to show that principal $G$-bundles are classified by $\Hom{}{\pi_1(X)}{G}$ which implies that the functor sending $X$ to its set of principal $G$-bundles up to isomorphism is represented by $K(G,1)$.


\subsection{The Connected Case}

Notice that since $G$ is discrete a connected principal $G$-bundle is exactly a Galois cover of $X$ with deck transformation group $G$. Furthermore, such Galois covers are classified by normal subgroups $N \triangleleft \pi_1(X)$ such that $\pi_1(X) / N \cong G$ or equivalent surjective morphims $\pi_1(X) \onto G$. Therefore the surjective subset of $\Hom{}{\pi_1(X)}{G}$ corresponds to the connected $G$-bundles.

\subsection{Group Cohomology and Cocycles}

\begin{defn}
Let $G$ be a group consider the category $\Mod{G}$ of left $\Z[G]$-modules. The functor $M \mapsto M^G$ where $M^G = \{ m \in M \mid \sigma(m) = m \forall \sigma \in G \}$ is left exact. Then we define the group cohomology $H^n(G, -)$ as the right-derived functors of $(-)^G$.
\end{defn}

\begin{rmk}
Notice that $(-)^G = \Hom{}{\Z}{-}$ where $\Z$ is a trivial $G$-module. Therefore, 
\[ H^n(G,-) = \Ext{n}{\Z[G]}{\Z}{-} \]
By general homological algebra, we can compute $\Ext{n}{\Z[G]}{\Z}{M}$ via projective resolutions in the first argument. 
\end{rmk}

\begin{defn}
The complex $P_n(G) = \Z[G^{n+1}]$ with the diagonal $G$-action where the boundary map $\d : P_{n+1}(G) \to P_n(G)$ is defined by,
\[ \d (g_0, \dots, g_n) = \sum_{i = 0}^{n} (-1)^i (g_1, \dots, \hat{g}_i, \dots g_n) \]
\end{defn}

\begin{prop}
$P_\bullet(G) \to \Z$ with $\epsilon : \Z[G] \to \Z$ sending $g \mapsto 1$ is a projective resolution.
\end{prop}

\begin{proof}
The modules $P_n = \Z[G^{n+1}]$ is a free $\Z[G]$-module with basis $\{ (1, g_1, \dots, g_n) \mid g_i \in G \}$ and thus projective. Furthermore, we see,
\begin{align*}
\d^2 (g_0, \dots, g_n) & = \sum_{i = 0}^n  (-1)^i \d (g_0, \dots, \hat{g}_i, \dots, g_n) 
\\
& = \sum_{i = 0}^n \sum_{j = 0}^{i-1} (-1)^{i+j} (g_0, \dots, \hat{g}_j , \dots, \hat{g}_i, \dots, g_n) + \sum_{i = 0}^n \sum_{j = i+1}^{n} (-1)^{i+j} (g_0, \dots, \hat{g}_i , \dots, \hat{g}_j, \dots, g_n)
\\
& = 0
\end{align*}
Furthermore, this complex is exact because there exists a map $k_r : P_r \to P_{r+1}$ defined by sending $(g_0, \dots, g_r) \mapsto (1, g_0, \dots, g_r)$ which satisfies,
\[ k_{r-1} \circ \d_{r} + \d_{r+1} \circ k_{r} = \id \]
because,
\[ k_{r-1} \circ \d_{r}(g_0, \dots, g_{r}) = \sum_{i = 0}^{r} (-1)^i (1, g_0, \dots, \hat{g}_i, \dots, g_{r}) \]
and likewise,
\[ \d_{r+1} \circ k_r(g_0, \dots, g_{r}) = (g_0, \dots, g_r) + \sum_{i = 0}^{r} (-1)^{i+1} (1, g_0, \dots, \hat{g}_i, \dots, g_r) \]
proving that,
\[ (k_{r-1} \circ \d_{r} + \d_{r+1} \circ k_r)(g_0, \dots, g_r) = (g_0, \dots, g_r) \]
Therefore, $P_\bullet$ is homotopic to the zero complex in positive degrees and is thus exact. Expliclty, if $\d_r{\gamma} = 0$ for $\gamma \in \Z[G^{r+1}]$ for $r > 0$ then,
\[ \gamma = (k_{r-1} \circ \d_r + \d_{r+1} \circ k_r)(\gamma) = \d_{r + 1}(k_r(\gamma)) \]
so $\gamma \in \Im{\d : P_{r+1} \to P_r}$.
Finally, notice that $\ker{\epsilon}$ is the submodule generated by $g_i - g_j$ which is exactly the image of $\d : P^1 \to P^0$. 
\end{proof}

\begin{prop}
Let $G$ be a group then,
\[ H^n(G, M) = H^n(\Hom{}{P_\bullet}{M}) \]
\end{prop}

\begin{proof}
Becuase $P_\bullet \to \Z$ is a projective resolution this computes $\Ext{n}{\Z[G]}{\Z}{M} = H^n(G, M)$. 
\end{proof}

\begin{defn}
The homogeneous $n$-cochains $\tilde{C}^n(G, M) = \Hom{}{P_n}{M}$ are $\varphi : G^{n+1} \to M$ (as sets) satisfying $\varphi(g g_0, \dots, g g_r) = g \varphi(g_0, \dots, g_r)$ with boundary map $\d^r : \tilde{C}^r(G, M) \to \tilde{C}^{r+1}(G, M)$,
\[ \d{\varphi}(g_0, \dots, g_{r+1}) = \sum_{i = 0}^{r} (-1)^i \varphi(g_0, \dots, \hat{g}_i, \dots, g_r) \]
\end{defn}

\begin{rmk}
Notice that such a map $\varphi : G^{n+1} \to M$ is uniquely determined on $(1, g_1, \dots, g_n)$ since we may pull out $g_0$ (and replace $g_1 \mapsto g_0^{-1} g_1$). However, restricting to elements of this sort does not play nicely with the boundary map because,
\[ \d{\varphi}(1, g_1, \dots, g_{r+1}) = \varphi(g_1, \dots, g_{r+1}) + \sum_{i = 1}^{r+1} (-1)^i \varphi(1, g_1, \dots, \hat{g}_i, \dots, g_{r+1}) \]
but the first term,
\[ \varphi(g_1, \dots, g_{r+1}) = g_1 \varphi(1, g_1^{-1} g_2, \dots, g_1^{-1} g_{r+1}) \]
which is a bit nasty because of all the $g_1^{-1}$. We can use the following trick to put the differential in a nicer form on our basis. Because multiplication is bijective elements of the form $(1, g_1, g_1 g_2, \dots, g_1 \cdots g_r)$ are exactly the same as the elements of the form $(1, g_1, \cdots, g_r)$. However, furthermore the differential acts via,
\begin{align*}
\d{\varphi}(1, g_1, g_1 g_2, \dots, g_1 \cdots g_{r+1}) & = \varphi(g_1, g_1 g_2, \dots, g_1 \cdots g_{r+1}) + \sum_{i = 1}^{r+1} (-1)^i \varphi(1, g_1, \dots, \widehat{g_1 \cdots g_i}, \dots, g_1 \cdots g_{r+1}) 
\\
& = g_1 \varphi(g_2, \dots, g_2 \cdots g_{r+1}) + \sum_{i = 1}^{r} \varphi(1, g_1, \dots, g_1 \cdots \tilde{g}_i, \dots, g_1 \cdots \tilde{g}_{r+1})
\\
& + \varphi(1, g_1, \dots, g_1 \cdots g_r) 
\end{align*}
where $\tilde{g}_i = g_i g_{i+1}$ and $\tilde{g}_j = g_{j + 1}$ for $j > i$. Therefore, if we define $\varphi' : G^n \to M$ via,
\[ \varphi'(g_1, \dots, g_r) = \varphi(1, g_1, g_1 g_2, \dots, g_1 \cdots g_r) \]
we find that,
\begin{align*}
\d{\varphi}(1, g_1, g_1 g_2, \dots, g_1 \cdots g_{r+1}) & = g_1 \varphi'(g_2, \dots, g_{r+1}) + \sum_{i = 1}^r \varphi'(g_1, \dots, g_i g_{i+1}, \dots, g_{r+1}) + (-1)^{r+1} \varphi(g_1, \dots, g_r) 
\end{align*}
Thus we define the following equivalent description of the complex $P_\bullet \to \Z$.
\end{rmk}

\begin{defn}
The inhomogeneous $n$-cochains $C^n(G, M)$ are (set) maps $\varphi : G^n \to M$ with corresponding boundary maps $\d^r : C^r(G, M) \to C^{r+1}(G, M)$ defined via,
\[ \d{\varphi}(g_1, \dots, g_{r+1}) = g_1 \varphi(g_2, \dots, g_{r+1}) + \sum_{i = 1}^r (-1)^i \varphi(g_1, \dots, g_i g_{i+1}, \dots, g_{r+1}) + (-1)^{r + 1} \varphi(g_1, \dots, g_r) \]
\end{defn}

\begin{prop}
The group cohomology may be computed as,
\[ H^n(G, M) = H^n(C^\bullet(G, M)) \]
\end{prop}

\begin{proof}
We have shown the map $\tilde{C}^\bullet(G, M) \to C^\bullet(G, M)$ via sending $\varphi \mapsto \varphi'$ is an isomorphism comuting with the boundary maps by the preceeding remarks.
\end{proof}

\subsubsection{Low Degree Computations}

\begin{prop}
Let $M$ be a $G$-module. Then,
\[ H^1(G, M) = \frac{ \{ \varphi : G \to M \mid \varphi(g_1 g_2) = g_1 \varphi(g_2) + \varphi(g_1) \} }{\{ \varphi : G \to M \mid  \varphi(g) = g \cdot m - m \}} \]
and likewise,
\[ H^2(G, M) = \frac{\{ \varphi : G^2 \to M \mid g_1 \varphi(g_2, g_3) - \varphi(g_1 g_2, g_3) + \varphi(g_1, g_2 g_3) - \varphi(g_1, g_2) = 0 \}}{\{ \varphi : G^2 \to M \mid \varphi(g_1, g_2) = g_1 \eta(g_2) - \eta(g_1 g_2) + \eta(g_1) \}} \]
\end{prop}

\begin{rmk}
These $2$-cocycles $G^2 \to M$ have an important interpretation.
\end{rmk}

\begin{defn}
Let $M$ be a $G$-module. Then an $M$-extension is an exact sequence,
\begin{center}
\begin{tikzcd}
1 \arrow[r] & M \arrow[r] & E \arrow[r] & G \arrow[r] & 1
\end{tikzcd}
\end{center}
where for any $g \in G$ any preimage $e_g$ acts on $m \in M$ via $e_g m e_g^{-1} = g \cdot m$.
\end{defn}

\begin{rmk}
Notice that the formula $e_g \, m  \, e_g^{-1} = g \cdot m$ is well-defined because for any other lift $e_g'$ of $g$ we must have $e_g' = e_g \, m'$ for some $m' \in M$ and,
\[ e_g' \, m \, e_g'^{-1} = e_g \, m' \, m \, m'^{-1} \, e_g^{-1} = e_g \, m \, e_g^{-1} \]
because $M$ is commutative. In general, when $M$ is not commutative, the same construction works but does not give a well-defined action of $G$ on $M$ rather an outer action i.e.\ a map $G \to \mathrm{Out}\left( M \right)$.
\end{rmk}

\begin{prop}
Let $M$ be a $G$-module. Then isomorphism classes of $M$-extensions are bijective to $H^2(G, M)$ where the split extension corresponds to the trivial cocycle.
\end{prop}

\begin{proof}
Given an $M$-extension,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & M \arrow[r] & E \arrow[r] & G \arrow[r] & 0
\end{tikzcd}
\end{center}
Then we consider a (set-theoretic) section $s : G \to E$. This may not be a group homomorphism so we can measure its failure to be a homomorphism by a map $\varphi(g_1, g_2) = s(g_1 g_2) s(g_1)^{-1} s(g_2)^{-1}$. However, $\pi(\varphi(g_1, g_2)) = (g_1 g_2) g_1^{-1} g_2^{-1} = 1$ (because $\pi : E \to G$ is a group homomorphism). Therefore, this defines a cochain $\varphi : G^2 \to M$. Furthermore, consider the tripple products,
\[ s(g_1 g_2 g_3) = \varphi(g_1 g_2, g_3) s(g_1 g_2) s(g_3) = \varphi(g_1 g_2, g_3) \varphi(g_1, g_2) s(g_1) s(g_2) s(g_3) \]
but we can also write,
\begin{align*}
s(g_1 g_2 g_3) & = \varphi(g_1, g_2 g_3) s(g_1) s(g_2 g_3) = \varphi(g_1, g_2 g_3) s(g_1) \varphi(g_2, g_3) s(g_2) s(g_3) 
\\
& = \varphi(g_1, g_2 g_3) [ s(g_1) \varphi(g_2, g_3) s(g_1)^{-1} ] s(g_1) s(g_2) s(g_3)
\end{align*}
Therefore, writing in additive notaiton, we find,
\[ \varphi(g_1 g_2, g_3) + \varphi(g_1, g_2) = \varphi(g_1, g_2 g_3) + g_1 \cdot \varphi(g_2, g_3) \]
where, by definition, $s(g_1) m s(g_1)^{-1} = g_1 \cdot m$ for all $m \in M$. Therefore $\varphi : G^2 \to M$ is a cocycle. This defines a map from $M$-extensions to $H^1(G, M)$. It suffices to construct an inverse. Given a $2$-cocycle $\varphi : G^2 \to M$. We define an extension,
\begin{center}
\begin{tikzcd}
1 \arrow[r] & M \arrow[r] & E \arrow[r] & G \arrow[r] & 1
\end{tikzcd}
\end{center}
where $E = G \times M$ with a ``twisted'' product structure,
\[ (g_1, m_1) \cdot (g_2, m_2) = (g_1 g_2, m_1 + g_1 \cdot m_2 + \varphi(g_1, g_2)) \]
\end{proof}

\subsection{The General Case}

Consider a cocylce $\varphi : N^2 \to G/N$ 

We want to construct a principal $G$-bundle $P(\varphi) = \tilde{X} \times G/N$ with the following action,
\[ g_1 \cdot (x, g_2 N) = (g_1 \cdots x, g_1 g_2 N) \]

\subsection{Examples}

\section{Low Degree Terms of Specral Sequences}

Suppose we have a bounded spectral sequence $E_r^{p,q} \implies H^{p+q}(E^\bullet)$ converging to $H^n$. Explicitly the differentials are maps $\d_r : E^{p,q}_r \to E^{p + r, q - r + 1}_r$. Then there is a filtration $F^p H^{n}(E^\bullet)$ of $H^n(E^\bullet)$ with $F^0 H^n(E^\bullet) = H^n(E^\bullet)$ and $F^{n+1} H^n(E^\bullet) = 0$ such that,
\[ F^{p} H^{p+q}(E^\bullet) / F^{p+1} H^{p+q}(E^\bullet) = E_\infty^{p,q} \] 
\begin{prop}
Given a spectral sequence $E^{p,q}_r \implies H^{p+q}(E^\bullet)$ then $H^0(E^\bullet) = E^{0,0}_2$ and there is a spectral sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & E^{1, 0}_2 \arrow[r] & H^1(E^\bullet) \arrow[r] & E^{0, 1}_2 \arrow[r, "\d_2"] & E^{2, 0}_2 \arrow[r] & H^2(E^\bullet)
\end{tikzcd}
\end{center}
\end{prop}

\begin{proof}
First, notice that differentials $\d_r : E^{1, 0}_r \to E^{1 + r, 1 - r}_r$ and $\d_r : E^{1 - r, r - 1} \to E^{1, 0}_r$ both contain terms outside the support of the spectral sequence when $r > 1$. Therefore, $E^{1,0}_2 = E^{1,0}_{\infty}$. Furthermore, since $F^2 H^1(E^\bullet) = 0$ we get,
\[ F^1 H^1(E^\bullet) = E^{1, 0}_\infty = E^{1, 0}_2 \]
Furthermore, since $F^0 H^1(E^\bullet) / F^1 H^1(E^\bullet) = E^{0, 1}_\infty$ we get an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & E_2^{1, 0} \arrow[r] & H^1(E^\bullet) \arrow[r] & E^{0, 1}_\infty \arrow[r] & 0
\end{tikzcd}
\end{center}
Furthermore, consider the differentials $\d_r : E^{-r, r} \to E^{0, 1}$ and $\d_r : E^{0, 1}_r \to E^{r, 2-r}_r$. The first lies outside the support and thus is zero when $r > 1$ and the second is outside the support and thus zero when $r > 2$. Therefore, $E^{0, 1}_\infty = E^{0, 1}_3 = \ker{(\d_r : E^{0, 1}_2 \to E^{2, 0}_2)}$. 
This alows us to refine the exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & E_2^{1, 0} \arrow[r] & H^1(E^\bullet) \arrow[r] & E^{0, 1}_2 \arrow[r, "\d_2"] & E^{2, 0}_2
\end{tikzcd}
\end{center}
Finally, since $F^3 H^2(E^\bullet) = 0$ we find $F^2 H^2(E^\bullet) = E^{2, 0}_\infty$ embedds inside $H^2(E^\bullet)$. However, the differentials $\d_r : E^{2,0}_r \to E^{2+r, 1-r}$ is outside the support when $r > 1$ and $\d_r : E^{2-r, r-1} \to E^{2, 0}$ is zero for $r > 2$ so $E^{2,0}_\infty = E^{2, 0}_2 / \Im{\d_r : E^{0, 1} \to E^{2, 0}_2}$. Therefore, the kernel of $E^{2, 0}_2 \to E^{2, 0}_\infty \to H^2(E^\bullet)$ is $\Im{\d_r : E^{0, 1} \to E_2^{2, 0}}$ and thus the sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & E_2^{1, 0} \arrow[r] & H^1(E^\bullet) \arrow[r] & E^{0, 1}_2 \arrow[r, "\d_2"] & E^{2, 0}_2 \arrow[r] & H^2(E^\bullet)
\end{tikzcd}
\end{center}
is exact. Finally, the differentials $\d_r : E^{0,0}_r \to E^{r, 1-r}$ and $\d_r : E^{-r, r-1} \to E^{0,0}$ are zero for $r > 1$ so $E^{0,0}_\infty = E^{0,0}_2$ and $F^1 H^0(E^\bullet) = 0$ so 
\[ H^0(E^\bullet) = F^0 H^0(E^\bullet) = E^{0, 0}_\infty = E^{0, 0}_2 \]
\end{proof}

\begin{example}
The Hodge to de Rham spectral sequence,
\[ E_1^{p,q} = H^q(X, \Omega^p_X) \implies H^{p+q}_{\dR}(X) \]
for curves gives a low degree exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & H^0(X, \Omega_X^1) \arrow[r] & H^1_{\dR}(X) \arrow[r] & H^1(X, \struct{X}) \arrow[r] & 0
\end{tikzcd}
\end{center}
because $E^{p,q}_1 = 0$ if $p > 1$ or $q > 1$ and thus $E^{p,q}_2 = E^{p,q}_1$. Analytically, we can compare this to the differential sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \underline{\mathbb{C}} \arrow[r] & \struct{X} \arrow[r, "\d"] & \Omega^1_X \arrow[r] & 0 
\end{tikzcd}
\end{center}
since this gives an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & H^0(X, \Omega^1_X) \arrow[r] & H^1(X, \mathbb{C}) \arrow[r] & H^1(X, \struct{X}) \arrow[r] & 0
\end{tikzcd}
\end{center}
notice that the map $\d : H^0(X, \struct{X}) \to H^0(X, \Omega^1_X)$ is zero for proper curves since the global functions are constant and similarly $\d : H^1(X, \struct{X}) \to H^1(X, \Omega_X^1)$ by Serre duality.
\end{example}

\begin{example}
There is a dual Hodge to de Rham spectral sequence,
\[ E^{p,q}_2 = H^p(X, \mathcal{H}^q(\Omega^\bullet)) \implies H^{p+q}_{\dR}(X) \]
which gives an exact sequence of low degree terms,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & H^1(X, \ker{\d}) \arrow[r] & H^1_{\dR}(X) \arrow[r] & H^0(X, \mathcal{H}^1(\Omega^\bullet)) \arrow[r, "\d_2"] & H^1(X, \ker{\d}) \arrow[r] & H^2_{\dR}(X)
\end{tikzcd}
\end{center}
Often we will have $H^i(X, \ker{\d}) = 0$ for $i > 0$ in which case $H^1_{\mathrm{dR}}(X) = H^0(X, \mathcal{H}^1(\Omega^\bullet))$.
\end{example}

\begin{example}
The Leray spectral sequence for a morphism $f : X \to Y$ and a sheaf $\F$ on $X$,
\[ E^{p,q}_2 = H^p(Y, R^q f_* \F) = H^{p+q}(X, \F) \]
gives an exact sequence of low degree terms,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & H^1(Y, f_* \F) \arrow[r] & H^1(X, \F) \arrow[r] & H^0(Y, R^1 f_* \F) \arrow[r, "\d_2"] & H^2(Y, f_* \F) \arrow[r] & H^2(X, \F)
\end{tikzcd}
\end{center}
A particular example is when $f : X \to Y$ has $f_* \struct{X} = \struct{Y}$ and $\F = \struct{X}^\times$ in which case,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \Pic{Y} \arrow[r] & \Pic{X} \arrow[r] & H^0(Y, R^1 f_* \struct{X}^\times) \arrow[r, "\d_2"] & H^2(Y, f_* \struct{X}^\times) \arrow[r] & H^2(X, \struct{X}^\times)
\end{tikzcd}
\end{center}
which is why we define $\Pic{X/Y} = H^0(Y, R^1 f_* \struct{X}^\times)$.
\end{example}

\begin{example}
The Grothendieck spectral sequence,
\[ E^{p,q}_2 = R^p F \circ R^q G(A) \implies R^{p+q}(F \circ G)(A) \]
gives an exact sequence of low degree terms,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & R^1 F \circ G(A) \arrow[r] & R^1(F \circ G)(A) \arrow[r] & F \circ R^1 G(A) \arrow[r, "\d_2"] & R^2 F \circ G(A) \arrow[r] & R^2(F \circ G)(A)
\end{tikzcd}
\end{center}
\end{example}

\subsection{Conormal Sheaves}

\begin{defn}
Let $\iota : Z \to X$ be an embedding and let $\I = \ker{(\iota^\# : \struct{X} \to \iota_* \struct{Z})}$. Then the conormal sheaf of $\iota$ is the $\struct{Z}$-module $\C_{Z/X} = \iota^* \I = \iota^* (\I/I^2)$.
\end{defn}

\begin{prop}
Let $f : Z \to X$ be an immersion over $S$. Then there is a right-exact sequence,
\begin{center}
\begin{tikzcd}
\C_{Z/X} \arrow[r] & f^* \Omega_{X/S} \arrow[r] & \Omega_{Z/S} \arrow[r] & 0
\end{tikzcd}
\end{center}
which is exact on the left when $Z \to S$ is formally smooth.
\end{prop}

\begin{proof}
There is an exact sequence,
\begin{center}
\begin{tikzcd}
f^* \Omega_{X/S} \arrow[r] & \Omega_{Z/S} \arrow[r] & \Omega_{Z/X} \arrow[r] & 0
\end{tikzcd}
\end{center}
However, $f : Z \to X$ is formally unramified so $\Omega_{Z/X} = 0$ proving that $f^* \Omega_{X/S} \to \Omega_{Z/S}$ is surjective. The rest is given by Tag 04FC and Tag 06B7. 
\end{proof}

\begin{prop}
Suppose that $\iota : Z \to X$ is an immersion and $f : X \to Y$ is such that $f \circ \iota : Z \to Y$ is an immersion. Then there is a right-exact sequence,
\begin{center}
\begin{tikzcd}
\C_{Z/Y} \arrow[r] & \C_{Z/X} \arrow[r] & \iota^* \Omega_{X/Y} \arrow[r] & 0 
\end{tikzcd}
\end{center}
If $f : X \to Y$ is formally smooth this is short exact.
\end{prop}

\begin{proof}
Tag 04FC and Tag 06B7.
\end{proof}

\begin{prop}
Let $\iota_1 : Z \to Y$ and $\iota_2 : Y \to X$ be immersions over $S$ where $Z \to S$ is formally smooth. Then there is a right exact sequence,
\begin{center}
\begin{tikzcd}
\iota_1^* \C_{Y/X} \arrow[r] & \C_{Z/X} \arrow[r] & \C_{Z/Y} \arrow[r] & 0
\end{tikzcd}
\end{center}
which is short exact when $g : Y \to S$ is formally smooth.
\end{prop}

\begin{proof}
Using the conormal sequences we get a diagram,
\begin{center}
\begin{tikzcd}
& & & 0 \arrow[d]
\\
& & & \C_{Z/Y} \arrow[d]
\\
& \iota_1^* \C_{Y/X} \arrow[d, dashed] \arrow[r] & \iota^* \Omega_{X/S} \arrow[r] \arrow[d, equals] & \iota_1^* \Omega_{Y/S} \arrow[r] \arrow[d] & 0
\\
0 \arrow[r] & \C_{Z/X} \arrow[r] & \iota^* \Omega_{X/S} \arrow[r] & \Omega_{Z/S} \arrow[r] \arrow[d] & 0
\\
& & & 0 &
\end{tikzcd}
\end{center}
Therefore, by the snake lemma we get an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \C_{Z/Y} \arrow[r] & \coker{(\iota_1^* \C_{Y/X} \to \C_{Z/X})} \arrow[r] & 0
\end{tikzcd}
\end{center}
which is an isomorphism and therefore there is a right exact sequence,
\begin{center}
\begin{tikzcd}
\iota_1^* \C_{Y/X} \arrow[r] & \C_{Z/X} \arrow[r] & \C_{Z/Y} \arrow[r] & 0
\end{tikzcd}
\end{center}
Finally, if $Y \to S$ is smooth then the top row is left exact ($\iota_1^*$ is an exact functor since $\iota_1$ is an immersion). Therefore, the dashed arrow $\iota_1 \C_{Y/X} \to \C_{Z/X}$ is injective (because $\iota_1 \C_{Y/X} \to \iota^* \Omega_{X/S}$ which equals $\iota_1^* \C_{Y/X} \to \C_{Z/X} \to \iota^* \Omega_{X/S}$ is injective) thus making following sequence exact,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \iota_1^* \C_{Y/X} \arrow[r] & \C_{Z/X} \arrow[r] & \C_{Z/Y} \arrow[r] & 0
\end{tikzcd}
\end{center}
\end{proof}

\begin{rmk}
The most general version of the above is when $\iota_1 : Z \to Y$ and $\iota_2 : Y \to X$ are formally unramified morphisms over $S$ then there is a right exact sequence,
\begin{center}
\begin{tikzcd}
\iota_1^* \C_{Y/X} \arrow[r] & \C_{Z/X} \arrow[r] & \C_{Z/Y} \arrow[r] & 0
\end{tikzcd}
\end{center}
which is short exact when $\iota_1 : Z \to Y$ is a $H_1$-regular immersion (automatic when $Z$ and $Y$ are smooth or even regular). This is Tag 06AE and Tag 06BA 
\end{rmk}


\begin{lemma}
Consider a commutative diagram of schemes,
\begin{center}
\begin{tikzcd}
Z' \arrow[r, "\iota'"] \arrow[d, "g"] & X' \arrow[d, "f"]
\\
Z \arrow[r, "\iota"] & X
\end{tikzcd}
\end{center}
where $\iota$ and $\iota'$ are closed embeddings. Then there is a canonical map $g^* \C_{Z/X} \to \C_{Z'/X'}$. Furthermore, suppose the diagram is cartesian i.e. $Z' = f^{-1}(Z) = Z \times_X X'$ then
\begin{enumerate}
\item $g^* \C_{Z/X} \onto \C_{Z'/X'}$ is surjective
\item if furthermore $f$ is flat then $g^* \C_{Z/X} \iso \C_{Z'/X'}$ is an isomorphism.
\end{enumerate}
\end{lemma}

\begin{proof}
Since $\iota \circ g = f \circ \iota'$ we see that $(\iota')^* (f^* \I \to \struct{X'})$ equals $g^* (\iota^* \I \to \struct{Z})$ but $\iota^* \I \to \struct{Z}$ is the zero map  so $f^* \I \to \struct{X'}$ has image contained in $\I'$ because it becomes zero after tensoring by $\iota'_* \struct{Z'} = \struct{X'} / \I'$. Therefore, we get a map $f^* \I \to \I'$ which gives a map $f^* (\I / \I^2) \to \I' / \I'^2$. Applying $(\iota')^*$ we get,
\[ (\iota')^* f^* (\I/\I^2) \to (\iota')^* (\I' /  \I'^2) \]
but $(\iota')^* (\I' /  \I'^2) = \C_{Z'/X'}$ and $(\iota')^* f^* (\I/\I^2) = g^* \iota^* (\I / \I^2) = g^* \C_{Z/X}$ so we have a map,
\[ \varphi : g^* \C_{Z/X} \to \C_{Z'/X'} \]
Now suppose the diagram is cartesian. Then $f^* \I \onto \I'$ is surjective because if $X' \to X$ is locally $\Spec{B} \to \Spec{A}$ then this map is $I \otimes_A B \to I'$ where $I' = \ker{(B \to B \otimes A / I = B / IB)} = IB$ is surjective. Therefore, taking the quotient,
\[ f^* (\I/\I^2) \onto \I' /  \I'^2 \]
is surjective and pulling back via the right-exact functor $(\iota')^*$ shows that $g^* \C_{Z/X} \onto \C_{Z'/X'}$ remains a surjection.
\bigskip\\
Finally, suppose that $f$ is flat. Then $f^*$ is an exact functor so $f^* \I \embed \struct{X}$ is injective and thus $f^* \I \iso \I'$ is an isomorphism onto its image $\I'$. Therefore, quotienting and pulling back, $g^* \C_{Z/X} \iso \C_{Z'/X'}$ is an isomorphism.
\end{proof}

\begin{cor}
Let $f : X \to S$ be a flat family. For any closed point $s \in S$ the fiber $X_s \embed X$ is a closed immersion with conormal sheaf $C_{X_s/X} = \underline{T_s^\vee S} \otimes_{\underline{\kappa(s)}} \struct{X_s}$.
\end{cor}

\begin{proof}
Consider the cartesian diagram,
\begin{center}
\begin{tikzcd}
X_s \arrow[r] \arrow[d, "g"] & X \arrow[d, "f"]
\\
\Spec{\kappa(s)} \arrow[r] & S
\end{tikzcd}
\end{center}
where $f$ is flat by assumption. Then by the lemma, $\C_{X_s/X} = g^* \C_{s/S}$. However, $\C_{s/S} = \m_s / \m_s^2 = T_s^\vee S$ as a $\kappa(s)$-module. Therefore, 
\[ \C_{X_s / X} = g^* (T_s^\vee S) = \underline{T_s^\vee S} \otimes_{\underline{\kappa(s)}} \struct{X_s} \]
because for any $\kappa(s)$-module $M$ on $\Spec{\kappa(s)}$ we know that $f^{-1} M = \underline{M}$ is the constant sheaf as a $\underline{\kappa(s)}$-module. 
\end{proof}

\begin{lemma}
Let $\iota : Z \embed X$ be a closed embedding of schemes over $S$. Then there is an exact sequence of $\struct{Z}$-modules,
\begin{center}
\begin{tikzcd}
\C_{Z/X} \arrow[r] & \iota^* \Omega_{X/S} \arrow[r] & \Omega_{Z/S} \arrow[r] & 0
\end{tikzcd}
\end{center}
which is exact on the left if $Z \to S$ is smooth.
\end{lemma}

\begin{proof}
This follows from the exact sequence for rings $R \to A \to B$ where $B = A / I$,
\begin{center}
\begin{tikzcd}
I/I^2 \arrow[r] & \Omega_{A/R} \otimes_A B \arrow[r] & \Omega_{B/R} \arrow[r] & 0
\end{tikzcd}
\end{center}
\end{proof}

\renewcommand{\X}{\mathfrak{X}}

\begin{cor}
Let $f : \X \to S$ be a flat family of schemes and $s \in S$ a closed point such that the fiber $X = \X_s$ is smooth over $\Spec{\kappa(s)}$ then there is an exact sequence of $\struct{X}$-modules,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \underline{T_s^\vee S} \otimes_{\underline{\kappa(s)}} \struct{X} \arrow[r] & \Omega_{\X}|_{X} \arrow[r] & \Omega_{X} \arrow[r] & 0
\end{tikzcd}
\end{center}
Furthermore, dualizing there is an exact sequence of $\struct{X}$-modules,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \T_{X} \arrow[r] & \T_{\X/k}|_{X} \arrow[r] & \underline{T_{s} S} \otimes_{\underline{\kappa(s)}} \struct{X} \arrow[r] & 0
\end{tikzcd}
\end{center}
\end{cor}

\begin{proof}
Since $X \to \Spec{\kappa(s)}$ is smooth the conormal sequence is exact on the left and the conormal sheaf is $\C_{X/\X} = \underline{T_s^\vee S} \otimes_{\underline{\kappa(s)}} \struct{X}$. Then apply the functor $\shHom{\struct{X}}{-}{\struct{X}}$ which gives,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \T_{X} \arrow[r] & \T_{\X}|_{X} \arrow[r] & \underline{T_{X}} \otimes_{\underline{\kappa(s)}} \struct{X} \arrow[r] & \shExt{1}{\struct{X}}{\T_{X}}{\struct{X}} 
\end{tikzcd}
\end{center}
But since $X \to \Spec{\kappa(s)}$ is smooth, $\T_{X}$ is finite locally free so $\shExt{1}{\struct{X}}{\T_{X}}{\struct{X}} = 0$ giving the desired sequence. Note that we have used,
\[ \shHom{\struct{X}}{\underline{T_s^\vee S} \otimes_{\underline{\kappa(s)}} \struct{X}}{\struct{X}} = \shHom{\underline{\kappa(s)}}{\underline{T_s^\vee S}}{\struct{X}} = \underline{T_s S} \otimes_{\underline{\kappa(s)}} \struct{X} \]
\end{proof}

\begin{prop}
Let $f : \X \to S$ be a flat family of schemes over $\Spec{k}$ and $s \in S$ a closed point such that the fiber $X = \X_s$ is smooth. There is a canonical map $T_s S \to H^1(X, \T_{X})$ giving an infinitesimal deformation of the fiber $X$ along a tangent direction $v \in T_s S$.
\end{prop}

\begin{proof}
Using the above exact sequence, applying the cohomology exact sequence there is a connecting map, $\delta : H^0(X, \underline{T_s S} \otimes_{\underline{\kappa(s)}} \struct{X}) \to H^1(X, \T_{X})$. Furthermore,
\[ H^0(X, \underline{T_s S} \otimes_{\underline{\kappa(s)}} \struct{X}) = T_s S \otimes_{\kappa(s)} H^0(X, \struct{X}) \]
Taking $1 \in H^0(X, \struct{X})$ gives an embedding,
\[ T_s S \embed T_s S \otimes H^0(X, \struct{X}) \xrightarrow{\delta} H^1(X, \T_{X}) \]
\end{proof}

\begin{rmk}
This is called the Kodaira-Spencer map. We can describe where this comes from in a number of (extremely related) ways. We can choose our tangent vector $\eta \in T_s S$ prior to the construction. This gives a map $\eta : \Spec{\kappa(s)[\epsilon]} \to S$ compatible with $s \in S$ and thus,
\begin{center}
\begin{tikzcd}
X \pullback \arrow[r] \arrow[d] & X' \pullback \arrow[r] \arrow[d] & \X \arrow[d]
\\
\Spec{\kappa(s)} \arrow[r] & \Spec{\kappa(s)[\epsilon]} \arrow[r] & S
\end{tikzcd}
\end{center}
Then the conormal sequence for $X$ in $X'$ gives,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \struct{X} \arrow[r] & \Omega_{X'}|_X \arrow[r] & \Omega_X \arrow[r] & 0
\end{tikzcd}
\end{center}
because $X$ is smooth and the conormal bundle is $\struct{X}$ by pulling back the conormal bundle $\kappa(s)$ on $\Spec{\kappa(s)}$. This sequence gives a class,
\[ \xi \in \Ext{1}{\struct{X}}{\Omega_X}{\struct{X}} = H^1(X, \T_X) \]
corresponding to the infinitessimal deformation of $X$ over $\kappa(s)$. This is actually exactly the same class that we got before. How do we actually produce this Ext class? Given the sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \struct{X} \arrow[r] & \Omega_{X'}|_X \arrow[r] & \Omega_X \arrow[r] & 0
\end{tikzcd}
\end{center}
we apply $\Hom{\struct{X}}{\Omega_X}{-}$ to get,
\begin{center}
\begin{tikzcd}
\Hom{\struct{X}}{\Omega_X}{\Omega_{X'}|X} \arrow[r] & \Hom{\struct{X}}{\Omega_X}{\Omega_X} \arrow[r, "\delta"] & \Ext{1}{\struct{X}}{\Omega_X}{\struct{X}}
\end{tikzcd}
\end{center}
and $\xi = \delta(\id)$. However, we can also apply $\Hom{\struct{X}}{-}{\struct{X}}$ to get,
\begin{center}
\begin{tikzcd}
\Hom{\struct{X}}{\Omega_{X'}|_X}{\struct{X}} \arrow[r] & \Hom{\struct{X}}{\struct{X}}{\struct{X}} \arrow[r, "\delta"] & \Ext{1}{\struct{X}}{\Omega_X}{\struct{X}}
\end{tikzcd}
\end{center}
and $\xi = \delta(\id)$ should give the same class. This is actually what we did above since 
\[ \Hom{\struct{X}}{-}{\struct{X}} = H^0(X, \shHom{\struct{X}}{-}{\struct{X}}) \]
and $\shHom{\struct{X}}{-}{\struct{X}}$ is exact on locally-free sheaves so we get an equality of derived functors,
\[ \Ext{i}{\struct{X}}{-}{\struct{X}} = H^i(X, \shHom{\struct{X}}{-}{\struct{X}}) \]
(or we can use the sheaf Ext spectral sequence) and therefore this second Ext class construction agrees with what we did previously. 
\bigskip\\
We can also describe the conormal sequence in another way. Let $k = \kappa(s)$ and $D = k[\epsilon]$ then because $\pi : X' \to D$ is smooth there is an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \pi^* \Omega_D \arrow[r] & \Omega_{X'} \arrow[r] & \Omega_{X'/D} \arrow[r] & 0 
\end{tikzcd}
\end{center}
Then pulling back under,
\begin{center}
\begin{tikzcd}
X \pullback \arrow[r, "\iota"] \arrow[d, "\bar{\pi}"] & X' \arrow[d, "\pi"]
\\
\Spec{k} \arrow[r] & \Spec{D} 
\end{tikzcd}
\end{center}
we see $\iota^* \Omega_{X'/D} = \Omega_{X/k}$ and $\iota^* \pi^* \Omega_{D/k} = \bar{\pi}*(\Omega_{D/k} \ot_D k) = \struct{X}$ since$\Omega_{D/k} \ot_D k = k$. Therefore, pulling back the sequence by $\iota$ gives,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \struct{X} \arrow[r] & \Omega_{X'}|_X \arrow[r] & \Omega_X \arrow[r] & 0
\end{tikzcd}
\end{center}
I claim this is the same sequence as before. Indeed, $\Omega_{D/k} \ot_D k$ is the conormal bundle of $\Spec{k} \embed \Spec{D}$ since $\Spec{k}$ is smooth and $\Omega_{k/k} = 0$ so from the conormal sequence, $\C_{k/D} \iso \Omega_{D/k} \ot_D k$ is an isomorphism. Furthermore, since $\pi : X' \to \Spec{D}$ is flat and the diagram is Cartesian then,
\[ \C_{X/X'} = \bar{\pi}^* \C_{k/D} = \iota^* \pi^* \Omega_{D} \]
\end{rmk}

\subsection{Relative Differentials}

\begin{prop}
Under base change,
\begin{center}
\begin{tikzcd}
X' \arrow[d, "f'"] \arrow[r, "g'"] & X \arrow[d, "f"]
\\
S' \arrow[r, "g"] & S
\end{tikzcd}
\end{center}
there is a canonical isomorphism $g'^* \Omega_{X/S} \iso \Omega_{X'/S'}$ and $\d'$ is characterized by $\d' g'^* = g'^* \d$.
\end{prop}

\begin{proof}
For any $\struct{X'}$-module $\F$ consider,
\[ \Hom{\struct{X'}}{g'^* \Omega_{X/S}}{\F} = \Hom{\struct{X}}{\Omega_{X/S}}{g'_* \F} = \Der{S}{\struct{X}}{g'_* \F} =  \Der{S'}{\struct{X'}}{\F} = \Hom{\struct{X'}}{\Omega_{X'/S'}}{\F} \]
The second to last equality holds because a derivation $\struct{X} \to g'_* \F$ over $f^{-1} \struct{S}$ is the same as a derivation $\struct{X'} \to \F$ over $f^{-1} \struct{S'}$ which can be checked locally (Tag 00RV). Therefore we get a canonical isomorphism $\Omega_{X'/S'} = g'^* \Omega_{X/S}$.
\end{proof}

\begin{prop}
Let $f : X \to S$ be a morphism of schemes and $s \in S$ a point. Then,
\[ \Omega_{X/S} |_{X_s} = \Omega_{X_s / s} \]
\end{prop}

\begin{prop}
Let $f : X \to S$ be a smooth projective family of relative dimension $r$ between noetherian schemes. Then the plurigenera,
\[ \varphi^i(s) = \dim_{\kappa(s)} H^i(X_s, \omega_{X_s}^{\otimes d}) \]
and in particular the plurigenera $p_d(X_s) = \varphi^0(s)$
are upper-semi-continuous on $S$. 
\end{prop}

\begin{proof}
Since $f$ is smooth of relative dimension $r$, the relative differentials $\Omega_{X/S}$ is locally free of rank $r$. Then consider the relative canonical bundle \[ \omega_{X/S} = \bigwedge^{r} \Omega_{X/S} \]  Since $\omega_{X/S}$ is locally free and $f : X \to S$ is flat then $\omega_{X/S}$ is flat over $S$. Therefore, by the Semicontinuity theorem,
\[ \varphi^0(s) = \dim_{\kappa(s)} H^0(X_s, \omega_{X/S}^{\otimes d}|_{X_s}) = \dim_{\kappa(s)} H^0(X_s, \omega_{X_s}^{\otimes d}) = p_d(X_s) \]
is semicontinuous.
\end{proof}

\begin{rmk}
In particular,
\[ U = \{ s \in S \mid p_d(X_s) = 0 \} \]
is open. 
\end{rmk}

\begin{theorem}
Let $f : X \to \Spec{\Z}$ be a projective flat surface (i.e. relative dimension $2$). If $X_\Q$ is smooth and unirational then $X_{\mathbb{F}_p}$ is rational for all but finitely many $p$.
\end{theorem}

\begin{proof}
First, a dominant rational map $\P^2_\Q \rat X_\Q$ is generically \etale and thus $H^0(X_\Q, \omega_{X_\Q}^{\otimes 2}) = 0$. Furthermore, 
\[ H^1(X_\Q, \struct{X_\Q}) = H^0(X_\Q, \Omega^1_{X_\Q}) = 0 \] 
by Hodge theory on $X_{\mathbb{C}}$. Therefore, by Castelnuovo, $X_\Q$ is rational. We can take a dense open $U \subset \Spec{\Z}$ such that $X_U \to  U$ is smooth and then the locus on which $p_2(X_s) = 0$ and $H^1(X_s, \struct{X_s}) = 0$ is open by Semicontinuity and contains the generic point so dense. Finally, dense opens of $\Spec{\Z}$ are cofinite proving the theorem because the fibers $X_{\mathbb{F}_p}$ over $p \in U$ are rational by Castelnuovo. 
\end{proof}

(IS THERE AN EASIER PROOF? DOES THE CONVERSE WORK?)

\begin{theorem}
Let $f : X \to \Spec{\Z}$ be a projective flat surface (i.e. relative dimension $2$). If there exists a prime $p \in \Spec{\Z}$ such that $X_{\mathbb{F}_p}$ is smooth and rational. Then $X_{\Q}$ is smooth and rational and $X_{\mathbb{F}_q}$ is smooth and rational for all but finitely many $q$.
\end{theorem}

\begin{proof}
Because $f$ is flat and proper with a smooth fiber, there is a dense open $U \subset \Spec{\Z}$ such that $X_U \to U$ is smooth and proper. Furthermore, the locus on which $p_2(X_s) = 0$ and $H^1(X_s, \struct{X_s}) = 0$ is open and nonempty (containing $p$) so it contains $\Q$ and all but finitely many primes.
\end{proof}

(CAN WE USE SPREADING OUT?)

\section{Six Functors}

\newcommand{\dtensor}{\otimes^{\mathbb{L}}}
\newcommand{\RHom}[3]{\mathrm{R}\shHom{#1}{#2}{#3}}

Given a morphism of schemes $f : X \to Y$ there are six functors on the derived categories of \etale sheaves with constructible cohomology,
\begin{enumerate}
\item $R f_* : D^c(X) \to D^c(Y)$
\item $L f_! : D^c(X) \to D^c(Y)$
\item $L f^* : D^c(Y) \to D^c(X)$
\item $R f^! : D^c(X) \to D^c(Y)$
\item $- \dtensor - : D^c(X) \times D^c(X) \to D^c(X)$
\item $\RHom{X}{-}{-} : D^c(X)^\op \times D^c(X) \to D^c(X)$
\end{enumerate}
such that there are adjunctions: $f^* \dashv f_*$ and $R f_! \dashv R f^!$ and,
\[ \RHom{X}{A \dtensor B}{C} = \RHom{X}{A \dtensor}{\RHom{X}{B}{C}} \]
This is the setting for Verdier duality,
\[ R f_* \RHom{X}{\F}{ R f^! \G} = \RHom{Y}{Rf_! \F}{\G} \]
I want to understand these functors in some settings. By factorsing,
\begin{center}
\begin{tikzcd}
X \arrow[r, hook, "j"] \arrow[rd, "f"] & \tilde{X} \arrow[d, "\tilde{f}"] 
\\
& Y
\end{tikzcd}
\end{center}
we get $f_! = \tilde{f}_* \circ j_!$ and $R f_! = R \tilde{f}_* \circ j_!$. Now furthermore in the following situations:
\begin{enumerate}
\item $f : U \to X$ is an open embedding then $f_!$ is extension by zero and $R f^!$ comes from a functor $f^! = f^*$
\item $f : X \to Y$ is proper then $f_! = f_*$ and $R f^!$
\item $f : Z \embed X$ is a closed embedding then $f^! $
\item $f : X \to Y$ is smooth of relative dimension $d$. Then $R f^!(\F[0]) = f^* \F(d) [2 d]$
\end{enumerate}

\section{Locally Free Resolutions}

\begin{prop}
Let $X$ be a Noetheran regular scheme with an ample line bundle $\L$. Then for any coherent $\struct{X}$-module $\F$ there exists a finite locally free resolution,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \E_{d} \arrow[r] & \cdots \arrow[r] & \E_1 \arrow[r] & \E_0 \arrow[r] & \F \arrow[r] & 0
\end{tikzcd}
\end{center}
where $d = \dim{X}$.
\end{prop}

\begin{proof}
Since $\L$ is ample there is an $n$ such that $\F \otimes_{\struct{X}} \L^{\otimes n}$ is globally generated. Since $\F$ is coherent we may choose finitely many which generate giving a surjection, $(\L^\vee)^{\oplus n} \onto \F$. Let $\E_0 = (\L^\vee)^{\oplus n}$ then take $\F_1 = \ker{(\E_0 \to \F)}$ which is also coherent because $X$ is Noetherian. Therefore, repeating this process gives an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \F_{d} \arrow[r] & \cdots \arrow[r] & \E_1 \arrow[r] & \E_0 \arrow[r] & \F \arrow[r] & 0
\end{tikzcd}
\end{center}
Localizing at $x \in X$ we get a resolution,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & (\F_{d})_x \arrow[r] & \cdots \arrow[r] & (\E_1)_x \arrow[r] & (\E_0)_x \arrow[r] & \F_x \arrow[r] & 0
\end{tikzcd}
\end{center}
of the $\stalk{X}{x}$-module $\F_x$ by finite free modules $(\E_k)_x$. Since $\stalk{X}{x}$ is regular and $(\F_d)_x$ is a finite $\stalk{X}{x}$-module, by (REFERENCE), we find that $(\F_d)_x$ is finite free. Furthermore, since $\F_d$ is coherent it is finite locally free and thus we conclude by setting $\E_d = \F_d$.
\end{proof}

\section{Finitely Presented Modules}

\begin{prop}
Consider an exact sequence of $R$-modules,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & M_1 \arrow[r] & M_2 \arrow[r] & M_3 \arrow[r] & 0
\end{tikzcd}
\end{center}
where $M_3$ is finitely presented and $M_2$ is finitely generated. Then $M_1$ is finitely generated.
\end{prop}

\begin{proof}
First we prove this when $M_2$ is projective. We know there exists a finite presentation,
\begin{center}
\begin{tikzcd}
R^{\oplus m} \arrow[r] & R^{\oplus n} \arrow[r] & M_3 \arrow[r] & 0
\end{tikzcd}
\end{center} 
and therefore $K = \ker{(R^{\oplus n} \to M_3)}$ is finitely generated. Furthermore, since $R^{\oplus n}$ and $M_2$ are projective, by Schanuel's lemma we see that $K \oplus M_2 \cong R^{\oplus n} \oplus M_1$. However, $K$ and $M_2$ are finitely generated so $R^{\oplus n} \oplus M_1$ must also be finitely generated and $R^{\oplus n} \oplus M_1 \onto M_1$ proving that $M_1$ is finitely generated as well. Now we consider the general case. Since $M_2$ is finitely generated, there is a map $R^{\oplus n} \onto M_2$ then form a diagram,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & K \arrow[r] \arrow[d, dashed] & R^{\oplus n} \arrow[r] \arrow[d] & M_3 \arrow[d, equals] \arrow[r] & 0
\\
0 \arrow[r] & M_1 \arrow[r] & M_2 \arrow[r] & M_3 \arrow[r] & 0
\end{tikzcd}
\end{center}
By the previous argument $K$ is finitely generated. Furthermore, the right two vertical maps are surjective so $K \onto M_1$ and thus $M_1$ is finitely generated. 
\end{proof}

\begin{rmk}
See \href{https://math.stackexchange.com/questions/1201049/is-the-kernel-of-a-map-to-a-finitely-presented-module-finitely-generated}{kernel-of-map-to-finitely-presented} and \href{https://mathoverflow.net/questions/1788/does-finitely-presented-mean-always-finitely-presented-answered-yes}{always-finitely-presented} for more proofs and \href{https://stacks.math.columbia.edu/tag/0517}{Tag 0517} for a full discussion. 
\end{rmk}

\section{Incidence Correspondences}

\begin{defn}
Let $V$ be a $k$-vectorspace. The polynomial algebra over $V$ is the graded $k$-algebra,
\[ \mathrm{Poly}(V) = \Sym{k}{V^*} \]
Then the geometric vectorspace is the $k$-variety,
\[ \mathbb{V}(V) = \Spec{\mathrm{Poly}(V)} \]
If $V$ is has finite dimension $n$ then there is a noncanical isomorphism $\mathbb{V}(V) \cong \A^n_k$.
\end{defn}

\begin{rmk}
Since taking polynomial algebras is contravariant, we see that $V \mapsto \mathbb{V}(V)$ is covariant as it should be.
\end{rmk}

\begin{defn}
Let $V$ be a $k$-vectorspace. Then $\P(V) := \Proj{\mathrm{Poly}(V)}$. 
\end{defn}

\begin{rmk}
We have the following properties of $\P(V)$,
\begin{enumerate}
\item $H^0(\P(V), \struct{\P(V)}(d)) = \mathrm{Sym}^d(V^*)$
\item there is a canonical surjection $V^* \otimes \struct{\P(V)} \onto \struct{\P(V)}(1)$.
\item morphisms $X \to \P(V)$ correspond to surjections $V^* \otimes \struct{X} \onto \L$ where $\L$ is a line bundle up to isomorphism,
\begin{center}
\begin{tikzcd}
V^* \otimes \struct{X} \arrow[r] \arrow[d, equals] & \L \arrow[r] \arrow[d, "\sim"] & 0
\\
V^* \otimes \struct{X} \arrow[r] & \L' \arrow[r] & 0
\end{tikzcd}
\end{center}
\item if $W \subset V$ then $\P(W) \subset \P(V)$ is a closed linear embedding
\item $\P(V)(\Spec{k})$ is given by surjections $V^* \onto k$ up to isomorphism i.e. lines $k \subset V$. If we choose a basis $x_1, \dots, x_n$ of $V^*$ then $V^* \onto k$ gives values for $x_1, \dots, x_n \in k$ up to total scaling which we write as $[x_1 : \dots : x_n]$.
\end{enumerate} 
\end{rmk}
\noindent
The first example of a incidence correspondence is the total space of the projectivized tautological bundle. We usually describe this as,
\[ Z = \{ (x, H) \mid x \in H \subset \P^n \} \subset \P^n \times \check{\P}^n \]
We can describe this rigorously as follows. Let $V$ be a $k$-vectorspace. Take the canonical element $\id \in V^* \otimes V \cong \Hom{k}{V}{V}$. This defines a section $s_{\id}$ of $\struct{\P(V)}(1) \boxtimes \struct{\P(V^*)}(1)$ on $\P(V) \times \P(V^*)$. Then I claim that,
\[ Z = V(s_{\id}) \subset \P(V) \times \P(V^*) \]
A $k$-point $x \in \P(V^*)$ is given by a hyperplane $V \onto k$ then the fiber $Z_x \subset \P(V)$ is cut out by the image of $s_\id$ under $V^* \otimes V \to V^* \otimes k = V^*$ which cuts out the hyperplane of $\P(V)$ because $s_x$ vanishes on a line $k \subset V$ if $\id \in \Hom{k}{V}{V}$ maps to zero in $\Hom{k}{k}{k}$ under $k \embed V \onto k$ meaning the line is contained in the hyperplane.
\bigskip\\
If we choose a basis $x_1, \dots, x_n$ for $V$ and $y_1, \dots, y_n$ is the dual basis of $V^*$ then,
\[ s_\id = y_1 \otimes x_1 + \cdots + y_n \otimes x_n \]
Consider a point $x \in \P(V^*)$ then the fiber $Z_x \subset \P(V) \times \Spec{\kappa(x)}$ is cut out by,
\[ s_x = y_1 \otimes a_1 + \cdots + y_n \otimes a_n \]
where $x = [a_1 : \dots : a_n]$ which defines the hyperplane represented by $x$. 

\subsection{Incidence Correspondence for Linear Systems}

Given a map $f : X \to \P(V)$ we are interested in the family of hyperplane sections. This is the following incidence correspondence,
\[ Z_f = \{ (x, H) \mid x \in X, f(x) \in H, H \subset \P(V) \} \subset X \times \P(V^*) \]
We can describe this scheme directly as the pullback,
\begin{center}
\begin{tikzcd}[row sep = large, column sep = large]
Z_f \pullback \arrow[d] \arrow[r] & Z  \arrow[d]
\\
X \arrow[r, "f"] & \P(V)
\end{tikzcd}
\end{center}
By base change, we get a closed immersion $Z_f \subset X \times \P(V^*)$. Furthermore, maps $\Spec{k} \to Z_f$ correspond to via the diagram,
\[ Z_f(k) = \{ (x,y,H) \mid x \in X(k), y \in \P(k), H \in \P^*(k) \text{ such that } f(x) = y \text{ and } y \in H \} \] 
Since $Z_f \subset X \times \P(V^*)$ we can consider the projection $Z_f \to \P(V^*)$ whose fibers over $x \in \P(V^*)$ are given by the diagram, 
\begin{center}
\begin{tikzcd}[row sep = large, column sep = large]
(Z_f)_x \pullback \arrow[d, hook] \arrow[r] & Z_x \pullback \arrow[r] & \Spec{\kappa(x)} \arrow[d, hook]
\\
Z_f \pullback \arrow[d] \arrow[r] & Z  \arrow[d] \arrow[r] & \P(V^*) 
\\
X \arrow[r, "f"] & \P(V)
\end{tikzcd}
\end{center}
Since the top two squares are cartesian, the upper rectangle is also cartesian so $(Z_f)_x$ is the fiber of $Z_f \to \P(V^*)$ over $\Spec{\kappa(x)} \to \P(V^*)$. Furthermore, the left rectange is cartesian so $(Z_f)_x$ is the pullback of $Z_x$ under $f$ and $Z_x \subset \P(V)$ is a hyperplane so $(Z_f)_x$ is a hyperplane section.
\bigskip\\
In particular, we get a family $Z_f \to \P(V^*)$ whose fibers are the hyperplane sections with a projection $Z_f \to X$ including these fibers. 

\subsection{Incidence Correspondence in Higher Degrees}


\subsection{Incidence Correspondence For Projective Bundles}

We can play the same game with projective bundles. 

\begin{defn}
Let $X$ be a scheme and $\E$ be a locally free $\struct{X}$-module. The polynomial algebra over $\E$ is the graded $\struct{X}$-algebra,
\[ \mathrm{Poly}(\E) = \shSym{X}{\E^\vee} \]
Then the geometric vector bundle is,
\[ \mathbb{V}(\E) = \rSpec{X}{\mathrm{Poly}(\E)} \]
\end{defn}

\begin{rmk}
Since taking polynomial algebras is contravariant, we see that $\E \mapsto \mathbb{V}(\E)$ is covariant as it should be.
\end{rmk}

\begin{defn}
Let $X$ be a scheme and $\E$ be a locally free $\struct{X}$-module. Then the projective bundle of $\E$ is,
\[ \P(V) := \rProj{X}{\mathrm{Poly}(\E)} \]
\end{defn}

\begin{rmk}
We have the following properties of $\pi : \P(\E) \to X$,
\begin{enumerate}
\item there is a canonical line bundle $\struct{\P(\E)}(1)$ and exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \Omega_{\P(\E)/X}(1) \arrow[r] & \pi^* \E^\vee \arrow[r] & \struct{\P(E)}(1) \arrow[r] & 0
\end{tikzcd}
\end{center}
or equivalently,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \struct{\P(\E)}(-1) \arrow[r] & \pi^* \E \arrow[r] & \T_{\P(\E)/X}(-1) \arrow[r] & 0
\end{tikzcd}
\end{center}
making $\struct{\P(\E)}(-1)$ is the tautological bundle and $\T_{\P(\E)/X}(-1)$ is the tautological quotient
\item $\pi_* \struct{\P(V)}(d) = \mathrm{Sym}^d(\E^\vee)$
\item let $f : T \to  X$ be an $X$-scheme, morphisms $T \to \P(\E)$ over $X$ correspond to surjections $f^* \E^\vee \onto \L$ where $\L$ is a invertible $\struct{T}$-module or equivalently $\L^\vee \subset \E$ is a line subbundle up to the equivalence,
\begin{center}
\begin{tikzcd}
f^* \E^\vee \arrow[r] \arrow[d, equals] & \L \arrow[r] \arrow[d, "\sim"] & 0
\\
f^* \E^\vee \arrow[r] & \L' \arrow[r] & 0
\end{tikzcd}
\end{center}
such that $T \to \P(\E)$ pulls back $\struct{\P(\E)}(1)$ to $\L$ and $\struct{\P(\E)}(-1)$ to $\L^\vee$
\item The $k$-points are,
\[ \P(\E)(k) = \{ (x, \ell) \mid x \in X(k) \text{ and } \ell \subset \E_x \otimes \kappa(x) \} \]
which are $k$-points of $X$ and lines in the fiber of $\E$
\item if $\E_1 \subset \E_2$ then $\P(\E_1) \subset \P(\E_2)$ is a closed linear embedding given by $\pi_1^* \E_2^\vee \onto \pi_1^* \E_1^\vee \onto \struct{\P(\E_1)}(1)$
\end{enumerate} 
\end{rmk}
\noindent
For a locally-free $\struct{X}$-module on $X$, there is an incidence correspondence which is the total space of the projectivized tautological bundle. We usually describe this as,
\[ Z = \{ (x, \ell, H) \mid x \in X, \ell \subset \E_x \otimes \kappa(x), H \subset \E_x \otimes \kappa(x), \ell \subset H \} \subset \P(\E) \times_X \P(\E^\vee) \]
We can describe this rigorously as follows. Take the canonical element,
\[ \id \in \shHom{\struct{X}}{\E}{\E} = \E^\vee \otimes_{\struct{X}} \E \]
This defines a section $s_{\id}$ of $\struct{\P(\E)}(1) \boxtimes \struct{\P(\E^\vee)}(1)$ on $\P(\E) \times_X \P(\E^\vee)$. Then I claim that,
\[ Z = V(s_{\id}) \subset \P(\E) \times_X \P(\E^\vee) \]
Then the fiber of $Z \to X$ over $x \in X$ is the incidence correspondence for $V = \E_x \otimes \kappa(x)$ and thus the points correspond to lines contained in hyperplanes in the fibers of $\E$. Furthermore, the fibers of $Z \to \P(V^*)$ over a point $(x, H) \in \P(\E)$ is a line $\ell \subset \E_x \otimes \kappa(x)$ contained in the hyperplane $H$.
\bigskip\\
Given an $X$-morphism $f : Y \to \P(\E)$ we can form the pullback, 
\begin{center}
\begin{tikzcd}[row sep = large, column sep = large]
Z_f \pullback \arrow[d] \arrow[r] & Z  \arrow[d]
\\
Y \arrow[r, "f"] & \P(\E)
\end{tikzcd}
\end{center}
giving the ``family of hyperplane sections'' $Z_f \to \P(\E^\vee)$ over $X$ with a projection $Z_f \to Y$. Explicitly, the fibers of $Z_f \to \P(\E^\vee)$ over $(x, H) \in \P(\E^\vee)$ is the hyperplane section of the fiber $Y_x$ of the hyperplane $H$ through the map $Y_x \to \P(\E_x \otimes \kappa(x))$ 

\subsection{General Pencil Contains How Many Tangent Points to a Fixed Curve}

Question: fix a plane curve $C \subset \P^2$ of degree $e$, how many elements of a general pencil of degree $d$ curves are tangent to $C$ (or actcually we ask how many tangency points are there). 
\bigskip\\
Let $\L = \struct{\P^2}(d)$ and $V \subset H^0(\P^2, \struct{\P^2}(d))$ be a general pencil. Then consider the inclusion $\iota : C \embed \P^2$ and $\L = \iota^* \struct{\P^2}(d)$. Because the pencil is general, the pullback $\iota^* V \subset H^0(C, \L)$ is two dimensional. Furthermore, the base locus $\mathrm{Bl}(V)$ has $d^2$ points so if $C$ and $V$ are in general position then $\iota^* V$ is basepoint-free. Therefore, we get a map $f : C \to \P^1$ and the curves tangent to $C$ are those whose vanishing locus is nonreduced and thus correspond to ramification points of $f : C \to \P^1$. Since $\deg{f} = \deg{\L} = de$ and $g(C) = \tfrac{1}{2} (e-1)(e-2)$ so by Riemann-Hurwitz,
\[ R = e^2 - 3 e + 2 de \]
which gives the number of tangent points (counted in an odd way). 

\section{Automorphisms of Functors}

\begin{defn}
Let $F : \C \to \D$ be a functor. Then $\End{F}$ is the monoid of natural transformations $\eta : F \implies F$ and $\Aut{F}$ is the group invertible elements i.e natural isomorphisms.
\end{defn}

\begin{lemma}
Given a commutative diagram of functors,
\begin{center}
\begin{tikzcd}
\C_1 \arrow[rr, "\alpha"] \arrow[rd, "F_1"'] & & \C_2 \arrow[ld, "F_2"]
\\
& \D
\end{tikzcd}
\end{center}
there is a monoid map $\alpha^* : \End{F_2} \to \End{F_1}$ and thus a group map $\alpha^* : \Aut{F_2} \to \Aut{F_1}$.
\end{lemma}

\begin{proof}
Let $\eta : F_2 \implies F_2$ be a natural transformation. Consider $\eta \circ \alpha : F_2 \circ \alpha \implies F_2 \circ \alpha$ defined by $(\eta \circ \alpha)_{X} = \eta_{\alpha(X)}$ as an endomorphism of $(F_2 \circ \alpha)(X) = F_2(\alpha(X))$. Note that $F_1 = F_2 \circ \alpha$ defining a map $\alpha^* : \End{F_2} \to \End{F_1}$. Given $\eta, \delta \in \End{F_2}$ consider,
\[ [(\eta * \delta) \circ \alpha]_{X} = (\eta * \delta)_{\alpha(X)} = \eta_{\alpha(X)} \circ \delta_{\alpha(X)} = (\eta \circ \alpha)_{X} \circ (\delta \circ \alpha)_{X} = [(\eta \circ \alpha) * (\delta \circ \alpha)]_X \]
Therefore, $\alpha^* : \eta \mapsto \eta \circ \alpha$ is a monoid homomorphism.
\end{proof}

\begin{lemma}
Given a commutative diagram of functors,
\begin{center}
\begin{tikzcd}
\C_1 \arrow[r, "\alpha_1"] \arrow[rd, "F_1"'] & \C_2 \arrow[d, "F_2"] \arrow[r, "\alpha_2"] & \C_3 \arrow[ld, "F_3"]
\\
& \D
\end{tikzcd}
\end{center}
we find that $(\alpha_2 \circ \alpha_1)^* = \alpha_1^* \circ \alpha_2^*$ as maps $\End{F_3} \to \End{F_1}$. Therefore, we a get (contravariant) functors $\mathrm{End} : \mathbf{Cat}^{\op}_{\D} \to \mathrm{Mon}$ and $\mathrm{Aut} : \mathbf{Cat}^{\op}_{\D} \to \Grp$ where $\mathbf{Cat}_{\D}$ is the category of categories over $\D$ i.e. functors $F : \C \to \D$.
\end{lemma}

\begin{proof}
It is clear that,
\[ (\alpha_2 \circ \alpha_1)^* \eta = \eta \circ (\alpha_2 \circ \alpha_1) = (\eta \circ \alpha_2) \circ \alpha_1 = \alpha_1^* (\alpha_2^* \eta) = (\alpha_1^* \circ \alpha_2^*) \eta \]
\end{proof}

\begin{prop}
Given the above situation,
\begin{enumerate}
\item if $\alpha$ is esssentially surjective then $\alpha^*$ is injective
\item if $\alpha$ is fully faithfull then $\alpha^*$ is surjective
\item if $\alpha$ is an equivalence then $\alpha^*$ is an isomorphism
\end{enumerate}
\end{prop}

\begin{proof}
Suppose that $\alpha$ is essentially surjective. Given any $Y \in \C_2$ we choose a $X \in \C_1$ and an isomorphism $\varphi : \alpha(X) \iso Y$. Suppose that $\eta \circ \alpha = \delta \circ \alpha$ then consider the diagram,
\begin{center}
\begin{tikzcd}
F_2(\alpha(X)) \arrow[d, "\eta_{\alpha(X)}"'] \arrow[r, "F_2(\varphi)"] & F_2(Y) \arrow[d, "\eta_{Y}"]
\\
F_2(\alpha(X)) \arrow[r, "F_2(\varphi)"] & F_2(Y)
\end{tikzcd}
\end{center} 
Therefore,
\begin{align*}
\eta_Y & = F_2(\varphi) \circ \eta_{\alpha(X)} \circ F_2(\varphi)^{-1}
\\
\delta_Y & = F_2(\varphi) \circ \delta_{\alpha(X)} \circ F_2(\varphi)^{-1}
\end{align*} 
and furthermore $\eta_{\alpha(X)} = \delta_{\alpha(X)}$ and thus $\eta_Y = \delta_Y$. Therefore $\eta = \delta$.
\bigskip\\
Suppose that $\alpha$ is fully faithful. Given any $\delta \in \End{F_1}$. The collection $\delta_X : F_1(X) \to F_1(X)$ defines a collection $\eta_{\alpha(X)} : F_2(\alpha(X)) \to F_2(\alpha(X))$. We need to show that $\eta$ can be extended to a natural transformation. First, on the image of $\alpha$ we know,
\[ \alpha : \Hom{\C_1}{X_1}{X_2} \iso \Hom{\C_2}{\alpha(X_1)}{\alpha(X_2)} \]
and therefore, for any $\varphi : \alpha(X_1) \to \alpha(X_2)$ we can lift to $\varphi' : X_1 \to X_2$ and thus,
\begin{center}
\begin{tikzcd}
F_2(\alpha(X_1)) \arrow[d, "\eta_{\alpha(X_1)}"'] \arrow[r, "F_2(\varphi)"] & F_2(\alpha(X_2)) \arrow[d, "\eta_{\alpha(X_2)}"]
\\
F_2(\alpha(X_1)) \arrow[r, "F_2(\varphi)"] & F_2(\alpha(X_2))
\end{tikzcd}
\end{center} 
because this is the same diagram as,
\begin{center}
\begin{tikzcd}
F_1(X_1) \arrow[d, "\delta_{X_1}"'] \arrow[r, "F_1(\varphi')"] & F_1(X_2) \arrow[d, "\delta_{X_2}"]
\\
F_1(X_1) \arrow[r, "F_1(\varphi')"] & F_1(X_2)
\end{tikzcd}
\end{center}
which we know commutes because $\delta$ is a natural transformation. 
\end{proof}

\section{The Meaning of Etale Local}

\begin{defn}
A morphism $f : X \to Y$ \etale-locally on the target has a propety $\mathcal{P}$ if for each $x \in Y$ there exists an \etale neighborhood $U \to Y$ such that $f' : X_U \to U$ has property $\mathcal{P}$ where,
\begin{center}
\begin{tikzcd}
X_U \arrow[r, "f_U"] \arrow[d] & U \arrow[d]
\\
X \arrow[r, "f"] & Y
\end{tikzcd}
\end{center}
Note that $X_U \to X$ is also an \etale neighborhood of the fiber $f^{-1}(x)$.
\end{defn}

\begin{defn}
A morphism $f : X \to Y$ \etale-locally on the source has a propety $\mathcal{P}$ if for each $x \in X$ there exists an \etale neighborhood $U \to X$ such that $f' : U \to X \to Y$ has property $\mathcal{P}$.
\end{defn}

\begin{defn}
We say a propety $\mathcal{P}$ of morphisms is,
\begin{enumerate}
\item \etale-local on the source if for any \etale cover $\{ U_i \to X \}$ 
\[ X \to Y \text{ has } \mathcal{P} \iff \forall i : U_i \to X \to Y \text{ has } \mathcal{P} \]
\item \etale-local on the target if for any \etale cover $\{ V_i \to Y \}$ 
\[ X \to Y \text{ has } \mathcal{P} \iff \forall i : X_{V_i} \to V_i \text{ has } \mathcal{P} \]
\end{enumerate}
\end{defn}

\begin{rmk}
If $\cP$ is \etale-local on the source/target and $f : X \to Y$ has $\cP$ \etale-locally on the source/target then $f$ has $\cP$.
\end{rmk}

\begin{defn}
A morphism $f : X \to Y$ has $\cP$ \etale-locally if for each $x \in X$ there exists,
\begin{center}
\begin{tikzcd}
U \arrow[r, "f'"] \arrow[d] & V \arrow[d]
\\
X \arrow[r, "f"] & Y
\end{tikzcd}
\end{center}
where $U \to X$ and $V \to Y$ are \etale neighborhoods of $x$ and $f(x)$ and $f'$ has $\cP$.
\end{defn}

\begin{defn}
A property $\cP$ of moprhisms is \etale-local if 
\begin{enumerate}
\item if $X \to Y$ has $\cP$ and $Y' \to Y$ is \etale then $X \times_Y Y' \to Y'$ is \etale
\item if $X \to Y$ has $\cP$ and $X' \to X$ is \etale then $X' \to X \to Y$ has $\cP$
\item having $\cP$ and having $\cP$ \etale-locally are equivalent
\end{enumerate}
\end{defn}

\begin{lemma}
Let $\cP$ be \etale-local. Then
\begin{enumerate}
\item $\cP$ is \etale-local on the source
\item $\cP$ is \etale-local on the target
\item if $f : X \to Y$ has $\cP$ and $g : Y \to Y'$ is \etale then $X \to Y \to Y'$ has $\cP$ 
\item if $f : X \to Y$ and $g : Y \to Z$ are \etale and $g \circ f$ has $\cP$, then $f$ has $\cP$.
\end{enumerate}
\end{lemma}

\begin{proof}
See Tag 04R0.
\end{proof}

\begin{rmk}
Unfortunately \etale-local is not the same as \etale-local on the source and \etale-local on the target (see Tag 04QW) it is, in general, stronger.
\end{rmk}

\subsection{Examples}

\begin{prop}
An \etale morphism $f : X \to Y$ admits a section \etale-locally on the target.
\end{prop}

\begin{proof}
Consider the diagram,
\begin{center}
\begin{tikzcd}
X \times_Y X \arrow[d] \arrow[r, "\pi"] & X \arrow[d, "f"] 
\\
X \arrow[r, "f"] & Y 
\end{tikzcd}
\end{center}
Then the diagonal $\Delta_{X/Y} : X \to X \times_Y X$ is a section of $\pi : X \times_Y X \to X$ because $\pi \circ \Delta_{X/Y} = \id_X$.
\end{proof}

\begin{prop}
An \etale morphism $f: X \to Y$ is an isomorphism \etale-locally.
\end{prop}

\begin{proof}
Consider the obvious diagram,
\begin{center}
\begin{tikzcd}
X \arrow[r, "\id"] \arrow[d,"\id"'] & X \arrow[d, "f"]
\\
X \arrow[r, "f"'] & Y 
\end{tikzcd}
\end{center}
where the vertical maps are surjective and \etale and $\id : X \to X$ is obviously an isomorphism.
\end{proof}

\begin{prop}
A smooth map $f : X \to Y$ is \etale-locally isomorphic to $\A^d_R \to \Spec{R}$.
\end{prop}

\begin{proof}
By Tag 01V7, for each $x \in X$ there are affine opens $U \subset X$ and $V \subset Y$ with $x \in U$ and $f(U) \subset V$ such that $f|_U : U \to V$ is standard smooth i.e. isomorphic to,
\[ \Spec{R[x_1, \dots, x_n]/(f_1, \dots, f_c)} \to \Spec{R} \]
where $R[x_{c+1}, \dots, x_n] \to R[x_1, \dots, x_n]/(f_1, \dots, f_c)$ is standard \etale. Therefore, we get a diagram,
\begin{center}
\begin{tikzcd}
X \arrow[dd, "f"'] & U \arrow[dd] \arrow[l, hook]  \arrow[dr, "\mathrm{etale}"]
\\
& & \A_V^d \arrow[dl, "\mathrm{projection}"]
\\
Y & V \arrow[l, hook] 
\end{tikzcd}
\end{center}
using the factorization,
\begin{center}
\begin{tikzcd}
R \arrow[r] \arrow[rd] & R[x_{c+1}, \dots, x_n] \arrow[d]
\\
& R[x_1, \dots, x_n]/(f_1, \dots, f_c)
\end{tikzcd}
\end{center}
\end{proof}

\begin{prop}
Let $X, Y$ be a $k$-varieties of dimension $n$ and $x \in X$ and $y \in Y$ smooth points. Then $x$ and $y$ have an isomorphic \etale neighborhood.
\end{prop}

\begin{proof}
Because $X \to \Spec{k}$ and $Y \to \Spec{k}$ are smooth at $x$ any $y$ respectively, there are open neighborhoods $U \subset X$ and $V \subset Y$ with \etale $k$-maps $U \to \A^n_k$ and $V \to \A^n_k$. Then consider,
\begin{center}
\begin{tikzcd}
U \times_{\A_k^n} V \arrow[r, "\et"] \arrow[d, "\et"'] & V \arrow[d, "\et"]
\\
U \arrow[r, "\et"'] & \A^n_k
\end{tikzcd}
\end{center}
Therefore, $U \times_{\A_k^n} V$ is an \etale cover of both $U$ and $V$ and therefore an \etale neighborhood of both $x$ and $y$.
\end{proof}


\section{Cech Cohomology of $G$-covers}

\begin{thm}
Let $Y \to X$ be a $G$-cover in the $\tau$-topology where $G$ is a finite group. Then, for any sheaf $\F$ on $X_{\tau}$ we have,
\[ \check{H}^i(Y/X, \F) = H^i(G, \F(Y)) \]
\end{thm}

\section{Singularities of Holomorphic Functions}

\renewcommand{\C}{\mathbb{C}}
\newcommand{\h}{\mathfrak{H}}


\begin{thm}
Let $\Omega \subset \C$ be open and $a \in \Omega$ and $f : \Omega \setminus \{ a \} \to \C$ holomorphic. The following are equivalent,
\begin{enumerate}
\item $f$ can be extended to $\tilde{f} : \Omega \to \C$ holomorphically
\item $f$ can be extended to $\tilde{f} : \Omega \to \C$ continuously
\item $\lim\limits_{z \to a} f(z)$ exists
\item $f$ is bounded on a neighborhood of $a$
\item $\lim\limits_{z \to a} (z - a) f(z) = 0$
\end{enumerate}
\end{thm}

\begin{proof}
(1) implies (2) implies (3) implies (4) implies (5) are obvious. Suppose that $\lim_{z \to a} (z - a) f(z) = 0$. Then define,
\[ h(z) = 
\begin{cases}
(z - a)^2 f(z) & z \neq a
\\
0 & z = a
\end{cases} \]
Clearly $h$ is holomorphic on $\Omega \setminus \{ z \}$ and,
\[ h'(a) = \lim\limits_{z \to z} \frac{(z - a)^2 f(z) - 0}{z - a} = \lim_{z \to a} (z - a) f(z) = 0 \]
by assumption so $h(z) : \Omega \to \C$ is holomorphic. Therefore, there is an analytic representation about $a$,
\[ h(z) = \sum_{n = 2}^{\infty} a_n (z - a)^n \]
Therefore define,
\[ g(z) = \sum_{n = 0}^{\infty} a_{n+2} (z - a)^n \]
so for $z \neq 0$ we see that,
\[ f(z) = \frac{h(z)}{(z - a)^2} = \sum_{n = 0}^\infty a_{n+2} (z - a)^n = g(z) \]
and it is clear that $g(z)$ is holomorphic on $\Omega$ extending $f$ (note we may need to patch $g$ and $f$ together outside the radius of convergence but they agree on a neighborhood of $a$ so they may be glued).
\end{proof}

\begin{rmk}
Following this theorem we say that $a$ is a removable singularity if the equivalent conditions above hold. We follow the apparently weakest condition to define the notion of poles.
\end{rmk}

\begin{defn}
Let $f : \Omega \setminus \{ a \} \to \C$ be holomorphic. We say that $f$ has a \textit{pole} at $a$ if,
\[ \lim_{z \to a} (z - a)^{n + 1} f(z) = 0 \]
for some $n \in \N$ and the \textit{order} of the pole is the least such $n$.
\end{defn}

\begin{rmk}
By the theorem, a pole of order zero is the same as a removable singularity.
\end{rmk}

\begin{prop}
Let $f : \Omega \setminus \{ a \} \to \C$ be holomorphic with a pole at $a$ of order $n$. Then,
\[ f(z) = \frac{u(z)}{(z - a)^n} \]
where $u : \Omega \to \C$ is holomorphic and nonvanishing at $a$. Thus $f$ has a Laurent series expansion,
\[ f(z) = \sum_{k = - n}^{\infty} a_k (z - a)^k \]
on some punctured neighborhood on $a$.
\end{prop}

\begin{proof}
We know that $\lim\limits_{z \to a} (z - a)^{n+1} f(z) = 0$ and therefore $h(z) = (z - a)^n f(z)$ has a removable singularity at $z = a$ meaning that it extends to a holomorphic function $h : \Omega \to \C$. Therefore on some neighborhood $U$ of $a$,
\[ h(z) = \sum_{k = 0}^{\infty} a_k (z - a)^k \]
and thus on $U \setminus \{ a \}$
\[ f(z) = \frac{h(z)}{(z - a)^n} = \sum_{k = - n}^{\infty} a_{k - n} (z - a)^k \]
\end{proof}

\begin{rmk}
A holomorphic function $f : \Omega \setminus \{ a \} \to \C$ such that $f$ does not have a pole at $a$ has an \textit{essential singularity} at $a$.
\end{rmk}


\begin{prop}
Let $f : \Omega \setminus \{ a \} \to \C$ be holomorphic and nonvanishing so $\frac{1}{f}$ is holomorphic on $\Omega \setminus \{ a \}$. Then $f$ has a pole at $a$ iff $\lim\limits_{z \to a} \frac{1}{f(z)}$ exists.
\end{prop}

\begin{proof}
If $\lim\limits_{z \to a} \frac{1}{f(z)}$ exists then by Riemann extension we can extend $\frac{1}{f}$ to a holomorphic function $g : \Omega \to \C$. Thus we can write $g(z) = (z - a)^k u(z)$ for some nonvanishing holomorphic function $u : \Omega \to \C$. Therefore, $f(z) = \frac{u(z)^{-1}}{(z - a)^k}$ on $\Omega \setminus \{ a \}$ where $u(z)^{-1}$ is holomorphic and thus $f$ has a pole of order $k$ at $a$. Conversely, if $f$ has a pole at $a$ of order $k$ we can write,
\[ f(z) = \frac{u(z)}{(z - a)^k} \]
where $u : \Omega \to \C$ is holomorphic. Then,
\[ \lim_{z \to a} \frac{1}{f(z)} = \lim_{z \to a} \frac{(z - a)^k}{u(z)} \]
exists because $\frac{1}{u(z)}$ is holomorphic.
\end{proof}


\begin{rmk}
We can (somewhat imprecisely) say that,
\begin{enumerate}
\item if $\lim\limits_{z \to a} f(z)$ and $\lim\limits_{z \to a} \frac{1}{f(z)}$ both exist then $a$ is a removable singularity of $f$ and $\frac{1}{f}$ i.e. a removable singularity which is not a zero of the extension.
\item if $\lim\limits_{z \to a} f(z)$ exists but $\lim\limits_{z \to a} \frac{1}{f(z)}$ does not exist then $f$ has a removable singularity at $a$ which is a zero of the extension and $\frac{1}{f(z)}$ has a pole (of positive order) at $a$
\item if $\lim\limits_{z \to a} f(z)$ does not exist but $\lim\limits_{z \to a} \frac{1}{f(z)}$ exists then $f$ has a pole (of positive order) at $a$ and $\frac{1}{f(z)}$ has a removable singularity at $a$ which extends to a zero
\item if neither $\lim\limits_{z \to a} f(z)$ nor $\lim\limits_{z \to a} \frac{1}{f(z)}$ exist then $f$ and $\frac{1}{f}$ have an essential singularity at $a$.
\end{enumerate}
\end{rmk}

\section{Extending Entire Functions}

\begin{lemma}
Let $f : \C \to \h$ be entire then $f$ is constant.
\end{lemma}

\begin{proof}
Consider $g = \exp{if}$. Then $|g(z)| = |e^{if(z)}| = e^{- \Im{f(z)}} < 1$ because $f(z) \in \h$ and thus $\Im{f(z)} > 0$. Therefore $g$ is bounded and thus constant so $f$ is constant.
\end{proof}

\begin{theorem}
Let $f : \C \to \C \setminus \{ p, q \}$ for $p \neq q$ be entire. Then $f$ is constant.
\end{theorem} 

\begin{proof}
First, there is a biholomorphism $\C \setminus \{ p, q \} \iso \C \setminus \{0, 1 \}$ so we may assume that $p = 0$ and $q = 1$. Then the $j$-function gives a covering map $j : \h \setminus S \to \C \setminus \{0, 1\}$ where $S$ is the set of cusps i.e. orbits of $i$ and $\zeta_3$. Then we get a lift,
\begin{center}
\begin{tikzcd}
& \h \setminus S \arrow[d]
\\
\C \arrow[r, "f"'] \arrow[ru, dashed, "\tilde{f}"] & \C \setminus \{0, 1 \}
\end{tikzcd}
\end{center}
because $\C$ is simply connected. Then $\tilde{f} : \C \to \h$ is constant and thus $f$ is constant.
\end{proof}

\begin{defn}
We say a continuous map $f : X \to Y$ is proper if for any compact $K \subset Y$ then $f^{-1}(K) \subset X$ is compact.
\end{defn}

\begin{lemma}
A continuous map $f : X \to Y$ is proper iff it extends to a continous map $\hat{f} : \hat{X} \to \hat{Y}$ sending $\hat{f}(\infty_X) = \infty_Y$.
\end{lemma}

\begin{prop}
Let $f : \C \to \C$ be entire then the following are equivalent:
\begin{enumerate}
\item $f$ admits a holomorphic extension $\hat{f} : \hat{\C} \to \hat{\C}$ sending $\hat{f}(\infty) = \infty$
\item $f$ admits a continuous extension $\hat{f} : \hat{\C} \to \hat{\C}$ sending $\hat{f}(\infty) = \infty$
\item $f$ is proper
\item $\lim\limits_{z \to \infty} f(z) = \infty$
\item $\lim\limits_{z \to 0} f(z^{-1})^{-1} = 0$
\item $f$ has a pole (of positive order) at $\infty$
\item $f$ has polynomial growth: $|f(z)| \le L |z|^k$ whenever $|z| \ge R$ and is nonconstant
\item $f$ is a nonconstant polynomial
\end{enumerate}
\end{prop}

\begin{proof}
(a) $\implies$ (b) $\implies$ (c) is $\implies$. If $f$ is proper then for any compact disk $D_r(0)$ we must have $f^{-1}(D_r(0))$ closed and bounded and thus there exists $r' > 0$ s.t.,
\[ f^{-1}(D_r(0)) \subset D_{r'}(0) \]
Therefore,
\[ |f(z)| \le r \implies |z| \le r' \]
or equivalently
\[ |z| > r' \implies |f(z)| > r \]
which is exactly the definition of $\lim\limits_{z \to \infty} f(z) = \infty$ (for complex infinity) so (c) $\implies$ (d). Assuming (d), let $w = \frac{1}{z}$ then for any $r > 0$ there exists $r' > 0$ such that,
\[ \left| w \right| < \frac{1}{r'} \implies \left| \frac{1}{f(\frac{1}{w})} \right| < \frac{1}{r} \]
and therefore $\lim\limits_{w \to 0} \frac{1}{f(\frac{1}{w})} = 0$ so (d) $\implies$ (e).
\bigskip\\ 
Now we show that (e) $\implies$ (a) so assume $\lim\limits_{z \to 0} \frac{1}{f(\frac{1}{z})} = 0$ and consider the charts,
\begin{center}
\begin{tikzcd}
\C \arrow[d, "z \mapsto z"', hook] \arrow[r, "f"] & \C \arrow[d, "z \mapsto z", hook]
\\
\hat{\C} \arrow[r, dashed, "\hat{f}"] & \hat{\C}
\\
\C \arrow[r, dashed] \arrow[u, "z \mapsto z^{-1}", hook]  & \C \arrow[u, "z \mapsto z^{-1}"', hook] 
\\
\C \setminus \{ 0 \} \arrow[u, hook] \arrow[r, "\tilde{f}"] & \C \setminus \{ 0 \} \arrow[u, hook]
\end{tikzcd}
\end{center}
Where $\tilde{f}(z) = f(z^{-1})^{-1}$ such that $f : \C \to \C$ on the standard chart around $0$ agrees with $\tilde{f}(z)$ on the overlap. Then $\tilde{f}$ has a removable singularity at $0$ so it extends holomorphically to $\tilde{f} : \C \to \C$ and thus $f$ and $\tilde{f}$ glue to give a holomorphic map $\hat{f} : \hat{\C} \to \hat{\C}$. Furthermore, because $\lim\limits_{z \to 0} \frac{1}{f(\frac{1}{z})} = 0$ we know $\tilde{f}(0) = 0$ and thus $\hat{f}(\infty) = \infty$. 
\bigskip\\
Now consider the chart around $\infty$ of $\hat{\C}$ defined by $z \mapsto z^{-1}$. Thus, in the local coordinate, the function becomes $f(\frac{1}{z})$. Then $\lim\limits_{z \to 0} \frac{1}{f(\frac{1}{z})} = 0$ is equivalent to  $f(\frac{1}{z})$ having a pole at $z = 0$ and thus to $f$ having a pole at $\infty$ on $\hat{\C}$. Furthermore, if $f$ has a pole at $\infty$ of order $k$ then,
\[ f(z) = z^k u(z) \]
where $u(z)$ is holomorphic, nonvanishing, and thus bounded at $\infty$ (i.e. $u(\frac{1}{w})$ is holomorphic at $w = 0$ and thus bounded) so $|f(z)| \le L |z^k|$ for $|z| \ge R$ where $u(\frac{1}{w})$ is bounded by $L$ on the disk $|w| \le \frac{1}{R}$. Conversely, if $f$ has polynomial growth then,
\[ \lim_{z \to \infty} \frac{f(z)}{z^{k+1}} = 0 \]
so $f$ has a pole at $\infty$. Finally, if $f$ is a polynomial then clearly it has polynomial growth. However if $f$ has polynomial growth then applying the Cauchy integral formula,
\[ f^{(n)}(0) = \frac{n!}{2 \pi i} \oint_{\partial D_R(0)} \frac{f(z)}{z^{n+1}} \, \d{z} \]
we see that,
\[ |f^{(n)}(0)| \le n! L R^{k - n} \]
so in the limit $R \to \infty$ we see that $f^{(n)}(0) = 0$ for $n > k$ and thus, because $f$ is entire so its power series expression is global (or by analytic continuation and using the series expression at $0$ to show that $f$ is a polynomial on some neighborhood of $0$) $f$ is a polynomial. Furthermore we assume that $f$ is nonconstant. Thus we show that (e) $\iff$ (f) $\iff$ (g) $\iff$ (h).
\end{proof}

\begin{prop}
Let $f : \C \to \C$ be entire then the following are equivalent:
\begin{enumerate}
\item $f$ admits a holomorphic extension $\hat{f} : \hat{\C} \to \C$
\item $f$ admits a continuous extension $\hat{f} : \hat{\C} \to \C$
\item $f$ is bounded
\item $f$ is constant
\item $\lim\limits_{z \to \infty} f(z)$ exists
\item $f$ has a removable singularity at $\infty$
\end{enumerate}
\end{prop}

\begin{proof}
(a) $\implies$ (b) is obvious. If $f$ admits a continuous extension $\hat{f} : \hat{\C} \to \C$ then the image of $\hat{f}$ is compact and thus closed and bounded in $\C$ so $f$ is bounded. Then (c) $\implies$ (d) is Liouville's theorem. Next (d) $\implies$ (e) is obvious. Now assume that $\lim\limits_{z \to \infty} f(z)$ exists or equivalently $\lim\limits_{z \to 0} f(\frac{1}{z})$ exists and thus $f(\frac{1}{z})$ has a removable singularity at $z = 0$ and thus $f$ has a removable singularity at $\infty$ on $\hat{\C}$ using the chart $z \mapsto z^{-1}$. Furthermore, if $f$ has a removable singularity then it extends to a well-defined function $g : \C \to \C$ with $g(z) = f(\frac{1}{z})$ and therefore gluing on the two charts gives a holomorphic extension $\hat{f} : \hat{\C} \to \C$.
\end{proof}

\begin{prop}
Any holomorphic function $f : \hat{\C} \to \hat{\C}$ is a rational function.
\end{prop}


\begin{proof}
Since $f$ is holomorphic, it set $P$ of poles is isolated and thus finite because $\hat{\C}$ is compact. Therefore,
\[ g(z) = f(z) \prod_{a \in P} (z - a)^{\ord_a(f)} \]
is a holomorphic function $g : \hat{\C} \to \hat{\C}$ with no poles on $\C$ thus restricting to an entire function $g : \C \to \C$ which admits a holomorphic extension to the Riemann sphere. Thus $g$ is a polynomial proving the theorem. 
\end{proof}

\begin{rmk}
If $f$ admits a holomorphic extension $\hat{f} : \hat{\C} \to \hat{\C}$ sending $\hat{f}(\infty) \in \C$ then $f$ is constant. This is because the image of $\hat{f}$ is compact but contained in $\C$ and thus bounded so by Liouville $f$ is consant.
\end{rmk}



\section{Blow Ups and Canonical Bundles}

Let $\pi : \tilde{X} \to X$ be the blow up at $Z \subset X$. Suppose that $X$ is a smooth variety over $k$ and $Z \subset X$ is smooth. Consider the diagram,

\begin{center}
\begin{tikzcd}
E \arrow[r, hook] \arrow[d] & \tilde{X} \arrow[d, "\pi"]
\\
Z \arrow[r, hook] & X
\end{tikzcd}
\end{center}
where $E = \P(\C_{Z/X})$.
Then there is an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \pi^* \Omega_X \arrow[r] & \Omega_{\tilde{X}} \arrow[r] & \Omega_{\tilde{X}/X} \arrow[r] & 0
\end{tikzcd}
\end{center}
which is exact on the left because it is a generically injective map of vector bundles. Furthermore, there are exact sequences,
\begin{center}
\begin{tikzcd}
\iota^* \Omega_{\tilde{X}/X} \arrow[r] & \Omega_{E/X} \arrow[r] & \Omega_{E/\tilde{X}} \arrow[r] & 0
\\
\pi^* \Omega_{Z/X} \arrow[r] & \Omega_{E/X} \arrow[r] & \Omega_{E/Z} \arrow[r] & 0
\end{tikzcd}
\end{center}
Now the horizontal maps are unramified so $\Omega_{E/\tilde{X}} = 0$ and $\Omega_{Z/X} = 0$ and thus $\Omega_{E/X} \iso \Omega_{E/Z}$ and there is a surjection $\iota^* \Omega_{\tilde{X}/X} \onto \Omega_{E/X}$. In fact, because the square is cartesian this is an isomorphism so,
\[ \iota^* \Omega_{\tilde{X}/X} \iso \Omega_{E/X} \iso \Omega_{E/Z} \]
Therefore, because $\I \cdot \Omega_{\tilde{X}/X} = 0$ we find that $\Omega_{\tilde{X}/X} \iso \iota_* \Omega_{E/Z}$ so our exact sequence becomes,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \pi^* \Omega_{X} \arrow[r] & \Omega_{\tilde{X}} \arrow[r] & \iota_* \Omega_{E/Z} \arrow[r] & 0
\end{tikzcd}
\end{center}
Furthermore, because $E \to Z$ is isomorphic to the projective bundle $\pi : \P_Z(\C_{Z/X}) \to Z$ we have an Euler sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \Omega_{E/Z} \arrow[r] & \pi^* \C_{Z/X} \otimes_{\struct{E}} \struct{E}(-1) \arrow[r] & \struct{E} \arrow[r] & 0
\end{tikzcd}
\end{center}

\section{Groups acting on Schemes, Torsors, and Covers}

\begin{rmk}
Here we use Daniel Litt's convention that torsors need not be split (what the Stacks project calles a pseudo-torsor).
\end{rmk}

\begin{prop}
Let $G$ be a group object in the category of schemes over $S$. 
\begin{enumerate}
\item if $G \to S$ is separated then $e : S \to G$ is a closed immersion
\item if $G \to S$ is unramified then $e : S \to G$ is an open immersion.
\end{enumerate}
\end{prop}

\begin{proof}
Notice that $e : S \to G$ is a section of the structure map $G \to S$. Therefore we apply implication of properties to the diagram,
\begin{center}
\begin{tikzcd}
S \arrow[rd, "\id"] \arrow[rr, "e"] & & X \arrow[ld, "f"]
\\
& S
\end{tikzcd}
\end{center}
\end{proof}

\begin{rmk}
If $G \to S$ is separated and unramified and $S$ is connected then $e : S \to G$ is an isomorphism onto a connected component of $G$. Furthermore, for each point $g \in G(S)$, the map $g : S \to G$ also gives an isomorphism to a connected componen of $G$. Therefore, consider the map,
\[ \coprod_{g \in G(S)} g S \to G \]
IS THIS AN ISOMORPHISM?
\end{rmk}

\begin{prop}
Let $G$ be an abstract group. Then,
\[ G_S = G \times S = \coprod_{g \in G} g S \]
is separated and (locally) \etale over $S$.
\end{prop}

\begin{proof}
Locally $G_S \to S$ is just $\id : S \to S$. Furthermore, the diagonal map is a canonical inclusion of copies of $S$ into more copies of $S$ and thus a closed immerison. (CHECK THIS!!)
\end{proof}

\begin{rmk}
Notice some people have \etale require finite presentation and thus quasi-compact. We only require locally of finite presentation so some infinite covers are acceptable. Since $G_S$ is \etale it is, in particular, smooth and unramified.
\end{rmk}

\begin{defn}
Let $\C$ be a category with fiber products and finite products (a terminal object suffices because of the existence of fiber products) and let $G$ be a group object in $\C$. A (relative) $G$-torsor is a morphism $f : X \to Y$ with a $G$-action $a : G \times_\C X \to X$ on $X$ such that $f : X \to Y$ is $G$-equivariant for the trivial action on $Y$ i.e
\begin{center}
\begin{tikzcd}
G \times_\C X \arrow[r, "\id \times f"] \arrow[d,"a"'] & G \times_\C Y \arrow[d, "\pi_2"]
\\
X \arrow[r, "f"'] & Y
\end{tikzcd}
\end{center}
commutes or more susictly $f \circ m = f \circ \pi_2$ as maps $G \times_\C X \to Y$. Furthermore, we require the map,
\[ G \times_\C X \xrightarrow{(\pi_2, m)} X \times_Y X \]
defined by the relation $f \circ m = f \circ \pi_2$ is an isomorphism.
\end{defn}

\begin{rmk}
This is identical to the definition of a $G_Y$-torsor in the slice category $\C_{/Y}$ where we base change such that $G_Y \times_Y X = G \times_\C X$.
\end{rmk}

\begin{defn}
Let $\C$ be a category with finite products and $G$ be a group object. A $G$-torsor $(X, a)$ is an object with an action $a : G \times_\C X \to X$ such that the map,
\[ G \times_\C X \xrightarrow{(\pi_2, a)} X \times_\C X \] 
is an isomorphism. 
\end{defn}

\begin{prop}
Let $f : X \to Y$ be a $G$-torsor in the category of $S$-schemes. Let $\cP$ be a property of morphisms preserved under base change and composition with $\id_S \in \cP$. Then,
\[ \Delta_{G/S} \in \cP \implies \Delta_{X/Y} \in \cP \]
\end{prop}

\begin{proof}
Consider the diagram,
\begin{center}
\begin{tikzcd}
X \arrow[d, "e \times \id"'] \arrow[r, "\id"] & X \arrow[d, "\Delta_{X/Y}"]  
\\
G \times_S X \arrow[r, "(\pi_2 \, a)"] & X \times_Y X
\end{tikzcd}
\end{center}
Since the horizontal maps are isomorphisms, $e \times \id : X \to G \times_S X$ and $\Delta_{X/Y}$ share the same properties. Furthermore, $e : S \to G$ and $\Delta_{G/S}$ share all properties $\cP$ because of the diagram,
\begin{center}
\begin{tikzcd}
S \arrow[rr, "e"] \arrow[rd, "\id"'] & & G \arrow[ld]
\\
& S
\end{tikzcd}
\end{center}
and implication of properties. Therefore if $\Delta_{G/S} \in \cP$ then $e \times \id \in \cP$ by base change so $\Delta_{X/Y} \in \cP$.
\end{proof}

\begin{rmk}
If base changing along $X \to S$ is not faithful on properties, mapping non $\cP$ into $\cP$, then we cannot conclude that $\Delta_{X/Y} \in \cP \implies \Delta_{G/S} \in \cP$. (GIVE EXAMPLE!!) 
\end{rmk}

\begin{defn}
We say that $f : X \to Y$ is \textit{weakly unramified} if $\Delta_{X/Y}$ is an open immersion.
\end{defn}

\begin{rmk}
We have unramified iff weakly unramified and locally finite type by Tag 02GE.
\end{rmk}

\begin{cor}
Let $f : X \to Y$ be a $G$-torsor in the category of $S$-schemes.
\begin{enumerate}
\item If $G \to S$ is (quasi/affine)-separated then $f : X \to Y$ is (quasi/affine)-separated.
\item If $G \to S$ is weakly unramified then $f : X \to Y$ is weakly unramified.
\end{enumerate}
\end{cor}

\begin{proof}
Immediate from the above, the definitions, and the fact that all such classes of morphisms are preserved under composition and base change and all identity maps belong to them.
\end{proof}

\begin{rmk}
Notice that if $G = S$ is the trivial $S$-group scheme and $f : X \to Y$ is a mono with the trivial action then,
\begin{center}
\begin{tikzcd}
G \times_S X \arrow[r, "(\pi_2 \, a)"] \arrow[d, equals] & X \times_Y X \arrow[d, equals]
\\
X \arrow[r, "\Delta_{X/Y}"] & X \times_Y X
\end{tikzcd}
\end{center} 
is an isomorphism because $f : X \to Y$ is monic. Therefore $f : X \to Y$ is a $G$-torsor. Therefore, no matter how nice $G$ is, we cannot ensure that $f : X \to Y$ is flat, smooth, \etale, etc automatically. In fact, consider $\Spec{\Q} \to \Spec{\Z}$ which is a monic but not even (locally) finite type. This case is fairly degenerate so we wish to eliminate it in the next section.
\end{rmk}

\subsection{Surjective Torsors}

\begin{defn}
We say a $G$-torsor in the category of $S$-schemes is \textit{surjective} if $f : X \to Y$ is surjective.
\end{defn}

(DREAM THEOREM!)

\begin{prop}
Let $f : X \to Y$ be a surjective $G$-torsor then,
\begin{enumerate}
\item If $G \to S$ is locally of finite type then $f : X \to Y$ is locally of finite type.
\item If $G \to S$ is unramified then $f : X \to Y$ is unramified.
\item If $G \to S$ is flat then $f : X \to Y$ is flat.
\item If $G \to S$ is smooth then $f : X \to Y$ is smooth.
\item If $G \to S$ is \etale then $f : X \to Y$ is \etale.
\end{enumerate}
\end{prop}

\begin{proof}

\end{proof}

\subsection{Locally Trivial Torsors}

Here let $\C$ be a category with fiber products and finite products and $\tau$ a Grothendieck topology so that $(\C, \tau)$ is a site.

\begin{defn}
A $G$-torsor $f : X \to Y$ is trivial if it is isomorphic (as $G$-objects) to $G \times_S Y$.
\end{defn}

\begin{lemma}
A $G$-torsor is trivial if and only if it has a section.
\end{lemma}

\begin{proof}
Clearly trivial torsors have sections given by the base change of $e : S \to G$. Suppose that $s : Y \to X$ is a section of $f : X \to Y$. Then consider, the map $a \circ (\id \times s) : G \times_S Y \to X$. First we need to check that this is a map of $G$-torsors meaning the diagram,
\begin{center}
\begin{tikzcd}[row sep = huge, column sep = huge]
G \times_S G \times_S Y \arrow[r, "\id_G \times \id_G \times s"] \arrow[d, "m \times \id_Y"'] & G \times_S G \times_S X \arrow[r, "\id_G \times a"]  \arrow[d, "m \times \id_X"] & G \times_S X \arrow[d, "a"]
\\
G \times_S Y \arrow[r, "\id_G \times s"] & G \times_S X \arrow[r, "a"] & X
\end{tikzcd}
\end{center}
commutes. The left square obviously commutes and the right square commutes because $a$ is an action. Now let $q : X \to X$ be $s \circ f$ and notice $f \circ q = f$ so that we can write the diagram,
\begin{center}
\begin{tikzcd}[column sep = huge, row sep = huge]
G \times_S X \arrow[r, "(\pi_2 \, a)"] \arrow[d, bend left, "\id_G \times f"] & X \times_Y X \arrow[d, bend left, "\pi_2"]
\\
G \times_S Y \arrow[u, bend left, "\id_G \times s"] \arrow[r, "a \circ (\id_G \times s)"] & X \arrow[u, bend left, "(q \, \id)"] 
\end{tikzcd}
\end{center}
Let $g = (\pi_2, a)$ and consider $(r, t) = g^{-1}$ where $r : X \times_Y X \to G$ and $t : X \times_Y X \to X$ where $(r, t) \circ g = \id$ meaning,
\[ r \circ g = \pi_1 \quad \text{and} \quad t \circ g = \pi_2 \]
and $g \circ (r, t) = \id$ meaning,
\[ \pi_2 \circ (r, t) = t = \pi_1 \quad \text{and} \quad a \circ (r, t) = \pi_2 \]
Now let $v = (\id_G \times f) \circ g^{-1} \circ (q, \id)$. I claim that $v$ and $u = a \circ (\id_G \times s)$ are inverse. Notice,
\begin{align*}
u \circ v & = a \circ (\id_G \times q) \circ g^{-1} \circ (q, \id)
\\
& = a \circ [(r \circ (q, \id)), (q \circ t \circ (q, \id))]
\\
& = a \circ [(r \circ (q, \id)), q]
\\
& = a \circ [(r \circ (q, \id)), t \circ (q, \id)]
\\
& = a \circ g^{-1} \circ (q, \id)
\\
& = \pi_2 \circ (q, \id) = \id_X
\end{align*}
using $q \circ q = q$ and $t = \pi_1$. Likewise, notice $q \circ a = q \circ \pi_2$ and $q \circ s = s$. Thus,
\begin{align*}
v \circ u & = (\id_G \times f) \circ g^{-1} \circ (q, \id) \circ a \circ (\id_G \times s)
\\
& = (\id_G \times f) \circ g^{-1} \circ (s \circ \pi_2, a \circ (\id_G \times s))
\\
& = (\id_G \times f) \circ (r \circ [s \circ \pi_2, a \circ (\id_G \times s)], s \circ \pi_2)
\\
& = (r \circ (\pi_2, a) \circ (\id_G \times s)], \pi_2)
\\
& = (\pi_1 \circ (\id_G \times s, \pi_2)
\\
& = (\pi_1, \pi_2) = \id_{G \times_S Y}
\end{align*}
\end{proof}

\begin{defn}
We say that a $G$-torsor $X$ is \textit{locally trivial} or \textit{split} in the $\tau$-topology if there exists a $\tau$-cover $\{ Y_i \to Y \}$ such that $X_{Y_i} \to Y_i$ is a trivial $G_{Y_i}$-torsor.
\end{defn}

\begin{prop}
If $\tau$ is subcanonical for $\C = \Sch_{S}$ then locally trivial $G$-torsors are surjective.
\end{prop}

\begin{proof}
(IS THIS TRUE?)
\end{proof}

\subsection{$G$-Covers and Galois Covers}

\section{Some Random Notes on Categories and Stuff}

\subsection{Group Objects in a Monoidal Category?}

Why don't we consider group objects in a monoidal category (only monoid objects) unless the monoidal operation is categorical product. Well, it's because the ``inverses'' diagram,
\begin{center}
\begin{tikzcd}[row sep = huge]
G \arrow[r, "(\id \times i) \circ \Delta"] \arrow[d, "(i \times \id) \circ \Delta"'] \arrow[rd, "e"] & G \otimes G \arrow[d, "m"]
\\
G \otimes G \arrow[r, "m"'] & G
\end{tikzcd}
\end{center}
only makes sense where there exists a diagonal map $G \to G \otimes G$. For example, in the category of abelian groups, there does not exists a diagonal map nor projections for $\otimes_\Z$ basically because $x \mapsto x \otimes x$ is not linear. In fact, suppose we have a monoidal category with a natural map $\Delta : A \to A \otimes A$ then for any pair of maps $f : A \to X$ and $g : A \to Y$ we get 
\[ A \xrightarrow{\Delta} A \otimes A \xrightarrow{f \otimes g} X \otimes Y \] 
So $\otimes$ acts sort of like a product (FORMALIZE THIS).

\subsection{Monoidal Category acting on a Category}

\begin{rmk}
Notice that a monoidal category is a monoid object in the two category $\mathbf{Cat}$.
\end{rmk}

\begin{defn}
Let $(\C, \otimes, I)$ be a monoidal category and $\D$ a category. Then an action of 
\end{defn}

\subsection{Modules for a Monoid}

\section{Descending Properties for Faithfully Flat Maps}

\begin{lemma}
Let $M$ be an $R$-module. Then the following are equivalent,
\begin{enumerate}
\item $M$ is finite projective
\item $M$ is finitely presented and flat.
\end{enumerate}
\end{lemma}

\begin{proof}
Tag 058R. (FIND A NICE PROOF)
\end{proof}

\begin{prop}
Let $\varphi : A \to B$ be a faithfully flat ring map and $M$ an $A$-module. Then, viewing $M \otimes_A B$ as a $B$-module,
\begin{enumerate}
\item if $M \otimes_A B$ is finite then $M$ is finite
\item if $M \otimes_A B$ is finitely presented then $M$ is finitely presented
\item if $M \otimes_A B$ is flat then $M$ is flat
\item if $M \otimes_A B$ is finite projective then $M$ is finite projective.
\end{enumerate}
\end{prop}

\begin{proof}
Choosing a generating set $e_i = \sum_j m_{ij} \otimes b_j$ of $M \otimes_A B$ gives a map $\psi : A^n \to M$ via the elements $m_{ij} \in M$. Clearly $\psi \otimes \id_B$ is surjective so $\coker{\psi} \otimes_A B = 0$ and thus $\coker{\psi} = 0$ by faithful flatness so $\psi$ is surjective and thus $M$ is finite. 
\bigskip\\
Let $M \otimes_A B$ be finitely presented. By finiteness we conclude that $M$ is finite and need to show that $K = \ker{(A^n \onto M)}$ is finite as well. However, by flatness, $\ker{(B^n \onto M \otimes_A B)} = K \otimes_A B$ which is finite by hypothesis and thus $K$ is finite by part (a) proving part (b).
\bigskip\\
Suppose that $M \otimes_A B$ is $B$-flat. Consider an exact sequence,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & K \arrow[r] & N \arrow[r] & L \arrow[r] & 0
\end{tikzcd}
\end{center}
of $A$-modules. Applying the functor $- \otimes_A M$ gives a complex,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & K \otimes_A M \arrow[r] & N \otimes_A M \arrow[r] & L \otimes_A M \arrow[r] & 0
\end{tikzcd}
\end{center}
To check if this sequence is exact, it suffices to apply $- \otimes_A B$ and check exactness because $\varphi : A \to B$ is faithfully flat. Applying $- \otimes_A B$ gives the complex,
\begin{center}
\begin{tikzcd}
0 \arrow[r] & K \otimes_A M \otimes_A B \arrow[r] & N \otimes_A M \otimes_A B \arrow[r] & L \otimes_A M \otimes_A B \arrow[r] & 0
\end{tikzcd}
\end{center}
which is isomorphic (as a complex of $B$-modules) to the complex of $B$-modules obtained by taking the original exact sequence and applying first $- \otimes_A B$ and then applying $- \otimes_B (M \otimes_A B)$ after applying $- \otimes_A B$. This sequence remains exact because $B$ is $A$-flat and $M \otimes_A B$ is $B$-flat. Therefore $- \otimes_A M$ preserves exactness so $M$ is $A$-flat.
\bigskip\\
Finally, being finite projective is equivalent to being flat and finitely presented, properties we have shown descend.
\end{proof}

\begin{rmk}
Clearly if $M \otimes_A B$ is finitely locally free over $B$ then $M$ is finite locally free over $A$ since this is equivalent to being finite projective. However, it is false that if $M \times_A B$ is finite free then $M$ must be finite free as well. For example, take an affine patch of an elliptic curve,
\[ A = k[x,y]/(y^2 - x(x^2 + 1)) \] 
with ideal $I = (x, y)$ which is locally principal. Now consider,
\[ B = A \oplus I \] 
where the algebra structure is given by $I \otimes I \to I^2 = (x) \to A$ via dividing by $x$. Therefore,
\[ B = k[x,y,u,v]/(y^2 - x(x^2 + 1), y u - x v, u^2 - x, v^2 - (x^2 + 1), uv - y) = k[u,v]/(v^2 - (u^4  + 1)) \]
It is clear that $B$ is a finite projective $A$-module but not free. However, I claim that $B \otimes_A B \cong B \oplus B$ as $B$-modules. This is because $\Spec{B} \to \Spec{A}$ is an \etale $\Z/2\Z$-cover. The $\Z/2\Z$-action is given by sending $v \mapsto -v$ and $u \mapsto - u$. However, $A \to B$ is faithfully flat so freeness does not descend.
\end{rmk}

\section{Local Freeness and Cohomology and Base Change}

\subsection{Cohomology and Base Change}

\begin{rmk}
We begin by recalling essential facts about cohomology and base change. 
\end{rmk}

\begin{prop}
Whenever we have a Cartesian diagram,
\begin{center}
\begin{tikzcd}
X' \arrow[r, "\psi'"] \arrow[d, "f'"] & X \arrow[d, "f"]
\\
Z \arrow[r, "\psi"] & Y
\end{tikzcd}
\end{center}
and a $\struct{X}$-module $\F$ then there are natural morphisms,
\[ \varphi^q_Z : \psi^* (R^q f_* \F) \to (R^q f'_*) \psi'^* \F \]
which are isomorphisms when $\psi$ is flat.
\end{prop}

\begin{proof}
We use the fact that $\psi^*$ is left-exact and exact when $\psi$ is flat.
\end{proof}

\subsection{Ravi Exercises}

\begin{prop}[16.3.G.]

\end{prop}

\begin{proof}
Consider the unit $\F \to \psi'_* \psi'^* \F$. Applying $\pi_*$ gives,
\[ \pi_* \F \to \pi_* \psi'_* \psi'^* \F \]
However, $\pi_* \psi'_* = \psi_* \pi'_*$ and therefore we get a morphism,
\[ \pi_* \F \to \psi_* \pi'_* \psi'^* \F \]
Then by adjunction we get a morphism,
\[ \psi^* \pi_* \F \to \pi'_* \psi'^* \F \]
\end{proof}


\subsection{Local Freeness}

\begin{prop}
Let $f : X \to Y$ be a flat and proper morphism of noetherian schemes with $H^1(X_y, \struct{X_y}) = 0$ for each $y \in Y$. Then $\pi_* \struct{X}$ is locally free.
\end{prop}

\begin{proof}
Since $H^1(X_y, \F|_{X_y}) = 0$ it is locally constant and thus $R^1 \pi_* \struct{X} = 0$. Therefore, by Cohomology and base change for $q = 1$, \[ \psi^0_y : (\pi_* \struct{X})_y \iso H^0(X_y, \struct{X_y}) \]
is an isomorphism and thus by cohomology and base change for $q = 0$ we see that $\pi_* \struct{X}$ is locally free.
\end{proof}

\begin{example}
Consider the degenerate family of elliptic curves $\pi : E \to \A^1$ defined by,
\[ E = V(y^2 z - x (x - 1)(x - \lambda)) \subset \P^2_{\A^1} = \Proj{k[\lambda][x,y,z]} \]
I claim that $\pi : E \to \A^1$ is flat and proper. Properness is clear and flatness follows from the fact that the fibers have constant Hilbert polynomial since they are curves of degree $3$ in $\P^2_k$. 
\end{example}

\section{Some Ordinal Facts}

\begin{lemma}
Let $S$ be a well-ordered set. There is a sucessor functon $s : S \setminus \{ \max S \} \to S$ such that $x < s(x)$ and is the minimal such element meaning there does not exist any $z \in S$ such that $x < z < s(x)$ or equivalently if $x < z$ then $s(x) \le z$.
\end{lemma}

\begin{proof}
Let $s(x) = \min \{ y \in S \mid x < y \}$ which exists by well-ordering if $x$ is not maximum because then the set is not empty. Then clearly $x < s(x)$ because $s(x)$ is a member. Furthermore, if $x < z$ then $s(x) \le z$ because it is the minimal element.
\end{proof}

\begin{rmk}
If a set has a least element then that element is the infimum. Indeed if $m \in S$ is minimal then for any lower bound $q$ we know that $q \le m$ because $m \in S$. Thus $s(x)$ is maximal as a sucessor.
\end{rmk}

\begin{lemma}
Let $S$ be a well-ordered set. If $x,y \in S \setminus \{ \max S \}$ are such that $x < s(y)$ and $y < s(x)$ then $x = y$.
\end{lemma}

\begin{proof}
Suppose not. Without loss of generality, then $x < y$ so $x < y < s(x)$ giving a contradiction. We can also show this directly. If $x < s(y)$ then we cannot have $y < x$ so $x \le y$. Likewise we see that $y \le x$ so $x = y$.
\end{proof}

\begin{prop}
Every well-ordered suborder of $\R$ is countable.
\end{prop}

\begin{proof}
Let $S \subset \R$ be a well-orderd suborder. For each $q \in \Q$ there is  at most one $x \in S$ such that $x < q < s(x)$. Indeed, if there were two such $x,y \in S$ then $x < q < s(y)$ and $y < q < s(x)$ so $x = y$ by the lemma. Furthermore, for each $x \in S \setminus \{ \max S \}$ we know that $x < s(x)$ so $(x, s(x)) \cap \Q \neq \varnothing$. Therefore, we have defined a surjective partial function $\Q \onto S \setminus \{ \max S \}$ so $S$ is countable.
\end{proof}

\begin{prop}
Every countable ordinal embedds in $\Q$ with bounded image.
\end{prop}

\begin{proof}
We proceed to construct such embeddings by transfinite recursion. For $\alpha = \varnothing$ this is trivial. If $\alpha = \beta + 1$ then take any upper bound $q \in \Q$ of the range of $f_\beta : \beta \embed \Q$ (to avoid choice issues, notice that there is a canonical choice $q = \min \{ n \in \N \mid \forall \gamma < \beta : n > f_\beta(\gamma) \}$) and let $f_\alpha |_\beta = f_\beta$ and $f_\beta(\beta) = q$. This clearly gives an order embedding. Finally, for a limit ordinal $\alpha$ we suppose that $f_\beta : \beta \embed \Q$ is defined for each $\beta < \alpha$. We decompose $\alpha$ into countably many intervals $[\gamma_n, \gamma_{n+1})$ which must have order type $\beta_n < \alpha$ so we get a bounded order embedding $f_{\beta_n} : \beta_n \embed \Q$. Since $\Q$ is order-isomorphic with $\Q \cap (0, 1)$ we can map $\beta_n \embed \Q \cap (0,1)$ and string these together giving an order embedding $f : \alpha \embed \Q$. One final application of $\Q \embed (0, 1) \cap \Q$ proves the result by transfinite induction. 
\bigskip\\
In fact, any countable total order embedds in $\Q$ (the boundedness of the image is obvious by using an order isomorphism $\Q \iso (0,1) \cap \Q$). The proof uses the countability of $\alpha$ by employing a  bijection $\N \to \alpha$. Call the resulting sequence $x_n \in \alpha$. We produce an order embedding $\alpha \embed \Q$ by induction on $n$. Send $f(x_0) = 0$. Then assume we have constructed $f$ on $\{x_0, \dots, x_{n-1} \}$. Consider the sets,
\[ A = \{ f(x_i) \mid i < n \text{ and } x_i < x_n \} \quad \text{and} \quad B = \{ f(x_i) \mid i < n \text{ and } x_i > x_n \} \]
Then $A < B$ because $f$ is order-preserving. Thus, exist a rational $q \in \Q$ such that $A < q < B$ (to avoid choice issues, notice there is a canonical choice $q = \tfrac{1}{2} (\max{A} + \min{B})$ which exists because $A$ and $B$ are finite and if $B$ is empty then let $q = \max{A} + 1$ and if $A$ is empty the let $q = \min{B} - 1$). Thus, taking $f(x_n) = q$ preserves the order because if $x_i < x_n$ then $f(x_i) \in A$ so $f(x_i) < f(x_n)$ and if $x_n > x_i$ then $f(x_i) \in B$ so $f(x_n) < f(x_i)$. Therefore, by induction we define the order embedding $f : \alpha \embed \Q$.
\bigskip\\
For more discussion, see \href{https://tinyurl.com/3dub3d9r}{this} blogpost and the following mathoverflow answers: \chref{https://math.stackexchange.com/questions/3521066/show-that-every-countable-well-ordered-set-is-order-isomorphic-to-a-subset-of}{one} \chref{https://math.stackexchange.com/questions/37151/showing-any-countable-dense-linear-ordering-is-isomorphic-to-a-subset-of-mat}{two} \chref{https://math.stackexchange.com/questions/408300/countable-ordinals-are-embeddable-in-the-rationals-bbb-q-proofs-and-their}{three}
\chref{https://math.stackexchange.com/questions/44559/formal-proof-for-a-subset-of-the-real-numbers-well-ordered-with-the-normal-orde}{four} \chref{https://math.stackexchange.com/questions/407833/proving-existence-of-a-surjection-2-aleph-0-to-aleph-1-without-ac}{five} 
\chref{https://math.stackexchange.com/questions/2149190/countable-ordinals-property}{six} 
\end{proof}

\begin{rmk}
Therefore the order type of $\Q$ or $\R$ contains exactly all the countable ordinals.
\end{rmk}

\begin{prop}
Endowing $\omega_1$ with the order topology, every continuous or increasing function $f : \omega_1 \to \R$ is eventually constant.
\end{prop}

\begin{proof}
DO THISS!!
\end{proof}

\begin{defn}
We say a topological space is,
\begin{enumerate}
\item second countable if it admits a countable basis
\item Lindel\"{o}f if every cover has a countable subcover.
\end{enumerate}
\end{defn}

\begin{rmk}
Obviously any compact space is Lindel\"{o}f.
\end{rmk}

\begin{lemma}
Every second countable space is Lindel\"{o}f.
\end{lemma}

\begin{proof}
Indeed, let $\{ U_\alpha \}_{\alpha \in A}$ be a cover of $X$ and let $\mathcal{B}$ be a countable basis for the topology on $X$. For each $x \in X$ we know $x \in U_{\alpha_x}$ for some $\alpha_x \in A$. Then there must exist basis elements $x \in B_x \subset U_{\alpha_x}$. Since $\mathcal{B}$ is countable, this given a countable refinement $\{ B_x \}_{x \in X}$ and thus choosing exactly one $U_\alpha$ containing each $B_x$ gives a countable subcover (emplying the axiom of countable choice).
\end{proof}


\begin{prop}
The topological space $\omega_1$ is not Lindel\"{o}f and thus not compact or second countable.
\end{prop}

\begin{proof}
Consider the cover $\{ [0, \alpha) \mid \alpha < \omega_1 \}$. Thss cannot have a countable (let alone finite) subcover because then the union would be bounded by $\sup \alpha$ which is a countable ordinal. 
\end{proof}

\begin{prop}
Every increasing sequence in $\omega_1$ converges.
\end{prop}

\begin{proof}
Let $\alpha_n \in \omega_1$ be a sequence. Then,
\[ \alpha = \sup \alpha_n = \bigcup_{n \in \N} \alpha_n \]
is the countable union of countable ordinals and thus is a countable ordinal such that $\alpha_n \le \alpha$ for all $n$. Thus $\alpha_n$ is bounded above and therefore converges to its supremem.
\end{proof}

\begin{prop}
$\omega_1$ is limit point compact but not compact and thus not metrizable.
\end{prop}

\begin{proof}
We have seen that every increasing sequence in $\omega_1$ converges and thus any infinite set $E$ must have a limit point since it contains an increasing sequence via sucessor inside $E$ meaning $s(x) = \min \{ y \in E \mid x < y \}$. However, $\omega_1$ is compact but limit point compactness and compactness agree for 
\end{proof}

\begin{rmk}
$\omega_1$ is countably compact because for $T_1$ spaces this is equivalent to being limit point compact. It turns out that $\omega_1$ is also sequentially compact because the set has a supremum and in the order topology there is always a subsequence converging to the supremum.
\end{rmk}

\begin{rmk}
This also shows again that $\omega_1$ is not Lindel\"{o}f because compactness and countable compactness coincide for Lindel\"{o}f spaces.
\end{rmk}

\section{Some Facts about Orbits}

\renewcommand{\Aut}[2]{\mathrm{Aut}_{#1}\left(#2 \right)}

\begin{prop}
Let $X$ be a $G$-set. Then $\Aut{G}{X}$ acts transitively on $\Orb{x}$ iff $\Stab{x}$ is normal in which case $\Orb{x}$ is a $G/\Stab{x}$-torsor.
\end{prop}

\begin{proof}
First, notice that $\Stab{g \cdot x} = g \Stab{x} g^{-1}$. But for any $\phi \in \Aut{G}{X}$ we know $\Stab{\phi(x)} = \Stab{x}$ because $g \cdot \phi(x) = \phi(g \cdot x)$. Thus if $\phi : x \mapsto g \cdot x$ then $g \Stab{x} g^{-1} = \Stab{x}$ i.e. $g \in N(\Stab{x})$. Thus if $\Aut{G}{X}$ acts transitively on $\Orb{x}$ then $\Stab{x}$ is normal.
\bigskip\\
There is an isomorphism of $G$-sets $G / \Stab{x} \iso \Orb{x}$. Thus if $\Stab{x}$ is normal then $\Orb{x}$ is isomorphic as $G$-sets to the group $G / \Stab{x}$ so it acts on itself transitively via right multiplication commuting with the left $G$-action so $\Aut{G}{\Orb{x}} \acts \Orb{x}$ transitively. Then any such automorphism can be extended by the identitiy to the entirety of $X$.
\end{proof}

\section{Perspectives on Derived Functors}

\renewcommand{\A}{\mathcal{A}}
\newcommand{\B}{\mathcal{B}}

NEW DEFN: TRIANGULATED KAN EXTENSION FROM HOMOTOPY CATEGORY 

\begin{rmk}
The total derived functor can be computed as follows. Take an quasi-isomorphism to an injective complex $A \to I$ then $RF(A) = KF(I)$ termwise. This is well-defined because quasi-isomorphisms between injective complexes are already invertible in the homotopy category.
\end{rmk}

\begin{rmk}
Consider $A \in \mathcal{A}$ as the complex $A[0]$ then an quasi-isomorphism $A \to I$ is the same as an injective resolution. Therefore, it is clear that $H^n(RF(A)) = H^n(F(I^\bullet)) = R^n F(A)$ by definition. Furthermore, for any complex, the hypercohomology is computed as, 
\[ \mathbb{R}^n F(A) = H^n(RF(A)) \]
by definiton.
\end{rmk}

\begin{theorem}
If $F : \A \to B$ is left-exact then
$R^n F = H^n \circ RF \circ \iota$ is a universal $\delta$-functor such that $R^0 F = F$.
\end{theorem}

(DO THIS)

\begin{rmk}
Because universal $\delta$-functors are unique up to unique isomorphism this shows again that our new definition coincides with the old.
\end{rmk}

\subsection{Hypercohomology Spectral Sequence}

(THINK ABOUT BOUNDEDNESS OF THESE COMPLEXES!!)

\begin{prop}
For an additive functor $F : \A \to \B$ and a complex $A \in D(\A)$ there are two spectral sequences,
\[ E^{p,q}_1 = R^q F(A^p) \implies \mathbb{R}^{p+q} F(A^\bullet) \]
and
\[ E^{p,q}_2 = R^p F(H^q(A^\bullet)) \implies \mathbb{R}^{p+q} F(A^\bullet) \]
computing the hypercohomology and thus computing $H^n(RF(A))$.
\end{prop}

\begin{proof}
Take Eilenberg-Cartan resultion et ( DO THIS!! LOOK AT ONE NOTE)
\end{proof}

\begin{corollary}
Let $F : \A \to \B$ and $G : \B \to \C$ be additive functors. Then for any complex $A \in \mathrm{Ch}^+(\A)$ there is a spectral sequence,
\[ E^{p,q}_2 = R^p G \circ \mathbb{R}^q F(A) \implies H^{p+q}((RG \circ RF)(A)) \]
\end{corollary}

\begin{proof}
Consider, $H^n(RG \circ RF(A)) = \mathbb{R}^n G(RF(A))$ so we apply the second spectral sequence to compute the hypercohomology,
\[ E^{p+q}_2 = R^p G(H^q(RF(A)) = R^p G(\mathbb{R}^qF(A)) \implies \mathbb{R} G^{p+q}(RF(A)) = H^{p+q}((RG \circ RF)(A)) \]
\end{proof}

\begin{lemma}
Let $F : \A \to \B$ and $G : \B \to \C$ be additive functors then there is a natural transformation $R G \circ RF \to R(G \circ F)$.
\end{lemma}

\begin{proof}
Follows immediately from the fact that $R(G \circ F)$ is a left Kan extension.
\end{proof}

\begin{lemma}
Let $F : \A \to \B$ and $G : \B \to \C$ be additive functors such that $F$ takes injectives to $G$-acyclics or more generally there are adapted classes $\mathcal{R}_\A$ and $\mathcal{R}_\B$ for $F$ and $G$ such that $F(\mathcal{R}_\A) \subset \mathcal{R}_\B$. Then the natural transformation $R G \circ R F \iso R(G \circ F)$ is an isomorphism.
\end{lemma}

\begin{proof}
This follows by definition since if $A \to I$ is a quasi-isomorphism with $I \in K(\mathcal{R}_\A)$ then $RF(A) = KF(A) \in K(\mathcal{R}_\B)$ so 
\[ RG(RF(A)) = RG(KF(A)) = KG(KF(A)) = K(G \circ F)(A) \]
because $KF(A)$ is already adapted to $G$ so there is no need for a quasi-isomorphic replacement.
\end{proof}

\begin{cor}
In the above situation, for any complex $A \in \mathrm{Ch}^+(\A)$ there is a spectral sequence,
\[ E^{p,q}_2 = R^p G \circ \mathbb{R}^q F(A) \implies \mathbb{R}^{p+q}(G \circ F)(A) \]
\end{cor}

\begin{rmk}
There are also spectral sequences computing $\mathbb{F}^q F(A)$ so we get a sort of double spectral sequence. (Can I make this precise?)
\end{rmk}

\begin{cor}
In the above situation, for any object $A \in \A$ there is a spectral sequence,
\[ E^{p,q}_2 = R^p G \circ R^q F(A) \implies R^{p+q}(G \circ F)(A) \]
\end{cor}

\begin{rmk}
(GIVE FULL EXPLICT PROOF OF GROTHENDIECK SPECTRAL SEQUENCE AND ALSO GIVE THE EXPLICIT WAY TO GET FROM HYPERCOHOMOLOGY SEQUENCE JUST USING F SENDING ADAPTED CLASSES TO ADAPTED CLASSES!! PAGE 11 OF https://anagrams-seminar.github.io/ss/intro.pdf)
\end{rmk}

\section{Reflective Subcategory}

\begin{defn}
A full subcategory $\A \subset \B$ is called \textit{reflective} (resp. \textit{coreflective}) if the inclusion has a left (resp. right) adjoint called the reflector.
\end{defn}

\begin{example}
On any site, $\mathrm{Sh}(\C) \subset \mathrm{PSh}(\C)$ is a reflective subcategory with sheafification.
\end{example}

\begin{example}
$\mathbf{Ab} \subset \mathbf{Grp}$ is a reflective subcategory with abelianization $G \mapsto G^\ab$ as its reflector.
\end{example}

\begin{example}
The category of fields is reflective inside the category of domains with $F \mapsto \Frac{F}$ as its reflector.
\end{example}

\begin{example}
The category of monoids inside the category of groups is coreflective with $M \mapsto M^\times$ as its reflector.
\end{example}

\begin{prop}
Suppose that $F : \A \to \B' \subset \B'$ and $G : \B \to \A' \subset \A$ form an adjoint pair $F \dashv G$ restricting to an equivalence on the full subcategories $\A' \subset \A$ and $\B' \subset \A$. Then $G \circ F : \A \to \A'$ and $G \circ F : \B \to \B'$ are respectively a reflector making $\A' \subset \A$ reflective and a coreflector making $\B' \subset \B$ coreflective. 
\end{prop}

\begin{proof}
It suffices to prove that $G \circ F \dashv \iota_{\A'}$ and $\iota_{\B'} \dashv F \circ G$ are adjoint pairs. Since $F : \A' \to \B'$ is fully faithful and $F$ and $G$ are inverses on $\A'$ and $\B'$,
\begin{align*}
\Hom{\A'}{GF(X)}{Y} & = \Hom{\B'}{FGF(X)}{F(Y)} = \Hom{\B'}{F(X)}{F(Y)} = \Hom{\B}{F(X)}{F(Y)} 
\\
& = \Hom{\A}{X}{GF(Y)} = \Hom{\A}{X}{\iota_{\A'}Y}
\end{align*}
Dually, 
\begin{align*}
\Hom{\B'}{X}{FG(Y)} & = \Hom{\A'}{G(X)}{GFG(Y)} = \Hom{\A'}{G(X)}{G(Y)} = \Hom{\A}{G(X)}{G(Y)}
\\
& = \Hom{\B}{FG(X)}{Y} = \Hom{\B}{\iota_{\B'} X}{Y}
\end{align*}
\end{proof}

\section{Torsors don't have two commuting actions}

On a group there are commuting left and right actions by left and right multiplication respectively. However, a $G$-torsor only gets one action. To have a well-defined right $G$-action on a torsor commuting with the defining left $G$-action we need to choose a basepoint (or a section if this is a $G$-bundle) as the ``identity'' and thus trivialize it. Let's see why. Recall that a torsor is a $G$-set meaning a set $X$ with a left $G$-action that is free and transitive. Choose a point $x_0 \in X$. We could try defining a right $G$-action via,
\[ (g \cdot x_0) \cdot h = gh \cdot x_0 \]
This clearly commutes with the left action and is actually well-defined because there is a unique $g$ such that $x = g \cdot x_0$ for each $x \in X$. However, suppose we puck a different basepoint $x_1 \in X$ and define,
\[ (g \cdot x_1) \cdot' h = gh \cdot x_1 \]
Then if $x_0 = r \cdot x_1$ we find that,
\[ (gr \cdot x_0) \cdot' h = ghr \cdot x_0 \]
while $(gr \cdot x_0) \cdot h = grh \cdot x_0$ and unless $G$ is commutative (in which case the whole business of commuting actions and right vs left actions becomes trivial) we cannot have $rh = hr$ for all $r,h \in G$ and thus the action must depend on the choice of basepoint.
\bigskip\\
In fact, the choice of a commuting transitive free right action determines a $Z(G)$-torsor inside $X$ so it pins down a choice of basepoint up to $Z(G)$-action. Indeed, consider the set, 
\[ S = \{ x \in X \mid \forall g \in G : g \cdot x = x \cdot g \} \] Clearly, if $X = G$ with the usual actions then $S = Z(G)$. In general, the left action of $Z(G)$ on $X$ sends $S \to S$ because if $g \in Z(G)$ then for any $h \in G$,
\[ h \cdot (g \cdot x) = hg \cdot x = gh \cdot x = g \cdot (h \cdot x) = g \cdot (x \cdot h) = (g \cdot x) \cdot h \]
(here is where we use commutativity of the left and right actions) so we simply need to show that $Z(G) \acts S$ is transitive. Let $x, y \in S$ then there is a unique $g \in G$ such that $y = g \cdot x$ and it suffices to show that $g \in Z(G)$. We know for any $h \in G$ that $h \cdot y = y \cdot h$ so,
\[ hg \cdot x = h \cdot y = y \cdot h = (g \cdot x) \cdot h = (x \cdot g) \cdot h = x \cdot gh = gh \cdot x \]
Since the action is free, $gh = hg$ and thus $g \in Z(G)$.
\bigskip\\
In particular, for a principal $G$-bundle $P \to X$, a globally defined commuting right fiberwise transitive $G$-action is equivalent to a choice of principal $Z(G)$-bundle $S \to X$ and an equivariant map $S \to P$ over $X$. For instance, this shows that $G$-bundles for $G$ simple cannot have globally defined commuting right $G$-action without be trivialized.
\bigskip\\
This lack of a right action precludes having a product structure on $G$-bundles. We would try $P_1 \otimes_G P_2 = (P_1 \times_X P_2)/G$ but this no longer has a well-defined $G$-action because we need both left and right commuting actions. This of course works when $G$ is abelian leading to a group structure on $H^1(X, G)$ when $G$ is abelian.


\section{Notes on the action $\pi_1(Y) \acts [X, Y]_* $}

The action is defined as follows. We say that $[\gamma] \cdot [f] = [g]$ if there is a homotopy (of unbased maps) from $f$ to $g$ such that $h_t(*)$ is the path $\gamma$. 
\bigskip\\
For the action $\pi_1(Y)$ on $\pi_n(Y) = [S^n, Y]_*$ we can describe this explicitly as ... GIVE.

\section{Some Questions}

\begin{enumerate}
\item In \chref{https://stacks.math.columbia.edu/tag/036Z}{Tag036Z} Johan tells me that the stack of $G$-torsors is equivalent to the stack of $\mathcal{G}$-torsors where $\mathcal{G} = G$ viewed as a sheaf (here $G$ can be an algebraic space). However, I thought that not every $\mathcal{G}$-torsor is representable unless $G$ is affine? Is the resolution of this problem that the stack of $G$-torsors is allowed to include torsors that are algebraic spaces even when $G$ is a scheme and that every $\mathcal{G}$-torsor is represented (i.e. is as a sheaf) as an algebraic space?

\item When in general are $\mathcal{G}$-torsors representable?

\item How to define twistor space slickly?

\item In the topological category, for a topological group $G$ and $\mathcal{G}$ is associated sheaf of continuous functions, is there a distinction between $G$-torsors and $\mathcal{G}$-torsors?

\item What is the topology of $\mathcal{M}_{1,1}$ and $\overline{\mathcal{M}}_{1,1}$. Are they the same as $\P^1 \setminus \{ 0,1,\infty \}$ and $\P^1$? Also how many isomorphism classes of stable $1$-pointed $g = 1$ curves are there that are not smooth. Is there only one?
\end{enumerate}

\section{Action of the Lorentz Group on Celestial Sphere}

Let $M = \mathbb{R}^{1,3}$ be Minkowski space. Then $G = \mathrm{SO}(1,3)$ acts on $M$ via isometries. Consider the light cone of the origin $L = V(t^2 - x^2 - y^2 - z^2) \subset M$. We know $G$ preserves $L$ and $\{ 0 \}$ is in its own orbit. Therefore, we can projectivize to get $C = \P(L) = (L \setminus \{ 0 \} ) / \mathbb{R}^\times$. Then $C \cong S^2$ is called the celestial sphere and there is a well-defined action $G \acts C$ because $G \acts L$ preserves scalar multiplication because $G \acts M$ linearly. 
\bigskip\\
Because $C$ is not constructed as a submanifold of $M$ there is not an obvious induced metric on $C$. The inclusion $L \subset M$ does give a metric on $L \setminus \{ 0 \}$ (we must remove the origin for it to be a smooth manifold). However, this metric does not descend to $C$. In general, for a principal $G$-bundle $\pi : P \to X$, a metric $g$ on $P$ descends iff $g$ is $G$-equivariant because if $g = \pi^* h$ then for any $\sigma \in G$ we must have $\sigma^* g = \sigma ^* \pi^* h = \pi^* h = g$. In our case, the scaling action clearly does not preserve the metric on $L$ (doubling the coordinates doubles tangent vectors as well) so this metric does not descend. Instead, a conformal class of metrics descends to $C$. Let's see why this is necessary. 
\bigskip\\
Instead of requiring that $g = \pi^* h$ we might ask for something a bit weaker. In our case there are actually sections $s : C \to L$ (cones are nicer than vector spaces in this way) then we could take the metric $s^* g$. However, this clearly depends on the section. Well just take a canonical one! You say pointing to the unit sphere at $t = 1$ as a pretty good canonical choice. However, the $G$ action on $M$ does not preserve this unit sphere in $L$ indeed it tilts the $t$-plane so our clean horizontal $t$ slice of $L$ becomes slanted giving a different section $s : C \to L$. 
\bigskip\\
Therefore, we define a conformal structure on $C$ as follows. $\pi : L^{> 0} \to C$ where $L^{>0} = L \cap \{ t > 0 \}$ is a $\mathbb{R}^+$-bundle and therefore multiplication is well-defined for sections of $L^{> 0}$ (and for $L^\times = L \setminus \{ 0 \}$ as a $\mathbb{R}^\times$-bundle but not addition because sections could add to zero where the singularity is). Therefore, define the principal $\mathbb{R}^+$-bundle $\mathcal{Q} \subset \mathrm{Sym}^2(TC)$ generated by $s^* g$ for any section $s : C \to L^{>0}$ notice that any two sections differ by a positive real function on $C$ because $\pi : L^{>0} \to C$ is a principal $\mathbb{R}^{+}$-bundles so $\mathcal{Q}$ is indeed a principal $\mathbb{R}^+$-bundle and thus defines a conformal structure. 
\bigskip\\
Finally, we examine the $G$-action. Unfortunately $G$ does not preserve $L^{>0}$ because it can reverse $t$. However, the connected subgroup $G^+ = \mathrm{SO}^+(1,3)$ does not reverse $t$ and preserves $L$ so thus preserves $L^{>0}$. Therefore $s \mapsto g \circ s$ is an action $G \acts \Gamma(C, L^{>0})$ and therefore the action of $G$ on $C$ preserves the bundle $\mathcal{Q}$ meaning that we get an action of $G^{+}$ on $C$ by conformal orientation-preserving transformations. Choosing the ``canonical'' section we see that $C$ is conformally equivalent to the round sphere and thus we get a map $G^{+} \to \mathrm{PSL}(2, \mathcal{C})$ is the M\"{o}bius group of orientation-preserving conformal transformation of $S^2$. Furthermore, this map is injective because the action of $G$ on $C$ determines its action on $L$ by scaling which determines the action on $M$ by linearity. Finally, we can show this map is an isomorphism by using the explicit form of M\"{o}bius transformations.
\end{document}

